

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:29,560I’m going to be playing at Borymark in Lawrenceville and I’ll set up a 200:00:29,559 –&gt; 00:00:36,359new information on Wednesday. So if you’re free, come down. So I’">
<meta property="og:type" content="article">
<meta property="og:title" content="CMU15445 P16F202315 ConcurrencyControlTheory">
<meta property="og:url" content="http://example.com/2025/10/24/CMU15445%20P16F202315-ConcurrencyControlTheory/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:29,560I’m going to be playing at Borymark in Lawrenceville and I’ll set up a 200:00:29,559 –&gt; 00:00:36,359new information on Wednesday. So if you’re free, come down. So I’">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-24T12:00:44.468Z">
<meta property="article:modified_time" content="2025-10-24T12:06:28.541Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>CMU15445 P16F202315 ConcurrencyControlTheory - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CMU15445 P16F202315 ConcurrencyControlTheory"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-24 20:00" pubdate>
          2025年10月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          53 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CMU15445 P16F202315 ConcurrencyControlTheory</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:29,560<br>I’m going to be playing at Borymark in Lawrenceville and I’ll set up a</p>
<p>2<br>00:00:29,559 –&gt; 00:00:36,359<br>new information on Wednesday. So if you’re free, come down. So I’ll be 11 to 1 at night.</p>
<p>3<br>00:00:36,359 –&gt; 00:00:43,879<br>Okay, and you said you have a bouncer that’s going to ignore the IDs or you have fake IDs that you’re</p>
<p>4<br>00:00:43,879 –&gt; 00:00:48,519<br>going to hand out on the side as a business. That all of that information I cannot say in this class.</p>
<p>5<br>00:00:48,519 –&gt; 00:00:53,480<br>Okay, please don’t do that. Please don’t do that. Okay, great. Excellent. And we’ll have a</p>
<p>6<br>00:00:53,479 –&gt; 00:00:58,919<br>trip report. Some of you guys make it to that. So all right, sorry about taking a little bit of</p>
<p>7<br>00:00:58,919 –&gt; 00:01:03,879<br>time to get started. I had a bunch of people at the office hours. But we’re going to talk about</p>
<p>8<br>00:01:04,599 –&gt; 00:01:11,239<br>Concurrency Control today. And let’s just jump right into it. All right, so let’s get into this.</p>
<p>9<br>00:01:11,879 –&gt; 00:01:17,560<br>You’ve seen this diagram of what a database engine looks like as a modular architecture for the</p>
<p>10<br>00:01:17,560 –&gt; 00:01:24,280<br>different components. We are going to talk today about Concurrency Control mechanisms that</p>
<p>11<br>00:01:24,280 –&gt; 00:01:28,920<br>hit across these different layers, which largely has the operator execution and the access method</p>
<p>12<br>00:01:28,920 –&gt; 00:01:33,640<br>layers. In two classes from now, we’ll talk about recovery methods, which is at the Buffipool</p>
<p>13<br>00:01:33,640 –&gt; 00:01:38,680<br>and disk manager layers. Now, all of this will become a lot more clear as we jump into what that</p>
<p>14<br>00:01:38,680 –&gt; 00:01:46,439<br>transaction management mean, what does recovery mean. So let’s go straight to that. So transaction</p>
<p>15<br>00:01:46,439 –&gt; 00:01:53,159<br>management allows us to do things safely in a database system in situations where multiple</p>
<p>16<br>00:01:53,159 –&gt; 00:02:00,920<br>things are getting updated out at the same time. Let’s start with a simple example. Here is a</p>
<p>17<br>00:02:01,799 –&gt; 00:02:07,319<br>schematic of database operations. These could be fired through a SQL query. From the perspective of</p>
<p>18<br>00:02:07,319 –&gt; 00:02:12,680<br>the transaction management component, we are largely going to look at the operations that happen</p>
<p>19<br>00:02:12,680 –&gt; 00:02:17,960<br>at the object level. So imagine we fired up a transaction and that ends up reading an object,</p>
<p>20<br>00:02:17,960 –&gt; 00:02:23,000<br>could be a record, could be a page, we’re just going to refer to them as objects here. In this class,</p>
<p>21<br>00:02:23,000 –&gt; 00:02:29,159<br>does some checking of that value, does some action like pay, and then updates that A by subtracting</p>
<p>22<br>00:02:29,159 –&gt; 00:02:35,800<br>25 from it and eventually writes that. For the purpose of the discussion for transaction management,</p>
<p>23<br>00:02:35,800 –&gt; 00:02:41,800<br>we are largely concerned with the read and write operations that happen with each of these database</p>
<p>24<br>00:02:42,600 –&gt; 00:02:47,400<br>you can think of them as records, pages, tables, what have you, it won’t matter, just</p>
<p>25<br>00:02:47,400 –&gt; 00:02:52,680<br>assume the reads and writes for objects that are in the database is what we care about. And we want</p>
<p>26<br>00:02:52,680 –&gt; 00:02:57,960<br>to have certain properties about these reads and write to ensure notions of correctness as we</p>
<p>27<br>00:02:57,960 –&gt; 00:03:02,920<br>will define it and that’s what transaction management does. So what could go wrong, right? This is a</p>
<p>28<br>00:03:02,920 –&gt; 00:03:09,640<br>simple set of actions that are presented to the database in response to a query that an application</p>
<p>29<br>00:03:09,719 –&gt; 00:03:15,399<br>might have sent and a couple things could go wrong. So here on the right side, you see the bank</p>
<p>30<br>00:03:15,399 –&gt; 00:03:22,119<br>balance starts out has a value of 100. The first thing that happens is does that check and</p>
<p>31<br>00:03:22,119 –&gt; 00:03:28,359<br>everything looks okay. It says yes, that check passes so there’s sufficient balance to pay $25. So</p>
<p>32<br>00:03:28,359 –&gt; 00:03:36,199<br>this is you going to an ATM asking for a withdrawal and pays you that $25 so you now have it and</p>
<p>33<br>00:03:36,199 –&gt; 00:03:41,079<br>the new balance is calculated and that balance now gets written to your bank account okay. So after</p>
<p>34<br>00:03:41,079 –&gt; 00:03:46,839<br>the new balance gets calculated that last action of bank balance of 75 is that write operation that</p>
<p>35<br>00:03:46,839 –&gt; 00:03:56,039<br>you see in that code on the left side. But now what if after the ATM machine spitted out the $25</p>
<p>36<br>00:03:57,719 –&gt; 00:04:02,759<br>you went and yanked that ATM machines power parts so that it could not send the right back okay,</p>
<p>37<br>00:04:02,759 –&gt; 00:04:09,799<br>imagine you were that fast or there’s a natural power failure. So the paying action and the</p>
<p>38<br>00:04:09,799 –&gt; 00:04:13,799<br>right to the databases not atomic right they’re happening in different systems they might even be</p>
<p>39<br>00:04:13,799 –&gt; 00:04:19,879<br>geographically spread across and that things could happen in between those actions. So how do we</p>
<p>40<br>00:04:19,879 –&gt; 00:04:24,519<br>make sure that this transaction is correct? Obviously we don’t want that here bank would be very upset</p>
<p>41<br>00:04:24,519 –&gt; 00:04:29,879<br>if that’s how database systems work because they would be losing money if this happens. So we want</p>
<p>42<br>00:04:29,879 –&gt; 00:04:34,759<br>this type of stuff to be protected and we’ll talk about how. Here’s another scenario a different</p>
<p>43<br>00:04:34,759 –&gt; 00:04:39,800<br>scenario showing a different type of problems that we also need to worry about. So this is not a</p>
<p>44<br>00:04:39,800 –&gt; 00:04:45,879<br>power failure or things of that sort but concurrent actions. So imagine you and your significant other</p>
<p>45<br>00:04:45,879 –&gt; 00:04:51,159<br>both share this bank account and you have individual debit cards that allow you to debit from that same</p>
<p>46<br>00:04:51,159 –&gt; 00:04:58,040<br>bank account and you both go to two separate ATM simultaneously run this transaction so both of</p>
<p>47<br>00:04:58,040 –&gt; 00:05:05,640<br>you are running these sequence of actions to withdraw $25 and sufficient balance is checked on</p>
<p>48<br>00:05:05,640 –&gt; 00:05:12,920<br>both sides you get paid ATM spits out $25 your significant other gets paid but now because both of</p>
<p>49<br>00:05:12,920 –&gt; 00:05:18,759<br>them read the original bank balance both of them have calculated the new balance as being 75 right</p>
<p>50<br>00:05:18,759 –&gt; 00:05:25,240<br>because everything looks correct and then the first one writes the second one over writes that</p>
<p>51<br>00:05:25,319 –&gt; 00:05:31,720<br>and now the bank is short $25 again this is not a ideal situation for the banks banks would never</p>
<p>52<br>00:05:31,720 –&gt; 00:05:36,360<br>use database systems or enterprises wouldn’t use database systems if these types of things are allowed</p>
<p>53<br>00:05:36,360 –&gt; 00:05:43,639<br>to happen. So semantically what we wanted is that we wanted the database application was sending</p>
<p>54<br>00:05:43,639 –&gt; 00:05:48,519<br>this read and write request right that was written by some application code that is firing up the</p>
<p>55<br>00:05:48,519 –&gt; 00:05:53,879<br>SQL queries to the database system and now to no fault of the application code writer right that’s</p>
<p>56<br>00:05:53,879 –&gt; 00:05:58,680<br>what the application code writer is doing effectively writing the code that ends up sending those read</p>
<p>57<br>00:05:58,680 –&gt; 00:06:03,480<br>write operations to the database it feels the database system is just corrupting the data so that’s</p>
<p>58<br>00:06:03,480 –&gt; 00:06:08,839<br>obviously not what we want of a database system we wanted to be well behaved we want the final</p>
<p>59<br>00:06:08,839 –&gt; 00:06:16,519<br>balance in this case to be $50 okay so how do we deal with these bad system systems behavior</p>
<p>60<br>00:06:17,399 –&gt; 00:06:22,199<br>and have the database be coherent because ultimately the database is the keeper of the record</p>
<p>61<br>00:06:22,199 –&gt; 00:06:27,479<br>sets the master copy of what you have in the bank account and it has to be consistent in spite of</p>
<p>62<br>00:06:27,479 –&gt; 00:06:33,079<br>all these different failure scenarios. So one system way assuming that you don’t have power failure</p>
<p>63<br>00:06:33,079 –&gt; 00:06:38,360<br>is to say okay the second type of option that I had where congruent actions were corrupting each other</p>
<p>64<br>00:06:39,159 –&gt; 00:06:44,279<br>is to say I’m going to have a very simple database system even if two people requested the queries</p>
<p>65<br>00:06:44,279 –&gt; 00:06:49,159<br>at the same time I will only run the one query at a time I’m going to queue everything up all the</p>
<p>66<br>00:06:49,160 –&gt; 00:06:56,439<br>requests I get I will run one query at a time and I can get a sensible correct behavior for the</p>
<p>67<br>00:06:56,439 –&gt; 00:07:01,480<br>scenario we just talked about I can also start to do things like before transaction starts I can make</p>
<p>68<br>00:07:01,480 –&gt; 00:07:07,640<br>a copy of the entire database make all the changes there and if the transaction complete successfully</p>
<p>69<br>00:07:07,640 –&gt; 00:07:12,440<br>so didn’t have a power failure all of that other kinds of stuff I will override it with a new copy</p>
<p>70<br>00:07:13,080 –&gt; 00:07:18,040<br>both of these are really bad from they will give you some form of correctness but they’re really bad</p>
<p>71<br>00:07:18,040 –&gt; 00:07:26,040<br>from a performance perspective because it would be a very very slow database system and you won’t</p>
<p>72<br>00:07:26,040 –&gt; 00:07:30,439<br>be able to quite use that right today when you go to amazon and you’re checking out your shopping</p>
<p>73<br>00:07:30,439 –&gt; 00:07:35,640<br>card you know ultimately something’s going and issuing database transaction records to debit from</p>
<p>74<br>00:07:35,640 –&gt; 00:07:40,920<br>your to add to your shopping card eventually another transaction gets there sent to your credit card</p>
<p>75<br>00:07:40,920 –&gt; 00:07:45,560<br>account to record that that amount needs to be depended and all of that works correctly even if</p>
<p>76<br>00:07:45,560 –&gt; 00:07:50,600<br>multiple people multiple account holders on the same credit card are doing the transactions at</p>
<p>77<br>00:07:50,600 –&gt; 00:07:55,079<br>the same time multiple shopping cards are getting created so we really want to be able to do this at</p>
<p>78<br>00:07:55,079 –&gt; 00:08:00,040<br>scale we don’t want to do one transaction at a time you want to be doing thousands tens of thousands</p>
<p>79<br>00:08:00,040 –&gt; 00:08:04,439<br>if not millions of billions of transactions at a time okay so how do we do that that’s a really</p>
<p>80<br>00:08:04,439 –&gt; 00:08:10,040<br>hard problem okay we want better utilization for the database hardware we want higher throughput</p>
<p>81<br>00:08:10,040 –&gt; 00:08:15,160<br>better response times and of course we wanted to be correct so that the right thing happens and</p>
<p>82<br>00:08:15,160 –&gt; 00:08:21,240<br>we’ll define what that notion of correctness is and in many cases you also wanted to be fair so if</p>
<p>83<br>00:08:21,240 –&gt; 00:08:25,800<br>multiple transactions come at the same time you want all of them to be given that equal chance to</p>
<p>84<br>00:08:25,800 –&gt; 00:08:30,680<br>complete and not just say I’m going to hold two of you in the back forever and just let the other</p>
<p>85<br>00:08:30,680 –&gt; 00:08:36,680<br>others go forward right that’s not fair you want to have some notion of fairness okay and some</p>
<p>86<br>00:08:36,680 –&gt; 00:08:40,360<br>systems may not have that sometimes you have priorities where you say I want high priorities</p>
<p>87<br>00:08:40,360 –&gt; 00:08:44,600<br>for transactions to go through but assuming you want fairness you at least one the capability of having</p>
<p>88<br>00:08:44,600 –&gt; 00:08:49,000<br>fairness how you balance that in terms of partitioning your workload to let higher priority</p>
<p>89<br>00:08:49,000 –&gt; 00:08:54,920<br>stuff go is a different issue right but you do want the mechanism of fairness to be built into the</p>
<p>90<br>00:08:54,920 –&gt; 00:09:06,680<br>database system okay questions so far in terms of what we are trying to achieve yep we will try to</p>
<p>91<br>00:09:06,680 –&gt; 00:09:12,120<br>we will solve all the issues except the power failure ratio and the power failure issue will be</p>
<p>92<br>00:09:12,120 –&gt; 00:09:17,480<br>solved in you we get to all of that solution later on where the power there’s a very subtle issue</p>
<p>93<br>00:09:17,480 –&gt; 00:09:21,799<br>in the power failure stuff which is with all the stuff we’ll talk about in the next few lectures we</p>
<p>94<br>00:09:21,799 –&gt; 00:09:28,120<br>can make sure that the database record ends up in the right state but if the bank has paid you $25</p>
<p>95<br>00:09:28,120 –&gt; 00:09:34,200<br>and there’s a power failure there’s extra action that is needed because that $25 has been a</p>
<p>96<br>00:09:34,200 –&gt; 00:09:40,200<br>physical action everything else is a digital action and to undo that action of paying you $25</p>
<p>97<br>00:09:40,200 –&gt; 00:09:44,840<br>when they should not have paid the bank would have to then do a separate transaction and physical</p>
<p>98<br>00:09:44,840 –&gt; 00:09:48,840<br>space where they’ll send you a letter saying whoops we accidentally paid you $25 but here’s</p>
<p>99<br>00:09:48,840 –&gt; 00:09:53,879<br>what’s what your bank account is right so there are other ways to do that we won’t we will be able to</p>
<p>100<br>00:09:53,879 –&gt; 00:09:59,480<br>undo all the reads and writes if we don’t want them to happen but you know if the transaction is</p>
<p>101<br>00:09:59,480 –&gt; 00:10:04,520<br>paid $25 there’s a physical action you can’t undo it you’ll undo that by doing other physical actions</p>
<p>102<br>00:10:04,520 –&gt; 00:10:08,680<br>in the physical work okay similarly if there’s a transaction that fired a missile you can’t undo</p>
<p>103<br>00:10:08,679 –&gt; 00:10:12,519<br>that missile you can’t bring that missile back you have to send an apology letter or something else</p>
<p>104<br>00:10:12,519 –&gt; 00:10:19,959<br>like that right so or something really bad so it’s like the undo for physical actions in transactions</p>
<p>105<br>00:10:19,959 –&gt; 00:10:25,159<br>will require undo in the physical world which we won’t cover and there are mechanisms to do that</p>
<p>106<br>00:10:25,159 –&gt; 00:10:29,799<br>that are business related actions you’ll sometimes get a letter from your company saying whoops we made</p>
<p>107<br>00:10:29,799 –&gt; 00:10:34,599<br>a mistake sorry about that here’s what really happened oh and by the way he’s a $10 gift card</p>
<p>108<br>00:10:34,680 –&gt; 00:10:40,360<br>to make up for a mistake but all the digital actions the reads and writes we will cast them into a</p>
<p>109<br>00:10:40,360 –&gt; 00:10:46,519<br>very strict structure to guarantee very well to find properties of correctness that we will hold</p>
<p>110<br>00:10:46,519 –&gt; 00:10:51,320<br>to the mechanisms we’ll talk about today and going into the next few lectures okay great question</p>
<p>111<br>00:10:52,840 –&gt; 00:11:03,160<br>other questions all right so we want these arbitrary interleaving of operations and be correct</p>
<p>112<br>00:11:03,719 –&gt; 00:11:08,839<br>so before we go a little bit further just want to solidify the notion of transactions</p>
<p>113<br>00:11:08,839 –&gt; 00:11:14,600<br>we’re going to carry out these operations and the database as we just talked about is only concerned</p>
<p>114<br>00:11:14,600 –&gt; 00:11:19,399<br>about the read and write operations to the database objects right these physical world actions</p>
<p>115<br>00:11:19,399 –&gt; 00:11:26,679<br>of paying an amount or you know starting this is fighting for missiles stuff like that those</p>
<p>116<br>00:11:27,319 –&gt; 00:11:34,359<br>we won’t be able to repair if bad things happen okay and there’s a in the advanced database class</p>
<p>117<br>00:11:34,359 –&gt; 00:11:37,879<br>depending upon the material that’s there’s sometimes we’ll talk about stuff like that and what are</p>
<p>118<br>00:11:37,879 –&gt; 00:11:43,159<br>compensating transactions and stuff like that that might happen and what people might do as other ways</p>
<p>119<br>00:11:43,159 –&gt; 00:11:48,759<br>so but for the purpose of this class we’ll just look at in this in this many ways of more limited scope</p>
<p>120<br>00:11:49,799 –&gt; 00:11:55,240<br>reiterating what we talked about we’ll think primarily about read and write operations you notice</p>
<p>121<br>00:11:55,240 –&gt; 00:11:59,159<br>that in the code that I had there was also a check there was a subtraction there was math and</p>
<p>122<br>00:11:59,159 –&gt; 00:12:03,720<br>stuff like that from the perspective of what we want to cover today for transaction management</p>
<p>123<br>00:12:03,720 –&gt; 00:12:09,000<br>all we care about is didn’t object get written did it get read and do those reads and writes end up</p>
<p>124<br>00:12:09,000 –&gt; 00:12:13,560<br>interfering with each other in bad ways what are those bad ways and how do we prevent those bad ways</p>
<p>125<br>00:12:14,680 –&gt; 00:12:21,240<br>okay and how do we prevent those bad ways while allowing the maximum number of transactions to work</p>
<p>126<br>00:12:21,240 –&gt; 00:12:25,799<br>on the system concurrently that’s the hard part right because you already saw there’s an easy way</p>
<p>127<br>00:12:25,799 –&gt; 00:12:31,000<br>which is to just to one transaction at a time if you want to do better than that all right so it’s only</p>
<p>128<br>00:12:31,000 –&gt; 00:12:36,600<br>these objects which will just refer to as variables a b and c but if you want to have a simple model</p>
<p>129<br>00:12:36,600 –&gt; 00:12:41,480<br>you can think of it as a record but inside a database system in this we cover in the advanced</p>
<p>130<br>00:12:41,480 –&gt; 00:12:47,480<br>database class that a could be a column which is doing things at a final level of granularity</p>
<p>131<br>00:12:47,480 –&gt; 00:12:52,840<br>all could be a page all could be a file all could be a database some early versions of databases</p>
<p>132<br>00:12:53,560 –&gt; 00:12:59,159<br>like Mongo at one point to do concurrency would lock the entire database they don’t do that now</p>
<p>133<br>00:12:59,159 –&gt; 00:13:07,080<br>but the the the the size of that object or the a b’s and c just refer to database objects right</p>
<p>134<br>00:13:07,080 –&gt; 00:13:11,800<br>for the purpose of today you can think about them as records and everything today and the next two</p>
<p>135<br>00:13:11,799 –&gt; 00:13:17,639<br>classes will make a lot more sense if you wanted to pick a mental model for that okay all right</p>
<p>136<br>00:13:19,719 –&gt; 00:13:25,240<br>how does the database system know that a transaction has started and transaction has ended in</p>
<p>137<br>00:13:25,240 –&gt; 00:13:30,120<br>SQL you can explicitly put a begin transaction statement and an end transaction statement to tell</p>
<p>138<br>00:13:30,120 –&gt; 00:13:35,079<br>the database system all the stuff that happened in between is a transaction and in between could be</p>
<p>139<br>00:13:35,079 –&gt; 00:13:40,919<br>multiple SQL queries if you don’t have a begin an transaction like all the stuff you’ve been doing</p>
<p>140<br>00:13:40,919 –&gt; 00:13:45,479<br>in your homework when you fire up a SQL query implicitly the database system will put a begin</p>
<p>141<br>00:13:45,479 –&gt; 00:13:49,719<br>at the beginning of the query and an end at the end of the query but a transaction could be multi</p>
<p>142<br>00:13:49,719 –&gt; 00:13:55,079<br>queries right you can explicitly put begin and end you could also put an explicit abort statement</p>
<p>143<br>00:13:55,079 –&gt; 00:14:00,199<br>which is to say so and instead of end it is called a commit which is to say everything I’ve done</p>
<p>144<br>00:14:00,199 –&gt; 00:14:05,879<br>from the begin to here please commit it and make its changes permanent the other way to end that</p>
<p>145<br>00:14:05,879 –&gt; 00:14:11,639<br>transaction is to say abort so it may be I’m trying to make vacation plans so I do a transaction</p>
<p>146<br>00:14:11,639 –&gt; 00:14:16,759<br>to book flight tickets then I do a little bit of search in the code to find hotel reservations and</p>
<p>147<br>00:14:16,759 –&gt; 00:14:21,960<br>find whoops don’t have a hotel so I could say oh abort this transaction then abort says I did some</p>
<p>148<br>00:14:21,960 –&gt; 00:14:27,240<br>work reads and writes but I don’t think I can go further something doesn’t look right about this</p>
<p>149<br>00:14:27,240 –&gt; 00:14:31,399<br>transaction and you could the application could be trying again which you could explicitly</p>
<p>150<br>00:14:31,399 –&gt; 00:14:36,279<br>abort the transaction and sometimes it may be that the database aborts for you because multiple</p>
<p>151<br>00:14:36,279 –&gt; 00:14:41,159<br>transactions are happening at the same time it detects some unsafe condition and says whoops I’m</p>
<p>152<br>00:14:41,159 –&gt; 00:14:46,600<br>going to abort this transaction for you and you get an abort code from the transaction manager’s</p>
<p>153<br>00:14:46,600 –&gt; 00:14:52,039<br>perspective the module that we are trying to understand and build today it will be presented with</p>
<p>154<br>00:14:52,039 –&gt; 00:14:57,559<br>a begin transaction bunch of read write actions and eventually it will get a commit or an abort</p>
<p>155<br>00:14:58,199 –&gt; 00:15:05,000<br>action and that’s what we have to build in the system code to do transactions right so transactions</p>
<p>156<br>00:15:05,000 –&gt; 00:15:09,319<br>could end by committing or they could end by aborting a botting means undo everything that might</p>
<p>157<br>00:15:09,319 –&gt; 00:15:15,559<br>be done commit says everything I did make it permanent okay so they can end in those two ways</p>
<p>158<br>00:15:16,279 –&gt; 00:15:20,759<br>and the abort could be self-inflicted as we talked about application could have explicitly put</p>
<p>159<br>00:15:20,759 –&gt; 00:15:25,879<br>in a bot call or it could be that the database system has to abort for some reason to do all the</p>
<p>160<br>00:15:25,879 –&gt; 00:15:30,519<br>safety guarantee that we talked about and we’ll look at different ways in which a bot happens inside</p>
<p>161<br>00:15:30,519 –&gt; 00:15:37,799<br>a database system over the next couple lectures okay many of you might have heard of this thing called</p>
<p>162<br>00:15:37,799 –&gt; 00:15:45,080<br>acid it’s a cool acronym that was that the community came up with the couple guys who came up with</p>
<p>163<br>00:15:47,480 –&gt; 00:15:53,720<br>to say what are the properties we want of these transactions okay and the properties are</p>
<p>164<br>00:15:53,720 –&gt; 00:15:59,960<br>atomicity consistency isolation and durability so let’s go through each one of those</p>
<p>165<br>00:16:00,519 –&gt; 00:16:08,519<br>atomicity says I have a transaction that did a whole bunch of read writes and when I say commit</p>
<p>166<br>00:16:08,519 –&gt; 00:16:13,399<br>everything should have committed to the database or if I say abort nothing should have happened so</p>
<p>167<br>00:16:13,399 –&gt; 00:16:17,800<br>it’s like I want this all or nothing property of this transaction even though lots of reason</p>
<p>168<br>00:16:17,800 –&gt; 00:16:22,920<br>rights might have happened in this in this transaction right it should feel like it’s a</p>
<p>169<br>00:16:22,919 –&gt; 00:16:29,719<br>atomic right so it’s very much like what you see with atomic instructions in in processors but now</p>
<p>170<br>00:16:29,719 –&gt; 00:16:35,000<br>this is for multiple reads and writes those reads and writes may be spilling data to disk so it’s a much</p>
<p>171<br>00:16:35,000 –&gt; 00:16:42,599<br>higher granularity right so much harder problem consistency says consistency is a little weird one</p>
<p>172<br>00:16:42,599 –&gt; 00:16:48,039<br>and I’m actually going to go to that last let me go to isolation and I come back to consistency</p>
<p>173<br>00:16:48,039 –&gt; 00:16:53,559<br>isolation says if two transactions like we have those two debit transactions happening</p>
<p>174<br>00:16:53,559 –&gt; 00:16:59,480<br>we draw a lot of $25 from the bank account for you and your significant other we want those to</p>
<p>175<br>00:16:59,480 –&gt; 00:17:04,039<br>not interfere with each other it should feel like each transaction happened by itself so even though</p>
<p>176<br>00:17:04,039 –&gt; 00:17:09,079<br>we don’t want to run one transaction at a time we want the illusion of the system running one</p>
<p>177<br>00:17:09,079 –&gt; 00:17:13,720<br>transaction at a time it should feel like when my transaction ran I had the whole system to myself</p>
<p>178<br>00:17:14,200 –&gt; 00:17:20,039<br>and nothing else interfered with me okay is that make sense so it’s like I should feel no one</p>
<p>179<br>00:17:20,039 –&gt; 00:17:27,319<br>interfered with my work durability says that if the database comes back to me and says I’ve committed</p>
<p>180<br>00:17:27,319 –&gt; 00:17:35,160<br>your transaction after that even if there’s some failure the disk fails or the memory fails I should</p>
<p>181<br>00:17:35,160 –&gt; 00:17:44,360<br>be able to recover that state of the database with all the commit information in that so if I</p>
<p>182<br>00:17:44,360 –&gt; 00:17:50,120<br>had changed the final value of that bank account to 75 the database said I’ve committed your transaction</p>
<p>183<br>00:17:50,120 –&gt; 00:17:55,640<br>right that commit call came back with the green signal and then there’s a power failure when I</p>
<p>184<br>00:17:55,640 –&gt; 00:18:02,040<br>bring back the machine I should see 75 in there not 100 which was the value it started with okay</p>
<p>185<br>00:18:02,920 –&gt; 00:18:08,039<br>now going back to consistency and I’ll wait it for that because I’ll just put a little labels around</p>
<p>186<br>00:18:08,039 –&gt; 00:18:14,680<br>how we go about doing things like that consistency is this weird thing that says if the database starts</p>
<p>187<br>00:18:14,680 –&gt; 00:18:22,359<br>consistent as per some definition then it should end in that same consistent state now that</p>
<p>188<br>00:18:22,359 –&gt; 00:18:28,680<br>also seems vague right so what does it mean that the database started consistent in SQL there are</p>
<p>189<br>00:18:28,680 –&gt; 00:18:33,400<br>things like you can define a primary key for in key right you’ve already done that SQL also has</p>
<p>190<br>00:18:33,400 –&gt; 00:18:40,440<br>these things called constraints where you can say at all and things called checks so check might say</p>
<p>191<br>00:18:40,440 –&gt; 00:18:45,960<br>the price I’ve got a price field in the table and that price should never be greater than 100</p>
<p>192<br>00:18:47,400 –&gt; 00:18:51,880<br>okay and the databases required whenever any updates happen to the database system to make sure</p>
<p>193<br>00:18:51,880 –&gt; 00:18:59,400<br>those things hold true so consistently really says if the application has specified in the SQL</p>
<p>194<br>00:18:59,400 –&gt; 00:19:07,800<br>DDL all the things that they want the database to hold correct then the database transaction shouldn’t</p>
<p>195<br>00:19:07,800 –&gt; 00:19:13,240<br>mess that up and the main ways in which that happens is by checks primary keys and you can also define</p>
<p>196<br>00:19:14,920 –&gt; 00:19:20,920<br>checks outside tables and other ways of defining constraints and you really want all of that to hold</p>
<p>197<br>00:19:21,480 –&gt; 00:19:28,200<br>okay so it’s sort of weird but it says if the application has defined the structure of the database</p>
<p>198<br>00:19:28,200 –&gt; 00:19:33,160<br>correctly using everything that SQL allows with these checks the transaction management</p>
<p>199<br>00:19:33,880 –&gt; 00:19:39,000<br>everything that we do here shouldn’t mess that up if I said a plus b must always equal to 100</p>
<p>200<br>00:19:39,000 –&gt; 00:19:45,720<br>and someone modified a and modified b in the appropriate way so that it is still equal to 100</p>
<p>201<br>00:19:46,279 –&gt; 00:19:51,720<br>in a single transaction the transaction shouldn’t violate anything and change that constraint so</p>
<p>202<br>00:19:51,720 –&gt; 00:19:56,440<br>it should maintain that correctness okay and we’ll come back to it it sounds a little vague but</p>
<p>203<br>00:19:57,079 –&gt; 00:20:01,880<br>in many ways that C was fitted into that acid definition because the real key things that the database</p>
<p>204<br>00:20:01,880 –&gt; 00:20:08,039<br>done is AID but if the acronym was AID then it didn’t sound as good as acid and this was done when</p>
<p>205<br>00:20:08,039 –&gt; 00:20:13,400<br>hippies were ruling the Bay Area and Europe and they wanted acid everywhere so that’s the</p>
<p>206<br>00:20:13,400 –&gt; 00:20:20,200<br>uh uh uh uh that’s my understanding of how C was plugged in we’ll talk about different mechanisms</p>
<p>207<br>00:20:20,200 –&gt; 00:20:26,120<br>and those are what you see in those blue bubble atomicity and durability will require this mechanism</p>
<p>208<br>00:20:26,120 –&gt; 00:20:31,160<br>to redo and undo stuff oh I’ve changed A and I’ve pushed it out to disk I’ve pushed it out from</p>
<p>209<br>00:20:31,160 –&gt; 00:20:38,200<br>my buffer pool to disk oh but I need to abort that transaction uh so how do I undo that oh I committed</p>
<p>210<br>00:20:38,200 –&gt; 00:20:42,680<br>a transaction with a new value of A but it’s still sending my buffer pool it didn’t make it to disk</p>
<p>211<br>00:20:42,680 –&gt; 00:20:48,680<br>I need to redo the disk copy so the redo and undo mechanisms is what the A and D provides we’ll use</p>
<p>212<br>00:20:48,680 –&gt; 00:20:54,519<br>things that we’ll see today and in the next lecture that cover that as I said consistency is provided</p>
<p>213<br>00:20:54,519 –&gt; 00:20:59,799<br>by making sure there are integrity constraints defined in a SQL DDL and the transaction management</p>
<p>214<br>00:20:59,799 –&gt; 00:21:04,920<br>system shouldn’t violate that isolation is done by something called concurrency control which we</p>
<p>215<br>00:21:04,920 –&gt; 00:21:09,400<br>which we will also look at right and locking another mechanisms will come into play there so we’re</p>
<p>216<br>00:21:09,400 –&gt; 00:21:15,080<br>going to dig into each one of these so let’s get started all right so that’s our agenda dive into</p>
<p>217<br>00:21:15,080 –&gt; 00:21:23,400<br>each of these four components so atomicity of transactions uh there are uh two possible outcomes</p>
<p>218<br>00:21:23,400 –&gt; 00:21:28,600<br>for executing a transaction it either commits or it aborts right and aborts could be explicitly</p>
<p>219<br>00:21:29,320 –&gt; 00:21:34,519<br>triggered by the application or it could be something where the database says something’s unsafe</p>
<p>220<br>00:21:34,519 –&gt; 00:21:39,480<br>I need to abort you okay and then that transaction could restart and reissue that SQL statement</p>
<p>221<br>00:21:40,200 –&gt; 00:21:45,559<br>and the DBMS needs to provide this all on nothing slash atomic property of these transactions</p>
<p>222<br>00:21:46,920 –&gt; 00:21:50,519<br>so let’s make it a little bit more concrete we’ve been playing around with examples so we’ll look</p>
<p>223<br>00:21:50,519 –&gt; 00:21:55,639<br>at a couple scenarios as we dig into this we take hundred dollars out of an account uh but the</p>
<p>224<br>00:21:55,639 –&gt; 00:22:01,960<br>database system aborts the transaction before we transfer it right so we want to make sure uh uh uh</p>
<p>225<br>00:22:01,960 –&gt; 00:22:06,600<br>that that is reflected correctly scenario two is we take hundred dollars out of an account but then</p>
<p>226<br>00:22:06,600 –&gt; 00:22:10,519<br>there’s a power failure before we transfer that we’ve kind of seen both of these transactions but</p>
<p>227<br>00:22:10,519 –&gt; 00:22:15,319<br>just giving you more examples of what that should be and you know we have determined what’s the</p>
<p>228<br>00:22:15,319 –&gt; 00:22:21,880<br>correct state of the account after both these uh transaction aborts so how can we do some of this</p>
<p>229<br>00:22:21,880 –&gt; 00:22:28,440<br>stuff uh the atomicity part can be done in one of two ways logging and shadowing one way is to</p>
<p>230<br>00:22:28,440 –&gt; 00:22:34,759<br>log everything that we do so if I’m recording all my actions the minute I change a value</p>
<p>231<br>00:22:35,320 –&gt; 00:22:40,519<br>from hundred to seventy five I can record that my value was hundred I change it to seventy five</p>
<p>232<br>00:22:40,519 –&gt; 00:22:46,279<br>before value was hundred after value is seventy five now I can take those logs and I can maintain</p>
<p>233<br>00:22:46,279 –&gt; 00:22:53,400<br>those log records and I can store those log records in memory and then appropriate points move it</p>
<p>234<br>00:22:53,400 –&gt; 00:22:58,680<br>out to disk once it moves into disk I know it is going to be there it will survive that power failure</p>
<p>235<br>00:22:59,240 –&gt; 00:23:03,720<br>if I don’t think I can trust a single disk to hold that log many times people will use disk</p>
<p>236<br>00:23:03,720 –&gt; 00:23:08,040<br>mirroring remember we talked about disk mirroring a couple lectures ago so that there are two discs</p>
<p>237<br>00:23:08,040 –&gt; 00:23:13,880<br>that will have a copy of that same file I write but it’s actually being written in twice in two places</p>
<p>238<br>00:23:13,880 –&gt; 00:23:18,600<br>so that if one fails I still have that other copy that if both fail you’d have to make a third copy</p>
<p>239<br>00:23:18,679 –&gt; 00:23:24,279<br>and so on so you have to decide what failure you can tolerate but once a log hits the disk you kind</p>
<p>240<br>00:23:24,279 –&gt; 00:23:29,319<br>of know you can recover from that and reconstruct the state of the database and we’ll talk about</p>
<p>241<br>00:23:29,319 –&gt; 00:23:35,399<br>the protocol Aries as we uh in two lectures from now how we go at make that happen but logging is</p>
<p>242<br>00:23:35,399 –&gt; 00:23:41,319<br>the mechanism that most database systems will use to go and record the changes that are happening</p>
<p>243<br>00:23:42,199 –&gt; 00:23:48,439<br>okay all right does that make sense questions yeah uh how does it relate</p>
<p>244<br>00:23:48,839 –&gt; 00:23:55,399<br>to like sorry like at the storage level sorry sorry great is this sort of no no don’t confuse</p>
<p>245<br>00:23:55,399 –&gt; 00:23:59,159<br>this with log structured file system is that what you are thinking it will look like that</p>
<p>246<br>00:23:59,159 –&gt; 00:24:06,279<br>but it’s different so a lot of this originated in the 70s and 80s it’s a file of records but the</p>
<p>247<br>00:24:06,279 –&gt; 00:24:11,799<br>records are going to be variable length and the structure will have a certain set of common fields</p>
<p>248<br>00:24:12,599 –&gt; 00:24:20,119<br>but think of it as a file with a bunch of variable with some fixed length components and a whole bunch</p>
<p>249<br>00:24:20,119 –&gt; 00:24:25,000<br>of variable it’s sitting in a file that will often be called the log file and it’s basically</p>
<p>250<br>00:24:25,000 –&gt; 00:24:29,319<br>going to be written sequentially from first to the end and it’ll be it’ll have its own buffer</p>
<p>251<br>00:24:29,319 –&gt; 00:24:34,839<br>management so it’ll the recent pages will be in the buffer pool at certain points we will have to</p>
<p>252<br>00:24:34,839 –&gt; 00:24:41,079<br>tell that the buffer pool to say I cannot commit this transaction till this page you have here in</p>
<p>253<br>00:24:41,079 –&gt; 00:24:47,079<br>memory that needs to hit to disk before I can commit this transaction so we might hold the</p>
<p>254<br>00:24:47,079 –&gt; 00:24:51,960<br>transactions commit we won’t return it till we have but you can think of it as a file of records</p>
<p>255<br>00:24:52,679 –&gt; 00:25:04,759<br>just like a regular file which got its special structure in schema yeah so the question is if I</p>
<p>256<br>00:25:04,759 –&gt; 00:25:10,759<br>have a log structured file system do I need logging a log structured file system just works for that</p>
<p>257<br>00:25:10,759 –&gt; 00:25:15,240<br>file so in a database system I may have a hundred tables a transaction we have updated in five different</p>
<p>258<br>00:25:15,240 –&gt; 00:25:20,920<br>places I need a global log logging mechanism to deal with that so traditionally what will be done I</p>
<p>259<br>00:25:20,920 –&gt; 00:25:26,279<br>have a log file which is going to keep these changes for all the changes that are happening across</p>
<p>260<br>00:25:26,279 –&gt; 00:25:31,000<br>not just for a single file so log structured file system does make sense they have similar elements</p>
<p>261<br>00:25:31,000 –&gt; 00:25:36,200<br>to the types of mechanisms that you’re trying to do redo and undo type of things but they are on a</p>
<p>262<br>00:25:36,200 –&gt; 00:25:40,359<br>poor file basis they may not be the right structure for it they don’t necessarily have all the buffer</p>
<p>263<br>00:25:40,359 –&gt; 00:25:44,359<br>stuff so it’s good for certain applications in file system but for database systems we’re going to</p>
<p>264<br>00:25:44,359 –&gt; 00:25:50,759<br>need something different and we need it across different files right you might prove no operations too</p>
<p>265<br>00:25:50,759 –&gt; 00:25:54,599<br>so we’ll talk about all of that as we go into details but that’s a good point why am I you know</p>
<p>266<br>00:25:54,599 –&gt; 00:25:59,319<br>why do the operating systems guys talk about log structured file systems they’re very similar elements</p>
<p>267<br>00:25:59,319 –&gt; 00:26:06,119<br>to that can we use that we we need to worry about transactions that update records across multiple</p>
<p>268<br>00:26:06,119 –&gt; 00:26:10,359<br>different tables which may be in multiple different files sitting in the file system and still be</p>
<p>269<br>00:26:10,359 –&gt; 00:26:14,759<br>atomic across those files so it’s different so we in many ways we have to do a little bit we have a</p>
<p>270<br>00:26:14,759 –&gt; 00:26:24,679<br>harder problem to solve okay great question though other questions okay all right so logging is used</p>
<p>271<br>00:26:25,559 –&gt; 00:26:32,039<br>by nearly every database system what’s the alternative you might ask in the very early days before</p>
<p>272<br>00:26:32,039 –&gt; 00:26:38,359<br>logging and all the details about logging were really worked out a very easy way to kind of do this</p>
<p>273<br>00:26:38,359 –&gt; 00:26:43,000<br>stuff was to do shadow paging it’s like copy on right type of thing right and you’ll see that</p>
<p>274<br>00:26:43,000 –&gt; 00:26:47,159<br>in many applications you’ll see similar concepts by the way those of you’ve taken operating systems</p>
<p>275<br>00:26:47,159 –&gt; 00:26:52,440<br>or a dug into that are going to find a lot of common things between database systems and operating</p>
<p>276<br>00:26:52,440 –&gt; 00:26:57,000<br>systems we already hit latches and locks they try to different things but a lot of database</p>
<p>277<br>00:26:57,000 –&gt; 00:27:02,680<br>things are going to be on larger things lots of files lots of data and in some said the mechanisms</p>
<p>278<br>00:27:02,680 –&gt; 00:27:08,920<br>are going to be different and in my view often richer okay so shadowing is okay I’m going to make</p>
<p>279<br>00:27:09,960 –&gt; 00:27:14,519<br>change to a record on a page you know what I’m just going to make a new copy of the page and make</p>
<p>280<br>00:27:14,519 –&gt; 00:27:19,240<br>the changes there that way if I need to undo stuff I’ll just go back to the old page and I’ve got</p>
<p>281<br>00:27:19,240 –&gt; 00:27:25,799<br>both my before and after copy for the entire page now of course some systems still do that but it’s</p>
<p>282<br>00:27:25,799 –&gt; 00:27:31,879<br>not a good idea it’s less efficient right if I just want to do change one bite in one page I’m</p>
<p>283<br>00:27:31,879 –&gt; 00:27:36,359<br>going to make an entire copy of the page so that’s obviously based on I still need to go and</p>
<p>284<br>00:27:36,359 –&gt; 00:27:42,039<br>clean things up and merge things up others before you know it if I’ve got one page which has got a hot</p>
<p>285<br>00:27:42,039 –&gt; 00:27:48,759<br>record and let’s say it’s the counter that says how many skews to a half for the pink Barbie doll</p>
<p>286<br>00:27:48,759 –&gt; 00:27:53,319<br>that’s really popular every time someone buys that Barbie doll that counter will change I’m going to</p>
<p>287<br>00:27:53,319 –&gt; 00:27:57,240<br>make copies and copies of the page right so if I’ve got a million Barbie dolls I’ll have a million</p>
<p>288<br>00:27:57,240 –&gt; 00:28:03,240<br>copies okay by the way counters in database systems on captack way they are done with more semantic</p>
<p>289<br>00:28:03,240 –&gt; 00:28:07,720<br>components using commutative action that’s just a side common also an encouragement to take the</p>
<p>290<br>00:28:07,720 –&gt; 00:28:13,720<br>advanced database class to talk about more complex mechanisms to make transactions go even faster and</p>
<p>291<br>00:28:13,720 –&gt; 00:28:20,359<br>better okay but you get the idea that shadow paging can very quickly it’s a cheap mechanism easy</p>
<p>292<br>00:28:20,359 –&gt; 00:28:25,479<br>to implement but is problematic logging is superior and that’s what most database systems use</p>
<p>293<br>00:28:27,159 –&gt; 00:28:32,199<br>so let’s get to the C part which has always been a little difficult to explain but hopefully</p>
<p>294<br>00:28:32,199 –&gt; 00:28:36,839<br>with this slide it’ll start to become better it’s essentially saying I have a contract between the</p>
<p>295<br>00:28:36,839 –&gt; 00:28:42,839<br>database system and I as an application programmer have a contract with you the database system that</p>
<p>296<br>00:28:42,839 –&gt; 00:28:48,119<br>I’ll tell you what I want in the application through my SQL statement my primary key constraints</p>
<p>297<br>00:28:48,119 –&gt; 00:28:54,279<br>my checks and other things that I want in the system and don’t mess it up if those constraint</p>
<p>298<br>00:28:54,279 –&gt; 00:28:59,639<br>held before the transaction started then the transaction ran and it may have touched a million</p>
<p>299<br>00:28:59,639 –&gt; 00:29:05,639<br>objects read and write millions of objects across hundreds of tables once you say it’s committed</p>
<p>300<br>00:29:05,639 –&gt; 00:29:12,279<br>all those constraints must still be true okay if one of my constraints was the sum of all the</p>
<p>301<br>00:29:12,279 –&gt; 00:29:20,839<br>columns in this a in the price field is less than 100 that should still be true if I said all the</p>
<p>302<br>00:29:20,839 –&gt; 00:29:26,279<br>column A should add up to be a million and exactly be a million and lots of changes happened to</p>
<p>303<br>00:29:26,279 –&gt; 00:29:33,559<br>different values in that column 8 that should still hold true that sum should still be a</p>
<p>304<br>00:29:33,559 –&gt; 00:29:37,879<br>million at the end of it and I’ve specified that through my constraint that should still hold true</p>
<p>305<br>00:29:38,840 –&gt; 00:29:45,320<br>okay now the transaction management is not going to do anything different as you’ll see</p>
<p>306<br>00:29:45,320 –&gt; 00:29:51,400<br>we just have to make sure that the atomicity holds the AID components hold and constraint</p>
<p>307<br>00:29:51,400 –&gt; 00:29:56,600<br>consistency will just get taken care of right we don’t mess that up so that’s why it sees kind of</p>
<p>308<br>00:29:56,600 –&gt; 00:30:00,840<br>like plugged into this asset stuff the transaction mechanisms we’ll talk about today in the next</p>
<p>309<br>00:30:00,840 –&gt; 00:30:05,720<br>two lectures I’m going to directly address see it’s the responsibility of the application programmer</p>
<p>310<br>00:30:05,720 –&gt; 00:30:12,920<br>to define those constraints correctly to make matters even more confusing a little while back close</p>
<p>311<br>00:30:12,920 –&gt; 00:30:21,000<br>to a decade ago there’s all this excitement about this thing called eventual consistency even though</p>
<p>312<br>00:30:21,000 –&gt; 00:30:24,759<br>it has a word consistency it has nothing to do with the consistency that we just defined here as a</p>
<p>313<br>00:30:24,759 –&gt; 00:30:31,640<br>C in asset that consistency was a model saying oh this transactions are hard in distributed systems</p>
<p>314<br>00:30:31,800 –&gt; 00:30:35,560<br>it becomes very tough to do that though now we have figured things out and how to do things in</p>
<p>315<br>00:30:35,560 –&gt; 00:30:40,920<br>distributed systems well too but that time when people were building these systems and largely</p>
<p>316<br>00:30:40,920 –&gt; 00:30:44,840<br>the systems were being built by people who hadn’t taken the database course that was the problem</p>
<p>317<br>00:30:45,480 –&gt; 00:30:49,880<br>they said the best way we can make this happen is to be eventually consistent so let the changes</p>
<p>318<br>00:30:49,880 –&gt; 00:30:56,840<br>happen and then eventually if A two transactions made changes to A eventually they would be the same</p>
<p>319<br>00:30:56,839 –&gt; 00:31:01,879<br>so if that $25 withdrawal from two accounts happening simultaneously it’s like eventually they</p>
<p>320<br>00:31:01,879 –&gt; 00:31:07,319<br>will end up to be 50 but for a while even though both have been paid $25 you read the value you will</p>
<p>321<br>00:31:07,319 –&gt; 00:31:13,799<br>see 75 so the eventual consistency model is don’t trust the value eventually it will be right but the</p>
<p>322<br>00:31:13,799 –&gt; 00:31:18,679<br>question from the application perspective is how long do I have to wait for it and how do I know</p>
<p>323<br>00:31:18,679 –&gt; 00:31:23,480<br>when something is right or not and there were early days when people were building these</p>
<p>324<br>00:31:23,480 –&gt; 00:31:27,960<br>applications with the eventual consistency where you have your Facebook app you’d post a message</p>
<p>325<br>00:31:28,599 –&gt; 00:31:33,000<br>and your friend would see it you would refresh here and it would be gone because eventually it</p>
<p>326<br>00:31:33,000 –&gt; 00:31:37,319<br>would be there but it just fetched from a different server that hadn’t gotten your message right</p>
<p>327<br>00:31:37,319 –&gt; 00:31:41,480<br>your first connection was made to server one second connection for refresh went to something else</p>
<p>328<br>00:31:41,480 –&gt; 00:31:46,680<br>it hasn’t gotten the update so as you can imagine that became very hard for application programmers</p>
<p>329<br>00:31:46,680 –&gt; 00:31:51,640<br>to do the whole point of having database systems or data platforms deal with transactions</p>
<p>330<br>00:31:51,640 –&gt; 00:31:57,720<br>is so i as an application programmer don’t have to deal with it so it’s now universally accepted</p>
<p>331<br>00:31:57,720 –&gt; 00:32:02,680<br>that it’s a pretty bad idea unless there’s you’ve got very strict requirements for performance that</p>
<p>332<br>00:32:02,680 –&gt; 00:32:09,080<br>require you to do nothing but just that okay but it is not the go-to way to build data platforms by</p>
<p>333<br>00:32:09,080 –&gt; 00:32:16,920<br>saying you the application person start worrying about transactions the bunch of systems still use</p>
<p>334<br>00:32:16,920 –&gt; 00:32:23,160<br>eventual such but i’ll briefly flash the standard paper which globally is using things that are</p>
<p>335<br>00:32:23,160 –&gt; 00:32:28,279<br>even stronger than acid and then again if you take the advanced database class we talk about stuff</p>
<p>336<br>00:32:28,279 –&gt; 00:32:33,800<br>like that over there is there so it’s not that systems don’t use that today i’m just saying</p>
<p>337<br>00:32:34,360 –&gt; 00:32:39,560<br>in my view it’s not a good idea to use that as a default way to build a data platform there’s still</p>
<p>338<br>00:32:39,560 –&gt; 00:32:43,320<br>some reasons why you may want to do that but it’s not the way you should say i’m going to make my</p>
<p>339<br>00:32:43,319 –&gt; 00:32:48,839<br>database by design eventual consistency because i didn’t think of doing other ways of doing full</p>
<p>340<br>00:32:48,839 –&gt; 00:32:53,000<br>transactions their performance obviously you can get more performance with eventual consistency let’s</p>
<p>341<br>00:32:53,000 –&gt; 00:33:00,200<br>know down about that close my ears everyone close their ears now basically the question is like</p>
<p>342<br>00:33:03,000 –&gt; 00:33:08,279<br>eventual consistency says eventually all the values will be the right values so it will feel like</p>
<p>343<br>00:33:08,279 –&gt; 00:33:12,039<br>you got your transactions but for a while you may see inconsistent values so that’s what eventual</p>
<p>344<br>00:33:12,039 –&gt; 00:33:17,960<br>consistency is so an application gets there like it’s between the view hasn’t much to run yeah as</p>
<p>345<br>00:33:17,960 –&gt; 00:33:22,839<br>i said you may see 75 per a while when it should be 50 both of you are you’re standing next to each</p>
<p>346<br>00:33:22,839 –&gt; 00:33:28,519<br>other on two side by side ATM machines both of you got your 25 bucks and you will say oops 75 is</p>
<p>347<br>00:33:28,519 –&gt; 00:33:33,240<br>in the bank which is not true and the bank will say you know what it was actually 50 we sent you</p>
<p>348<br>00:33:33,240 –&gt; 00:33:38,039<br>that eventually it will be the right amount right but as you can see it’s hard right you don’t want</p>
<p>349<br>00:33:38,039 –&gt; 00:33:47,879<br>that in your application yep another another question no there are the dynamo has eventual</p>
<p>350<br>00:33:47,879 –&gt; 00:33:59,000<br>consistency other systems to have eventual consistency models put this term out yes but but</p>
<p>351<br>00:33:59,000 –&gt; 00:34:04,039<br>there there was a whole time where people were saying we don’t need sequel we don’t need transactions</p>
<p>352<br>00:34:04,039 –&gt; 00:34:10,519<br>no sequel eventual consistency that hasn’t quite worked out for those people okay so i’m not</p>
<p>353<br>00:34:10,519 –&gt; 00:34:14,759<br>saying there’s no fault for eventual consistency i’m saying that’s not what you should design for</p>
<p>354<br>00:34:14,759 –&gt; 00:34:18,519<br>by default unless you know what you’re getting into and now you’re going to have to put the</p>
<p>355<br>00:34:18,519 –&gt; 00:34:25,159<br>complexity in the application okay so there is still some place for it but not like that’s not the</p>
<p>356<br>00:34:25,159 –&gt; 00:34:34,440<br>default setting so all right let’s go find my mouse again there we go all right so isolation of</p>
<p>357<br>00:34:34,440 –&gt; 00:34:39,399<br>transactions so we are still on i use submit transaction each transaction executes as if it is running</p>
<p>358<br>00:34:39,399 –&gt; 00:34:45,079<br>by itself and obviously an easier programming model as we talked about and the dbms it’s going to</p>
<p>359<br>00:34:45,079 –&gt; 00:34:53,480<br>do its stuff to give this one at a time or isolation as a principle so how does it do that</p>
<p>360<br>00:34:53,639 –&gt; 00:34:59,880<br>there are two classes of methods and again today i’m just going to outline it at a high level we’ll</p>
<p>361<br>00:34:59,880 –&gt; 00:35:05,639<br>get into the details of it in the next lecture the two classes one is pessimistic which is to say</p>
<p>362<br>00:35:06,519 –&gt; 00:35:10,840<br>even before i let a read and write happen i’m going to be pessimistic if i think something bad</p>
<p>363<br>00:35:10,840 –&gt; 00:35:15,000<br>is going to happen i’m going to hold you back hold you that transaction that i think is going to start</p>
<p>364<br>00:35:15,000 –&gt; 00:35:19,880<br>this bad action back okay and we’ll see how that happens in a little bit with with a couple of</p>
<p>365<br>00:35:19,880 –&gt; 00:35:30,920<br>mechanisms the second way is basically to do something called optimistic concurrence which is to</p>
<p>366<br>00:35:30,920 –&gt; 00:35:37,079<br>say i think every life is good i’m going to let every transaction go through i’ll still provide the</p>
<p>367<br>00:35:37,079 –&gt; 00:35:42,440<br>isolation principle so that they don’t interfere with each other but i’m going to do that by checking</p>
<p>368<br>00:35:42,440 –&gt; 00:35:46,360<br>assuming everything is going to go well so it’s like everyone go to your reads and writes i’ll keep</p>
<p>369<br>00:35:46,360 –&gt; 00:35:50,920<br>track off it go make your changes but before you’re ready to commit i will do some checks to see if</p>
<p>370<br>00:35:50,920 –&gt; 00:35:54,920<br>you guys interfere with each other all of you guys all of you transactions that we’re running together</p>
<p>371<br>00:35:54,920 –&gt; 00:36:01,000<br>simultaneously so optimistic says most transactions don’t conflict with each other so i can get a</p>
<p>372<br>00:36:01,000 –&gt; 00:36:07,079<br>higher performance system by being optimistic that most things will work out it will still be correct</p>
<p>373<br>00:36:07,079 –&gt; 00:36:14,519<br>so to make sure bad things don’t happen which is a different philosophy okay all right so</p>
<p>374<br>00:36:16,519 –&gt; 00:36:24,440<br>let’s start digging into a couple examples now as we know transactions are going to be</p>
<p>375<br>00:36:24,920 –&gt; 00:36:29,720<br>cast in terms of these read write operations and now you’re starting to see some of the big in</p>
<p>376<br>00:36:29,720 –&gt; 00:36:35,000<br>and commit calls that are coming in so t1 is a transaction that subtracted that moving $100</p>
<p>377<br>00:36:35,000 –&gt; 00:36:41,880<br>from bank account a to bank account b and t2 is a transaction that’s adding 6% interest to all the</p>
<p>378<br>00:36:41,880 –&gt; 00:36:48,360<br>bank accounts and assume this is a small bank so it just has two bank accounts okay also keeps the</p>
<p>379<br>00:36:48,360 –&gt; 00:36:55,880<br>examples and what’s the possible outcome of running these two the two possible outcomes one is</p>
<p>380<br>00:36:57,640 –&gt; 00:37:06,519<br>assume both a and b start with $1,000 if i run a followed by b or b followed by a i’m going to get</p>
<p>381<br>00:37:06,599 –&gt; 00:37:16,519<br>two different execution strategies but eventually a plus b should be 2000 and 6% of that means that</p>
<p>382<br>00:37:16,519 –&gt; 00:37:25,960<br>the total bank account across those two banks should be 2120 right so that’s what we want to end up</p>
<p>383<br>00:37:25,960 –&gt; 00:37:35,159<br>now what we are going to look at next i’m just going to jump into this is with just these two</p>
<p>384<br>00:37:35,159 –&gt; 00:37:42,279<br>transactions i could have a correct isolation property being held by either running the first</p>
<p>385<br>00:37:42,279 –&gt; 00:37:47,879<br>transaction first and running the second transaction first right there two possible outcomes t1</p>
<p>386<br>00:37:47,879 –&gt; 00:37:54,839<br>runs first followed by t2 or vice versa and so here you can see one example where the value of a</p>
<p>387<br>00:37:55,559 –&gt; 00:38:01,879<br>is 950 for and b is 166 that will correspond to having done the $100 transfer first then adding</p>
<p>388<br>00:38:01,880 –&gt; 00:38:08,599<br>6% and the other one is doing it the other way around okay so either one of those by the isolation</p>
<p>389<br>00:38:08,599 –&gt; 00:38:13,800<br>principle is correct if both transactions are in the system at the same time we are okay we as a</p>
<p>390<br>00:38:13,800 –&gt; 00:38:19,160<br>transaction management system are okay in picking that order so let’s just look at it more visually</p>
<p>391<br>00:38:19,160 –&gt; 00:38:25,400<br>and that might make sense this is notion of a serial execution and the serial execution diagram that</p>
<p>392<br>00:38:25,400 –&gt; 00:38:32,039<br>we’ll see in the next 10 of 15 slides all are going to have time going from top to the bottom so</p>
<p>393<br>00:38:32,039 –&gt; 00:38:37,960<br>imagine you are the machine and you’re watching transactions come at you and isolation basically</p>
<p>394<br>00:38:37,960 –&gt; 00:38:44,840<br>says if this execution is such that you can show me prove to me that no matter what you do whichever</p>
<p>395<br>00:38:44,840 –&gt; 00:38:48,840<br>order you allow the transaction it feels like one happened before the other and that one happened</p>
<p>396<br>00:38:48,840 –&gt; 00:38:54,039<br>before the other could be all of t1 happened followed by t2 in this case which is the example on the</p>
<p>397<br>00:38:54,039 –&gt; 00:39:00,599<br>lap which is when you end up with a is equal to 954 and b is 1166 or t2 followed by that both of them</p>
<p>398<br>00:39:00,599 –&gt; 00:39:05,960<br>are correct but if you are going to interleave these reads and writes for these two transactions the</p>
<p>399<br>00:39:05,960 –&gt; 00:39:13,239<br>database better end up with one of these two correct end states which one doesn’t matter but it should</p>
<p>400<br>00:39:13,239 –&gt; 00:39:19,880<br>be one of those two not not something else question why we love to do to do exactly</p>
<p>401<br>00:39:19,960 –&gt; 00:39:27,800<br>obviously this is like an example but like it would be like one of them would have a service right</p>
<p>402<br>00:39:27,800 –&gt; 00:39:31,640<br>no that’s a whole point so the question is why are we doing this in parallel that’s the whole point</p>
<p>403<br>00:39:32,280 –&gt; 00:39:36,920<br>right now this is serial execution so t1 is happening after t2 in time but what you want to do is to</p>
<p>404<br>00:39:37,480 –&gt; 00:39:43,320<br>imagine I’ve got two cores in this server and today servers have 40 cores and database machines</p>
<p>405<br>00:39:43,320 –&gt; 00:39:47,400<br>sometimes have hundreds of machines I don’t want to be just running one transaction at a time I want</p>
<p>406<br>00:39:47,400 –&gt; 00:39:52,599<br>to be able to do as many actions at any given point in time I want to do as many things as possible</p>
<p>407<br>00:39:53,320 –&gt; 00:39:57,240<br>right because I want to use all the hardware I have access to that way I can get more transactions</p>
<p>408<br>00:39:57,240 –&gt; 00:40:02,440<br>in the system higher throughput and lower latency potentially basically lowering the</p>
<p>409<br>00:40:03,639 –&gt; 00:40:07,960<br>no no no we will not lower the standard so hold on we will not lower the standard we are</p>
<p>410<br>00:40:08,599 –&gt; 00:40:15,240<br>definitely changing the standard a little bit to say any permutation of t1 followed by t2 is</p>
<p>411<br>00:40:15,239 –&gt; 00:40:21,559<br>allowed t2 t1 and t2 can be interchange as long as we can prove one did all of its work before</p>
<p>412<br>00:40:21,559 –&gt; 00:40:26,599<br>the other so hold on for two slides you’re right it’s like why is that not only one possible way</p>
<p>413<br>00:40:26,599 –&gt; 00:40:32,679<br>that t1 should be followed by t2 if we did that then we would allow less parallelism in the system</p>
<p>414<br>00:40:32,679 –&gt; 00:40:38,039<br>okay so you’re going to relax the strict nosing of what is correct and this is where there’s this</p>
<p>415<br>00:40:38,039 –&gt; 00:40:45,880<br>notion of strict serializable which will say the transactions should feel like they retard in the</p>
<p>416<br>00:40:45,880 –&gt; 00:40:50,840<br>way in which they happen in the physical world we’ll talk about that in the next class a little bit</p>
<p>417<br>00:40:50,840 –&gt; 00:40:56,119<br>and we’ll talk about it a lot more in the advanced database class okay first let’s get a little bit</p>
<p>418<br>00:40:56,119 –&gt; 00:41:02,039<br>right and this is by the way what most database systems do today they will take this slight liberty</p>
<p>419<br>00:41:02,039 –&gt; 00:41:06,119<br>of rechanging it because it’s also like t1 and t2 issued at the same time what does it even mean</p>
<p>420<br>00:41:06,119 –&gt; 00:41:10,759<br>for it to be issued at the same time there may be in different cities if you’re sitting next to each</p>
<p>421<br>00:41:10,759 –&gt; 00:41:14,920<br>of this not as if you would be pressing the button exactly at the same second because that doesn’t</p>
<p>422<br>00:41:14,920 –&gt; 00:41:19,400<br>happen right so it’s like what does simultaneous mean so we’re going to be a little bit more relaxed</p>
<p>423<br>00:41:19,400 –&gt; 00:41:24,839<br>all we have is to say for us to be have this proper isolation the final values should be one of</p>
<p>424<br>00:41:24,839 –&gt; 00:41:33,319<br>these two not a third value look at this slide here first yep so here t t1 starts and does its</p>
<p>425<br>00:41:33,320 –&gt; 00:41:39,960<br>subtraction of 100 so now a has the hundred dollars already removed t2 starts and gives 6%</p>
<p>426<br>00:41:39,960 –&gt; 00:41:46,760<br>interest to the two bank accounts but the bank account value for a that it is looking at is a</p>
<p>427<br>00:41:46,760 –&gt; 00:41:53,160<br>hundred dollar short and so it ends up with a value of 2114 as a sum total which is six dollars</p>
<p>428<br>00:41:53,160 –&gt; 00:41:59,080<br>off from what that original about should be okay so what we want to allow is these two the</p>
<p>429<br>00:41:59,079 –&gt; 00:42:03,880<br>interleaving in the previous slide that is safe where you end up with the correct value even though</p>
<p>430<br>00:42:03,880 –&gt; 00:42:08,920<br>there’s interleaving but this is an example of an unsafe interleaving where you ended up with the</p>
<p>431<br>00:42:08,920 –&gt; 00:42:17,079<br>wrong value right so this is fine sorry I was here on the wrong slide here this is fine and the</p>
<p>432<br>00:42:17,079 –&gt; 00:42:22,360<br>question is how do we determine that this is okay this type of interleaving of actions across</p>
<p>433<br>00:42:22,360 –&gt; 00:42:29,960<br>different transactions is okay but this one is not okay so let’s look at how we go about doing that</p>
<p>434<br>00:42:29,960 –&gt; 00:42:36,519<br>so this is form and notion of serial schedule that says a schedule that does not interleave any of</p>
<p>435<br>00:42:36,519 –&gt; 00:42:41,720<br>the actions so we saw that right a serial example of a serial schedule was one where you just had</p>
<p>436<br>00:42:42,599 –&gt; 00:42:49,720<br>all the t1s like here is a serial schedule if we go back this is serial schedule t1 followed by t2</p>
<p>437<br>00:42:49,799 –&gt; 00:42:58,839<br>or t2 followed by t1 okay now the thing that we are trying to get to the hardware part is an</p>
<p>438<br>00:42:58,839 –&gt; 00:43:09,159<br>equivalent schedule so here was a schedule that we saw that was correct it is not serial but as we</p>
<p>439<br>00:43:09,159 –&gt; 00:43:16,679<br>will see this is correct and we want to look at this schedule and say the one on the left is</p>
<p>440<br>00:43:16,679 –&gt; 00:43:22,039<br>equivalent to the serial schedule on the right we want to be able to show that happens and in which</p>
<p>441<br>00:43:22,039 –&gt; 00:43:27,960<br>case we will say that schedule is safe and that’s allowed so the notion of equivalent schedule says</p>
<p>442<br>00:43:27,960 –&gt; 00:43:32,919<br>allow some interleaving and as long as you can prove that this interleaving is safe</p>
<p>443<br>00:43:34,519 –&gt; 00:43:39,639<br>and the proof of safety is going to be by saying all these actions are equivalent to some</p>
<p>444<br>00:43:39,639 –&gt; 00:43:46,119<br>serial schedule in this case one of those two t1 followed by t2 or t2 followed by t1 you are okay you</p>
<p>445<br>00:43:46,119 –&gt; 00:43:52,679<br>will end up with the correct answer okay so it sounds like magic but there’s a very simple way to go</p>
<p>446<br>00:43:53,960 –&gt; 00:43:59,000<br>figure that out and this is the part that you were asking about it’s like okay but why are the two</p>
<p>447<br>00:43:59,000 –&gt; 00:44:03,960<br>correct states of the database and that’s really what we are relaxing a little bit in this notion of</p>
<p>448<br>00:44:03,960 –&gt; 00:44:08,440<br>serializable and as I said this is social of strict serializable where that real world effect is taken</p>
<p>449<br>00:44:08,440 –&gt; 00:44:14,440<br>into place and it’s stricter but for the purpose of this class we are going to work with this notion</p>
<p>450<br>00:44:14,440 –&gt; 00:44:19,240<br>that we just have to prove it equivalent to one of the many equivalent serial schedules and if you</p>
<p>451<br>00:44:19,240 –&gt; 00:44:24,679<br>have two transactions there are only two possible outcomes if there were three t1 t2 t3 it could be</p>
<p>452<br>00:44:25,320 –&gt; 00:44:30,119<br>first transaction could be either one of those there are three possible combinations then two</p>
<p>453<br>00:44:30,119 –&gt; 00:44:36,840<br>then one right so you you get that factorial effect we are going to think about these rewrites in terms</p>
<p>454<br>00:44:36,840 –&gt; 00:44:43,720<br>of conflicting actions that can happen between these objects like the a’s and the b’s and the c’s</p>
<p>455<br>00:44:44,599 –&gt; 00:44:51,320<br>so we are going to have we call these things anomalies and there are three different types</p>
<p>456<br>00:44:51,320 –&gt; 00:44:58,519<br>a read could interfere with a transaction reads an object and something else writes to it or a</p>
<p>457<br>00:44:58,519 –&gt; 00:45:04,840<br>transaction writes an object and someone else reads that object the third one is two transaction one</p>
<p>458<br>00:45:04,840 –&gt; 00:45:09,480<br>writes to an object and the other transaction also writes to that object what is missing from this</p>
<p>459<br>00:45:09,480 –&gt; 00:45:14,360<br>combination is read read right which is obviously not a conflict if I am just reading this two</p>
<p>460<br>00:45:14,360 –&gt; 00:45:18,679<br>transactions if I have just got a copy that’s read only many transactions could read it you are not</p>
<p>461<br>00:45:18,679 –&gt; 00:45:24,920<br>going to conflict with each other right it’s a read only copy all right so let’s take these read</p>
<p>462<br>00:45:24,920 –&gt; 00:45:33,480<br>write conflicts and go look at that here is the schedule in which there is a read of an object a</p>
<p>463<br>00:45:33,480 –&gt; 00:45:40,440<br>followed by a write of an object a as these actions got interleaved and so that would be an</p>
<p>464<br>00:45:40,440 –&gt; 00:45:48,599<br>example of a read write conflict there are other conflicts in the schedule too but what’s the</p>
<p>465<br>00:45:48,599 –&gt; 00:45:57,800<br>downside of this read write object conflict transaction one read the value a t2 ran and then t1</p>
<p>466<br>00:45:57,800 –&gt; 00:46:04,360<br>reads that value and got a different value right so it was 10 to 4 t2 made it 19 t1 reads it again</p>
<p>467<br>00:46:04,360 –&gt; 00:46:08,920<br>and obviously it is not seen the isolation principle right in the same transaction if I read the</p>
<p>468<br>00:46:08,920 –&gt; 00:46:14,280<br>value twice I should see the same value unless someone else interfered with me so it violates the</p>
<p>469<br>00:46:14,280 –&gt; 00:46:26,840<br>isolation principle and so this is bad okay all right let’s look at the and so that’s called</p>
<p>470<br>00:46:26,840 –&gt; 00:46:31,240<br>unrepeatable read because when you have a read write conflict same transaction reads the value twice</p>
<p>471<br>00:46:31,240 –&gt; 00:46:38,039<br>is going to see different values a dirty read is a reader value let’s say this 10 write it to be 12</p>
<p>472<br>00:46:38,600 –&gt; 00:46:45,160<br>someone else reads the value which is 12 so far no problem but what happens a little bit later</p>
<p>473<br>00:46:45,160 –&gt; 00:46:50,760<br>is that transaction t1 the bots and when transaction t1 the bots that value 12 should never have been read</p>
<p>474<br>00:46:50,760 –&gt; 00:46:54,840<br>because it didn’t get committed to the database it was an intermediate value which is getting thrown</p>
<p>475<br>00:46:54,840 –&gt; 00:47:01,720<br>away right that’s what the bot should do and so now transaction t2 when it was reading the value a</p>
<p>476<br>00:47:01,720 –&gt; 00:47:07,320<br>read a dirty value which should have never been in the database because of that a bot so that’s</p>
<p>477<br>00:47:07,320 –&gt; 00:47:17,000<br>called a dirty read right a write write conflict is t1 is writing a value t2 is also writing that</p>
<p>478<br>00:47:17,000 –&gt; 00:47:27,239<br>value and when t1 writes another value b t1 it feels like it’s writing $10 imagine a and b are now</p>
<p>479<br>00:47:27,239 –&gt; 00:47:35,719<br>columns and it’s updating a record where dollar 10 is in Alice’s account and its column 1 is 10 the</p>
<p>480<br>00:47:35,719 –&gt; 00:47:42,199<br>account yeah amount and b is the name of the person it thinks it’s adding 10 to Alice but the</p>
<p>481<br>00:47:42,199 –&gt; 00:47:48,119<br>other conflict over there is writing to that same record 19 and Bob so you have 10 in there 19</p>
<p>482<br>00:47:48,119 –&gt; 00:47:54,839<br>and Bob got written to that same record and then you have this Alice beat that is written that update</p>
<p>483<br>00:47:54,839 –&gt; 00:48:01,399<br>of 19 and Bob just got overwritten so transaction 2 did its work but its values just got overwritten</p>
<p>484<br>00:48:01,399 –&gt; 00:48:10,919<br>so it lost its update it never got made it made it to the database okay so the we’ll use these</p>
<p>485<br>00:48:10,920 –&gt; 00:48:19,880<br>properties to then define how to go make this equivalent schedule work the two types of</p>
<p>486<br>00:48:21,079 –&gt; 00:48:26,760<br>serializability conflict serializability which we’ll talk about next something called view serializability</p>
<p>487<br>00:48:26,760 –&gt; 00:48:30,599<br>since we are running out of time I might just totally go skip that piece but I’ll briefly</p>
<p>488<br>00:48:30,599 –&gt; 00:48:36,680<br>allude to what that does okay won’t grill you with exam questions on view serializability okay so</p>
<p>489<br>00:48:36,759 –&gt; 00:48:41,480<br>it’s okay if you don’t totally get that conflict serializability is what database systems implement</p>
<p>490<br>00:48:41,480 –&gt; 00:48:47,480<br>and let’s just jump into that then let me just go with this graph form here to make it even more</p>
<p>491<br>00:48:47,480 –&gt; 00:48:52,679<br>easier to understand so what we’ll do is the following we’ll take operations that we have</p>
<p>492<br>00:48:53,719 –&gt; 00:49:00,919<br>and here’s the schedule that we have we will start going through that and enumerate all possible</p>
<p>493<br>00:49:00,920 –&gt; 00:49:08,840<br>conflicts read right right right and right read okay those three conflicts we’ll create a graph</p>
<p>494<br>00:49:08,840 –&gt; 00:49:14,039<br>called the dependence graph so I’ve got two nodes in that graph t1 and t2 every time a transaction</p>
<p>495<br>00:49:14,039 –&gt; 00:49:18,360<br>comes in a new node will be added so the graph will have as many transactions that are active in the</p>
<p>496<br>00:49:18,360 –&gt; 00:49:25,000<br>system at any point in time now I’ll just start going through the schedule and start marking all the</p>
<p>497<br>00:49:25,000 –&gt; 00:49:32,599<br>conflicts and I start with the first conflict that I see which is a read right doesn’t matter what</p>
<p>498<br>00:49:32,599 –&gt; 00:49:37,719<br>the conflict is as soon as I have one of those three types of conflict read right right right or</p>
<p>499<br>00:49:37,719 –&gt; 00:49:46,920<br>right read I’m going to put an arrow there so the first conflict a is on the subject a and it goes</p>
<p>500<br>00:49:46,920 –&gt; 00:49:54,119<br>from t1 to t2 because t1 happens before t2 in the schedule right so I’ll draw a directed arc from</p>
<p>501<br>00:49:54,119 –&gt; 00:50:02,039<br>t1 to t2 okay does that make sense so really simple I’m going to just walk through this for every</p>
<p>502<br>00:50:02,039 –&gt; 00:50:06,679<br>conflict that I have I’ll draw a directed graph in the order in which this conflict is happening</p>
<p>503<br>00:50:08,519 –&gt; 00:50:18,039<br>right now I go and find the next conflict which is this right followed by read and I will do that</p>
<p>504<br>00:50:18,599 –&gt; 00:50:29,800<br>so the proof is really simple you take a schedule if you walk through it and draw a line for every</p>
<p>505<br>00:50:30,759 –&gt; 00:50:39,719<br>read right right right or right read conflict and if it there’s a cycle in that graph you have a</p>
<p>506<br>00:50:39,719 –&gt; 00:50:47,400<br>bad schedule that schedule will violate the isolation principle that schedule should never have been</p>
<p>507<br>00:50:47,400 –&gt; 00:50:52,680<br>allowed to run in the database system in the next class we’ll see mechanisms that you can use</p>
<p>508<br>00:50:52,680 –&gt; 00:50:58,599<br>to prevent that from ever happening okay does that make sense if you didn’t get anything else because</p>
<p>509<br>00:50:58,599 –&gt; 00:51:02,920<br>of that bug in the slide that’s the main thing I want you to get from this isolation principle</p>
<p>510<br>00:51:05,960 –&gt; 00:51:11,800<br>the edges go in the time order see so look at the right followed by read the red line that is</p>
<p>511<br>00:51:11,800 –&gt; 00:51:18,519<br>shown here right now it’s going from t1 to t2 right the read the right in a happened before the</p>
<p>512<br>00:51:18,519 –&gt; 00:51:26,680<br>read in t2 so I will draw a directed line from t1 to t2 saying some action in t1 happens before</p>
<p>513<br>00:51:26,680 –&gt; 00:51:32,760<br>the action in t2 which means t2 better not do stuff that is the other way around because now</p>
<p>514<br>00:51:32,760 –&gt; 00:51:39,080<br>I’ve got a contradictory state that I’m going to end up with okay so the serial schedule is a</p>
<p>515<br>00:51:40,039 –&gt; 00:51:44,599<br>the time on the left side is the order in which the databases see those actions and it’s going to</p>
<p>516<br>00:51:44,599 –&gt; 00:51:49,639<br>construct this graph and what we’ll see in the next classes the minute it starts to say this second</p>
<p>517<br>00:51:49,639 –&gt; 00:51:55,719<br>stuff which is going to cause this art to complete it’ll stop it won’t let it will basically not let</p>
<p>518<br>00:51:55,719 –&gt; 00:52:01,319<br>this thing proceed beyond the right of v because it says if I allow this right to happen this</p>
<p>519<br>00:52:01,319 –&gt; 00:52:07,400<br>art to form I will have a conflict so this line it will pause that it will stop transaction t1</p>
<p>520<br>00:52:07,400 –&gt; 00:52:16,360<br>from proceeding with the techniques we’ll talk about in the next class okay yep does it need to</p>
<p>521<br>00:52:16,360 –&gt; 00:52:23,000<br>what yeah and then it may need to abort something or delay something so we’ll we’ll talk about that</p>
<p>522<br>00:52:23,000 –&gt; 00:52:26,440<br>right so there are the sometimes where it may just say you know what I need to abort</p>
<p>523<br>00:52:27,480 –&gt; 00:52:33,720<br>and I can’t go any further all right so it’s really that simple we will construct this graph</p>
<p>524<br>00:52:33,719 –&gt; 00:52:40,519<br>and now we have this beautiful proof that says how do I have correct isolation property</p>
<p>525<br>00:52:41,959 –&gt; 00:52:48,519<br>all right so here is three transactions just to show this in a slightly more complicated way</p>
<p>526<br>00:52:50,599 –&gt; 00:52:56,039<br>as I walk down the first conflict is that read to write there are other conflicts in there there’s</p>
<p>527<br>00:52:56,039 –&gt; 00:53:02,039<br>a w a and t1 to read in a I’m not showing every possible conflict in there but both of them</p>
<p>528<br>00:53:02,039 –&gt; 00:53:10,279<br>induce arc from t1 to t2 right it’s just a hazard and then there are other conflicts but that will</p>
<p>529<br>00:53:10,279 –&gt; 00:53:15,719<br>just redo that same line you don’t have to redraw that line multiple types one arc is one arc is</p>
<p>530<br>00:53:15,719 –&gt; 00:53:22,039<br>enough right that’s all this is showing as you go further down we see another conflict from t2 to t1</p>
<p>531<br>00:53:23,000 –&gt; 00:53:34,039<br>okay and that’s all there is in here so this basically says in this schedule even though there’s</p>
<p>532<br>00:53:34,039 –&gt; 00:53:39,400<br>a bunch of interleaving going on between the three transactions this you can prove to be correct</p>
<p>533<br>00:53:40,920 –&gt; 00:53:47,719<br>and can you guess what’s the correct serial schedule look at the graph</p>
<p>534<br>00:53:48,039 –&gt; 00:53:58,119<br>yeah it’s going to be the order of that graph t2 it’s like t2 happened first then t1 happened</p>
<p>535<br>00:53:58,919 –&gt; 00:54:04,919<br>then t3 happened looks it’s as if that was the serial order in which they were executed and we</p>
<p>536<br>00:54:04,919 –&gt; 00:54:11,399<br>were just running one transaction at a time and that’s the whole idea now if you get why this graph</p>
<p>537<br>00:54:11,399 –&gt; 00:54:14,839<br>makes sense it’s trivial but it took a little while for people to figure this out it wasn’t that</p>
<p>538<br>00:54:14,840 –&gt; 00:54:19,240<br>trivial and that’s what’s been you have these beautiful ideas are they seem simple only in retrospect</p>
<p>539<br>00:54:20,840 –&gt; 00:54:26,760<br>okay so for ever everything I said with that bug in the slide this if you get it you understand</p>
<p>540<br>00:54:26,760 –&gt; 00:54:42,600<br>how isolation works okay yep yeah and we’ll talk about a bots and other kinds of special handling</p>
<p>541<br>00:54:42,599 –&gt; 00:54:47,400<br>in there but what is true is that even before the about if you start to see a cycle you know you</p>
<p>542<br>00:54:47,400 –&gt; 00:54:55,400<br>will end up in a bad situation so you need to stop it right because time is evolving I as the</p>
<p>543<br>00:54:55,400 –&gt; 00:55:01,000<br>database transaction manager if I’m at this point in time and I’ve been told should I admit this</p>
<p>544<br>00:55:01,000 –&gt; 00:55:05,880<br>read of B I have to make a decision if I’m the pessimistic transaction management system</p>
<p>545<br>00:55:05,880 –&gt; 00:55:10,920<br>pessimistic isolation management if I I will have to decide whether to let that happen or not</p>
<p>546<br>00:55:10,920 –&gt; 00:55:14,280<br>if I’m optimistic I’ll say let it go and in the end I will figure out right so that’s the</p>
<p>547<br>00:55:14,280 –&gt; 00:55:20,920<br>difference between the pessimistic and the optimistic yep so is this going to be created before it</p>
<p>548<br>00:55:20,920 –&gt; 00:55:25,320<br>happens or like it is being created while it’s happening right so you can imagine something like</p>
<p>549<br>00:55:25,320 –&gt; 00:55:32,360<br>this is happening in the system uh third step is run uh we start with the begin on p1 then read of</p>
<p>550<br>00:55:32,360 –&gt; 00:55:38,760<br>a is done right of a is done systems is I can let you go then when the right of a comes system is say</p>
<p>551<br>00:55:38,760 –&gt; 00:55:43,560<br>you know what I need to put an arc in this graph so as time is progressing these arcs are being done</p>
<p>552<br>00:55:43,560 –&gt; 00:55:52,760<br>the uh region rights are being presented to the system at time evolves and that’s the difference</p>
<p>553<br>00:55:52,760 –&gt; 00:55:58,120<br>between the pessimistic method and the optimistic pessimistic will say first time I think there’s a</p>
<p>554<br>00:55:58,120 –&gt; 00:56:04,040<br>problem I’m going to stop you and we’ll see how in the next class and optimistic says I’ll let</p>
<p>555<br>00:56:04,040 –&gt; 00:56:08,440<br>everything go but I know how to get you back to a safe place if bad things had happened okay</p>
<p>556<br>00:56:08,760 –&gt; 00:56:14,600<br>this is not optimistic it’s just saying how do I detect that something is good or bad</p>
<p>557<br>00:56:14,600 –&gt; 00:56:24,600<br>but this is the mechanism yep if it is a cycle it is not okay how do I find the cycle when do I</p>
<p>558<br>00:56:24,600 –&gt; 00:56:30,360<br>find the cycle is where the difference is do I find the cycle as soon as it is formed or do I find</p>
<p>559<br>00:56:30,360 –&gt; 00:56:37,160<br>the cycle after I let everything go yeah so that’s basically the whole theory of saying is this</p>
<p>560<br>00:56:37,159 –&gt; 00:56:45,719<br>equivalent to that order or not so here is another example and this is where we are getting into this</p>
<p>561<br>00:56:45,719 –&gt; 00:56:53,159<br>new serializability and kind of what is happening over here in here what’s happening is A is getting</p>
<p>562<br>00:56:54,119 –&gt; 00:57:00,039<br>10 dollars removed from it and there’s a some that is being calculated that’s getting printed out</p>
<p>563<br>00:57:00,039 –&gt; 00:57:05,639<br>over here of course there are problems with this transaction because that one causes the arc from</p>
<p>564<br>00:57:05,639 –&gt; 00:57:11,400<br>t1 to t2 and then you have this transaction so this is not serializable but if instead of</p>
<p>565<br>00:57:11,879 –&gt; 00:57:16,759<br>the second transaction doing a sum of the two transactions if the code in there was only about</p>
<p>566<br>00:57:16,759 –&gt; 00:57:21,960<br>saying find the number of transactions that have values account value is greater than 100 the fact</p>
<p>567<br>00:57:21,960 –&gt; 00:57:27,639<br>that it is a cycle doesn’t matter from the semantics of that second transaction at a very high level</p>
<p>568<br>00:57:27,639 –&gt; 00:57:32,679<br>that’s what view serializability is it’ll if you knew something about the semantics of what was</p>
<p>569<br>00:57:32,679 –&gt; 00:57:37,960<br>happening you will admit a few more types of schedules that you would not otherwise and as I said</p>
<p>570<br>00:57:37,960 –&gt; 00:57:43,079<br>that’s all I want you to know for this class if you didn’t get that that’s okay let it go we’re not</p>
<p>571<br>00:57:43,079 –&gt; 00:57:48,839<br>going to talk too much about view serializability it will just allow certain types of cycles because</p>
<p>572<br>00:57:48,839 –&gt; 00:57:54,599<br>it says I think the application is okay all right and there’s a formal definition of it if you’re</p>
<p>573<br>00:57:54,599 –&gt; 00:58:00,359<br>interested in looking at it in terms of what it allows it basically allows a few more schedules</p>
<p>574<br>00:58:00,360 –&gt; 00:58:05,800<br>than a strictly serial schedule will allow all right so config serializability is the main thing</p>
<p>575<br>00:58:05,800 –&gt; 00:58:14,200<br>that we want you to know about all right pictorially here’s the universal all possible schedules</p>
<p>576<br>00:58:14,200 –&gt; 00:58:20,120<br>including the bad ones the ones we don’t want to happen sorry serial schedule is that strict</p>
<p>577<br>00:58:20,120 –&gt; 00:58:24,039<br>serial stuff which we talked about even followed by t2 and that’s the only thing that allow</p>
<p>578<br>00:58:24,039 –&gt; 00:58:29,000<br>config serializable is if we are allowing a few more combinations and view serializable is where</p>
<p>579<br>00:58:29,000 –&gt; 00:58:35,880<br>you might have a little bit more by way of this application performance okay and there are many more</p>
<p>580<br>00:58:35,880 –&gt; 00:58:40,760<br>layers in there and we’ll uncover some of those in later classes and again a lot more in the detail</p>
<p>581<br>00:58:40,760 –&gt; 00:58:46,840<br>class so we still have one more letter to cover which is the d which is the durability right we did</p>
<p>582<br>00:58:46,840 –&gt; 00:58:53,000<br>atomicity consistency isolation which is where we spend most of the time today and the last one is</p>
<p>583<br>00:58:53,000 –&gt; 00:59:00,199<br>durability which will cover really fast durability we have a full lecture coming on it on this in</p>
<p>584<br>00:59:00,199 –&gt; 00:59:08,920<br>took the second class from now which is about making sure that the changes that we make to the system</p>
<p>585<br>00:59:08,920 –&gt; 00:59:15,480<br>we’re making changes to A’s the B’s and the C’s and stuff like that just in memory right if you’re</p>
<p>586<br>00:59:15,480 –&gt; 00:59:21,960<br>updating a column value or a record that’s sitting in the buffer pool but what happens if you have a</p>
<p>587<br>00:59:21,960 –&gt; 00:59:28,119<br>power loss and memory is volatile so those changes never made it to this but you might have committed</p>
<p>588<br>00:59:28,119 –&gt; 00:59:36,440<br>that transaction so durability is the aspect that says if the database commits a transaction oh by the</p>
<p>589<br>00:59:36,440 –&gt; 00:59:41,960<br>way the database is allowed to use a buffer pool because that’s an efficient way to build data processing</p>
<p>590<br>00:59:41,960 –&gt; 00:59:46,519<br>systems right you don’t want to go to disk every time you want a buffer pool because buffer pool</p>
<p>591<br>00:59:46,519 –&gt; 00:59:51,960<br>accessing data in buffer pool is just so much faster than accessing things on this but if the</p>
<p>592<br>00:59:51,960 –&gt; 00:59:58,360<br>database is it’s committed you want to make sure that if there’s power failure you can get the</p>
<p>593<br>00:59:58,360 –&gt; 01:00:04,360<br>right values in the database so durability will do that by making sure when the commit happens</p>
<p>594<br>01:00:05,000 –&gt; 01:00:10,039<br>it’s going to make sure certain things get written to disk and it’ll try to do very small amounts</p>
<p>595<br>01:00:10,039 –&gt; 01:00:17,000<br>of forced right to disk so that it can provide this durability property okay and as I said in</p>
<p>596<br>01:00:17,000 –&gt; 01:00:22,119<br>two lectures from now we’ll talk about that so that’s basically what acid looks like</p>
<p>597<br>01:00:24,759 –&gt; 01:00:31,239<br>yeah we can talk about that offline the answer is the principles will probably apply is like I</p>
<p>598<br>01:00:31,239 –&gt; 01:00:36,599<br>have volatile storage and non-volatile storage and I can apply this principle of durability across</p>
<p>599<br>01:00:36,599 –&gt; 01:00:44,039<br>any of those systems yeah yeah the same principles to apply yep the logs sorry</p>
<p>600<br>01:00:46,519 –&gt; 01:00:50,759<br>yeah the logs will be kept in memory we’ll get to that in two lectures from now the log records</p>
<p>601<br>01:00:50,759 –&gt; 01:00:55,319<br>that we create will be kept in memory too but at appropriate times we will actually flush them out</p>
<p>602<br>01:00:55,319 –&gt; 01:01:01,880<br>to disk to guarantee the durability property so what happens is we we’ll talk about that what happens</p>
<p>603<br>01:01:01,880 –&gt; 01:01:06,680<br>if the log fails that’s the whole lecture two lectures from now it’s a full lecture I can give you</p>
<p>604<br>01:01:06,680 –&gt; 01:01:12,519<br>a 10 second answer the 10 second answer is that we will make sure that absolutely what must be written</p>
<p>605<br>01:01:12,519 –&gt; 01:01:17,400<br>to disk is written and if we write the wrong thing we will look at the value and undo if we need to</p>
<p>606<br>01:01:17,400 –&gt; 01:01:21,720<br>we’ll do one of two things with stuff we write on disk either redo the operation because it’s</p>
<p>607<br>01:01:21,720 –&gt; 01:01:26,440<br>inconsistent with what was in memory or undo it because we wrote something that we should not have</p>
<p>608<br>01:01:26,440 –&gt; 01:01:34,119<br>written okay so we’ll do we do an undoologic on on those okay so here’s the conclusions</p>
<p>609<br>01:01:35,079 –&gt; 01:01:39,559<br>concurrency control and recovery amongst the most important functions the transactions are super</p>
<p>610<br>01:01:39,559 –&gt; 01:01:45,240<br>important that’s a put a social definition component of database systems and if you go back to</p>
<p>611<br>01:01:45,240 –&gt; 01:01:50,360<br>the early days of database systems that’s why they started getting adopted in enterprises because</p>
<p>612<br>01:01:50,360 –&gt; 01:01:55,720<br>they allowed all this record keeping now I need five minutes to go over a couple things but</p>
<p>613<br>01:01:55,720 –&gt; 01:02:01,880<br>before that we’ve talked about this a few times that there are there’s still a lot more things you</p>
<p>614<br>01:02:01,880 –&gt; 01:02:06,840<br>can do with transactions this is breakthrough paper that came out from Google called stanner by the</p>
<p>615<br>01:02:06,840 –&gt; 01:02:11,079<br>way before that they were doing eventual consistency stuff in many parts and they realized wow</p>
<p>616<br>01:02:11,079 –&gt; 01:02:16,680<br>application programmers can’t quite do that so they actually build a very hard thing which is a</p>
<p>617<br>01:02:16,679 –&gt; 01:02:21,960<br>globally distributed system that can do transactions whether transactions could be touching objects</p>
<p>618<br>01:02:22,759 –&gt; 01:02:27,559<br>in their database which is distributed so it might touch an object in London touch an object in</p>
<p>619<br>01:02:27,559 –&gt; 01:02:34,519<br>the US and commit that transaction across the globe as one transaction and do that fast and efficiently</p>
<p>620<br>01:02:34,519 –&gt; 01:02:39,799<br>and the reason they did that is if they kept the eventual consistency stuff all kinds of application</p>
<p>621<br>01:02:39,799 –&gt; 01:02:44,440<br>programmer bugs were showing up like the ad system would report wrong things it would tell</p>
<p>622<br>01:02:44,440 –&gt; 01:02:49,240<br>the same advertiser proctor and gamble for example in London this is how many impressions we showed</p>
<p>623<br>01:02:49,240 –&gt; 01:02:53,320<br>and the same campaign in US would show a different number and these two guys get on the phone and say</p>
<p>624<br>01:02:53,320 –&gt; 01:02:57,880<br>what are exasperating what impressions it would be really show you want that answer to be precise</p>
<p>625<br>01:02:57,880 –&gt; 01:03:02,760<br>for someone’s paying money for it that was one of the big reasons why they invented that it’s a</p>
<p>626<br>01:03:02,760 –&gt; 01:03:08,519<br>beautiful system requires atomic clocks where you need satellite sinking across the data centers so</p>
<p>627<br>01:03:08,519 –&gt; 01:03:14,280<br>that the two clocks are not out of sync cockroach DB was formed by people from Google who</p>
<p>628<br>01:03:15,239 –&gt; 01:03:20,440<br>worked on this and have a version of it that doesn’t require satellite clocks but the fascinating</p>
<p>629<br>01:03:20,440 –&gt; 01:03:25,639<br>field there’s still a lot of new things that are happening bonus time I leave this link in the</p>
<p>630<br>01:03:25,639 –&gt; 01:03:30,599<br>slides if you want to we’ve talked about all kinds of different models and levels of consistency but</p>
<p>631<br>01:03:30,599 –&gt; 01:03:34,840<br>there’s a lot more and you can play around with that chart but I want to spend a couple minutes on</p>
<p>632<br>01:03:35,559 –&gt; 01:03:43,240<br>project 3 which is on query execution and the overview of this project is we essentially have</p>
<p>633<br>01:03:45,240 –&gt; 01:03:49,960<br>these are the different components of bus stop as you’ve gotten to know and love over time project</p>
<p>634<br>01:03:49,960 –&gt; 01:03:55,720<br>3 is related to the optimizer and the query execution and project 4 that’s coming will be</p>
<p>635<br>01:03:55,720 –&gt; 01:04:01,240<br>query execution in the transaction management piece okay so what is project 3 you’re going to</p>
<p>636<br>01:04:01,719 –&gt; 01:04:09,399<br>add access methods two different access methods sequential scan and index scan you will also do insert</p>
<p>637<br>01:04:09,399 –&gt; 01:04:13,719<br>delete and updates so these are the operator stuff that you’re going to add you’re going to add</p>
<p>638<br>01:04:13,719 –&gt; 01:04:19,959<br>these as new operators that are in the system two different types of joints nested loops join</p>
<p>639<br>01:04:19,959 –&gt; 01:04:26,039<br>and hash join and there’s some miscellaneous window aggregation function limit sort and top</p>
<p>640<br>01:04:27,000 –&gt; 01:04:34,199<br>you’ll also touch the optimizer so there’s already an optimizer in bus stop and to convert a query</p>
<p>641<br>01:04:34,199 –&gt; 01:04:39,239<br>if a query has both an order by an limit you can convert it to a with a simple transformation</p>
<p>642<br>01:04:39,239 –&gt; 01:04:44,039<br>into a top-k query right so that’ll give you a chance to look at how do optimizers work</p>
<p>643<br>01:04:44,840 –&gt; 01:04:49,159<br>if you see a nested loops that’s often a bad idea so in the optimizer you will write a rule</p>
<p>644<br>01:04:49,159 –&gt; 01:04:54,599<br>to convert nested loops to hash join okay because those are typically much faster and similarly</p>
<p>645<br>01:04:54,599 –&gt; 01:04:59,639<br>with sequential scan to index scan if an index exists don’t do a sequential scan go use an index scan</p>
<p>646<br>01:04:59,639 –&gt; 01:05:04,839<br>these are think of it as the heuristic stuff that we talked about in the optimization stuff right not</p>
<p>647<br>01:05:04,839 –&gt; 01:05:13,079<br>cost-based heuristics just rules based okay the leaderboard will require making deeper changes to</p>
<p>648<br>01:05:13,079 –&gt; 01:05:17,559<br>the optimizer so even if you have awesome code from project 1 and project 2 you’re guaranteed not</p>
<p>649<br>01:05:17,559 –&gt; 01:05:22,679<br>to get good high stats on the leaderboard unless you go add new optimization rules and you</p>
<p>650<br>01:05:23,159 –&gt; 01:05:27,960<br>that’s all described in the project you’ll be adding rules to winder aggregation and top-k</p>
<p>651<br>01:05:29,399 –&gt; 01:05:35,079<br>quick tips start with the easy stuff the insert and sequential scan that’s the easiest stuff get it</p>
<p>652<br>01:05:35,079 –&gt; 01:05:46,279<br>right before you go do other things with it and the key thing is now you can actually go and run</p>
<p>653<br>01:05:46,280 –&gt; 01:05:54,840<br>bus stop in uh in the browser so i’m going to close this here and whoops</p>
<p>654<br>01:05:58,200 –&gt; 01:06:06,120<br>pit power point don’t need that anymore and if you go look at bus stop now you can actually</p>
<p>655<br>01:06:07,080 –&gt; 01:06:15,400<br>uh go and run bus stop in the browser let me go find the link here yep uh</p>
<p>656<br>01:06:15,400 –&gt; 01:06:21,160<br>she who’s just an awesome programmer has written this version which completely runs in</p>
<p>657<br>01:06:21,160 –&gt; 01:06:26,599<br>vassam code in the browser and it’s already loaded with some tables in there and you can start to</p>
<p>658<br>01:06:26,599 –&gt; 01:06:34,440<br>do things like uh select star uh from the mock table and do things like that whoops there’s my</p>
<p>659<br>01:06:34,440 –&gt; 01:06:40,119<br>semi colon and you can start to run stuff so you can use this to test if your code works our solution</p>
<p>660<br>01:06:40,119 –&gt; 01:07:05,880<br>is sitting behind that yep yeah so the use this as a reference don’t use grade scope as a way</p>
<p>661<br>01:07:05,880 –&gt; 01:07:12,840<br>of doing your debugging write your tests others you will not do well in this project okay so hopefully</p>
<p>662<br>01:07:12,840 –&gt; 01:07:16,680<br>it’s a fun project start with the simple stuff it may seem like a lot start with the simple stuff</p>
<p>663<br>01:07:16,680 –&gt; 01:07:21,960<br>it will be surprised how quickly you start knocking things off okay all right thank you tj shubham</p>
<p>664<br>01:07:21,960 –&gt; 01:07:22,519<br>hit it</p>
<p>665<br>01:07:36,840 –&gt; 01:07:39,640<br>You</p>
<p>666<br>01:07:57,079 –&gt; 01:08:03,440<br>say i’m the poppee with the motherfucking hoppa 28 Shangri-Wok</p>
<p>667<br>01:08:03,440 –&gt; 01:08:05,099<br>we gonna try to build a</p>
<p>668<br>01:08:05,099 –&gt; 01:08:06,940<br>I smack you with the bottom of the cliff</p>
<p>669<br>01:08:06,940 –&gt; 01:08:07,940<br>I’ll tell you, little bug</p>
<p>670<br>01:08:07,940 –&gt; 01:08:09,219<br>Show me what it’s safe set</p>
<p>671<br>01:08:09,219 –&gt; 01:08:10,539<br>For I blow your face back</p>
<p>672<br>01:08:10,539 –&gt; 01:08:11,860<br>I got a block on tap</p>
<p>673<br>01:08:11,860 –&gt; 01:08:13,299<br>The fets can’t trace that</p>
<p>674<br>01:08:13,299 –&gt; 01:08:14,860<br>Style is like tent for proof</p>
<p>675<br>01:08:14,860 –&gt; 01:08:16,779<br>You can’t lace that at the Dominican</p>
<p>676<br>01:08:16,779 –&gt; 01:08:18,619<br>Oh you could call me Dominican</p>
<p>677<br>01:08:18,619 –&gt; 01:08:20,019<br>Black Skelly, black, nothing</p>
<p>678<br>01:08:20,019 –&gt; 01:08:21,260<br>Blacks, weight, dimmelings</p>
<p>679<br>01:08:21,260 –&gt; 01:08:24,140<br>My poor black 38 is sent you to the perigates</p>
<p>680<br>01:08:24,140 –&gt; 01:08:25,659<br>You get the zombie trying to skate</p>
<p>681<br>01:08:25,659 –&gt; 01:08:26,859<br>And that’s your first instinct</p>
<p>682<br>01:08:26,859 –&gt; 01:08:28,220<br>I ain’t lying for that cake</p>
<p>683<br>01:08:28,220 –&gt; 01:08:29,420<br>You’re famous, see you wait</p>
<p>684<br>01:08:29,420 –&gt; 01:08:30,579<br>My grandson’s happy wait</p>
<p>685<br>01:08:30,579 –&gt; 01:08:31,739<br>The rant do every state</p>
<p>686<br>01:08:31,739 –&gt; 01:08:33,059<br>When they acting how I’m living</p>
<p>687<br>01:08:33,059 –&gt; 01:08:34,539<br>I tell them I’m living great</p>
<p>688<br>01:08:35,100 –&gt; 01:08:36,539<br>I tell them I’m living great</p>
<p>689<br>01:08:36,539 –&gt; 01:08:37,340<br>I tell them I’m living great</p>
<p>690<br>01:08:37,340 –&gt; 01:08:38,539<br>I tell them I’m living great</p>
<p>691<br>01:08:38,539 –&gt; 01:08:39,340<br>I tell them I’m living great</p>
<p>692<br>01:08:39,340 –&gt; 01:08:40,340<br>I tell them I’m living great</p>
<p>693<br>01:08:40,340 –&gt; 01:08:41,340<br>I tell them I’m living great</p>
<p>694<br>01:08:41,340 –&gt; 01:08:42,340<br>I tell them I’m living great</p>
<p>695<br>01:08:42,340 –&gt; 01:08:43,340<br>I tell them I’m living great</p>
<p>696<br>01:08:43,340 –&gt; 01:08:44,340<br>I tell them I’m living great</p>
<p>697<br>01:08:44,340 –&gt; 01:08:45,340<br>I tell them I’m living great</p>
<p>698<br>01:08:45,340 –&gt; 01:08:46,340<br>I tell them I’m living great</p>
<p>699<br>01:08:46,340 –&gt; 01:08:47,340<br>I tell them I’m living great</p>
<p>700<br>01:08:47,340 –&gt; 01:08:48,340<br>I tell them I’m living great</p>
<p>701<br>01:08:48,340 –&gt; 01:08:49,340<br>I tell them I’m living great</p>
<p>702<br>01:08:49,340 –&gt; 01:08:50,340<br>I tell them I’m living great</p>
<p>703<br>01:08:50,340 –&gt; 01:08:51,340<br>I tell them I’m living great</p>
<p>704<br>01:08:51,340 –&gt; 01:08:52,340<br>I tell them I’m living great</p>
<p>705<br>01:08:52,340 –&gt; 01:08:53,340<br>I tell them I’m living great</p>
<p>706<br>01:08:53,340 –&gt; 01:08:54,340<br>I tell them I’m living great</p>
<p>707<br>01:08:54,340 –&gt; 01:08:55,340<br>I tell them I’m living great</p>
<p>708<br>01:08:55,340 –&gt; 01:08:56,340<br>I tell them I’m living great</p>
<p>709<br>01:08:56,340 –&gt; 01:08:57,340<br>I tell them I’m living great</p>
<p>710<br>01:08:57,340 –&gt; 01:08:58,340<br>I tell them I’m living great</p>
<p>711<br>01:08:58,340 –&gt; 01:08:59,340<br>I tell them I’m living great</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CMU15445 P16F202315 ConcurrencyControlTheory</div>
      <div>http://example.com/2025/10/24/CMU15445 P16F202315-ConcurrencyControlTheory/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/24/CMU15445%20P18F202317-TimestampOrderingConcurrencyControl/" title="CMU15445 P18F202317 TimestampOrderingConcurrencyControl">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CMU15445 P18F202317 TimestampOrderingConcurrencyControl</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/24/CMU15445%20P15F202314-QueryPlanningOptimization/" title="CMU15445 P15F202314 QueryPlanningOptimization">
                        <span class="hidden-mobile">CMU15445 P15F202314 QueryPlanningOptimization</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
