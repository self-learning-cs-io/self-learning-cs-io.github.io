

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:27,960DGGPL is not here. 200:00:28,460 –&gt; 00:00:52,520The veteran’ 300:00:52,520 –&gt; 00:00:54,780is 400:00:54,780 –&gt; 00:00:57,679single store talk about their distrib">
<meta property="og:type" content="article">
<meta property="og:title" content="CMU15445 P23F202322 DistributedTransactionProcessingDatabases">
<meta property="og:url" content="http://example.com/2025/10/24/CMU15445%20P23F202322-DistributedTransactionProcessingDatabases/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:27,960DGGPL is not here. 200:00:28,460 –&gt; 00:00:52,520The veteran’ 300:00:52,520 –&gt; 00:00:54,780is 400:00:54,780 –&gt; 00:00:57,679single store talk about their distrib">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-24T12:00:44.474Z">
<meta property="article:modified_time" content="2025-10-24T12:06:28.542Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>CMU15445 P23F202322 DistributedTransactionProcessingDatabases - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CMU15445 P23F202322 DistributedTransactionProcessingDatabases"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-24 20:00" pubdate>
          2025年10月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          20k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          168 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CMU15445 P23F202322 DistributedTransactionProcessingDatabases</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:27,960<br>DGGPL is not here.</p>
<p>2<br>00:00:28,460 –&gt; 00:00:52,520<br>The veteran’</p>
<p>3<br>00:00:52,520 –&gt; 00:00:54,780<br>is</p>
<p>4<br>00:00:54,780 –&gt; 00:00:57,679<br>single store talk about their distributed database system.</p>
<p>5<br>00:00:57,679 –&gt; 00:00:59,579<br>And again, it’ll cover a lot of the co-ideas.</p>
<p>6<br>00:00:59,579 –&gt; 00:01:02,300<br>We’ve been talking about this entire semester.</p>
<p>7<br>00:01:02,300 –&gt; 00:01:03,780<br>And then you realize, oh, Andy’s not crazy.</p>
<p>8<br>00:01:03,780 –&gt; 00:01:05,780<br>And this may be up like this is what</p>
<p>9<br>00:01:05,780 –&gt; 00:01:08,579<br>healthy will really build systems.</p>
<p>10<br>00:01:08,579 –&gt; 00:01:10,299<br>And then as I post it on Piotr yesterday,</p>
<p>11<br>00:01:10,299 –&gt; 00:01:11,140<br>please go vote.</p>
<p>12<br>00:01:11,140 –&gt; 00:01:12,980<br>We’ll do a speed run in the last day of class.</p>
<p>13<br>00:01:12,980 –&gt; 00:01:16,219<br>We’ll start off with the final review for the final exam.</p>
<p>14<br>00:01:16,219 –&gt; 00:01:18,780<br>And then we’ll just plow through as many systems as you guys</p>
<p>15<br>00:01:18,780 –&gt; 00:01:20,780<br>want to learn about.</p>
<p>16<br>00:01:20,780 –&gt; 00:01:22,700<br>And again, instead of having a giant drop down</p>
<p>17<br>00:01:22,700 –&gt; 00:01:24,379<br>of 900 different databases, because nobody</p>
<p>18<br>00:01:24,379 –&gt; 00:01:27,140<br>would click that, just copying paste URLs in.</p>
<p>19<br>00:01:27,140 –&gt; 00:01:30,699<br>And that way, I can sort by uniqueness, right?</p>
<p>20<br>00:01:30,699 –&gt; 00:01:33,780<br>Just do a group by it, right?</p>
<p>21<br>00:01:33,780 –&gt; 00:01:34,859<br>Again, there’s a person, Piotr, that</p>
<p>22<br>00:01:34,859 –&gt; 00:01:35,899<br>takes you to the Google form.</p>
<p>23<br>00:01:35,899 –&gt; 00:01:37,259<br>And then vote as many times as you want.</p>
<p>24<br>00:01:37,259 –&gt; 00:01:38,420<br>I don’t care.</p>
<p>25<br>00:01:38,420 –&gt; 00:01:44,899<br>The number one vote as this morning was redis.</p>
<p>26<br>00:01:44,899 –&gt; 00:01:45,979<br>The interesting system.</p>
<p>27<br>00:01:45,979 –&gt; 00:01:48,060<br>All right, final exam will be Tuesday, December 12.</p>
<p>28<br>00:01:48,060 –&gt; 00:01:49,699<br>Somewhere will announce it.</p>
<p>29<br>00:01:49,699 –&gt; 00:01:51,579<br>It’ll be 8.30 in the morning, because it’s early.</p>
<p>30<br>00:01:51,579 –&gt; 00:01:52,379<br>And that sucks.</p>
<p>31<br>00:01:52,379 –&gt; 00:01:55,859<br>We’ll do coffee donuts and cigarettes for everyone in the morning.</p>
<p>32<br>00:01:55,859 –&gt; 00:01:59,299<br>And then Jake Nash is teaching this class by himself in the fall.</p>
<p>33<br>00:01:59,299 –&gt; 00:02:01,699<br>So if you want more databases, I’m</p>
<p>34<br>00:02:01,699 –&gt; 00:02:03,579<br>going to go even deeper into bus tub.</p>
<p>35<br>00:02:03,579 –&gt; 00:02:05,219<br>Please sign up for the VTA.</p>
<p>36<br>00:02:05,219 –&gt; 00:02:05,719<br>OK?</p>
<p>37<br>00:02:05,719 –&gt; 00:02:08,099<br>And we’ll post on Piotr to how to make that happen.</p>
<p>38<br>00:02:08,099 –&gt; 00:02:10,060<br>All right?</p>
<p>39<br>00:02:10,060 –&gt; 00:02:11,300<br>There’s a lot here, any questions?</p>
<p>40<br>00:02:11,300 –&gt; 00:02:12,300<br>Run this dump and answer, master.</p>
<p>41<br>00:02:15,659 –&gt; 00:02:16,419<br>OK.</p>
<p>42<br>00:02:16,419 –&gt; 00:02:18,340<br>Let’s go through it.</p>
<p>43<br>00:02:18,340 –&gt; 00:02:20,900<br>So last class, we started off talking about distributed database</p>
<p>44<br>00:02:20,900 –&gt; 00:02:21,419<br>systems.</p>
<p>45<br>00:02:21,739 –&gt; 00:02:24,179<br>It was a high level introduction to the key concepts</p>
<p>46<br>00:02:24,179 –&gt; 00:02:26,819<br>about how people think about and reason</p>
<p>47<br>00:02:26,819 –&gt; 00:02:29,139<br>and design these database systems.</p>
<p>48<br>00:02:29,139 –&gt; 00:02:30,979<br>And again, unfortunately, there’s no distributed</p>
<p>49<br>00:02:30,979 –&gt; 00:02:34,099<br>database system course at Carnegie Mellon.</p>
<p>50<br>00:02:34,099 –&gt; 00:02:35,819<br>Eventually, maybe we’ll teach you, but right now it’s just</p>
<p>51<br>00:02:35,819 –&gt; 00:02:36,859<br>just to connect myself.</p>
<p>52<br>00:02:36,859 –&gt; 00:02:37,539<br>So we can’t do that.</p>
<p>53<br>00:02:37,539 –&gt; 00:02:40,500<br>So this last lecture and this week’s lecture,</p>
<p>54<br>00:02:40,500 –&gt; 00:02:42,500<br>it’s really much all you’ll be able to get</p>
<p>55<br>00:02:42,500 –&gt; 00:02:46,459<br>out of distributed databases in low-level detail</p>
<p>56<br>00:02:46,459 –&gt; 00:02:49,219<br>at Carnegie Mellon.</p>
<p>57<br>00:02:49,219 –&gt; 00:02:52,780<br>But again, the ideas just sort of give you a lit</p>
<p>58<br>00:02:52,780 –&gt; 00:02:56,060<br>of different concepts and ideas and techniques.</p>
<p>59<br>00:02:56,060 –&gt; 00:02:57,939<br>And then that way when you go out in the real world,</p>
<p>60<br>00:02:57,939 –&gt; 00:02:59,340<br>you’ll see these ideas come up.</p>
<p>61<br>00:02:59,340 –&gt; 00:03:01,020<br>And then you can reason about what</p>
<p>62<br>00:03:01,020 –&gt; 00:03:02,659<br>help people describe their systems.</p>
<p>63<br>00:03:02,659 –&gt; 00:03:04,259<br>So we started off talking about the different system</p>
<p>64<br>00:03:04,259 –&gt; 00:03:04,819<br>architectures.</p>
<p>65<br>00:03:04,819 –&gt; 00:03:07,219<br>We said shared everything is basically what bus tub is.</p>
<p>66<br>00:03:07,219 –&gt; 00:03:10,060<br>It’s a single node system where everyone can communicate.</p>
<p>67<br>00:03:10,060 –&gt; 00:03:12,699<br>The processes are workers can communicate very quickly.</p>
<p>68<br>00:03:12,699 –&gt; 00:03:14,139<br>And then shared disk and shared nothing</p>
<p>69<br>00:03:14,139 –&gt; 00:03:18,020<br>are the two major distributed database architectures</p>
<p>70<br>00:03:18,020 –&gt; 00:03:18,939<br>where shared disk was.</p>
<p>71<br>00:03:18,939 –&gt; 00:03:24,099<br>There’s a single repository or a single storage device</p>
<p>72<br>00:03:24,099 –&gt; 00:03:27,699<br>that all the worker nodes can read and write to.</p>
<p>73<br>00:03:27,699 –&gt; 00:03:29,579<br>And then shared nothing is where each worker node,</p>
<p>74<br>00:03:29,579 –&gt; 00:03:32,900<br>each node, and the system has some portion of the database.</p>
<p>75<br>00:03:32,900 –&gt; 00:03:34,539<br>And you have the same messages and pass</p>
<p>76<br>00:03:34,539 –&gt; 00:03:36,379<br>data between the nodes directly.</p>
<p>77<br>00:03:36,379 –&gt; 00:03:38,539<br>Then we talked about how to do partitioning or sharding,</p>
<p>78<br>00:03:38,539 –&gt; 00:03:40,219<br>simple range partitioning, hash partitioning,</p>
<p>79<br>00:03:40,219 –&gt; 00:03:43,259<br>again splitting the database up into disjointed subsets,</p>
<p>80<br>00:03:43,259 –&gt; 00:03:46,900<br>and distributing them across different nodes.</p>
<p>81<br>00:03:46,900 –&gt; 00:03:48,460<br>And then we talked about how to do transaction</p>
<p>82<br>00:03:48,460 –&gt; 00:03:49,900<br>condition at a high level.</p>
<p>83<br>00:03:49,900 –&gt; 00:03:52,659<br>Is there a centralized coordinator that’s in charge</p>
<p>84<br>00:03:52,659 –&gt; 00:03:55,340<br>of taking all the queries, figuring out what locks or what</p>
<p>85<br>00:03:55,340 –&gt; 00:03:57,500<br>data they’re going to touch, and communicating</p>
<p>86<br>00:03:57,500 –&gt; 00:03:59,980<br>to the different nodes, or is it decentralized,</p>
<p>87<br>00:03:59,980 –&gt; 00:04:03,300<br>meaning the nodes are free to decide on their own</p>
<p>88<br>00:04:03,300 –&gt; 00:04:07,420<br>how they’re going to commit and order transactions.</p>
<p>89<br>00:04:07,420 –&gt; 00:04:10,540<br>So today’s class, we’re going to focus on transaction</p>
<p>90<br>00:04:10,540 –&gt; 00:04:11,700<br>processing.</p>
<p>91<br>00:04:11,700 –&gt; 00:04:15,460<br>When’s this class will be about analytical processing</p>
<p>92<br>00:04:15,460 –&gt; 00:04:17,740<br>or decision support systems?</p>
<p>93<br>00:04:17,740 –&gt; 00:04:19,420<br>And again, we’ve talked about this many times.</p>
<p>94<br>00:04:19,420 –&gt; 00:04:21,019<br>I just want to bring up the distinction between the two</p>
<p>95<br>00:04:21,019 –&gt; 00:04:26,139<br>workloads today, again, because then that’ll help us understand</p>
<p>96<br>00:04:26,139 –&gt; 00:04:28,500<br>what are the different design trade-offs or things</p>
<p>97<br>00:04:28,500 –&gt; 00:04:31,699<br>we’re going to care about in one sort of category of a system</p>
<p>98<br>00:04:31,699 –&gt; 00:04:33,460<br>versus another.</p>
<p>99<br>00:04:33,460 –&gt; 00:04:36,740<br>Think of something like Postgres is meant to be</p>
<p>100<br>00:04:36,740 –&gt; 00:04:38,660<br>like a general purpose database system.</p>
<p>101<br>00:04:38,660 –&gt; 00:04:41,540<br>It is a row store, and it can use transactions.</p>
<p>102<br>00:04:41,540 –&gt; 00:04:44,620<br>Primarily people use it for OTP, but there are some aspects</p>
<p>103<br>00:04:44,620 –&gt; 00:04:48,340<br>of that you would see in OLAP system.</p>
<p>104<br>00:04:48,340 –&gt; 00:04:50,379<br>But there are certain things that Postgres does that you</p>
<p>105<br>00:04:50,379 –&gt; 00:04:52,139<br>wouldn’t want to use in a snowflake system,</p>
<p>106<br>00:04:52,139 –&gt; 00:04:55,180<br>because they’re not worried about running transactions.</p>
<p>107<br>00:04:55,180 –&gt; 00:04:57,819<br>So the two rough categories can be sort of broken</p>
<p>108<br>00:04:57,819 –&gt; 00:05:00,899<br>between these characteristics.</p>
<p>109<br>00:05:00,899 –&gt; 00:05:03,060<br>So for OTP workloads, these transactions</p>
<p>110<br>00:05:03,060 –&gt; 00:05:05,259<br>are going to be short-lived, and there</p>
<p>111<br>00:05:05,259 –&gt; 00:05:07,699<br>going to be a combination of read-write queries.</p>
<p>112<br>00:05:07,699 –&gt; 00:05:11,620<br>Short-lived means less than 100 milliseconds,</p>
<p>113<br>00:05:11,620 –&gt; 00:05:12,620<br>even that’s a long time.</p>
<p>114<br>00:05:12,620 –&gt; 00:05:14,300<br>50 milliseconds is considered the max.</p>
<p>115<br>00:05:14,540 –&gt; 00:05:16,699<br>You want to have for a transaction.</p>
<p>116<br>00:05:16,699 –&gt; 00:05:18,939<br>Anything along with them, that is considered</p>
<p>117<br>00:05:18,939 –&gt; 00:05:20,780<br>a longer run transaction.</p>
<p>118<br>00:05:20,780 –&gt; 00:05:22,860<br>And that number comes from, that 50 milliseconds</p>
<p>119<br>00:05:22,860 –&gt; 00:05:26,900<br>is like the conventional wisdom in internet advertising.</p>
<p>120<br>00:05:26,900 –&gt; 00:05:28,460<br>Like when you go visit a website,</p>
<p>121<br>00:05:28,460 –&gt; 00:05:29,900<br>so you don’t have an abloc or turned on.</p>
<p>122<br>00:05:29,900 –&gt; 00:05:31,980<br>If you don’t, please do that.</p>
<p>123<br>00:05:31,980 –&gt; 00:05:33,900<br>When you go visit a website, there’s an abloc or turned on.</p>
<p>124<br>00:05:33,900 –&gt; 00:05:34,580<br>Sorry.</p>
<p>125<br>00:05:34,580 –&gt; 00:05:37,620<br>If you go visit a website, the ad-serving company</p>
<p>126<br>00:05:37,620 –&gt; 00:05:39,939<br>has an auction that it sends out information</p>
<p>127<br>00:05:39,939 –&gt; 00:05:43,139<br>to all the people that want to potentially put out ads</p>
<p>128<br>00:05:43,139 –&gt; 00:05:44,220<br>to do a bid on it.</p>
<p>129<br>00:05:44,220 –&gt; 00:05:45,820<br>They say, here’s the information about this person visiting</p>
<p>130<br>00:05:45,820 –&gt; 00:05:46,500<br>website.</p>
<p>131<br>00:05:46,500 –&gt; 00:05:48,380<br>And you have to give back a response roughly</p>
<p>132<br>00:05:48,380 –&gt; 00:05:49,820<br>in 50 milliseconds.</p>
<p>133<br>00:05:49,820 –&gt; 00:05:51,980<br>So roughly, that’s where this number comes from.</p>
<p>134<br>00:05:51,980 –&gt; 00:05:54,300<br>It might be down to 30 milliseconds nowadays.</p>
<p>135<br>00:05:54,300 –&gt; 00:05:55,380<br>If you’re doing high-frequency trading,</p>
<p>136<br>00:05:55,380 –&gt; 00:05:56,940<br>those guys are freaks, and they want things less</p>
<p>137<br>00:05:56,940 –&gt; 00:05:58,700<br>than a millisecond.</p>
<p>138<br>00:05:58,700 –&gt; 00:06:00,740<br>But the workload basically still looks the same.</p>
<p>139<br>00:06:00,740 –&gt; 00:06:03,300<br>It’s a lot of small gets and sets.</p>
<p>140<br>00:06:03,300 –&gt; 00:06:05,580<br>And then these operations are going to be very repetitive.</p>
<p>141<br>00:06:05,580 –&gt; 00:06:07,300<br>Again, think of going through a website,</p>
<p>142<br>00:06:07,300 –&gt; 00:06:09,300<br>you can only do certain many things on a website.</p>
<p>143<br>00:06:09,300 –&gt; 00:06:10,580<br>You’re not sitting at a raw terminal,</p>
<p>144<br>00:06:10,580 –&gt; 00:06:11,900<br>putting in a SQL query.</p>
<p>145<br>00:06:11,900 –&gt; 00:06:13,340<br>So you’re running application code that’s</p>
<p>146<br>00:06:13,339 –&gt; 00:06:15,459<br>going to be running the same queries over and over again.</p>
<p>147<br>00:06:15,459 –&gt; 00:06:16,979<br>And there’s certain oppositions you can do</p>
<p>148<br>00:06:16,979 –&gt; 00:06:18,459<br>if you know you’re going to be running the same queries over</p>
<p>149<br>00:06:18,459 –&gt; 00:06:19,659<br>and over again.</p>
<p>150<br>00:06:19,659 –&gt; 00:06:22,739<br>In other lab, we’re going to focus this, focus more on this workload</p>
<p>151<br>00:06:22,739 –&gt; 00:06:24,219<br>on Wednesday.</p>
<p>152<br>00:06:24,219 –&gt; 00:06:25,859<br>But these are your long running queries,</p>
<p>153<br>00:06:25,859 –&gt; 00:06:28,459<br>typically read only, doing a lot of joins.</p>
<p>154<br>00:06:28,459 –&gt; 00:06:32,939<br>And oftentimes, they’ll be one off ad-hot queries.</p>
<p>155<br>00:06:32,939 –&gt; 00:06:34,579<br>Because someone sitting in that dashboard,</p>
<p>156<br>00:06:34,579 –&gt; 00:06:36,500<br>clicking a bunch of buttons to form a query,</p>
<p>157<br>00:06:36,500 –&gt; 00:06:38,859<br>they click go to generate the visualization.</p>
<p>158<br>00:06:38,859 –&gt; 00:06:41,339<br>And maybe the first time that the database system has</p>
<p>159<br>00:06:41,339 –&gt; 00:06:42,500<br>ever seen that query.</p>
<p>160<br>00:06:42,500 –&gt; 00:06:44,180<br>And it may never see it again.</p>
<p>161<br>00:06:44,180 –&gt; 00:06:46,939<br>So that limits what sort of optimizations</p>
<p>162<br>00:06:46,939 –&gt; 00:06:49,500<br>you can do.</p>
<p>163<br>00:06:49,500 –&gt; 00:06:53,139<br>So this is the setup that we sort of care about today.</p>
<p>164<br>00:06:53,139 –&gt; 00:06:54,740<br>We have some application server that</p>
<p>165<br>00:06:54,740 –&gt; 00:06:56,939<br>wants to run a transaction that’s going to touch data</p>
<p>166<br>00:06:56,939 –&gt; 00:06:58,899<br>these three partitions.</p>
<p>167<br>00:06:58,899 –&gt; 00:07:02,300<br>I’m not saying whether it’s shared disk or shared nothing</p>
<p>168<br>00:07:02,300 –&gt; 00:07:04,379<br>for our purposes right now, it doesn’t matter.</p>
<p>169<br>00:07:04,379 –&gt; 00:07:07,980<br>So somehow, we’ve elected this one first partition here</p>
<p>170<br>00:07:07,980 –&gt; 00:07:09,379<br>to be the primary node.</p>
<p>171<br>00:07:09,379 –&gt; 00:07:12,300<br>So to begin request where the transaction goes to this node,</p>
<p>172<br>00:07:12,300 –&gt; 00:07:14,460<br>and let’s say there’s a node-centralized coordinator,</p>
<p>173<br>00:07:14,460 –&gt; 00:07:16,780<br>and the application is allowed to send queries directly</p>
<p>174<br>00:07:16,780 –&gt; 00:07:19,900<br>to the various nodes.</p>
<p>175<br>00:07:19,900 –&gt; 00:07:21,100<br>And then when it comes time to commit,</p>
<p>176<br>00:07:21,100 –&gt; 00:07:22,939<br>it goes to the primary node, said, hey, can I commit?</p>
<p>177<br>00:07:22,939 –&gt; 00:07:25,780<br>And the primary node is responsible for fitting out</p>
<p>178<br>00:07:25,780 –&gt; 00:07:28,500<br>amongst the nodes that participate in the transaction,</p>
<p>179<br>00:07:28,500 –&gt; 00:07:31,259<br>whether this thing’s allowed to commit.</p>
<p>180<br>00:07:31,259 –&gt; 00:07:34,900<br>So our focus relates to today is, is this sort of safe commit</p>
<p>181<br>00:07:34,900 –&gt; 00:07:38,540<br>step, and how to get everyone to agree that yes, this transaction</p>
<p>182<br>00:07:38,540 –&gt; 00:07:39,460<br>is safe to commit.</p>
<p>183<br>00:07:39,460 –&gt; 00:07:41,900<br>And then if they all say yes, it’s going to commit</p>
<p>184<br>00:07:41,899 –&gt; 00:07:45,739<br>that we commit it.</p>
<p>185<br>00:07:45,739 –&gt; 00:07:50,419<br>And all the stuff we talked about for two-phase locking,</p>
<p>186<br>00:07:50,419 –&gt; 00:07:52,739<br>a multi-virtual control, or OCC, all of that</p>
<p>187<br>00:07:52,739 –&gt; 00:07:54,819<br>is still happening here.</p>
<p>188<br>00:07:54,819 –&gt; 00:07:58,539<br>That’s still the mechanism that’s going to use to determine</p>
<p>189<br>00:07:58,539 –&gt; 00:08:01,179<br>is this thing allowed to commit on each individual node.</p>
<p>190<br>00:08:01,179 –&gt; 00:08:03,259<br>And then there’s a high little process above that</p>
<p>191<br>00:08:03,259 –&gt; 00:08:06,060<br>that’s trying to get everyone to agree that it’s now time</p>
<p>192<br>00:08:06,060 –&gt; 00:08:08,099<br>to commit this transaction.</p>
<p>193<br>00:08:08,099 –&gt; 00:08:11,859<br>So that’s the big picture what we’re trying to do today.</p>
<p>194<br>00:08:12,139 –&gt; 00:08:14,699<br>And so again, even though my last example,</p>
<p>195<br>00:08:14,699 –&gt; 00:08:16,340<br>I showed the application going directly</p>
<p>196<br>00:08:16,340 –&gt; 00:08:18,220<br>to different partitions, ignored that for now.</p>
<p>197<br>00:08:18,220 –&gt; 00:08:21,540<br>But the big picture what we’re trying to achieve today</p>
<p>198<br>00:08:21,540 –&gt; 00:08:24,259<br>is that, and as you would want in any distributed data</p>
<p>199<br>00:08:24,259 –&gt; 00:08:27,540<br>system, is that you would have a multi,</p>
<p>200<br>00:08:27,540 –&gt; 00:08:29,780<br>or you wouldn’t have a single logical view</p>
<p>201<br>00:08:29,780 –&gt; 00:08:31,540<br>against a single database system,</p>
<p>202<br>00:08:31,540 –&gt; 00:08:33,259<br>even though underneath the covers, it’s comprised</p>
<p>203<br>00:08:33,259 –&gt; 00:08:37,060<br>by multiple physical servers or multiple physical resources.</p>
<p>204<br>00:08:37,060 –&gt; 00:08:39,300<br>And so we haven’t talked about how, again,</p>
<p>205<br>00:08:39,300 –&gt; 00:08:41,379<br>we’re going to get a transaction, or to her node</p>
<p>206<br>00:08:41,379 –&gt; 00:08:43,500<br>to agree that we committed a transaction.</p>
<p>207<br>00:08:43,500 –&gt; 00:08:45,500<br>And then if we decide that it is going to commit,</p>
<p>208<br>00:08:45,500 –&gt; 00:08:47,860<br>how do we make sure that it does commit?</p>
<p>209<br>00:08:47,860 –&gt; 00:08:50,220<br>And if there’s a crash, there’s a failure</p>
<p>210<br>00:08:50,220 –&gt; 00:08:52,659<br>that when this system comes back up,</p>
<p>211<br>00:08:52,659 –&gt; 00:08:54,620<br>that if we set, we told the outside world</p>
<p>212<br>00:08:54,620 –&gt; 00:08:57,820<br>that a transaction committed, we have to make that guarantee.</p>
<p>213<br>00:08:58,899 –&gt; 00:09:03,860<br>That’s the de-in-asset, the durability guarantee.</p>
<p>214<br>00:09:03,860 –&gt; 00:09:06,059<br>But then if the whole thing is down, come back up,</p>
<p>215<br>00:09:06,059 –&gt; 00:09:07,259<br>then that’s one thing.</p>
<p>216<br>00:09:07,259 –&gt; 00:09:10,379<br>But what happens if one node goes down, which will happen?</p>
<p>217<br>00:09:11,100 –&gt; 00:09:12,259<br>How do we do with that?</p>
<p>218<br>00:09:12,259 –&gt; 00:09:13,500<br>Well, what happens if we send a message</p>
<p>219<br>00:09:13,500 –&gt; 00:09:16,620<br>of committed transaction, and then the message</p>
<p>220<br>00:09:16,620 –&gt; 00:09:18,379<br>can disappear somehow?</p>
<p>221<br>00:09:18,379 –&gt; 00:09:20,820<br>Because someone tripped over the cable,</p>
<p>222<br>00:09:20,820 –&gt; 00:09:23,779<br>there’s a weird hiccup in the network or something.</p>
<p>223<br>00:09:23,779 –&gt; 00:09:25,939<br>And then now our message to commit this transaction</p>
<p>224<br>00:09:25,939 –&gt; 00:09:27,299<br>shows up late.</p>
<p>225<br>00:09:27,299 –&gt; 00:09:28,139<br>What do we do?</p>
<p>226<br>00:09:28,139 –&gt; 00:09:30,259<br>What does the node do in that setting?</p>
<p>227<br>00:09:31,220 –&gt; 00:09:32,779<br>And then what happens if every node,</p>
<p>228<br>00:09:34,139 –&gt; 00:09:35,419<br>sorry, what happens if the system,</p>
<p>229<br>00:09:35,419 –&gt; 00:09:38,620<br>we don’t want to wait for everyone to read a commit,</p>
<p>230<br>00:09:38,620 –&gt; 00:09:40,179<br>but we still want to commit in some cases,</p>
<p>231<br>00:09:40,179 –&gt; 00:09:41,819<br>or we don’t want to block everything in case</p>
<p>232<br>00:09:41,819 –&gt; 00:09:42,939<br>a one node goes down.</p>
<p>233<br>00:09:46,459 –&gt; 00:09:48,859<br>So one very, very important assumption</p>
<p>234<br>00:09:48,859 –&gt; 00:09:50,779<br>that we’re going to make in today’s discussion</p>
<p>235<br>00:09:51,899 –&gt; 00:09:54,099<br>is that we’re going to assume that all the nodes</p>
<p>236<br>00:09:54,099 –&gt; 00:09:55,739<br>in our distributed database system</p>
<p>237<br>00:09:55,739 –&gt; 00:09:57,539<br>are going to be well behaved</p>
<p>238<br>00:09:57,539 –&gt; 00:09:59,899<br>and under the same administrative domain.</p>
<p>239<br>00:09:59,899 –&gt; 00:10:01,299<br>And what I mean by that is,</p>
<p>240<br>00:10:01,299 –&gt; 00:10:03,659<br>these are nodes that if you’re the database system operator,</p>
<p>241<br>00:10:03,659 –&gt; 00:10:06,500<br>these are nodes you control, you own, or you’re renting,</p>
<p>242<br>00:10:06,500 –&gt; 00:10:08,979<br>or whatever, and it’s running software</p>
<p>243<br>00:10:08,980 –&gt; 00:10:12,899<br>that it’s expected to run as part of the database server.</p>
<p>244<br>00:10:15,019 –&gt; 00:10:20,019<br>So that does mean that we’re not in this weird untrusted world</p>
<p>245<br>00:10:21,420 –&gt; 00:10:24,180<br>where there’s some nodes in our distributed database</p>
<p>246<br>00:10:24,180 –&gt; 00:10:25,860<br>that we don’t control and we’re renting,</p>
<p>247<br>00:10:25,860 –&gt; 00:10:28,980<br>or like that people are running altruistically or something,</p>
<p>248<br>00:10:28,980 –&gt; 00:10:31,580<br>and it’s not going to be the case</p>
<p>249<br>00:10:31,580 –&gt; 00:10:32,700<br>that we go commit a transaction</p>
<p>250<br>00:10:32,700 –&gt; 00:10:34,580<br>and one node’s going to be nefarious</p>
<p>251<br>00:10:34,580 –&gt; 00:10:36,019<br>and starts trying to screw with us and say,</p>
<p>252<br>00:10:36,019 –&gt; 00:10:37,659<br>no, no, no, no, we’re not going to commit that.</p>
<p>253<br>00:10:37,659 –&gt; 00:10:39,459<br>Or like if everyone agrees that it commits,</p>
<p>254<br>00:10:39,459 –&gt; 00:10:42,299<br>this other node isn’t going to come back later on say,</p>
<p>255<br>00:10:42,299 –&gt; 00:10:44,259<br>hey, you know, I lied,</p>
<p>256<br>00:10:44,259 –&gt; 00:10:45,659<br>I’m reading a commit that transaction</p>
<p>257<br>00:10:45,659 –&gt; 00:10:48,699<br>and start trying to change the state of things, right?</p>
<p>258<br>00:10:49,699 –&gt; 00:10:51,379<br>So that kind of tolerance,</p>
<p>259<br>00:10:51,379 –&gt; 00:10:54,899<br>or that property is called Byzantine fault tolerance,</p>
<p>260<br>00:10:54,899 –&gt; 00:10:57,219<br>right, and that’s what you get if you get a blockchain,</p>
<p>261<br>00:10:58,740 –&gt; 00:11:00,779<br>blockchain basically is just a database,</p>
<p>262<br>00:11:00,779 –&gt; 00:11:03,500<br>a distributed ledger, a distributed write-able.</p>
<p>263<br>00:11:03,500 –&gt; 00:11:06,259<br>And in that world because something like a Bitcoin</p>
<p>264<br>00:11:06,259 –&gt; 00:11:08,220<br>where it’s a bunch of people running</p>
<p>265<br>00:11:08,220 –&gt; 00:11:10,100<br>these peer-to-bear networks where you don’t control,</p>
<p>266<br>00:11:10,100 –&gt; 00:11:11,980<br>no, no, no, there’s no single authority controlling</p>
<p>267<br>00:11:11,980 –&gt; 00:11:16,980<br>all the different nodes, you need a BFT protocol.</p>
<p>268<br>00:11:17,740 –&gt; 00:11:18,860<br>We don’t care about that shit, right?</p>
<p>269<br>00:11:18,860 –&gt; 00:11:22,500<br>That’s a bunch of overhead that we don’t have to deal with.</p>
<p>270<br>00:11:22,500 –&gt; 00:11:25,460<br>And be honest, if you wanted to run transactions at scale,</p>
<p>271<br>00:11:25,460 –&gt; 00:11:27,379<br>you wouldn’t want to use a blockchain anyway,</p>
<p>272<br>00:11:27,379 –&gt; 00:11:30,500<br>because they measure their latencies in like seconds,</p>
<p>273<br>00:11:31,539 –&gt; 00:11:33,700<br>right, if you go to a website and make an order on Amazon</p>
<p>274<br>00:11:33,700 –&gt; 00:11:36,500<br>and takes like 20 seconds to commit that transaction,</p>
<p>275<br>00:11:36,500 –&gt; 00:11:38,980<br>you’re gonna give up, right?</p>
<p>276<br>00:11:38,980 –&gt; 00:11:42,300<br>So nobody runs a real database system</p>
<p>277<br>00:11:42,300 –&gt; 00:11:44,379<br>doing transactions on a blockchain.</p>
<p>278<br>00:11:44,379 –&gt; 00:11:46,980<br>This is stupid, the real one doesn’t work this way,</p>
<p>279<br>00:11:46,980 –&gt; 00:11:48,900<br>we can ignore that entirely, okay?</p>
<p>280<br>00:11:50,100 –&gt; 00:11:52,220<br>So now, another mean of node won’t crash,</p>
<p>281<br>00:11:52,220 –&gt; 00:11:53,980<br>disappear, come back and try to say,</p>
<p>282<br>00:11:53,980 –&gt; 00:11:55,860<br>hey guys, I missed, what’s going on?</p>
<p>283<br>00:11:55,860 –&gt; 00:11:58,300<br>I missed, I missed all the updates.</p>
<p>284<br>00:11:58,300 –&gt; 00:11:59,860<br>And then you gotta go ahead and update.</p>
<p>285<br>00:11:59,860 –&gt; 00:12:03,100<br>But again, that’s just a, that’s a hardware failure,</p>
<p>286<br>00:12:03,100 –&gt; 00:12:05,980<br>and we will have mechanisms to deal with that.</p>
<p>287<br>00:12:05,980 –&gt; 00:12:07,620<br>And we’re still not worried about whether,</p>
<p>288<br>00:12:07,620 –&gt; 00:12:10,500<br>the node is nefarious or not, okay?</p>
<p>289<br>00:12:10,500 –&gt; 00:12:12,460<br>So it makes our lives a lot easier,</p>
<p>290<br>00:12:12,460 –&gt; 00:12:14,820<br>if we don’t worry about visiting fault tolerance.</p>
<p>291<br>00:12:16,860 –&gt; 00:12:20,899<br>All right, so today’s lecture is really me,</p>
<p>292<br>00:12:20,899 –&gt; 00:12:22,460<br>again, attempting to try to cadence</p>
<p>293<br>00:12:22,460 –&gt; 00:12:24,820<br>a year’s worth of material and distributed databases</p>
<p>294<br>00:12:24,820 –&gt; 00:12:26,740<br>into like one or two lectures.</p>
<p>295<br>00:12:26,740 –&gt; 00:12:28,779<br>So we can’t cover everything into detail,</p>
<p>296<br>00:12:28,779 –&gt; 00:12:29,740<br>where to go through like these</p>
<p>297<br>00:12:29,740 –&gt; 00:12:33,019<br>the most important things that you need to be aware of that exists.</p>
<p>298<br>00:12:33,179 –&gt; 00:12:34,699<br>And the challenge you have faced when you have</p>
<p>299<br>00:12:34,699 –&gt; 00:12:36,419<br>a distributed database system.</p>
<p>300<br>00:12:36,419 –&gt; 00:12:39,179<br>So we’re gonna first talk about how,</p>
<p>301<br>00:12:39,179 –&gt; 00:12:41,860<br>what replication looks like in this environment.</p>
<p>302<br>00:12:41,860 –&gt; 00:12:44,100<br>So for most people, like, you know,</p>
<p>303<br>00:12:44,100 –&gt; 00:12:46,100<br>when they say, oh, my database can’t scale,</p>
<p>304<br>00:12:46,100 –&gt; 00:12:48,539<br>the very first step you actually should do is replication.</p>
<p>305<br>00:12:48,539 –&gt; 00:12:49,500<br>You should probably be doing this anyway</p>
<p>306<br>00:12:49,500 –&gt; 00:12:52,100<br>for a high availability and durability.</p>
<p>307<br>00:12:52,100 –&gt; 00:12:56,059<br>But you can actually offload some reads to replicas</p>
<p>308<br>00:12:56,059 –&gt; 00:12:57,819<br>to, depending on your workload,</p>
<p>309<br>00:12:57,819 –&gt; 00:12:58,980<br>to alleviate some of the load</p>
<p>310<br>00:12:58,980 –&gt; 00:13:00,419<br>and start scaling things out.</p>
<p>311<br>00:13:00,419 –&gt; 00:13:02,419<br>So even though most people don’t need</p>
<p>312<br>00:13:02,620 –&gt; 00:13:05,139<br>some massive distributed database system like a spanner,</p>
<p>313<br>00:13:06,620 –&gt; 00:13:08,699<br>you’re gonna need replication, almost always,</p>
<p>314<br>00:13:08,699 –&gt; 00:13:10,339<br>right, if you care about your data.</p>
<p>315<br>00:13:10,339 –&gt; 00:13:12,019<br>Then we’ll talk about time of commit protocols,</p>
<p>316<br>00:13:12,019 –&gt; 00:13:13,339<br>two-page commit, Paxos, RAP,</p>
<p>317<br>00:13:13,339 –&gt; 00:13:14,979<br>to how to actually get everyone to agree.</p>
<p>318<br>00:13:14,979 –&gt; 00:13:17,139<br>And again, I realized there’s a distributed systems course</p>
<p>319<br>00:13:17,139 –&gt; 00:13:18,860<br>at CMU that does a better job</p>
<p>320<br>00:13:18,860 –&gt; 00:13:20,620<br>and spends more time talking about these things.</p>
<p>321<br>00:13:20,620 –&gt; 00:13:23,500<br>But we just wanna describe it in the context of databases.</p>
<p>322<br>00:13:23,500 –&gt; 00:13:25,099<br>And then we’ll talk about consistency issues</p>
<p>323<br>00:13:25,099 –&gt; 00:13:27,980<br>in the context of the cat theorem or Pacellic,</p>
<p>324<br>00:13:27,980 –&gt; 00:13:29,379<br>which the fall up to it.</p>
<p>325<br>00:13:29,379 –&gt; 00:13:31,059<br>Again, in the context of databases.</p>
<p>326<br>00:13:31,059 –&gt; 00:13:31,899<br>And then if you have time,</p>
<p>327<br>00:13:32,179 –&gt; 00:13:34,019<br>you can finish up just talking about spanner real quickly,</p>
<p>328<br>00:13:34,019 –&gt; 00:13:36,659<br>just because it encapsulates a lot of the ideas</p>
<p>329<br>00:13:36,659 –&gt; 00:13:38,100<br>we’ll talk about today.</p>
<p>330<br>00:13:38,100 –&gt; 00:13:41,059<br>And I consider this a state of the art system.</p>
<p>331<br>00:13:41,059 –&gt; 00:13:44,179<br>Even though Google put it out over 10 years ago,</p>
<p>332<br>00:13:44,179 –&gt; 00:13:46,459<br>it does a lot of really interesting things.</p>
<p>333<br>00:13:46,459 –&gt; 00:13:48,579<br>And then you do this one thing that nobody else does,</p>
<p>334<br>00:13:48,579 –&gt; 00:13:51,539<br>which is you can do if you’re Google and have Google money.</p>
<p>335<br>00:13:52,579 –&gt; 00:13:53,419<br>Let me take a guess what that is.</p>
<p>336<br>00:13:53,419 –&gt; 00:13:54,259<br>You know what that is?</p>
<p>337<br>00:13:54,259 –&gt; 00:13:56,179<br>If you’re from the rich spanner,</p>
<p>338<br>00:13:56,179 –&gt; 00:13:57,019<br>what’s one?</p>
<p>339<br>00:13:57,019 –&gt; 00:13:59,899<br>Time of clocks, yes, we’ll get there in a second.</p>
<p>340<br>00:13:59,899 –&gt; 00:14:02,779<br>So spoiler, Google basically puts satellite hookups,</p>
<p>341<br>00:14:02,779 –&gt; 00:14:05,459<br>gets the time from satellites, from GPS satellites,</p>
<p>342<br>00:14:05,459 –&gt; 00:14:07,459<br>and has a time of clocks in every data center.</p>
<p>343<br>00:14:07,459 –&gt; 00:14:12,459<br>And that doesn’t make things magically always in sync,</p>
<p>344<br>00:14:12,459 –&gt; 00:14:13,459<br>but it reduces the bounds.</p>
<p>345<br>00:14:13,459 –&gt; 00:14:15,459<br>You have to, how much time you have to spend waiting</p>
<p>346<br>00:14:15,459 –&gt; 00:14:17,740<br>for new transactions to show up.</p>
<p>347<br>00:14:17,740 –&gt; 00:14:19,819<br>Again, we’ll get there in a second.</p>
<p>348<br>00:14:19,819 –&gt; 00:14:20,899<br>But there’s still gonna new packs of us.</p>
<p>349<br>00:14:20,899 –&gt; 00:14:22,059<br>There’s still gonna new phase commit.</p>
<p>350<br>00:14:22,059 –&gt; 00:14:25,419<br>There’s still gonna do MVC, all these other stuff.</p>
<p>351<br>00:14:25,419 –&gt; 00:14:29,860<br>Okay, so with replication, the idea is that we wanna replicate</p>
<p>352<br>00:14:29,899 –&gt; 00:14:32,580<br>the database, either a portion of it or all of it,</p>
<p>353<br>00:14:32,580 –&gt; 00:14:34,779<br>across multiple nodes.</p>
<p>354<br>00:14:34,779 –&gt; 00:14:36,539<br>And we wanna do this to increase availability</p>
<p>355<br>00:14:36,539 –&gt; 00:14:37,940<br>and in some cases, scalability.</p>
<p>356<br>00:14:37,940 –&gt; 00:14:40,060<br>Not always, but in some cases, yes.</p>
<p>357<br>00:14:40,060 –&gt; 00:14:42,139<br>And again, we wanna do this whether it’s partition or not.</p>
<p>358<br>00:14:42,139 –&gt; 00:14:44,340<br>So partition would be, if I split my database up</p>
<p>359<br>00:14:44,340 –&gt; 00:14:47,740<br>into disjoint sets, I still wanna have multiple copies</p>
<p>360<br>00:14:47,740 –&gt; 00:14:49,139<br>of those disjoint subsets.</p>
<p>361<br>00:14:49,139 –&gt; 00:14:50,659<br>So again, if one node goes down,</p>
<p>362<br>00:14:50,659 –&gt; 00:14:54,659<br>I can still potentially serve the serve queries.</p>
<p>363<br>00:14:54,659 –&gt; 00:14:57,580<br>Or if it’s not partition, which is most database systems,</p>
<p>364<br>00:14:57,580 –&gt; 00:14:59,860<br>then I wanna be able to use the replicas</p>
<p>365<br>00:14:59,860 –&gt; 00:15:02,660<br>for off-loading these read-only queries.</p>
<p>366<br>00:15:03,780 –&gt; 00:15:05,460<br>Right, so the idea is again, we wanna make multiple copies</p>
<p>367<br>00:15:05,460 –&gt; 00:15:07,100<br>of data so that if any node goes down,</p>
<p>368<br>00:15:07,100 –&gt; 00:15:09,259<br>we can still potentially remain online.</p>
<p>369<br>00:15:10,780 –&gt; 00:15:12,820<br>So there’s much design history at the side,</p>
<p>370<br>00:15:12,820 –&gt; 00:15:16,139<br>put in our system, if we wanna add replication.</p>
<p>371<br>00:15:16,139 –&gt; 00:15:18,540<br>So what the sort of overall configuration</p>
<p>372<br>00:15:18,540 –&gt; 00:15:20,780<br>of the architectures look like,</p>
<p>373<br>00:15:20,780 –&gt; 00:15:22,580<br>how we’re gonna propagate the updates,</p>
<p>374<br>00:15:22,580 –&gt; 00:15:24,420<br>when should we propagate the updates,</p>
<p>375<br>00:15:24,419 –&gt; 00:15:27,500<br>and then the method in which we propagate those updates?</p>
<p>376<br>00:15:30,219 –&gt; 00:15:31,539<br>So at a high level, basically,</p>
<p>377<br>00:15:31,539 –&gt; 00:15:33,699<br>there’s two approaches to do replication.</p>
<p>378<br>00:15:33,699 –&gt; 00:15:36,219<br>You have what it’s called primary replica and multi-primary.</p>
<p>379<br>00:15:36,219 –&gt; 00:15:38,099<br>So primary replica is the most common one.</p>
<p>380<br>00:15:39,899 –&gt; 00:15:42,500<br>Sometimes you’ll see this as later follower.</p>
<p>381<br>00:15:42,500 –&gt; 00:15:45,299<br>The order terms use master slave.</p>
<p>382<br>00:15:45,299 –&gt; 00:15:46,699<br>We obviously don’t say that anymore.</p>
<p>383<br>00:15:46,699 –&gt; 00:15:49,379<br>Problem is like a lot of the literature that describes</p>
<p>384<br>00:15:49,379 –&gt; 00:15:52,980<br>this configuration is gonna be bit order,</p>
<p>385<br>00:15:52,980 –&gt; 00:15:54,940<br>so you have the Google master slave,</p>
<p>386<br>00:15:54,940 –&gt; 00:15:57,980<br>but usually the newer stuff will refer to as primary replica.</p>
<p>387<br>00:15:58,820 –&gt; 00:16:00,980<br>The idea here is that all updates</p>
<p>388<br>00:16:00,980 –&gt; 00:16:04,420<br>are gonna go to a single node, primary node,</p>
<p>389<br>00:16:04,420 –&gt; 00:16:06,980<br>in the database, right?</p>
<p>390<br>00:16:06,980 –&gt; 00:16:09,180<br>And it’s the V, that primary’s responsibility</p>
<p>391<br>00:16:09,180 –&gt; 00:16:12,500<br>to then propagate those updates to any replicas, right?</p>
<p>392<br>00:16:12,500 –&gt; 00:16:14,580<br>And later follower primary replica.</p>
<p>393<br>00:16:15,539 –&gt; 00:16:17,500<br>And in some cases, depending on the system,</p>
<p>394<br>00:16:17,500 –&gt; 00:16:20,460<br>how they expose this capability,</p>
<p>395<br>00:16:20,460 –&gt; 00:16:22,740<br>you’ll allow read only transactions</p>
<p>396<br>00:16:22,740 –&gt; 00:16:26,620<br>to run queries on those replicas.</p>
<p>397<br>00:16:26,620 –&gt; 00:16:31,620<br>And you can do this because if everything’s all transactional,</p>
<p>398<br>00:16:31,620 –&gt; 00:16:35,220<br>meaning if I do a transactional update on the primary,</p>
<p>399<br>00:16:35,220 –&gt; 00:16:36,700<br>then I’d propagate that transactional update</p>
<p>400<br>00:16:36,700 –&gt; 00:16:40,379<br>to the replica and that update is atomic,</p>
<p>401<br>00:16:40,379 –&gt; 00:16:42,860<br>then any read query will see a consistent view</p>
<p>402<br>00:16:42,860 –&gt; 00:16:46,460<br>of the database on the replica.</p>
<p>403<br>00:16:47,420 –&gt; 00:16:49,259<br>It may not be the most up to date version,</p>
<p>404<br>00:16:49,259 –&gt; 00:16:50,740<br>depending on how we propagate the updates,</p>
<p>405<br>00:16:50,740 –&gt; 00:16:52,980<br>but it’ll be least consistent.</p>
<p>406<br>00:16:52,980 –&gt; 00:16:54,500<br>And of course, you can relax that</p>
<p>407<br>00:16:54,500 –&gt; 00:16:59,220<br>and see partial updates if you want, right?</p>
<p>408<br>00:16:59,220 –&gt; 00:17:01,179<br>So then what happens is if the,</p>
<p>409<br>00:17:02,139 –&gt; 00:17:04,259<br>in the event the primary goes down,</p>
<p>410<br>00:17:04,259 –&gt; 00:17:06,140<br>will hold some kind of election process,</p>
<p>411<br>00:17:06,140 –&gt; 00:17:08,779<br>which will be Paxos or something,</p>
<p>412<br>00:17:08,779 –&gt; 00:17:11,859<br>and one of the replicas become a new primary,</p>
<p>413<br>00:17:11,859 –&gt; 00:17:14,619<br>and then now all the rights will go to that,</p>
<p>414<br>00:17:14,619 –&gt; 00:17:16,980<br>to that new primary, right?</p>
<p>415<br>00:17:16,980 –&gt; 00:17:18,740<br>And at the old primary, it becomes back up,</p>
<p>416<br>00:17:18,740 –&gt; 00:17:22,700<br>it’ll get relegated to be a replica.</p>
<p>417<br>00:17:22,700 –&gt; 00:17:25,140<br>Again, we’ll handle that in a second.</p>
<p>418<br>00:17:25,140 –&gt; 00:17:26,700<br>All right, so this is the, the top one here</p>
<p>419<br>00:17:26,700 –&gt; 00:17:28,299<br>is what most people are gonna do.</p>
<p>420<br>00:17:29,700 –&gt; 00:17:31,660<br>The bottom one, the bottom one, multi primary,</p>
<p>421<br>00:17:31,660 –&gt; 00:17:33,579<br>sometimes called multi-home,</p>
<p>422<br>00:17:33,579 –&gt; 00:17:37,460<br>this is where the, the replica, every object</p>
<p>423<br>00:17:37,460 –&gt; 00:17:39,819<br>we replicated in cross-mortal nodes,</p>
<p>424<br>00:17:39,819 –&gt; 00:17:42,859<br>and any transaction can update that object,</p>
<p>425<br>00:17:42,859 –&gt; 00:17:46,460<br>like a record table, whatever, at any possible node.</p>
<p>426<br>00:17:46,460 –&gt; 00:17:47,859<br>And then when you go to commit,</p>
<p>427<br>00:17:47,859 –&gt; 00:17:50,099<br>now the replicas need to synchronize amongst each other,</p>
<p>428<br>00:17:50,099 –&gt; 00:17:52,299<br>because they’re all considered leaders,</p>
<p>429<br>00:17:52,299 –&gt; 00:17:55,099<br>or the primary, they need to coordinate</p>
<p>430<br>00:17:55,099 –&gt; 00:17:56,500<br>with each other to figure out, okay,</p>
<p>431<br>00:17:56,500 –&gt; 00:17:58,859<br>like who’s allowed to commit,</p>
<p>432<br>00:17:58,859 –&gt; 00:17:59,979<br>who has the most latest version,</p>
<p>433<br>00:17:59,979 –&gt; 00:18:02,740<br>and how to reconcile any changes, right?</p>
<p>434<br>00:18:04,299 –&gt; 00:18:06,659<br>So those are the two visualizations of this.</p>
<p>435<br>00:18:06,659 –&gt; 00:18:09,459<br>So again, primary replica, we have a single primary,</p>
<p>436<br>00:18:09,459 –&gt; 00:18:10,979<br>and then the two replicas,</p>
<p>437<br>00:18:10,979 –&gt; 00:18:13,539<br>all the read and write queries will go to the primary,</p>
<p>438<br>00:18:13,539 –&gt; 00:18:16,819<br>and then the rights will get propagated to the replicas.</p>
<p>439<br>00:18:16,819 –&gt; 00:18:19,139<br>And this is typically just sending the right head log,</p>
<p>440<br>00:18:21,419 –&gt; 00:18:22,700<br>that we talked about before,</p>
<p>441<br>00:18:22,700 –&gt; 00:18:23,859<br>because you’re just sending the right head log</p>
<p>442<br>00:18:23,859 –&gt; 00:18:25,539<br>of all the changes that come out of the primary,</p>
<p>443<br>00:18:25,539 –&gt; 00:18:28,259<br>and the replicas are more or less in recovery mode,</p>
<p>444<br>00:18:28,259 –&gt; 00:18:29,939<br>and as if they’re reading like this,</p>
<p>445<br>00:18:29,939 –&gt; 00:18:31,619<br>this never ending file from disk,</p>
<p>446<br>00:18:31,619 –&gt; 00:18:33,579<br>and they’re replaying the, the right head log</p>
<p>447<br>00:18:33,579 –&gt; 00:18:34,619<br>to apply the changes.</p>
<p>448<br>00:18:35,859 –&gt; 00:18:38,059<br>Again, the right head log could be physiological, physical,</p>
<p>449<br>00:18:38,059 –&gt; 00:18:39,779<br>like here’s the deltas of the,</p>
<p>450<br>00:18:39,779 –&gt; 00:18:41,700<br>or the diffs I’m making on single pages,</p>
<p>451<br>00:18:41,700 –&gt; 00:18:42,899<br>or it could be the queries.</p>
<p>452<br>00:18:44,220 –&gt; 00:18:45,700<br>If you send the queries, things get tricky,</p>
<p>453<br>00:18:45,700 –&gt; 00:18:47,380<br>because now there’s things in the query,</p>
<p>454<br>00:18:47,380 –&gt; 00:18:50,220<br>like timestamps, or random,</p>
<p>455<br>00:18:50,220 –&gt; 00:18:52,140<br>that you gotta make sure that the replicas</p>
<p>456<br>00:18:52,140 –&gt; 00:18:56,779<br>execute the exact same values for those functions when they run,</p>
<p>457<br>00:18:56,779 –&gt; 00:19:00,420<br>and there’s tricks to handle that, right?</p>
<p>458<br>00:19:00,420 –&gt; 00:19:01,700<br>And as I said, in some systems,</p>
<p>459<br>00:19:01,700 –&gt; 00:19:05,100<br>though, I run read only queries on the replicas.</p>
<p>460<br>00:19:05,100 –&gt; 00:19:07,140<br>Now, how you actually find these replicas,</p>
<p>461<br>00:19:07,140 –&gt; 00:19:09,740<br>that’s that coordinator, middleware stuff we talked about before,</p>
<p>462<br>00:19:09,740 –&gt; 00:19:10,580<br>right?</p>
<p>463<br>00:19:10,580 –&gt; 00:19:12,100<br>You can either explicitly in your application say,</p>
<p>464<br>00:19:12,100 –&gt; 00:19:14,059<br>oh, I know, here’s the IP address of some replica,</p>
<p>465<br>00:19:14,059 –&gt; 00:19:15,779<br>let me go send my query there,</p>
<p>466<br>00:19:15,779 –&gt; 00:19:17,220<br>or you send it to a middleware and says,</p>
<p>467<br>00:19:17,220 –&gt; 00:19:20,740<br>oh, this is read only, let me send it to the replica, right?</p>
<p>468<br>00:19:21,740 –&gt; 00:19:24,980<br>And so, if you can offload all the reads to the replicas,</p>
<p>469<br>00:19:24,980 –&gt; 00:19:27,019<br>then this thing’s just doing nothing but rights,</p>
<p>470<br>00:19:27,019 –&gt; 00:19:29,740<br>which are gonna always typically be slower.</p>
<p>471<br>00:19:29,740 –&gt; 00:19:31,500<br>So this allows you a lot of take over head</p>
<p>472<br>00:19:31,500 –&gt; 00:19:34,019<br>in the burden of a running read queries,</p>
<p>473<br>00:19:34,019 –&gt; 00:19:35,299<br>and put it on the replicas.</p>
<p>474<br>00:19:36,460 –&gt; 00:19:37,899<br>Some cases, this is okay.</p>
<p>475<br>00:19:37,899 –&gt; 00:19:41,019<br>Again, if you don’t really care about having the most up-to-date</p>
<p>476<br>00:19:41,019 –&gt; 00:19:43,339<br>view of the database, which will be re-encouraged theme</p>
<p>477<br>00:19:43,339 –&gt; 00:19:45,740<br>throughout the entire lecture, then this is fine.</p>
<p>478<br>00:19:45,740 –&gt; 00:19:47,980<br>If you need to have exactly, here’s the most latest version,</p>
<p>479<br>00:19:48,939 –&gt; 00:19:50,859<br>then you have to run the primary.</p>
<p>480<br>00:19:50,859 –&gt; 00:19:53,500<br>Because I haven’t said yet, how long is this gonna take?</p>
<p>481<br>00:19:54,500 –&gt; 00:19:55,859<br>We’ll get there in a second.</p>
<p>482<br>00:19:56,980 –&gt; 00:19:58,819<br>So in multi-primary, you have, again,</p>
<p>483<br>00:19:58,819 –&gt; 00:20:02,779<br>the every node is considered the primary,</p>
<p>484<br>00:20:02,779 –&gt; 00:20:06,179<br>and can take reads and writes.</p>
<p>485<br>00:20:06,179 –&gt; 00:20:09,699<br>So now what happens if you have two transactions</p>
<p>486<br>00:20:09,699 –&gt; 00:20:13,259<br>that do rights, one down here, one down here,</p>
<p>487<br>00:20:13,259 –&gt; 00:20:15,980<br>you get to propagate those updates across these guys,</p>
<p>488<br>00:20:15,980 –&gt; 00:20:19,420<br>and then decide, coordinate who’s allowed to commit,</p>
<p>489<br>00:20:19,420 –&gt; 00:20:20,460<br>see the latest version.</p>
<p>490<br>00:20:23,099 –&gt; 00:20:25,180<br>So this is less common, because this is hard to do.</p>
<p>491<br>00:20:27,299 –&gt; 00:20:30,740<br>And a lot of times, people will start with something like this,</p>
<p>492<br>00:20:30,740 –&gt; 00:20:32,339<br>and then if this thing becomes the bottleneck,</p>
<p>493<br>00:20:32,339 –&gt; 00:20:35,299<br>the right node, then you gotta switch to something like this.</p>
<p>494<br>00:20:36,259 –&gt; 00:20:37,940<br>Actually, it doesn’t necessarily have to be a bottleneck,</p>
<p>495<br>00:20:37,940 –&gt; 00:20:40,819<br>could just be that the geographical distance</p>
<p>496<br>00:20:40,819 –&gt; 00:20:44,579<br>between the primary and the replicas are really far.</p>
<p>497<br>00:20:45,779 –&gt; 00:20:48,419<br>So example I was like to use was Facebook.</p>
<p>498<br>00:20:48,419 –&gt; 00:20:51,819<br>Like in the old days, 2010ish,</p>
<p>499<br>00:20:51,819 –&gt; 00:20:53,379<br>I’d say, yeah, over a decade ago,</p>
<p>500<br>00:20:54,379 –&gt; 00:20:56,859<br>Facebook used this model.</p>
<p>501<br>00:20:56,859 –&gt; 00:20:58,939<br>So the data center for summer in California,</p>
<p>502<br>00:20:58,939 –&gt; 00:21:01,259<br>for the primary, but then all the replicas</p>
<p>503<br>00:21:01,259 –&gt; 00:21:03,139<br>are all across the world, right?</p>
<p>504<br>00:21:03,139 –&gt; 00:21:06,179<br>So if you were down in Brazil and did update to your timeline,</p>
<p>505<br>00:21:06,179 –&gt; 00:21:07,859<br>whatever it’s called now, right?</p>
<p>506<br>00:21:07,859 –&gt; 00:21:09,539<br>That would again get sent back up,</p>
<p>507<br>00:21:09,539 –&gt; 00:21:11,379<br>shipped up to California,</p>
<p>508<br>00:21:11,379 –&gt; 00:21:12,659<br>sort of in that data center,</p>
<p>509<br>00:21:12,659 –&gt; 00:21:15,939<br>and then eventually we get propagated down to the replicas,</p>
<p>510<br>00:21:15,939 –&gt; 00:21:18,500<br>like down in Brazil and whatever other countries, right?</p>
<p>511<br>00:21:19,500 –&gt; 00:21:21,899<br>Of course, what’s the problem with that?</p>
<p>512<br>00:21:21,899 –&gt; 00:21:24,299<br>Okay, you have to go geographical distance</p>
<p>513<br>00:21:24,299 –&gt; 00:21:26,579<br>and get propagated back.</p>
<p>514<br>00:21:26,579 –&gt; 00:21:28,099<br>And then so if someone like,</p>
<p>515<br>00:21:28,099 –&gt; 00:21:31,139<br>post a cat picture on their timeline,</p>
<p>516<br>00:21:31,139 –&gt; 00:21:34,179<br>clicks submit, then refreshes the page,</p>
<p>517<br>00:21:34,179 –&gt; 00:21:36,899<br>that page refresh is gonna pull the data from the database,</p>
<p>518<br>00:21:36,900 –&gt; 00:21:39,340<br>but it’s gonna pull from its local replica,</p>
<p>519<br>00:21:39,340 –&gt; 00:21:40,340<br>and it’s not gonna see the updates.</p>
<p>520<br>00:21:40,340 –&gt; 00:21:43,060<br>So people aren’t gonna see their own timeline updates.</p>
<p>521<br>00:21:43,060 –&gt; 00:21:44,460<br>So Facebook played a little game</p>
<p>522<br>00:21:44,460 –&gt; 00:21:46,900<br>by putting something in a cookie in your browser,</p>
<p>523<br>00:21:46,900 –&gt; 00:21:49,180<br>so that when you refresh, you saw your own rights</p>
<p>524<br>00:21:49,180 –&gt; 00:21:52,660<br>locally, not actually from the database, right?</p>
<p>525<br>00:21:52,660 –&gt; 00:21:54,220<br>So they hid that all that from you.</p>
<p>526<br>00:21:54,220 –&gt; 00:21:56,340<br>But eventually they had to switch to this model,</p>
<p>527<br>00:21:56,340 –&gt; 00:21:59,980<br>because for doing, for things were doing updates,</p>
<p>528<br>00:21:59,980 –&gt; 00:22:01,860<br>and you can’t put the browser cookie trick in,</p>
<p>529<br>00:22:02,699 –&gt; 00:22:06,299<br>you know, they had to, they had to be scale this way.</p>
<p>530<br>00:22:09,819 –&gt; 00:22:12,099<br>All right, so next thing you’ve gotta consider is K safety.</p>
<p>531<br>00:22:13,139 –&gt; 00:22:15,299<br>And this is a, I think this is primarily a database term,</p>
<p>532<br>00:22:15,299 –&gt; 00:22:19,099<br>but the idea here is that it’s the number of failures</p>
<p>533<br>00:22:19,099 –&gt; 00:22:21,859<br>that your distributed database has been allowed to have</p>
<p>534<br>00:22:21,859 –&gt; 00:22:26,179<br>before it decides that it doesn’t wanna proceed any further,</p>
<p>535<br>00:22:26,179 –&gt; 00:22:28,419<br>because it may end up losing data</p>
<p>536<br>00:22:28,419 –&gt; 00:22:31,579<br>if there’s more failures, right?</p>
<p>537<br>00:22:31,579 –&gt; 00:22:33,139<br>It’s a sort of like, you know, thing that look like a quorum</p>
<p>538<br>00:22:33,139 –&gt; 00:22:35,059<br>right, same kind of ideas we talked about before,</p>
<p>539<br>00:22:35,059 –&gt; 00:22:36,980<br>but it’s basically saying, how many times,</p>
<p>540<br>00:22:36,980 –&gt; 00:22:39,220<br>how many nodes can go down for a,</p>
<p>541<br>00:22:40,419 –&gt; 00:22:43,220<br>for all the replicas I have of a given object in my database</p>
<p>542<br>00:22:43,220 –&gt; 00:22:46,859<br>before I decide that this is enough, right?</p>
<p>543<br>00:22:46,859 –&gt; 00:22:48,859<br>And we’ll see this in a second when we talk about the cat theorem,</p>
<p>544<br>00:22:48,859 –&gt; 00:22:51,460<br>but like in a distributed relational database,</p>
<p>545<br>00:22:51,460 –&gt; 00:22:55,099<br>like I’ll say traditional, but like in the relational database</p>
<p>546<br>00:22:55,099 –&gt; 00:22:57,899<br>world, we typically, we don’t like losing data,</p>
<p>547<br>00:22:57,899 –&gt; 00:23:00,819<br>we care about acid, and so we don’t wanna have</p>
<p>548<br>00:23:00,819 –&gt; 00:23:04,539<br>a bunch of nodes go down and say there’s like one last copy</p>
<p>549<br>00:23:04,539 –&gt; 00:23:09,460<br>of an object, we do a write to it, but then we crash,</p>
<p>550<br>00:23:09,460 –&gt; 00:23:13,179<br>and then now that portion of the database is not missing.</p>
<p>551<br>00:23:14,019 –&gt; 00:23:15,819<br>So sometimes you would say, I’ll,</p>
<p>552<br>00:23:15,819 –&gt; 00:23:19,659<br>I need to have at least two copies of every object in my database</p>
<p>553<br>00:23:19,659 –&gt; 00:23:20,899<br>for my database to consider online.</p>
<p>554<br>00:23:20,899 –&gt; 00:23:25,659<br>And if I go below that threshold, then the system just stops.</p>
<p>555<br>00:23:25,659 –&gt; 00:23:27,099<br>It doesn’t accept any new requests.</p>
<p>556<br>00:23:28,099 –&gt; 00:23:31,219<br>There’s self-healing models, there’s other tricks like that,</p>
<p>557<br>00:23:31,219 –&gt; 00:23:33,219<br>you can say, all right, I’ve gone along the threshold,</p>
<p>558<br>00:23:33,219 –&gt; 00:23:36,099<br>so let me make a copy of this data now before I run any queries,</p>
<p>559<br>00:23:36,099 –&gt; 00:23:39,980<br>so that, you know, I can start running more queries after</p>
<p>560<br>00:23:39,980 –&gt; 00:23:42,219<br>I make another copy to go above the threshold,</p>
<p>561<br>00:23:43,219 –&gt; 00:23:45,539<br>but again, there’s different ways to handle that.</p>
<p>562<br>00:23:47,819 –&gt; 00:23:49,539<br>All right, so I’ve already alluded this as well,</p>
<p>563<br>00:23:49,539 –&gt; 00:23:51,419<br>the next is the propagation scheme.</p>
<p>564<br>00:23:51,419 –&gt; 00:23:55,899<br>So this is how we’re gonna decide when and how we will propagate</p>
<p>565<br>00:23:55,900 –&gt; 00:23:59,140<br>the changes from a primary to a replica.</p>
<p>566<br>00:23:59,140 –&gt; 00:24:01,500<br>And this is whether it’s the primary replica model</p>
<p>567<br>00:24:01,500 –&gt; 00:24:05,180<br>or the multi-home multi-primary model, right?</p>
<p>568<br>00:24:05,180 –&gt; 00:24:06,420<br>And there’s basically two approaches,</p>
<p>569<br>00:24:06,420 –&gt; 00:24:11,580<br>and there’s obviously there’s different degrees of propagation</p>
<p>570<br>00:24:11,580 –&gt; 00:24:13,860<br>or strength you wanna have between these different,</p>
<p>571<br>00:24:13,860 –&gt; 00:24:18,860<br>these two approaches, but we’ll just take the two major ones,</p>
<p>572<br>00:24:18,860 –&gt; 00:24:20,940<br>the two extremes.</p>
<p>573<br>00:24:20,940 –&gt; 00:24:22,700<br>The first is synchronous commits,</p>
<p>574<br>00:24:22,700 –&gt; 00:24:24,140<br>or what is called strong consistency</p>
<p>575<br>00:24:24,140 –&gt; 00:24:25,500<br>in the distributed data world,</p>
<p>576<br>00:24:25,500 –&gt; 00:24:27,020<br>or a distributed systems world.</p>
<p>577<br>00:24:27,020 –&gt; 00:24:30,860<br>And yeah, here is that if I do an update to an object</p>
<p>578<br>00:24:30,860 –&gt; 00:24:33,540<br>that may have multiple copies of multiple replicas,</p>
<p>579<br>00:24:33,540 –&gt; 00:24:36,140<br>then I don’t get an acknowledgement back my application</p>
<p>580<br>00:24:36,140 –&gt; 00:24:38,500<br>that my change has been committed or saved</p>
<p>581<br>00:24:38,500 –&gt; 00:24:41,380<br>into all the replicas have been updated</p>
<p>582<br>00:24:41,380 –&gt; 00:24:43,380<br>and agreed to have been updated,</p>
<p>583<br>00:24:43,380 –&gt; 00:24:46,300<br>or they agreed that transaction has committed.</p>
<p>584<br>00:24:46,300 –&gt; 00:24:48,700<br>Eventually consistency means that if I do it right,</p>
<p>585<br>00:24:49,980 –&gt; 00:24:52,060<br>I’d eventually get propagated to the replicas,</p>
<p>586<br>00:24:52,059 –&gt; 00:24:55,500<br>but I’ll get a response back potentially before they get updated.</p>
<p>587<br>00:24:57,139 –&gt; 00:24:59,259<br>So if you have, yes, question.</p>
<p>588<br>00:25:05,779 –&gt; 00:25:06,619<br>Right, so this question is,</p>
<p>589<br>00:25:06,619 –&gt; 00:25:07,579<br>how do you make sure you’re eventually,</p>
<p>590<br>00:25:07,579 –&gt; 00:25:08,460<br>you’ll be eventually consistent</p>
<p>591<br>00:25:08,460 –&gt; 00:25:10,619<br>if there’s no guarantee that you’re getting a response,</p>
<p>592<br>00:25:10,619 –&gt; 00:25:12,740<br>we’ll get that earned a second, yes.</p>
<p>593<br>00:25:12,740 –&gt; 00:25:14,700<br>The answer is, yeah, right?</p>
<p>594<br>00:25:14,700 –&gt; 00:25:18,019<br>Like, you’ll get there eventually, but when?</p>
<p>595<br>00:25:19,659 –&gt; 00:25:20,500<br>Other questions?</p>
<p>596<br>00:25:21,460 –&gt; 00:25:22,460<br>Yes.</p>
<p>597<br>00:25:22,460 –&gt; 00:25:24,660<br>So in a multi-fine research,</p>
<p>598<br>00:25:24,660 –&gt; 00:25:27,220<br>how do we prevent simultaneous</p>
<p>599<br>00:25:27,220 –&gt; 00:25:29,059<br>updates to the model,</p>
<p>600<br>00:25:29,059 –&gt; 00:25:31,059<br>how do we make a consistent vehicle?</p>
<p>601<br>00:25:31,059 –&gt; 00:25:34,180<br>You allow rights when both the primary and also.</p>
<p>602<br>00:25:34,180 –&gt; 00:25:35,819<br>Yeah, go ahead, so question is,</p>
<p>603<br>00:25:35,819 –&gt; 00:25:38,779<br>in multi-primer, how do I prevent rights</p>
<p>604<br>00:25:38,779 –&gt; 00:25:40,740<br>from occurring on the same object?</p>
<p>605<br>00:25:40,740 –&gt; 00:25:41,740<br>Yeah.</p>
<p>606<br>00:25:41,740 –&gt; 00:25:43,779<br>To vase locking, OCC, all that.</p>
<p>607<br>00:25:43,779 –&gt; 00:25:46,740<br>It distributed across two nodes.</p>
<p>608<br>00:25:46,740 –&gt; 00:25:49,779<br>So you basically run two vase locking across multiple nodes.</p>
<p>609<br>00:25:49,779 –&gt; 00:25:50,859<br>Right?</p>
<p>610<br>00:25:50,859 –&gt; 00:25:53,420<br>Again, it’s just the same protocols,</p>
<p>611<br>00:25:53,420 –&gt; 00:25:54,379<br>it’s just now where distributed,</p>
<p>612<br>00:25:54,379 –&gt; 00:25:57,099<br>and now like someone’s not the build the weight</p>
<p>613<br>00:25:57,099 –&gt; 00:25:59,099<br>to a graph assuming it’s two vase locking.</p>
<p>614<br>00:25:59,099 –&gt; 00:25:59,940<br>And someone’s having to decide,</p>
<p>615<br>00:25:59,940 –&gt; 00:26:00,940<br>okay, there’s a deadlock,</p>
<p>616<br>00:26:00,940 –&gt; 00:26:02,339<br>let me go ahead and kill it.</p>
<p>617<br>00:26:02,339 –&gt; 00:26:06,019<br>And that could be either the central-like coordinator</p>
<p>618<br>00:26:06,019 –&gt; 00:26:07,740<br>or it could be amongst the nodes,</p>
<p>619<br>00:26:07,740 –&gt; 00:26:09,139<br>they say, okay, well, I’m waiting for this</p>
<p>620<br>00:26:09,139 –&gt; 00:26:11,059<br>and you have this, but you update it.</p>
<p>621<br>00:26:11,059 –&gt; 00:26:12,779<br>And then the two nodes decide,</p>
<p>622<br>00:26:12,779 –&gt; 00:26:14,579<br>okay, yeah, there’s a deadlock here.</p>
<p>623<br>00:26:14,579 –&gt; 00:26:16,819<br>And then there’s some other ordering scene to decide,</p>
<p>624<br>00:26:16,819 –&gt; 00:26:19,740<br>you know, determine the priority of who gets killed.</p>
<p>625<br>00:26:20,779 –&gt; 00:26:23,579<br>So all of this that we talked about before is still here.</p>
<p>626<br>00:26:23,579 –&gt; 00:26:25,579<br>So we don’t worry about the network traffic</p>
<p>627<br>00:26:25,579 –&gt; 00:26:27,579<br>and the network security number.</p>
<p>628<br>00:26:27,579 –&gt; 00:26:29,099<br>We don’t worry about the network traffic.</p>
<p>629<br>00:26:29,099 –&gt; 00:26:31,779<br>So the latency in terms of updating any data</p>
<p>630<br>00:26:31,779 –&gt; 00:26:35,180<br>is actually how to keep the counter the lock.</p>
<p>631<br>00:26:35,180 –&gt; 00:26:39,460<br>So that would not be the same as the network.</p>
<p>632<br>00:26:39,460 –&gt; 00:26:41,220<br>Yeah, so it’s what David is, and he’s correct,</p>
<p>633<br>00:26:41,220 –&gt; 00:26:43,139<br>that like, the internet distributed system,</p>
<p>634<br>00:26:43,139 –&gt; 00:26:44,139<br>and we said this before,</p>
<p>635<br>00:26:44,139 –&gt; 00:26:46,180<br>but being parallel systems and distributed systems,</p>
<p>636<br>00:26:46,180 –&gt; 00:26:47,339<br>and the internet distributed system,</p>
<p>637<br>00:26:47,339 –&gt; 00:26:49,500<br>the communication latency is much higher.</p>
<p>638<br>00:26:49,500 –&gt; 00:26:51,059<br>The cost is much higher.</p>
<p>639<br>00:26:51,059 –&gt; 00:26:52,819<br>We do worry about it, but like we can’t,</p>
<p>640<br>00:26:52,819 –&gt; 00:26:54,940<br>there’s no magic wand to make it go away.</p>
<p>641<br>00:26:54,940 –&gt; 00:26:57,380<br>We’re kind of limited by the speed of light.</p>
<p>642<br>00:26:57,380 –&gt; 00:27:02,380<br>So we will see this in Spanner in a second.</p>
<p>643<br>00:27:02,980 –&gt; 00:27:06,420<br>Like the trick they basically do is say,</p>
<p>644<br>00:27:06,420 –&gt; 00:27:08,779<br>well, I’ll wait to see, I’ll wait for a certain mountain</p>
<p>645<br>00:27:08,779 –&gt; 00:27:11,220<br>on a bound of time to see whether someone shows up,</p>
<p>646<br>00:27:11,220 –&gt; 00:27:13,339<br>they may conflict with my transaction.</p>
<p>647<br>00:27:13,339 –&gt; 00:27:15,619<br>And if that, they don’t show up in that time,</p>
<p>648<br>00:27:15,619 –&gt; 00:27:17,660<br>then I’m allowed to commit, right?</p>
<p>649<br>00:27:17,660 –&gt; 00:27:21,460<br>But there’s no way to get around that.</p>
<p>650<br>00:27:21,460 –&gt; 00:27:22,460<br>Yeah.</p>
<p>651<br>00:27:23,460 –&gt; 00:27:26,860<br>Like there’s no magic two-phase locking you can do,</p>
<p>652<br>00:27:26,860 –&gt; 00:27:29,420<br>because you’re going to get the wide-area network.</p>
<p>653<br>00:27:29,420 –&gt; 00:27:32,500<br>It’s going to be basically the stuff we talked about before.</p>
<p>654<br>00:27:34,620 –&gt; 00:27:35,900<br>And the tricks, the games they play is like,</p>
<p>655<br>00:27:35,900 –&gt; 00:27:38,100<br>how much hints can you pass along to say,</p>
<p>656<br>00:27:38,100 –&gt; 00:27:39,100<br>okay, yeah, by the way,</p>
<p>657<br>00:27:39,100 –&gt; 00:27:42,180<br>like I’m going to, instead of saying one message at a time,</p>
<p>658<br>00:27:42,180 –&gt; 00:27:43,820<br>here’s all the locked-in require.</p>
<p>659<br>00:27:43,820 –&gt; 00:27:45,380<br>It’s like, here’s the locked-in required,</p>
<p>660<br>00:27:45,380 –&gt; 00:27:47,180<br>here’s the locked-in, I think I’m going to go wire,</p>
<p>661<br>00:27:47,180 –&gt; 00:27:49,180<br>and maybe you do more pessimistic things like that.</p>
<p>662<br>00:27:49,180 –&gt; 00:27:51,180<br>That’s really all you really can do.</p>
<p>663<br>00:27:54,259 –&gt; 00:27:56,259<br>Okay.</p>
<p>664<br>00:27:56,259 –&gt; 00:27:57,259<br>It’s going back.</p>
<p>665<br>00:28:00,220 –&gt; 00:28:01,460<br>Right, propagation team.</p>
<p>666<br>00:28:01,460 –&gt; 00:28:04,900<br>So, synchronous commit or synchronous propagation.</p>
<p>667<br>00:28:04,900 –&gt; 00:28:09,740<br>So the idea here is that when the primary sends a,</p>
<p>668<br>00:28:10,620 –&gt; 00:28:13,420<br>when the application sends a commit request to the primary,</p>
<p>669<br>00:28:13,420 –&gt; 00:28:18,420<br>the primary, we’ll send that request to all its replicas,</p>
<p>670<br>00:28:19,300 –&gt; 00:28:21,779<br>and it has to wait until they come back and say,</p>
<p>671<br>00:28:21,779 –&gt; 00:28:25,380<br>yes, I’ve got this change, I’ve go ahead and committed,</p>
<p>672<br>00:28:25,380 –&gt; 00:28:26,900<br>I flushed the changes to the disk,</p>
<p>673<br>00:28:27,900 –&gt; 00:28:32,060<br>and then once it gets acknowledgement from all its replicas</p>
<p>674<br>00:28:32,060 –&gt; 00:28:33,940<br>that things are durable and safe,</p>
<p>675<br>00:28:33,940 –&gt; 00:28:35,580<br>or there’s just actions a lot of commit,</p>
<p>676<br>00:28:36,580 –&gt; 00:28:38,220<br>then and only then can it propagate</p>
<p>677<br>00:28:38,220 –&gt; 00:28:41,019<br>the acknowledgement back to the application.</p>
<p>678<br>00:28:41,019 –&gt; 00:28:42,300<br>Right, it’s just like before,</p>
<p>679<br>00:28:42,299 –&gt; 00:28:44,700<br>when we commit transactions with the right-of-head log,</p>
<p>680<br>00:28:44,700 –&gt; 00:28:46,579<br>except now we’ve got to wait for somebody else</p>
<p>681<br>00:28:46,579 –&gt; 00:28:49,619<br>over the network to come back and say they got it too.</p>
<p>682<br>00:28:49,619 –&gt; 00:28:52,700<br>Right, a synchronous commit is,</p>
<p>683<br>00:28:52,700 –&gt; 00:28:54,299<br>and a highlight was basically,</p>
<p>684<br>00:28:54,299 –&gt; 00:28:56,299<br>all right, commit message shows up.</p>
<p>685<br>00:28:56,299 –&gt; 00:28:59,460<br>I’ll send the request to my replicas,</p>
<p>686<br>00:28:59,460 –&gt; 00:29:01,659<br>but I’m not going to wait for them to come back.</p>
<p>687<br>00:29:01,659 –&gt; 00:29:04,099<br>I’ll immediately say, yep, I got it, commit.</p>
<p>688<br>00:29:04,099 –&gt; 00:29:07,299<br>Right, and what I was saying before that there’s sort of,</p>
<p>689<br>00:29:07,299 –&gt; 00:29:10,019<br>like, these are two extremes,</p>
<p>690<br>00:29:10,019 –&gt; 00:29:14,460<br>there’s a bunch of games you can play about how much can you</p>
<p>691<br>00:29:14,460 –&gt; 00:29:17,019<br>really wait for how much should you wait.</p>
<p>692<br>00:29:17,019 –&gt; 00:29:20,900<br>Right, so going back here to the one at the top,</p>
<p>693<br>00:29:22,420 –&gt; 00:29:24,619<br>so say there was four replicas,</p>
<p>694<br>00:29:25,579 –&gt; 00:29:27,940<br>but instead of waiting for acknowledgement from all four,</p>
<p>695<br>00:29:27,940 –&gt; 00:29:30,660<br>maybe I waited for two out of four or one out of four,</p>
<p>696<br>00:29:30,660 –&gt; 00:29:33,700<br>so at least know it’s propagated on least one.</p>
<p>697<br>00:29:33,700 –&gt; 00:29:37,220<br>Right, same thing for the asynchronous one.</p>
<p>698<br>00:29:37,220 –&gt; 00:29:38,700<br>Right, so I send my,</p>
<p>699<br>00:29:38,700 –&gt; 00:29:39,940<br>I send my requests out,</p>
<p>700<br>00:29:39,940 –&gt; 00:29:42,140<br>maybe I wait for some of them.</p>
<p>701<br>00:29:42,140 –&gt; 00:29:46,019<br>We saw this with consistent hashing in Kansandra,</p>
<p>702<br>00:29:46,019 –&gt; 00:29:47,460<br>right, they do quorum rights.</p>
<p>703<br>00:29:47,460 –&gt; 00:29:49,460<br>You could say, all right,</p>
<p>704<br>00:29:49,460 –&gt; 00:29:53,140<br>every tuple is replicated three times,</p>
<p>705<br>00:29:53,140 –&gt; 00:29:56,019<br>all right, for two out of three responses from my replicas</p>
<p>706<br>00:29:56,019 –&gt; 00:30:00,180<br>before I say, tell the outside world that my data’s been saved.</p>
<p>707<br>00:30:01,299 –&gt; 00:30:04,500<br>I don’t want to use the term transaction committed in Kansandra</p>
<p>708<br>00:30:04,500 –&gt; 00:30:05,500<br>because they don’t,</p>
<p>709<br>00:30:05,900 –&gt; 00:30:08,740<br>is new versions maybe supported,</p>
<p>710<br>00:30:08,740 –&gt; 00:30:10,019<br>but not the older versions,</p>
<p>711<br>00:30:10,019 –&gt; 00:30:12,059<br>they didn’t support multi object updates,</p>
<p>712<br>00:30:12,059 –&gt; 00:30:13,380<br>they didn’t support transactions,</p>
<p>713<br>00:30:13,380 –&gt; 00:30:15,500<br>they definitely didn’t support multi node transactions.</p>
<p>714<br>00:30:16,500 –&gt; 00:30:17,900<br>For our purposes, assume that like,</p>
<p>715<br>00:30:17,900 –&gt; 00:30:20,500<br>we’re updating things just on to some of the single node.</p>
<p>716<br>00:30:22,819 –&gt; 00:30:26,700<br>So again, there’s pros and cons to all of these, right?</p>
<p>717<br>00:30:26,700 –&gt; 00:30:30,339<br>And there isn’t one scheme that’s gonna be universal for everyone,</p>
<p>718<br>00:30:30,339 –&gt; 00:30:33,380<br>it depends on the tolerance of the organization</p>
<p>719<br>00:30:33,380 –&gt; 00:30:34,500<br>of the company running your database</p>
<p>720<br>00:30:34,500 –&gt; 00:30:36,460<br>and the company’s gonna be the application is.</p>
<p>721<br>00:30:36,460 –&gt; 00:30:39,819<br>If it’s like post on Reddit and Twitter and hack our news,</p>
<p>722<br>00:30:40,779 –&gt; 00:30:42,500<br>then like, you know, if I lose something,</p>
<p>723<br>00:30:42,500 –&gt; 00:30:44,500<br>yeah, maybe no big deal, right?</p>
<p>724<br>00:30:45,619 –&gt; 00:30:47,299<br>But if it’s your bank,</p>
<p>725<br>00:30:47,299 –&gt; 00:30:48,339<br>then you don’t wanna lose anything</p>
<p>726<br>00:30:48,339 –&gt; 00:30:52,259<br>and you wanna make sure everything is fully committed.</p>
<p>727<br>00:30:52,259 –&gt; 00:30:54,500<br>And so the no-stinkle guys are saying,</p>
<p>728<br>00:30:54,500 –&gt; 00:30:56,819<br>yeah, you don’t wanna be, to be web-scale,</p>
<p>729<br>00:30:56,819 –&gt; 00:30:59,579<br>support online applications, a lot of users,</p>
<p>730<br>00:30:59,579 –&gt; 00:31:01,420<br>you wanna use asynchronous commit,</p>
<p>731<br>00:31:01,420 –&gt; 00:31:02,740<br>a eventual consistency.</p>
<p>732<br>00:31:03,539 –&gt; 00:31:05,140<br>And then the traditional database people say,</p>
<p>733<br>00:31:05,140 –&gt; 00:31:06,900<br>oh, you don’t wanna lose any data</p>
<p>734<br>00:31:06,900 –&gt; 00:31:08,099<br>and you wanna, you know,</p>
<p>735<br>00:31:08,099 –&gt; 00:31:09,660<br>when you want fully-asseted transactions,</p>
<p>736<br>00:31:09,660 –&gt; 00:31:11,140<br>even though you’re cross-mobile nodes.</p>
<p>737<br>00:31:13,019 –&gt; 00:31:14,660<br>And so the answer is,</p>
<p>738<br>00:31:14,660 –&gt; 00:31:16,779<br>the correct answer is it’s somewhere in between.</p>
<p>739<br>00:31:16,779 –&gt; 00:31:19,299<br>So, notifications, yes, some applications, no.</p>
<p>740<br>00:31:19,299 –&gt; 00:31:20,380<br>The difference with the no-stinkle guys,</p>
<p>741<br>00:31:20,380 –&gt; 00:31:22,980<br>they said, should have no, and they never had it</p>
<p>742<br>00:31:22,980 –&gt; 00:31:23,779<br>in the least in the beginning,</p>
<p>743<br>00:31:23,779 –&gt; 00:31:25,859<br>and they eventually had it at a back.</p>
<p>744<br>00:31:25,859 –&gt; 00:31:28,059<br>Whereas the relational database system started off</p>
<p>745<br>00:31:28,059 –&gt; 00:31:31,740<br>adding transactions and then they eventually relaxed it</p>
<p>746<br>00:31:31,740 –&gt; 00:31:33,099<br>a little bit.</p>
<p>747<br>00:31:33,099 –&gt; 00:31:34,779<br>And I would argue, it’s better off starting with a,</p>
<p>748<br>00:31:34,779 –&gt; 00:31:38,099<br>you know, full transactional drunk-assisting support</p>
<p>749<br>00:31:38,099 –&gt; 00:31:39,339<br>and then dial it back as needed,</p>
<p>750<br>00:31:39,339 –&gt; 00:31:40,940<br>rather than like trying to shoehorn</p>
<p>751<br>00:31:40,940 –&gt; 00:31:42,620<br>and after you’ve already built the system.</p>
<p>752<br>00:31:45,420 –&gt; 00:31:46,819<br>All right, the next is when,</p>
<p>753<br>00:31:46,819 –&gt; 00:31:49,660<br>when are the changes actually propagating?</p>
<p>754<br>00:31:49,660 –&gt; 00:31:51,539<br>So, again, a mind example here,</p>
<p>755<br>00:31:51,539 –&gt; 00:31:53,380<br>I just showed like on-combit,</p>
<p>756<br>00:31:53,380 –&gt; 00:31:55,819<br>tell the other replica I wanna go ahead</p>
<p>757<br>00:31:55,819 –&gt; 00:31:57,019<br>and apply my changes.</p>
<p>758<br>00:31:57,019 –&gt; 00:31:59,220<br>But let’s say that I’m doing a transaction,</p>
<p>759<br>00:31:59,220 –&gt; 00:32:00,700<br>it updates a lot of data,</p>
<p>760<br>00:32:00,700 –&gt; 00:32:02,860<br>and it’s a lot around trips to the application server</p>
<p>761<br>00:32:02,860 –&gt; 00:32:03,700<br>and the data server,</p>
<p>762<br>00:32:03,700 –&gt; 00:32:06,460<br>because like do one update, do another update, and so forth.</p>
<p>763<br>00:32:07,460 –&gt; 00:32:09,340<br>Do I wanna wait for the,</p>
<p>764<br>00:32:09,340 –&gt; 00:32:11,660<br>I get the commit message before I propagate those changes</p>
<p>765<br>00:32:11,660 –&gt; 00:32:14,860<br>to the replica?</p>
<p>766<br>00:32:14,860 –&gt; 00:32:15,700<br>Maybe not, right?</p>
<p>767<br>00:32:15,700 –&gt; 00:32:17,980<br>Because maybe like as the updates come in,</p>
<p>768<br>00:32:17,980 –&gt; 00:32:21,059<br>I can start sending them piecemeal to the replicas</p>
<p>769<br>00:32:21,059 –&gt; 00:32:23,819<br>so that when I go ahead and commit,</p>
<p>770<br>00:32:23,819 –&gt; 00:32:25,460<br>you know, they don’t apply a bunch of those changes,</p>
<p>771<br>00:32:25,460 –&gt; 00:32:27,860<br>they’ve already seen a bunch of these things.</p>
<p>772<br>00:32:27,860 –&gt; 00:32:30,660<br>But then that now means that if I roll back</p>
<p>773<br>00:32:30,700 –&gt; 00:32:31,900<br>into the transaction,</p>
<p>774<br>00:32:31,900 –&gt; 00:32:33,100<br>they’ve already applied a bunch of changes</p>
<p>775<br>00:32:33,100 –&gt; 00:32:34,580<br>that I have to reverse.</p>
<p>776<br>00:32:35,420 –&gt; 00:32:37,180<br>But again, this is sort of like what I was saying before,</p>
<p>777<br>00:32:37,180 –&gt; 00:32:39,460<br>the replicas are more or less in recovery mode,</p>
<p>778<br>00:32:39,460 –&gt; 00:32:41,660<br>ignoring multi-home,</p>
<p>779<br>00:32:41,660 –&gt; 00:32:44,460<br>because they’re just replaying these log messages</p>
<p>780<br>00:32:44,460 –&gt; 00:32:46,900<br>and they’re maintaining the on-new state,</p>
<p>781<br>00:32:46,900 –&gt; 00:32:47,740<br>or on-new buffer,</p>
<p>782<br>00:32:47,740 –&gt; 00:32:50,019<br>just as you would during regular recovery.</p>
<p>783<br>00:32:51,019 –&gt; 00:32:52,820<br>So, those systems do the top one.</p>
<p>784<br>00:32:53,820 –&gt; 00:32:57,019<br>If you do the bottom one, it does make it easier to implement,</p>
<p>785<br>00:32:57,019 –&gt; 00:33:00,340<br>but again, it just, it makes the commit process</p>
<p>786<br>00:33:00,339 –&gt; 00:33:03,619<br>a bit longer because now you bash up a bunch of updates,</p>
<p>787<br>00:33:03,619 –&gt; 00:33:04,459<br>you have to apply.</p>
<p>788<br>00:33:07,659 –&gt; 00:33:08,699<br>All right, this one’s a bit nuanced</p>
<p>789<br>00:33:08,699 –&gt; 00:33:10,220<br>and always confused with students.</p>
<p>790<br>00:33:10,220 –&gt; 00:33:12,699<br>So, ask questions if just to make sense.</p>
<p>791<br>00:33:12,699 –&gt; 00:33:15,699<br>So then there’s the question of what are the transactions,</p>
<p>792<br>00:33:15,699 –&gt; 00:33:17,899<br>or what are the nodes actually doing</p>
<p>793<br>00:33:17,899 –&gt; 00:33:21,220<br>that are involved in, say, like a multi-new transaction?</p>
<p>794<br>00:33:21,220 –&gt; 00:33:24,539<br>And so the two ideas are active, active, active, passive.</p>
<p>795<br>00:33:24,539 –&gt; 00:33:27,339<br>Active passive is what I’ve been sort of describing so far,</p>
<p>796<br>00:33:27,339 –&gt; 00:33:29,579<br>where there’s some primary,</p>
<p>797<br>00:33:29,579 –&gt; 00:33:31,259<br>the queries go there, they do updates,</p>
<p>798<br>00:33:31,259 –&gt; 00:33:34,539<br>and then they get propagated to the replicas.</p>
<p>799<br>00:33:34,539 –&gt; 00:33:35,659<br>And the replicas are eventually,</p>
<p>800<br>00:33:35,659 –&gt; 00:33:36,740<br>they’re not really running the queries</p>
<p>801<br>00:33:36,740 –&gt; 00:33:38,699<br>of doing the work, there’s replaying the updates</p>
<p>802<br>00:33:38,699 –&gt; 00:33:39,980<br>that occurred on the primer.</p>
<p>803<br>00:33:41,179 –&gt; 00:33:43,939<br>With active, active, the idea is that,</p>
<p>804<br>00:33:43,939 –&gt; 00:33:45,139<br>when I actually have a transaction,</p>
<p>805<br>00:33:45,139 –&gt; 00:33:47,259<br>it’s gonna, it’s gonna actually execute the logic</p>
<p>806<br>00:33:47,259 –&gt; 00:33:49,460<br>of that transaction at every replica.</p>
<p>807<br>00:33:50,379 –&gt; 00:33:52,059<br>And that when you go to now commit,</p>
<p>808<br>00:33:52,059 –&gt; 00:33:52,899<br>you don’t need to send like,</p>
<p>809<br>00:33:52,899 –&gt; 00:33:55,099<br>hey, here’s my updates from the right-of-head log,</p>
<p>810<br>00:33:55,099 –&gt; 00:33:57,379<br>because they all did the same thing.</p>
<p>811<br>00:33:57,379 –&gt; 00:33:59,299<br>I think of like, I have an update query,</p>
<p>812<br>00:33:59,299 –&gt; 00:34:02,539<br>ignoring random, ignoring times and all that other stuff,</p>
<p>813<br>00:34:02,539 –&gt; 00:34:05,659<br>that like, assuming I can execute it deterministically,</p>
<p>814<br>00:34:05,659 –&gt; 00:34:07,779<br>I send it to the two nodes,</p>
<p>815<br>00:34:07,779 –&gt; 00:34:09,460<br>and they both execute it in the exact same order</p>
<p>816<br>00:34:09,460 –&gt; 00:34:10,860<br>and produce the exact same result.</p>
<p>817<br>00:34:10,860 –&gt; 00:34:13,259<br>So now when they go to commit, they just need to agree,</p>
<p>818<br>00:34:13,259 –&gt; 00:34:16,579<br>yep, I did this, yep, you did that, and you’re done.</p>
<p>819<br>00:34:18,659 –&gt; 00:34:20,179<br>So most systems do this bottom one,</p>
<p>820<br>00:34:20,179 –&gt; 00:34:21,059<br>because this is easier,</p>
<p>821<br>00:34:21,059 –&gt; 00:34:23,900<br>because again, you’re just picking back off of the,</p>
<p>822<br>00:34:26,059 –&gt; 00:34:27,380<br>you’re picking back off of the,</p>
<p>823<br>00:34:27,460 –&gt; 00:34:28,579<br>the right-of-load mechanism,</p>
<p>824<br>00:34:30,019 –&gt; 00:34:32,700<br>but the top one is, if you can do it,</p>
<p>825<br>00:34:32,700 –&gt; 00:34:34,460<br>it’s way more efficient,</p>
<p>826<br>00:34:34,460 –&gt; 00:34:36,380<br>because you’re just sending less data.</p>
<p>827<br>00:34:36,380 –&gt; 00:34:37,740<br>It’s similar to that, the push versus,</p>
<p>828<br>00:34:37,740 –&gt; 00:34:39,460<br>pushing the data, sorry,</p>
<p>829<br>00:34:39,460 –&gt; 00:34:42,220<br>pushing the query to the data versus pulling data to query, yes.</p>
<p>830<br>00:34:42,220 –&gt; 00:34:44,260<br>So I could also turn the data to the reference</p>
<p>831<br>00:34:44,260 –&gt; 00:34:48,019<br>of the, you know, the D3 and the D3.</p>
<p>832<br>00:34:48,019 –&gt; 00:34:50,140<br>The question is, does active active defeat the purpose</p>
<p>833<br>00:34:50,140 –&gt; 00:34:52,780<br>of being able to run a lot of re-cories on replicas?</p>
<p>834<br>00:34:52,780 –&gt; 00:34:53,619<br>Yes.</p>
<p>835<br>00:34:57,539 –&gt; 00:35:00,140<br>And when would you add the key?</p>
<p>836<br>00:35:02,019 –&gt; 00:35:04,099<br>Question is, when do you want to do this?</p>
<p>837<br>00:35:04,099 –&gt; 00:35:07,940<br>If the, if the amount of data you have to send</p>
<p>838<br>00:35:07,940 –&gt; 00:35:11,420<br>to say here’s the transaction is gonna be less than,</p>
<p>839<br>00:35:11,420 –&gt; 00:35:13,740<br>like here’s the, here’s the right-of-load updates,</p>
<p>840<br>00:35:13,740 –&gt; 00:35:15,420<br>then it may potentially use better.</p>
<p>841<br>00:35:17,420 –&gt; 00:35:21,660<br>It also reduces the window of the synchronization time as well,</p>
<p>842<br>00:35:21,660 –&gt; 00:35:24,140<br>because now like, again, assuming the two nodes</p>
<p>843<br>00:35:24,140 –&gt; 00:35:26,820<br>have the same speed, send requests,</p>
<p>844<br>00:35:26,820 –&gt; 00:35:29,180<br>they rip through it, and then you just commit.</p>
<p>845<br>00:35:29,180 –&gt; 00:35:32,660<br>Whereas like, seeing the other, the, in the,</p>
<p>846<br>00:35:32,660 –&gt; 00:35:35,180<br>the active passive, I got to run the query,</p>
<p>847<br>00:35:35,180 –&gt; 00:35:36,500<br>generate the right-head log messages,</p>
<p>848<br>00:35:36,500 –&gt; 00:35:38,740<br>after around the query, then send the updates</p>
<p>849<br>00:35:38,740 –&gt; 00:35:39,900<br>that then get propagated,</p>
<p>850<br>00:35:39,900 –&gt; 00:35:40,940<br>whereas the other two can potentially have</p>
<p>851<br>00:35:40,940 –&gt; 00:35:41,820<br>an exact same time.</p>
<p>852<br>00:35:47,180 –&gt; 00:35:48,660<br>This question is, if you do active active,</p>
<p>853<br>00:35:48,660 –&gt; 00:35:51,500<br>and don’t end up with exact same result, what do you do?</p>
<p>854<br>00:35:51,500 –&gt; 00:35:54,180<br>You have to abort the transaction.</p>
<p>855<br>00:35:54,180 –&gt; 00:35:55,700<br>That’s why I’m assuming I’m doing it.</p>
<p>856<br>00:35:55,699 –&gt; 00:35:56,539<br>Yeah.</p>
<p>857<br>00:35:59,699 –&gt; 00:36:00,539<br>Yes.</p>
<p>858<br>00:36:00,539 –&gt; 00:36:03,259<br>The answer is, what do you mean you spend a lot more</p>
<p>859<br>00:36:03,259 –&gt; 00:36:04,939<br>about the form and the method?</p>
<p>860<br>00:36:04,939 –&gt; 00:36:06,819<br>Questions with active active, wouldn’t you need to send</p>
<p>861<br>00:36:06,819 –&gt; 00:36:11,659<br>a lot more, a lot more data with the network?</p>
<p>862<br>00:36:11,659 –&gt; 00:36:12,659<br>Why?</p>
<p>863<br>00:36:12,659 –&gt; 00:36:14,460<br>So for each,</p>
<p>864<br>00:36:14,460 –&gt; 00:36:17,500<br>where would you know how to send a message</p>
<p>865<br>00:36:17,500 –&gt; 00:36:19,059<br>and instead where it’s not the problem,</p>
<p>866<br>00:36:19,059 –&gt; 00:36:20,659<br>you send a whole lot of,</p>
<p>867<br>00:36:20,659 –&gt; 00:36:21,779<br>a whole rabbit thing on?</p>
<p>868<br>00:36:21,779 –&gt; 00:36:25,059<br>So the same it is, and the answer is,</p>
<p>869<br>00:36:25,579 –&gt; 00:36:26,860<br>of course, in data, it depends.</p>
<p>870<br>00:36:26,860 –&gt; 00:36:29,340<br>Save it is, with active active,</p>
<p>871<br>00:36:29,340 –&gt; 00:36:31,139<br>you would have to send the query,</p>
<p>872<br>00:36:31,139 –&gt; 00:36:32,699<br>with active password, you’d have to send a right-head log,</p>
<p>873<br>00:36:32,699 –&gt; 00:36:34,219<br>and couldn’t the right-head log,</p>
<p>874<br>00:36:34,219 –&gt; 00:36:36,820<br>the records be large in the query?</p>
<p>875<br>00:36:36,820 –&gt; 00:36:37,659<br>Well, it depends.</p>
<p>876<br>00:36:37,659 –&gt; 00:36:40,500<br>I have a single update query that updates the billion tuples,</p>
<p>877<br>00:36:40,500 –&gt; 00:36:42,059<br>and I could just send that single string,</p>
<p>878<br>00:36:42,059 –&gt; 00:36:45,219<br>and that’s enough to be a billion things, right?</p>
<p>879<br>00:36:45,219 –&gt; 00:36:46,500<br>So I want to go too much into this,</p>
<p>880<br>00:36:46,500 –&gt; 00:36:47,739<br>but the,</p>
<p>881<br>00:36:49,219 –&gt; 00:36:50,699<br>the handle the,</p>
<p>882<br>00:36:52,099 –&gt; 00:36:53,019<br>all of these problems,</p>
<p>883<br>00:36:53,019 –&gt; 00:36:55,139<br>if you can run your transactions as store procedures,</p>
<p>884<br>00:36:55,139 –&gt; 00:36:56,019<br>which we haven’t really talked about,</p>
<p>885<br>00:36:56,019 –&gt; 00:36:57,460<br>but think of like an RPC,</p>
<p>886<br>00:36:57,460 –&gt; 00:36:59,340<br>like I literally have a function that I can put</p>
<p>887<br>00:36:59,340 –&gt; 00:37:01,500<br>on my database system that has, you know,</p>
<p>888<br>00:37:01,500 –&gt; 00:37:02,259<br>if and else statements,</p>
<p>889<br>00:37:02,259 –&gt; 00:37:04,099<br>things you can’t easily do in SQL,</p>
<p>890<br>00:37:04,099 –&gt; 00:37:04,980<br>for loops and all that,</p>
<p>891<br>00:37:04,980 –&gt; 00:37:06,099<br>it’s procedural code,</p>
<p>892<br>00:37:06,099 –&gt; 00:37:08,500<br>that then makes invocations of SQL queries.</p>
<p>893<br>00:37:08,500 –&gt; 00:37:09,460<br>Now the application,</p>
<p>894<br>00:37:09,460 –&gt; 00:37:10,659<br>once you run a transaction,</p>
<p>895<br>00:37:10,659 –&gt; 00:37:11,500<br>doesn’t say,</p>
<p>896<br>00:37:11,500 –&gt; 00:37:13,340<br>okay, begin a transaction, update this query,</p>
<p>897<br>00:37:13,340 –&gt; 00:37:14,699<br>get a response, update an explorer,</p>
<p>898<br>00:37:14,699 –&gt; 00:37:15,460<br>and so forth, right?</p>
<p>899<br>00:37:15,460 –&gt; 00:37:16,739<br>You literally say, you know,</p>
<p>900<br>00:37:16,739 –&gt; 00:37:19,059<br>execute this function with this input parameters,</p>
<p>901<br>00:37:19,059 –&gt; 00:37:21,579<br>and then that runs on the database server.</p>
<p>902<br>00:37:21,659 –&gt; 00:37:23,739<br>This is very common in enterprise systems,</p>
<p>903<br>00:37:24,739 –&gt; 00:37:26,380<br>in order systems.</p>
<p>904<br>00:37:26,380 –&gt; 00:37:28,940<br>And so if you can run everything as store procedures,</p>
<p>905<br>00:37:28,940 –&gt; 00:37:29,779<br>now you,</p>
<p>906<br>00:37:29,779 –&gt; 00:37:31,900<br>the database server actually can look inside the code</p>
<p>907<br>00:37:31,900 –&gt; 00:37:33,380<br>and figure out what’s going on,</p>
<p>908<br>00:37:33,380 –&gt; 00:37:34,420<br>and flag anything,</p>
<p>909<br>00:37:34,420 –&gt; 00:37:35,659<br>oh, there’s a timestamp call,</p>
<p>910<br>00:37:35,659 –&gt; 00:37:38,059<br>there’s a random function and so forth, right?</p>
<p>911<br>00:37:38,059 –&gt; 00:37:39,219<br>And then you can play a bunch of games,</p>
<p>912<br>00:37:39,219 –&gt; 00:37:41,179<br>like making sure that like,</p>
<p>913<br>00:37:41,179 –&gt; 00:37:42,819<br>when you send the,</p>
<p>914<br>00:37:42,819 –&gt; 00:37:44,860<br>that function request to the different servers</p>
<p>915<br>00:37:44,860 –&gt; 00:37:46,420<br>that do active active replication,</p>
<p>916<br>00:37:46,420 –&gt; 00:37:49,299<br>it’s guaranteed execute in the exact same order, right?</p>
<p>917<br>00:37:49,299 –&gt; 00:37:50,900<br>Actually, the way you handle random and timestamp</p>
<p>918<br>00:37:50,900 –&gt; 00:37:55,099<br>is you basically piggyback on the request</p>
<p>919<br>00:37:55,099 –&gt; 00:37:57,579<br>as to go to one server that are server and signs like,</p>
<p>920<br>00:37:57,579 –&gt; 00:37:58,740<br>hey, if you ever called timestamp,</p>
<p>921<br>00:37:58,740 –&gt; 00:37:59,740<br>here’s the timestamp,</p>
<p>922<br>00:37:59,740 –&gt; 00:38:00,579<br>you ever call random,</p>
<p>923<br>00:38:00,579 –&gt; 00:38:01,579<br>here’s the starting seed,</p>
<p>924<br>00:38:01,579 –&gt; 00:38:03,619<br>and then that way you send that information along</p>
<p>925<br>00:38:03,619 –&gt; 00:38:06,220<br>with the request to any other server,</p>
<p>926<br>00:38:06,220 –&gt; 00:38:07,059<br>so when they execute it,</p>
<p>927<br>00:38:07,059 –&gt; 00:38:09,579<br>they’ll get things running in the exact same order.</p>
<p>928<br>00:38:09,579 –&gt; 00:38:11,660<br>That assumes though you’re running transaction requests</p>
<p>929<br>00:38:11,660 –&gt; 00:38:12,980<br>in the exact same order,</p>
<p>930<br>00:38:12,980 –&gt; 00:38:14,900<br>which you can do with serialized ability,</p>
<p>931<br>00:38:14,900 –&gt; 00:38:16,619<br>and that’s why we care about that.</p>
<p>932<br>00:38:17,619 –&gt; 00:38:18,619<br>Okay.</p>
<p>933<br>00:38:18,619 –&gt; 00:38:20,619<br>Okay.</p>
<p>934<br>00:38:20,619 –&gt; 00:38:21,619<br>Okay.</p>
<p>935<br>00:38:21,619 –&gt; 00:38:25,779<br>Again, most of them will be active passive,</p>
<p>936<br>00:38:25,779 –&gt; 00:38:28,659<br>but there’s active activity that you can do it,</p>
<p>937<br>00:38:28,659 –&gt; 00:38:30,500<br>not all systems can,</p>
<p>938<br>00:38:30,500 –&gt; 00:38:31,699<br>provides a lot of benefits.</p>
<p>939<br>00:38:33,699 –&gt; 00:38:35,219<br>All right, so now we gotta talk about how we actually</p>
<p>940<br>00:38:35,219 –&gt; 00:38:36,819<br>wanna get everyone to agree</p>
<p>941<br>00:38:36,819 –&gt; 00:38:38,420<br>that we wanna commit transactions.</p>
<p>942<br>00:38:39,900 –&gt; 00:38:40,500<br>Now, to curiosity,</p>
<p>943<br>00:38:40,500 –&gt; 00:38:41,980<br>who here is taking a distributed system’s course,</p>
<p>944<br>00:38:41,980 –&gt; 00:38:43,819<br>either CMU or some results?</p>
<p>945<br>00:38:43,819 –&gt; 00:38:45,339<br>All right, so more than half, okay.</p>
<p>946<br>00:38:45,340 –&gt; 00:38:47,460<br>So some of this will be somewhat redundant,</p>
<p>947<br>00:38:47,460 –&gt; 00:38:49,380<br>but again, I wanna focus on the things we care about</p>
<p>948<br>00:38:49,380 –&gt; 00:38:51,460<br>in the context of databases.</p>
<p>949<br>00:38:51,460 –&gt; 00:38:52,780<br>And so the,</p>
<p>950<br>00:38:53,980 –&gt; 00:38:55,260<br>in the distributed systems literature,</p>
<p>951<br>00:38:55,260 –&gt; 00:38:58,740<br>they’ll call this state machine replication</p>
<p>952<br>00:38:58,740 –&gt; 00:39:00,860<br>or log replication,</p>
<p>953<br>00:39:00,860 –&gt; 00:39:03,340<br>and the way to think about the context of databases,</p>
<p>954<br>00:39:03,340 –&gt; 00:39:05,500<br>the thing we’re trying to get around the coordinate on</p>
<p>955<br>00:39:05,500 –&gt; 00:39:10,260<br>is the order in which transactions are committed.</p>
<p>956<br>00:39:10,260 –&gt; 00:39:12,460<br>And that’s essentially our state machine, right?</p>
<p>957<br>00:39:12,460 –&gt; 00:39:13,300<br>This transaction committed,</p>
<p>958<br>00:39:13,300 –&gt; 00:39:15,940<br>I’ll tell you this transaction and this transaction, right?</p>
<p>959<br>00:39:15,940 –&gt; 00:39:20,300<br>And it’s not so much like here’s the changes that they made,</p>
<p>960<br>00:39:20,300 –&gt; 00:39:21,300<br>we know what these changes are,</p>
<p>961<br>00:39:21,300 –&gt; 00:39:22,860<br>because that’s part of our log,</p>
<p>962<br>00:39:22,860 –&gt; 00:39:24,940<br>but like the higher level thing that we’re trying to order</p>
<p>963<br>00:39:24,940 –&gt; 00:39:26,620<br>is the commit order.</p>
<p>964<br>00:39:26,620 –&gt; 00:39:29,180<br>Because if you say here’s the commit order</p>
<p>965<br>00:39:29,180 –&gt; 00:39:30,500<br>of my transactions,</p>
<p>966<br>00:39:30,500 –&gt; 00:39:33,180<br>along with that is the metadata that says,</p>
<p>967<br>00:39:33,180 –&gt; 00:39:35,260<br>here’s the changes that they made.</p>
<p>968<br>00:39:35,260 –&gt; 00:39:37,180<br>So if you get the commit order right,</p>
<p>969<br>00:39:37,180 –&gt; 00:39:39,700<br>and you piggyback the changes that the transactions made,</p>
<p>970<br>00:39:39,700 –&gt; 00:39:42,019<br>then you can propagate that to all the nodes,</p>
<p>971<br>00:39:42,019 –&gt; 00:39:46,340<br>and then everyone will be synchronized in order, right?</p>
<p>972<br>00:39:47,420 –&gt; 00:39:48,500<br>So for thing we’ll talk about now,</p>
<p>973<br>00:39:48,500 –&gt; 00:39:50,940<br>is this doesn’t matter whether the database system</p>
<p>974<br>00:39:50,940 –&gt; 00:39:53,579<br>is gonna be partitioned or replicated.</p>
<p>975<br>00:39:53,579 –&gt; 00:39:55,380<br>We still wanna do this to get everyone to agree</p>
<p>976<br>00:39:55,380 –&gt; 00:39:58,300<br>that this is the order that transactions are gonna commit.</p>
<p>977<br>00:39:59,780 –&gt; 00:40:02,340<br>So there’s a bunch of different, actually I take the back,</p>
<p>978<br>00:40:02,340 –&gt; 00:40:03,780<br>there’s not a lot of protocols to do this,</p>
<p>979<br>00:40:03,780 –&gt; 00:40:04,860<br>because it’s really hard.</p>
<p>980<br>00:40:05,820 –&gt; 00:40:09,259<br>These are the main ones that show up in databases.</p>
<p>981<br>00:40:09,260 –&gt; 00:40:11,900<br>Two-phase commit is the original one,</p>
<p>982<br>00:40:12,660 –&gt; 00:40:16,780<br>and this was originally thought to be invented by Jim Gray</p>
<p>983<br>00:40:16,780 –&gt; 00:40:19,420<br>at IBM, he won the Tournament 1 in Davis in the 90s,</p>
<p>984<br>00:40:19,420 –&gt; 00:40:21,020<br>but there’s a famous transaction book</p>
<p>985<br>00:40:21,020 –&gt; 00:40:23,940<br>where he actually trippes it to this other dude in Italy</p>
<p>986<br>00:40:23,940 –&gt; 00:40:26,820<br>who implemented Two-phase commit for like,</p>
<p>987<br>00:40:26,820 –&gt; 00:40:28,420<br>one of the early databases that they built</p>
<p>988<br>00:40:28,420 –&gt; 00:40:32,020<br>for the Italian social security system in the early 1970s.</p>
<p>989<br>00:40:32,020 –&gt; 00:40:33,740<br>But even then the idea of Two-phase commit</p>
<p>990<br>00:40:33,740 –&gt; 00:40:36,220<br>comes from the real world, comes from contract law,</p>
<p>991<br>00:40:37,179 –&gt; 00:40:40,059<br>between legal arrangements between humans, right?</p>
<p>992<br>00:40:40,059 –&gt; 00:40:42,739<br>So the idea of Two-phase commit is sort of,</p>
<p>993<br>00:40:43,579 –&gt; 00:40:45,059<br>it’s implemented in a database system,</p>
<p>994<br>00:40:45,059 –&gt; 00:40:46,539<br>there are different distributed systems,</p>
<p>995<br>00:40:46,539 –&gt; 00:40:49,379<br>but the idea predates computing.</p>
<p>996<br>00:40:50,500 –&gt; 00:40:51,579<br>Then there’s three-phase commit,</p>
<p>997<br>00:40:51,579 –&gt; 00:40:54,019<br>that’s from Stonebreaker, nobody actually does this.</p>
<p>998<br>00:40:54,019 –&gt; 00:40:55,299<br>We can ignore it.</p>
<p>999<br>00:40:55,299 –&gt; 00:40:57,619<br>ViewStamp replication is considered to be the first</p>
<p>1000<br>00:40:59,739 –&gt; 00:41:03,299<br>consensus protocol that shouldn’t be correct.</p>
<p>1001<br>00:41:03,299 –&gt; 00:41:05,299<br>I can handle a live in this issues,</p>
<p>1002<br>00:41:05,460 –&gt; 00:41:07,220<br>and that was invented by Barbara Liskov</p>
<p>1003<br>00:41:07,220 –&gt; 00:41:11,140<br>who won the Tournament Award a few years ago at MIT in 1988.</p>
<p>1004<br>00:41:11,140 –&gt; 00:41:13,380<br>Pax is probably one of everyone that also heard about,</p>
<p>1005<br>00:41:13,380 –&gt; 00:41:14,940<br>this was invented a year later,</p>
<p>1006<br>00:41:16,180 –&gt; 00:41:18,900<br>but the paper itself didn’t come out to the 90s,</p>
<p>1007<br>00:41:18,900 –&gt; 00:41:20,220<br>I’ll explain why in a second.</p>
<p>1008<br>00:41:20,220 –&gt; 00:41:23,580<br>Zab is from the Apache Zookeeper people,</p>
<p>1009<br>00:41:23,580 –&gt; 00:41:26,019<br>the Zookeeper Atomic Broadcast Protocol,</p>
<p>1010<br>00:41:26,019 –&gt; 00:41:27,019<br>that’s roughly 2008,</p>
<p>1011<br>00:41:27,019 –&gt; 00:41:28,620<br>and then RAPT is another popular one</p>
<p>1012<br>00:41:30,019 –&gt; 00:41:31,860<br>that was invented at Stanford in 2013,</p>
<p>1013<br>00:41:31,860 –&gt; 00:41:32,660<br>and this is the one that,</p>
<p>1014<br>00:41:33,659 –&gt; 00:41:35,940<br>you know, it’s sort of invoked now,</p>
<p>1015<br>00:41:35,940 –&gt; 00:41:37,460<br>if you’re building a distributed database system,</p>
<p>1016<br>00:41:37,460 –&gt; 00:41:39,420<br>you often have to do it with use RAPT.</p>
<p>1017<br>00:41:40,460 –&gt; 00:41:43,019<br>But for this lecture, we’re only gonna focus</p>
<p>1018<br>00:41:43,019 –&gt; 00:41:44,500<br>on two-phase commit and Paxos.</p>
<p>1019<br>00:41:45,739 –&gt; 00:41:47,899<br>RAPT is considered to be a more readable,</p>
<p>1020<br>00:41:47,899 –&gt; 00:41:49,980<br>understandable version of Paxos,</p>
<p>1021<br>00:41:49,980 –&gt; 00:41:51,539<br>and the sort of key difference is that</p>
<p>1022<br>00:41:51,539 –&gt; 00:41:54,940<br>there’s fewer node types or participant types</p>
<p>1023<br>00:41:54,940 –&gt; 00:41:58,059<br>in the network, and then when you do a leader election,</p>
<p>1024<br>00:41:59,059 –&gt; 00:42:03,420<br>you only have the nodes that have the most updated law,</p>
<p>1025<br>00:42:03,420 –&gt; 00:42:04,420<br>they’re allowed to go for election,</p>
<p>1026<br>00:42:04,420 –&gt; 00:42:06,299<br>where Paxos anybody can, right?</p>
<p>1027<br>00:42:07,299 –&gt; 00:42:08,820<br>Use different replication of VSR,</p>
<p>1028<br>00:42:08,820 –&gt; 00:42:10,380<br>again, this is a server-coming popular now,</p>
<p>1029<br>00:42:10,380 –&gt; 00:42:12,299<br>because there’s a distributed database</p>
<p>1030<br>00:42:12,299 –&gt; 00:42:14,900<br>out of South Africa, a tiger beetle,</p>
<p>1031<br>00:42:14,900 –&gt; 00:42:16,059<br>that’s written in ZIG,</p>
<p>1032<br>00:42:16,059 –&gt; 00:42:19,139<br>which is like Ross, but more rare,</p>
<p>1033<br>00:42:19,139 –&gt; 00:42:21,099<br>and then you’ll see VSR for that.</p>
<p>1034<br>00:42:23,579 –&gt; 00:42:25,820<br>Okay, so here’s two-phase commit.</p>
<p>1035<br>00:42:25,820 –&gt; 00:42:28,140<br>Basic idea is that there’s an application server,</p>
<p>1036<br>00:42:28,140 –&gt; 00:42:29,620<br>again, we can ignore whether this is actually</p>
<p>1037<br>00:42:29,620 –&gt; 00:42:33,019<br>going through middleware or whatever, it doesn’t matter.</p>
<p>1038<br>00:42:33,019 –&gt; 00:42:35,380<br>That they made a much update to the database,</p>
<p>1039<br>00:42:35,380 –&gt; 00:42:37,180<br>we don’t care whether it’s partitioned or replicated,</p>
<p>1040<br>00:42:37,180 –&gt; 00:42:38,660<br>it doesn’t matter, and they wanna say,</p>
<p>1041<br>00:42:38,660 –&gt; 00:42:41,059<br>okay, I wanna commit my transaction.</p>
<p>1042<br>00:42:41,059 –&gt; 00:42:44,820<br>And so the commit request is gonna be going to some node,</p>
<p>1043<br>00:42:44,820 –&gt; 00:42:46,019<br>we said it was the primary,</p>
<p>1044<br>00:42:46,019 –&gt; 00:42:47,380<br>but in the two-phase commit,</p>
<p>1045<br>00:42:47,380 –&gt; 00:42:49,860<br>Paxolance it’d be called the coordinator.</p>
<p>1046<br>00:42:49,860 –&gt; 00:42:51,740<br>And then the other nodes that were involved</p>
<p>1047<br>00:42:51,740 –&gt; 00:42:54,820<br>in the transaction, those would be called participants.</p>
<p>1048<br>00:42:54,820 –&gt; 00:42:56,460<br>So two-phase commit sounds like,</p>
<p>1049<br>00:42:56,460 –&gt; 00:42:58,019<br>it is what it sounds like, right?</p>
<p>1050<br>00:42:58,019 –&gt; 00:42:59,019<br>It’s two phases.</p>
<p>1051<br>00:42:59,019 –&gt; 00:43:01,059<br>So in the first phase is called prepare phase,</p>
<p>1052<br>00:43:01,059 –&gt; 00:43:02,820<br>you send a message, the coordinator sends a message</p>
<p>1053<br>00:43:02,820 –&gt; 00:43:04,420<br>to all the nodes, the participants and say,</p>
<p>1054<br>00:43:04,420 –&gt; 00:43:07,260<br>hey, there’s this transaction, it’s got this ID,</p>
<p>1055<br>00:43:07,260 –&gt; 00:43:11,140<br>whatever metadata or identification you wanna use,</p>
<p>1056<br>00:43:11,140 –&gt; 00:43:13,019<br>go ahead and prepare to commit.</p>
<p>1057<br>00:43:13,019 –&gt; 00:43:15,380<br>And they come back and they vote and say, yes.</p>
<p>1058<br>00:43:15,380 –&gt; 00:43:17,100<br>Okay, yes, we wanna commit this.</p>
<p>1059<br>00:43:17,100 –&gt; 00:43:20,420<br>And then once you get all the okays from all the participants,</p>
<p>1060<br>00:43:20,420 –&gt; 00:43:21,620<br>then you go through the second phase and say,</p>
<p>1061<br>00:43:21,620 –&gt; 00:43:23,420<br>okay guys, go ahead and commit.</p>
<p>1062<br>00:43:23,420 –&gt; 00:43:25,820<br>You send that message to them,</p>
<p>1063<br>00:43:25,820 –&gt; 00:43:27,220<br>they come back with okay.</p>
<p>1064<br>00:43:27,220 –&gt; 00:43:30,380<br>And once you get all them from the participants,</p>
<p>1065<br>00:43:30,380 –&gt; 00:43:32,659<br>then you’re allowed to go until the application</p>
<p>1066<br>00:43:32,659 –&gt; 00:43:34,820<br>that this transaction has committed.</p>
<p>1067<br>00:43:34,820 –&gt; 00:43:38,380<br>Now what I’m not showing here is that,</p>
<p>1068<br>00:43:38,380 –&gt; 00:43:40,059<br>on every node, we’re actually recording</p>
<p>1069<br>00:43:40,059 –&gt; 00:43:41,220<br>in our right-of-head log,</p>
<p>1070<br>00:43:41,220 –&gt; 00:43:43,700<br>here’s all the messages that we got,</p>
<p>1071<br>00:43:43,700 –&gt; 00:43:46,099<br>and here’s our response to them.</p>
<p>1072<br>00:43:46,099 –&gt; 00:43:47,500<br>And we flush that to disk.</p>
<p>1073<br>00:43:48,500 –&gt; 00:43:51,260<br>So that way, if there’s a crash and we come back,</p>
<p>1074<br>00:43:51,260 –&gt; 00:43:52,500<br>the doke and look on the log and say,</p>
<p>1075<br>00:43:52,500 –&gt; 00:43:54,380<br>well, I was involved in this transaction, not.</p>
<p>1076<br>00:43:54,380 –&gt; 00:43:56,500<br>So, at least knows about it.</p>
<p>1077<br>00:43:56,500 –&gt; 00:43:58,820<br>And it knows that it voted a certain way.</p>
<p>1078<br>00:44:00,260 –&gt; 00:44:01,940<br>So that, again, if there’s no failure,</p>
<p>1079<br>00:44:01,940 –&gt; 00:44:05,099<br>we can come back and reason about what was the state</p>
<p>1080<br>00:44:05,099 –&gt; 00:44:06,019<br>of the system,</p>
<p>1081<br>00:44:07,059 –&gt; 00:44:08,539<br>when we were committing transactions,</p>
<p>1082<br>00:44:08,539 –&gt; 00:44:10,860<br>and at the time of the failure.</p>
<p>1083<br>00:44:12,860 –&gt; 00:44:15,579<br>So another key thing about the two-phase commit,</p>
<p>1084<br>00:44:15,579 –&gt; 00:44:19,500<br>is that we have to wait for all the okays to come back</p>
<p>1085<br>00:44:19,500 –&gt; 00:44:22,739<br>from all the participants before we enter the next phase,</p>
<p>1086<br>00:44:22,739 –&gt; 00:44:25,940<br>or before we tell the outside word of transactions committed.</p>
<p>1087<br>00:44:25,940 –&gt; 00:44:27,099<br>That’s gonna be different than Paxos.</p>
<p>1088<br>00:44:27,099 –&gt; 00:44:30,059<br>Paxos has to wait for majority, wrapped as well.</p>
<p>1089<br>00:44:31,900 –&gt; 00:44:33,059<br>And I’ll talk about this in a second,</p>
<p>1090<br>00:44:33,059 –&gt; 00:44:36,860<br>but basically two-phase commit is a gendered case of Paxos.</p>
<p>1091<br>00:44:39,219 –&gt; 00:44:40,820<br>But it has this live-niss issue</p>
<p>1092<br>00:44:40,820 –&gt; 00:44:43,500<br>where anyone know can take the whole thing down,</p>
<p>1093<br>00:44:43,500 –&gt; 00:44:45,900<br>because you’re waiting for it, until you time out.</p>
<p>1094<br>00:44:46,740 –&gt; 00:44:50,740<br>All right, so this is success.</p>
<p>1095<br>00:44:50,740 –&gt; 00:44:55,340<br>For a board, say the application service says commit request,</p>
<p>1096<br>00:44:55,340 –&gt; 00:44:58,300<br>we send the prepare message out to everyone.</p>
<p>1097<br>00:44:58,300 –&gt; 00:45:00,220<br>One of them, for whatever reason, we don’t care.</p>
<p>1098<br>00:45:00,220 –&gt; 00:45:02,820<br>We don’t know why, comes back and says a board.</p>
<p>1099<br>00:45:02,820 –&gt; 00:45:06,460<br>And if one participant in the network</p>
<p>1100<br>00:45:06,460 –&gt; 00:45:08,220<br>says we wanna board this transaction,</p>
<p>1101<br>00:45:08,220 –&gt; 00:45:10,300<br>then immediately we can tell the outside world</p>
<p>1102<br>00:45:10,300 –&gt; 00:45:12,099<br>that our transaction has aborted,</p>
<p>1103<br>00:45:12,099 –&gt; 00:45:13,940<br>and then we enter the abort phase,</p>
<p>1104<br>00:45:13,940 –&gt; 00:45:15,820<br>and we send all the abort messages to everyone.</p>
<p>1105<br>00:45:16,660 –&gt; 00:45:17,580<br>And even though one note might have said,</p>
<p>1106<br>00:45:17,580 –&gt; 00:45:18,900<br>oh, yeah, I really wanna commit this transaction,</p>
<p>1107<br>00:45:18,900 –&gt; 00:45:20,580<br>I love it, whatever, really.</p>
<p>1108<br>00:45:20,580 –&gt; 00:45:23,380<br>If we get one abort, we have to kill the whole thing.</p>
<p>1109<br>00:45:23,380 –&gt; 00:45:26,300<br>If the coordinator tells us we have to fail,</p>
<p>1110<br>00:45:26,300 –&gt; 00:45:27,660<br>we have to fail, right?</p>
<p>1111<br>00:45:29,220 –&gt; 00:45:30,380<br>And then they send back their analogy,</p>
<p>1112<br>00:45:30,380 –&gt; 00:45:31,460<br>and we log all of this.</p>
<p>1113<br>00:45:33,700 –&gt; 00:45:34,700<br>Pretty simple, right?</p>
<p>1114<br>00:45:38,019 –&gt; 00:45:38,860<br>Yes.</p>
<p>1115<br>00:45:38,860 –&gt; 00:45:41,700<br>So this is for active active?</p>
<p>1116<br>00:45:41,700 –&gt; 00:45:43,019<br>Swaychan, is this for active active?</p>
<p>1117<br>00:45:43,019 –&gt; 00:45:44,300<br>Why would it be only for active active?</p>
<p>1118<br>00:45:44,300 –&gt; 00:45:48,060<br>Because we’re like checking the other nodes,</p>
<p>1119<br>00:45:48,060 –&gt; 00:45:49,580<br>it’s okay, then I’m quite dealing with it.</p>
<p>1120<br>00:45:49,580 –&gt; 00:45:51,860<br>It’s a little bit running, do you agree?</p>
<p>1121<br>00:45:51,860 –&gt; 00:45:54,220<br>The statement is, because we’re checking the other nodes</p>
<p>1122<br>00:45:55,460 –&gt; 00:45:56,660<br>when it’s okay to commit,</p>
<p>1123<br>00:45:56,660 –&gt; 00:45:59,380<br>that assume they’re running the other query,</p>
<p>1124<br>00:45:59,380 –&gt; 00:46:00,220<br>there’s a matter.</p>
<p>1125<br>00:46:01,300 –&gt; 00:46:02,620<br>You have to have someone be the coordinator.</p>
<p>1126<br>00:46:02,620 –&gt; 00:46:04,380<br>Someone has to say, okay guys, we’re committing.</p>
<p>1127<br>00:46:04,380 –&gt; 00:46:07,260<br>It doesn’t matter how node and two got,</p>
<p>1128<br>00:46:08,700 –&gt; 00:46:10,700<br>we’re propagating to the updates.</p>
<p>1129<br>00:46:10,700 –&gt; 00:46:13,580<br>Active passive, active active doesn’t matter.</p>
<p>1130<br>00:46:13,579 –&gt; 00:46:16,500<br>Okay, so I guess in what case does it send the board</p>
<p>1131<br>00:46:16,500 –&gt; 00:46:18,619<br>then it’s the only propagating update?</p>
<p>1132<br>00:46:18,619 –&gt; 00:46:21,019<br>Swaychan, in what case does it send a board?</p>
<p>1133<br>00:46:22,179 –&gt; 00:46:24,579<br>So there could be another coordinator</p>
<p>1134<br>00:46:24,579 –&gt; 00:46:25,860<br>committing another transaction,</p>
<p>1135<br>00:46:26,860 –&gt; 00:46:29,139<br>and node three is involved in it,</p>
<p>1136<br>00:46:29,139 –&gt; 00:46:31,699<br>and for whatever reason, it can commit the,</p>
<p>1137<br>00:46:31,699 –&gt; 00:46:33,579<br>that guy’s transaction, but not this one.</p>
<p>1138<br>00:46:40,539 –&gt; 00:46:41,380<br>Yes.</p>
<p>1139<br>00:46:41,380 –&gt; 00:46:42,980<br>So, the participants are limited,</p>
<p>1140<br>00:46:42,980 –&gt; 00:46:44,300<br>about the first 30 minutes.</p>
<p>1141<br>00:46:44,300 –&gt; 00:46:45,300<br>Your statement is,</p>
<p>1142<br>00:46:45,300 –&gt; 00:46:49,059<br>participants are not limited to replicas, correct, yes.</p>
<p>1143<br>00:46:50,380 –&gt; 00:46:53,140<br>So it could be multi-home, the multi-primary.</p>
<p>1144<br>00:46:53,140 –&gt; 00:46:54,660<br>It’s just again, when interest actually commits,</p>
<p>1145<br>00:46:54,660 –&gt; 00:46:57,180<br>someone has to be in charge, right?</p>
<p>1146<br>00:47:01,300 –&gt; 00:47:04,579<br>Okay, so as I said, all the inbound and outbound messages,</p>
<p>1147<br>00:47:04,579 –&gt; 00:47:07,660<br>we have to store and disk, and we have to flush them,</p>
<p>1148<br>00:47:07,660 –&gt; 00:47:08,940<br>like the red head log,</p>
<p>1149<br>00:47:09,860 –&gt; 00:47:11,860<br>and then when we crash, we come back.</p>
<p>1150<br>00:47:12,740 –&gt; 00:47:16,300<br>If we see that, if we go look at our log,</p>
<p>1151<br>00:47:16,300 –&gt; 00:47:19,579<br>and we see that we were in this prepared state,</p>
<p>1152<br>00:47:19,579 –&gt; 00:47:21,059<br>meaning like we got it, we got a request,</p>
<p>1153<br>00:47:21,059 –&gt; 00:47:23,139<br>to prepare the transaction,</p>
<p>1154<br>00:47:23,139 –&gt; 00:47:25,139<br>and we said, yeah, go ahead and prepare it,</p>
<p>1155<br>00:47:25,139 –&gt; 00:47:26,980<br>but then we didn’t see whether that,</p>
<p>1156<br>00:47:26,980 –&gt; 00:47:28,940<br>the vote was successful or not,</p>
<p>1157<br>00:47:28,940 –&gt; 00:47:30,260<br>then when the node comes back,</p>
<p>1158<br>00:47:30,260 –&gt; 00:47:32,900<br>it contacts the coordinator to get the updates for the log.</p>
<p>1159<br>00:47:32,900 –&gt; 00:47:34,780<br>I forgot what it missed.</p>
<p>1160<br>00:47:34,780 –&gt; 00:47:38,099<br>If the transaction was not in the prepared state,</p>
<p>1161<br>00:47:38,099 –&gt; 00:47:39,659<br>then we assume that it was aborted,</p>
<p>1162<br>00:47:40,659 –&gt; 00:47:43,380<br>because if I was involved in the transaction,</p>
<p>1163<br>00:47:43,380 –&gt; 00:47:45,420<br>under a two-base commit, and then I crashed,</p>
<p>1164<br>00:47:45,420 –&gt; 00:47:47,460<br>clearly couldn’t have committed.</p>
<p>1165<br>00:47:47,460 –&gt; 00:47:51,380<br>So I’m gonna correctly assume that it was aborted.</p>
<p>1166<br>00:47:54,099 –&gt; 00:47:57,779<br>If the transaction was committing,</p>
<p>1167<br>00:47:57,779 –&gt; 00:48:00,579<br>and the node that fails as the coordinator,</p>
<p>1168<br>00:48:02,739 –&gt; 00:48:05,099<br>then when I come back up, I just send out again,</p>
<p>1169<br>00:48:05,099 –&gt; 00:48:08,299<br>hey guys, you may have missed this,</p>
<p>1170<br>00:48:08,299 –&gt; 00:48:09,500<br>but I’m pretty sure you just get this,</p>
<p>1171<br>00:48:09,500 –&gt; 00:48:10,940<br>this transaction was committed.</p>
<p>1172<br>00:48:10,940 –&gt; 00:48:12,259<br>Of course, now again, I have to,</p>
<p>1173<br>00:48:12,259 –&gt; 00:48:13,699<br>the other nodes have to wait for that coordinator</p>
<p>1174<br>00:48:13,699 –&gt; 00:48:16,699<br>to come back up and come back online.</p>
<p>1175<br>00:48:16,699 –&gt; 00:48:19,139<br>Or at some point, they’ll be a timeout,</p>
<p>1176<br>00:48:19,139 –&gt; 00:48:20,500<br>and they say, oh, when that coordinator’s dead,</p>
<p>1177<br>00:48:20,500 –&gt; 00:48:22,980<br>he’s never coming back, this transaction is aborted.</p>
<p>1178<br>00:48:22,980 –&gt; 00:48:24,539<br>Right?</p>
<p>1179<br>00:48:24,539 –&gt; 00:48:27,380<br>But again, one node going down can take down the whole thing.</p>
<p>1180<br>00:48:30,659 –&gt; 00:48:32,699<br>So, all right, what happens if the coordinator crashes</p>
<p>1181<br>00:48:32,699 –&gt; 00:48:35,059<br>or they set this, they have to decide what to do,</p>
<p>1182<br>00:48:35,059 –&gt; 00:48:37,539<br>after timeout, and again, the system is not available</p>
<p>1183<br>00:48:37,539 –&gt; 00:48:38,980<br>during this time, and available means like,</p>
<p>1184<br>00:48:38,980 –&gt; 00:48:41,139<br>I can’t take any new queries.</p>
<p>1185<br>00:48:42,179 –&gt; 00:48:44,340<br>I could take read queries, and I’m okay for things</p>
<p>1186<br>00:48:44,340 –&gt; 00:48:47,019<br>being a little loosey-goosey if you don’t want</p>
<p>1187<br>00:48:47,019 –&gt; 00:48:48,659<br>that strong consistency guarantee,</p>
<p>1188<br>00:48:50,259 –&gt; 00:48:52,019<br>but I can’t take any rights,</p>
<p>1189<br>00:48:52,900 –&gt; 00:48:54,940<br>because I can’t propagate those rights,</p>
<p>1190<br>00:48:54,940 –&gt; 00:48:57,139<br>because until I find out what the transaction is before</p>
<p>1191<br>00:48:57,139 –&gt; 00:48:58,940<br>for me actually did.</p>
<p>1192<br>00:49:00,619 –&gt; 00:49:01,900<br>And then the participant crashes,</p>
<p>1193<br>00:49:01,900 –&gt; 00:49:04,980<br>the coordinators are gonna assume that it just hasn’t responded</p>
<p>1194<br>00:49:04,980 –&gt; 00:49:08,900<br>and it’s gonna be abort, and then we just timeout</p>
<p>1195<br>00:49:08,900 –&gt; 00:49:10,059<br>and say, okay, this guy’s dead,</p>
<p>1196<br>00:49:10,059 –&gt; 00:49:12,300<br>and then we just abort the transaction.</p>
<p>1197<br>00:49:12,300 –&gt; 00:49:13,139<br>Right?</p>
<p>1198<br>00:49:15,740 –&gt; 00:49:18,699<br>So, there are two optimizations we can do in two phase commit.</p>
<p>1199<br>00:49:18,699 –&gt; 00:49:20,460<br>The first is called early prepare voting,</p>
<p>1200<br>00:49:20,460 –&gt; 00:49:22,260<br>which is actually very rare,</p>
<p>1201<br>00:49:22,260 –&gt; 00:49:26,500<br>and you can only do this with the active approach I talked about</p>
<p>1202<br>00:49:26,500 –&gt; 00:49:28,300<br>for, and with store procedures.</p>
<p>1203<br>00:49:30,420 –&gt; 00:49:31,340<br>Yeah, I think that’s true.</p>
<p>1204<br>00:49:32,340 –&gt; 00:49:35,700<br>Now, sorry to be about you could do with the JDBC,</p>
<p>1205<br>00:49:35,700 –&gt; 00:49:38,660<br>but the wire protocol of the database system</p>
<p>1206<br>00:49:38,660 –&gt; 00:49:40,980<br>doesn’t support this technique,</p>
<p>1207<br>00:49:40,980 –&gt; 00:49:42,579<br>but you can do this, some systems can do this</p>
<p>1208<br>00:49:42,579 –&gt; 00:49:43,900<br>if you do store procedures.</p>
<p>1209<br>00:49:43,900 –&gt; 00:49:45,140<br>And then the one that’s more common</p>
<p>1210<br>00:49:45,140 –&gt; 00:49:47,220<br>is early acknowledgement after prepare.</p>
<p>1211<br>00:49:47,220 –&gt; 00:49:48,620<br>So, early prepare voting is,</p>
<p>1212<br>00:49:49,579 –&gt; 00:49:52,780<br>if I’m sending a query request to another node,</p>
<p>1213<br>00:49:52,780 –&gt; 00:49:54,660<br>and I know this is the last time,</p>
<p>1214<br>00:49:54,660 –&gt; 00:49:56,539<br>the last query I’m ever gonna execute on that node</p>
<p>1215<br>00:49:56,539 –&gt; 00:49:59,140<br>for this transaction, then I piggyback on my message</p>
<p>1216<br>00:49:59,139 –&gt; 00:50:01,539<br>and say, hey, execute this query, and oh by the way,</p>
<p>1217<br>00:50:01,539 –&gt; 00:50:03,099<br>I’m gonna commit, you’re pretty soon,</p>
<p>1218<br>00:50:03,099 –&gt; 00:50:05,980<br>I’m never gonna come back and ask you to run another query.</p>
<p>1219<br>00:50:05,980 –&gt; 00:50:07,819<br>So, go tell me what your vote’s gonna be</p>
<p>1220<br>00:50:07,819 –&gt; 00:50:09,019<br>for two phase commit.</p>
<p>1221<br>00:50:09,019 –&gt; 00:50:10,339<br>So, you get the query response back,</p>
<p>1222<br>00:50:10,339 –&gt; 00:50:12,900<br>and actually the vote on the prepare phase,</p>
<p>1223<br>00:50:12,900 –&gt; 00:50:14,299<br>all of them one round trip.</p>
<p>1224<br>00:50:15,940 –&gt; 00:50:18,859<br>Early acknowledgement after prepare is basically,</p>
<p>1225<br>00:50:18,859 –&gt; 00:50:21,139<br>if I get the acknowledgement on the coordinator</p>
<p>1226<br>00:50:21,139 –&gt; 00:50:23,059<br>from all of the participants,</p>
<p>1227<br>00:50:23,059 –&gt; 00:50:24,980<br>that this transaction is gonna commit,</p>
<p>1228<br>00:50:24,980 –&gt; 00:50:27,299<br>then I don’t wait until the,</p>
<p>1229<br>00:50:27,300 –&gt; 00:50:30,940<br>I get the acknowledgments from the commit phase.</p>
<p>1230<br>00:50:30,940 –&gt; 00:50:33,980<br>I immediately send back the commit message</p>
<p>1231<br>00:50:33,980 –&gt; 00:50:34,980<br>to the application,</p>
<p>1232<br>00:50:34,980 –&gt; 00:50:37,019<br>the acknowledge it back to the application.</p>
<p>1233<br>00:50:37,019 –&gt; 00:50:39,780<br>Because at that point, I assume that if there’s a crash</p>
<p>1234<br>00:50:39,780 –&gt; 00:50:43,380<br>and I come back, then the coordinator or the nodes</p>
<p>1235<br>00:50:43,380 –&gt; 00:50:44,700<br>will look in the log and say, okay,</p>
<p>1236<br>00:50:44,700 –&gt; 00:50:46,660<br>we all agree to commit this transaction.</p>
<p>1237<br>00:50:46,660 –&gt; 00:50:49,539<br>So, let’s go ahead and actually apply the change.</p>
<p>1238<br>00:50:49,539 –&gt; 00:50:51,780<br>So, there’s a small window where like,</p>
<p>1239<br>00:50:53,420 –&gt; 00:50:56,220<br>sorry, there is not a window where you could crash</p>
<p>1240<br>00:50:56,219 –&gt; 00:50:58,779<br>and lose data, but they’re able to take,</p>
<p>1241<br>00:50:58,779 –&gt; 00:51:00,459<br>we’ll make recovery a little bit longer.</p>
<p>1242<br>00:51:02,219 –&gt; 00:51:03,179<br>So, it looks like that’s right.</p>
<p>1243<br>00:51:03,179 –&gt; 00:51:05,059<br>So, I get my commitment crest,</p>
<p>1244<br>00:51:05,059 –&gt; 00:51:07,339<br>I do my prepare phase, they all come back and say,</p>
<p>1245<br>00:51:07,339 –&gt; 00:51:09,779<br>okay, go ahead and commit.</p>
<p>1246<br>00:51:09,779 –&gt; 00:51:11,899<br>And then immediately once I get back all the okay,</p>
<p>1247<br>00:51:11,899 –&gt; 00:51:13,419<br>I can send back the success.</p>
<p>1248<br>00:51:14,859 –&gt; 00:51:17,419<br>And then I still then have to do the commit phase</p>
<p>1249<br>00:51:17,419 –&gt; 00:51:19,179<br>and get that round trip.</p>
<p>1250<br>00:51:19,179 –&gt; 00:51:20,980<br>Again, all of this is written to the log,</p>
<p>1251<br>00:51:20,980 –&gt; 00:51:22,459<br>which not everyone always does,</p>
<p>1252<br>00:51:23,460 –&gt; 00:51:26,019<br>or no one ever always flushes it,</p>
<p>1253<br>00:51:27,780 –&gt; 00:51:29,340<br>but most systems doing two phase commit</p>
<p>1254<br>00:51:29,340 –&gt; 00:51:31,699<br>are gonna do this simple optimization.</p>
<p>1255<br>00:51:31,699 –&gt; 00:51:34,220<br>Because the fairytale window is pretty small.</p>
<p>1256<br>00:51:35,260 –&gt; 00:51:36,099<br>Yes.</p>
<p>1257<br>00:51:36,099 –&gt; 00:51:37,740<br>So, important to do two phase,</p>
<p>1258<br>00:51:37,740 –&gt; 00:51:39,619<br>if we’re doing phase commit?</p>
<p>1259<br>00:51:39,619 –&gt; 00:51:42,780<br>This question is, do we still need to do two phase commit</p>
<p>1260<br>00:51:42,780 –&gt; 00:51:44,579<br>if we’re doing asynchronous commits?</p>
<p>1261<br>00:51:48,579 –&gt; 00:51:50,820<br>You should, because you want everyone to say,</p>
<p>1262<br>00:51:50,820 –&gt; 00:51:53,539<br>okay, we all agree this is the update that happened.</p>
<p>1263<br>00:51:56,340 –&gt; 00:51:58,940<br>You don’t have to though, it makes,</p>
<p>1264<br>00:52:00,500 –&gt; 00:52:02,180<br>you’d have to do more work on recovery,</p>
<p>1265<br>00:52:03,380 –&gt; 00:52:05,660<br>but you could potentially not use two phase commit.</p>
<p>1266<br>00:52:07,940 –&gt; 00:52:09,900<br>I think that’s true, yes.</p>
<p>1267<br>00:52:09,900 –&gt; 00:52:11,260<br>Yeah, I think a lot of the new SQL systems,</p>
<p>1268<br>00:52:11,260 –&gt; 00:52:12,260<br>when they did that propagation,</p>
<p>1269<br>00:52:12,260 –&gt; 00:52:14,059<br>they weren’t using two phase commit.</p>
<p>1270<br>00:52:18,100 –&gt; 00:52:18,940<br>All right.</p>
<p>1271<br>00:52:20,980 –&gt; 00:52:24,940<br>So, Paxos, as I said, is considered a super set</p>
<p>1272<br>00:52:24,940 –&gt; 00:52:29,059<br>to two phase commit, and this was the,</p>
<p>1273<br>00:52:29,059 –&gt; 00:52:30,980<br>I think this was the first crack protocol</p>
<p>1274<br>00:52:30,980 –&gt; 00:52:34,140<br>that was presumably resilient in the face</p>
<p>1275<br>00:52:34,140 –&gt; 00:52:35,460<br>of asynchronous networks,</p>
<p>1276<br>00:52:35,460 –&gt; 00:52:37,260<br>but again, it wasn’t the first one</p>
<p>1277<br>00:52:37,260 –&gt; 00:52:39,140<br>that actually could do this,</p>
<p>1278<br>00:52:39,140 –&gt; 00:52:41,100<br>ViewStamp replication came before it.</p>
<p>1279<br>00:52:42,500 –&gt; 00:52:47,500<br>And so, the idea is basically that we’re gonna send out</p>
<p>1280<br>00:52:48,019 –&gt; 00:52:49,420<br>votes just like before,</p>
<p>1281<br>00:52:51,019 –&gt; 00:52:54,660<br>but instead of having all the participants come back</p>
<p>1282<br>00:52:54,660 –&gt; 00:52:57,660<br>and acknowledge that this transaction not commit,</p>
<p>1283<br>00:52:57,660 –&gt; 00:52:59,740<br>you just need a majority.</p>
<p>1284<br>00:52:59,740 –&gt; 00:53:02,180<br>And then for the ones that are in the minority,</p>
<p>1285<br>00:53:02,180 –&gt; 00:53:05,580<br>they basically are treated as failures or failing,</p>
<p>1286<br>00:53:05,580 –&gt; 00:53:08,380<br>and they have to basically crash, pseudo crash,</p>
<p>1287<br>00:53:08,380 –&gt; 00:53:11,420<br>and then replay the law to get that back up the,</p>
<p>1288<br>00:53:11,420 –&gt; 00:53:14,500<br>up the, the correct state.</p>
<p>1289<br>00:53:14,500 –&gt; 00:53:16,019<br>And this is going back to what I was saying before,</p>
<p>1290<br>00:53:16,019 –&gt; 00:53:18,260<br>this is why we don’t care about visiting fault tolerance</p>
<p>1291<br>00:53:18,260 –&gt; 00:53:21,580<br>in the real world, well, in this world,</p>
<p>1292<br>00:53:21,580 –&gt; 00:53:23,900<br>because it’s not like someone’s gonna vote no</p>
<p>1293<br>00:53:23,900 –&gt; 00:53:26,420<br>because they wanna be, right?</p>
<p>1294<br>00:53:26,420 –&gt; 00:53:28,060<br>Whenever an else is going to commit,</p>
<p>1295<br>00:53:28,060 –&gt; 00:53:30,740<br>there’s something really wrong with it,</p>
<p>1296<br>00:53:31,740 –&gt; 00:53:34,460<br>or the network, but when it comes back,</p>
<p>1297<br>00:53:34,460 –&gt; 00:53:38,260<br>it can get back up the date, right?</p>
<p>1298<br>00:53:38,260 –&gt; 00:53:40,940<br>Assuming that there’s no massive hardware failures.</p>
<p>1299<br>00:53:40,940 –&gt; 00:53:43,980<br>So, the original Paxos paper, I think,</p>
<p>1300<br>00:53:43,980 –&gt; 00:53:44,980<br>is there a date on this?</p>
<p>1301<br>00:53:45,980 –&gt; 00:53:47,980<br>Yeah, 1998.</p>
<p>1302<br>00:53:47,980 –&gt; 00:53:52,980<br>The land port actually wrote the paper in 89,</p>
<p>1303<br>00:53:54,980 –&gt; 00:53:56,980<br>but who here has ever read the Paxos paper?</p>
<p>1304<br>00:53:57,980 –&gt; 00:53:59,179<br>One, two.</p>
<p>1305<br>00:53:59,179 –&gt; 00:54:00,179<br>The wild reed, right?</p>
<p>1306<br>00:54:00,179 –&gt; 00:54:01,179<br>Yeah.</p>
<p>1307<br>00:54:01,179 –&gt; 00:54:02,380<br>So, it’s crazy.</p>
<p>1308<br>00:54:03,380 –&gt; 00:54:06,579<br>It’s basically, he’s trying to be very illustrative</p>
<p>1309<br>00:54:06,579 –&gt; 00:54:10,780<br>and not poetic, but he was trying to,</p>
<p>1310<br>00:54:10,780 –&gt; 00:54:12,179<br>instead of saying, here’s the protocol,</p>
<p>1311<br>00:54:12,179 –&gt; 00:54:13,780<br>like, does this, this, this, this, this,</p>
<p>1312<br>00:54:13,780 –&gt; 00:54:16,140<br>he describes it as if he’s like archaeologists</p>
<p>1313<br>00:54:16,140 –&gt; 00:54:19,340<br>finding this ancient Greek tribe in the island of Paxos</p>
<p>1314<br>00:54:19,340 –&gt; 00:54:21,340<br>and how they would do voting by throwing tablets</p>
<p>1315<br>00:54:21,340 –&gt; 00:54:24,900<br>in a hole and then coming back later to read them, right?</p>
<p>1316<br>00:54:24,900 –&gt; 00:54:28,460<br>Like, it’s just, I mean, it’s amusing,</p>
<p>1317<br>00:54:29,580 –&gt; 00:54:31,700<br>but like, if you really try to read and understand</p>
<p>1318<br>00:54:31,700 –&gt; 00:54:34,500<br>what the hell is actually trying to do, you can’t.</p>
<p>1319<br>00:54:34,500 –&gt; 00:54:36,420<br>And so, the story goes is that,</p>
<p>1320<br>00:54:38,180 –&gt; 00:54:41,060<br>if you go to, actually, if you go to Leslie Lamport’s website,</p>
<p>1321<br>00:54:41,060 –&gt; 00:54:42,980<br>and you go look at his, his, maybe theography,</p>
<p>1322<br>00:54:42,980 –&gt; 00:54:45,219<br>which is kind of cool, he lists, like, for every single paper,</p>
<p>1323<br>00:54:45,219 –&gt; 00:54:47,420<br>at least for the major ones,</p>
<p>1324<br>00:54:47,420 –&gt; 00:54:49,460<br>he lists like what he was doing in his daily life</p>
<p>1325<br>00:54:49,460 –&gt; 00:54:51,780<br>when he wrote the paper, like, what he was eating,</p>
<p>1326<br>00:54:51,780 –&gt; 00:54:53,260<br>who he’s dating, and so forth, right?</p>
<p>1327<br>00:54:53,260 –&gt; 00:54:54,940<br>And so, he talks about in the Paxos paper,</p>
<p>1328<br>00:54:54,940 –&gt; 00:54:56,940<br>when he submitted it with this Greek archaeology story</p>
<p>1329<br>00:54:56,940 –&gt; 00:54:59,740<br>inside of it, it got rejected.</p>
<p>1330<br>00:54:59,740 –&gt; 00:55:01,500<br>And he says, oh, the reviewers were stupid,</p>
<p>1331<br>00:55:01,500 –&gt; 00:55:03,019<br>because like, they couldn’t appreciate my genius</p>
<p>1332<br>00:55:03,019 –&gt; 00:55:04,019<br>or whatever.</p>
<p>1333<br>00:55:04,019 –&gt; 00:55:05,820<br>And so, when I was in grad school,</p>
<p>1334<br>00:55:05,820 –&gt; 00:55:07,099<br>I took a distributor, it says, it was course,</p>
<p>1335<br>00:55:07,099 –&gt; 00:55:08,820<br>and I presented the Paxos paper,</p>
<p>1336<br>00:55:08,820 –&gt; 00:55:10,420<br>and I started going on about like, oh, yeah,</p>
<p>1337<br>00:55:10,420 –&gt; 00:55:12,219<br>this paper is brilliant, and like,</p>
<p>1338<br>00:55:12,219 –&gt; 00:55:13,859<br>the reviewers were stupid, they were stupid</p>
<p>1339<br>00:55:13,859 –&gt; 00:55:16,099<br>for rejecting his, you know, he was a genius.</p>
<p>1340<br>00:55:16,099 –&gt; 00:55:17,500<br>Turns out though, the professor teaching it,</p>
<p>1341<br>00:55:17,500 –&gt; 00:55:20,019<br>this is back at Brown, was Maurice Hurley,</p>
<p>1342<br>00:55:20,019 –&gt; 00:55:22,659<br>who used to be here at CMU, and he’s like,</p>
<p>1343<br>00:55:22,659 –&gt; 00:55:25,139<br>yeah, I actually was one of the reviewers on this paper.</p>
<p>1344<br>00:55:25,139 –&gt; 00:55:30,659<br>And the story goes is that they were okay with,</p>
<p>1345<br>00:55:30,659 –&gt; 00:55:32,739<br>he says they were okay with all the Greek stuff,</p>
<p>1346<br>00:55:32,739 –&gt; 00:55:35,059<br>they just wanted him to have an appendix with like,</p>
<p>1347<br>00:55:35,059 –&gt; 00:55:37,699<br>you know, with an algorithm and like a proof,</p>
<p>1348<br>00:55:37,699 –&gt; 00:55:39,459<br>showing that what the thing actually was,</p>
<p>1349<br>00:55:39,459 –&gt; 00:55:41,980<br>and Leslie Lamport was apparently super stubborn,</p>
<p>1350<br>00:55:41,980 –&gt; 00:55:43,340<br>didn’t want to change anything in the paper,</p>
<p>1351<br>00:55:43,340 –&gt; 00:55:44,860<br>because he thought it was perfect as is.</p>
<p>1352<br>00:55:44,860 –&gt; 00:55:47,860<br>So, got rejected, they put it in his filing camera,</p>
<p>1353<br>00:55:47,860 –&gt; 00:55:51,139<br>put it in his shelf, and didn’t do anything with it</p>
<p>1354<br>00:55:51,139 –&gt; 00:55:53,139<br>for like 10 years, and then over the 90s,</p>
<p>1355<br>00:55:53,139 –&gt; 00:55:54,539<br>people started publishing papers that sort of like,</p>
<p>1356<br>00:55:54,539 –&gt; 00:55:56,780<br>dancing around the problem that he already saw</p>
<p>1357<br>00:55:56,780 –&gt; 00:55:59,219<br>back in 89, he actually was not aware</p>
<p>1358<br>00:55:59,219 –&gt; 00:56:02,219<br>of view stamp replication, which came out in 88.</p>
<p>1359<br>00:56:03,179 –&gt; 00:56:05,340<br>But then once he saw enough papers,</p>
<p>1360<br>00:56:05,340 –&gt; 00:56:08,099<br>trying to kind of bark him up the same tree as Paxos,</p>
<p>1361<br>00:56:08,099 –&gt; 00:56:10,179<br>then he put the original Paxos paper out,</p>
<p>1362<br>00:56:10,179 –&gt; 00:56:11,340<br>along with another paper called,</p>
<p>1363<br>00:56:11,340 –&gt; 00:56:13,780<br>Paxos Made Simple, which is not simple,</p>
<p>1364<br>00:56:13,780 –&gt; 00:56:16,620<br>which is, but actually the one paper,</p>
<p>1365<br>00:56:16,620 –&gt; 00:56:18,180<br>if you want to read a Paxos paper,</p>
<p>1366<br>00:56:18,180 –&gt; 00:56:20,059<br>the Google one Paxos Made Live,</p>
<p>1367<br>00:56:20,059 –&gt; 00:56:21,860<br>that’s the one that like, for me, clicked,</p>
<p>1368<br>00:56:21,860 –&gt; 00:56:23,860<br>and I was like, okay, now I understand what they’re doing.</p>
<p>1369<br>00:56:23,860 –&gt; 00:56:25,820<br>But then once you know that it’s actually just</p>
<p>1370<br>00:56:25,820 –&gt; 00:56:28,100<br>a degenerative case of two-faced commit,</p>
<p>1371<br>00:56:28,100 –&gt; 00:56:29,460<br>these for me coming from the database world,</p>
<p>1372<br>00:56:29,460 –&gt; 00:56:30,860<br>then it makes sense.</p>
<p>1373<br>00:56:30,860 –&gt; 00:56:34,900<br>So there’s this paper here, this is 2003 or 2005,</p>
<p>1374<br>00:56:34,900 –&gt; 00:56:37,300<br>2006 from Jim Gray, and Leslie Lamport,</p>
<p>1375<br>00:56:37,300 –&gt; 00:56:39,620<br>this is right before Jim Gray got lost at C,</p>
<p>1376<br>00:56:39,619 –&gt; 00:56:41,980<br>where they basically show, they prove that two-faced commit</p>
<p>1377<br>00:56:41,980 –&gt; 00:56:44,819<br>is a subset of Paxos.</p>
<p>1378<br>00:56:45,980 –&gt; 00:56:48,460<br>Right, so again, and Raff is gonna be basically</p>
<p>1379<br>00:56:48,460 –&gt; 00:56:52,139<br>the same idea here, it’s just gonna have fewer node types.</p>
<p>1380<br>00:56:52,139 –&gt; 00:56:53,259<br>And actually, I’m not even gonna show,</p>
<p>1381<br>00:56:53,259 –&gt; 00:56:55,739<br>there’s another node type in Paxos called Learners.</p>
<p>1382<br>00:56:55,739 –&gt; 00:56:58,059<br>We can ignore that, nobody does that.</p>
<p>1383<br>00:56:59,299 –&gt; 00:57:03,019<br>Or the nodes have multiple roles, it doesn’t matter.</p>
<p>1384<br>00:57:03,019 –&gt; 00:57:05,339<br>But again, in Paxos, when they do a leader election,</p>
<p>1385<br>00:57:05,339 –&gt; 00:57:08,059<br>any node can be a leader, but in Raff,</p>
<p>1386<br>00:57:08,059 –&gt; 00:57:10,179<br>they choose the ones that have the most updates logs,</p>
<p>1387<br>00:57:10,179 –&gt; 00:57:12,340<br>that’s sort of the major distinction.</p>
<p>1388<br>00:57:12,340 –&gt; 00:57:13,380<br>So going back to our example here,</p>
<p>1389<br>00:57:13,380 –&gt; 00:57:16,619<br>now we have three nodes, our transaction goes ahead and commit.</p>
<p>1390<br>00:57:17,820 –&gt; 00:57:19,779<br>The Paxos instead of calling them coordinators</p>
<p>1391<br>00:57:19,779 –&gt; 00:57:22,820<br>and participants, they can all propose her and accept her.</p>
<p>1392<br>00:57:22,820 –&gt; 00:57:25,619<br>Again, there’s a Learners, we can ignore that.</p>
<p>1393<br>00:57:26,539 –&gt; 00:57:29,299<br>We send out proposed that we wanna commit this transaction,</p>
<p>1394<br>00:57:29,299 –&gt; 00:57:31,699<br>say there’s one node three here, goes down,</p>
<p>1395<br>00:57:31,699 –&gt; 00:57:33,420<br>for whatever reason, it doesn’t matter.</p>
<p>1396<br>00:57:33,420 –&gt; 00:57:36,739<br>And then we get back the agreements from the other two nodes,</p>
<p>1397<br>00:57:36,739 –&gt; 00:57:39,739<br>and since we got two out of three of the nodes agreed</p>
<p>1398<br>00:57:39,739 –&gt; 00:57:41,379<br>that we can commit this transaction,</p>
<p>1399<br>00:57:41,379 –&gt; 00:57:44,739<br>this transaction is allowed, well, we do the commit phase,</p>
<p>1400<br>00:57:44,739 –&gt; 00:57:47,699<br>and then the transaction is allowed to commit.</p>
<p>1401<br>00:57:47,699 –&gt; 00:57:49,979<br>And eventually, when node three comes back up,</p>
<p>1402<br>00:57:49,979 –&gt; 00:57:54,099<br>it can learn about the changes that it missed.</p>
<p>1403<br>00:57:59,259 –&gt; 00:58:01,339<br>So another way to look at it is often</p>
<p>1404<br>00:58:01,339 –&gt; 00:58:05,179<br>this sort of timeline graph here, where you have a poser,</p>
<p>1405<br>00:58:05,179 –&gt; 00:58:09,299<br>says I wanna commit transaction, you have a timestamp n, right?</p>
<p>1406<br>00:58:09,299 –&gt; 00:58:11,500<br>Again, think of the log as just an order list,</p>
<p>1407<br>00:58:11,500 –&gt; 00:58:12,619<br>but here’s the transaction that I wanna commit.</p>
<p>1408<br>00:58:12,619 –&gt; 00:58:15,579<br>So the first guy who says, I wanna commit transaction n.</p>
<p>1409<br>00:58:16,579 –&gt; 00:58:19,179<br>So all the acceptors get that, they agree to do it.</p>
<p>1410<br>00:58:19,179 –&gt; 00:58:20,899<br>But during this time, another proposer comes along,</p>
<p>1411<br>00:58:20,899 –&gt; 00:58:23,619<br>says I wanna, I propose commit transaction n plus one.</p>
<p>1412<br>00:58:23,619 –&gt; 00:58:26,980<br>And then soon the acceptors see a new timestamp value</p>
<p>1413<br>00:58:26,980 –&gt; 00:58:29,980<br>that’s greater than anyone has seen the pass.</p>
<p>1414<br>00:58:29,980 –&gt; 00:58:33,059<br>Anything that comes after that is automatically rejected.</p>
<p>1415<br>00:58:33,059 –&gt; 00:58:34,940<br>So the log is always sort of moving forward.</p>
<p>1416<br>00:58:34,940 –&gt; 00:58:36,460<br>You never move backwards.</p>
<p>1417<br>00:58:36,460 –&gt; 00:58:39,380<br>So now when this other guy says I wanna go ahead and commit,</p>
<p>1418<br>00:58:39,380 –&gt; 00:58:43,500<br>and assuming we’re not doing the early acknowledgement optimization,</p>
<p>1419<br>00:58:43,500 –&gt; 00:58:47,780<br>go ahead and commit because these acceptors already saw n,</p>
<p>1420<br>00:58:47,780 –&gt; 00:58:49,780<br>they rejected and say, I can’t take n,</p>
<p>1421<br>00:58:49,780 –&gt; 00:58:51,579<br>because I’ve seen n plus one.</p>
<p>1422<br>00:58:51,579 –&gt; 00:58:54,220<br>So now they can go ahead and agree to commit n plus one,</p>
<p>1423<br>00:58:55,340 –&gt; 00:58:57,300<br>commit that, and then this other guy here,</p>
<p>1424<br>00:58:57,300 –&gt; 00:59:02,460<br>he can re-submit his request to commit that transaction.</p>
<p>1425<br>00:59:03,460 –&gt; 00:59:06,659<br>So in this world, we have multiple proposers</p>
<p>1426<br>00:59:06,659 –&gt; 00:59:08,699<br>proposing commit transactions.</p>
<p>1427<br>00:59:08,699 –&gt; 00:59:11,260<br>And obviously that’s gonna be problematic</p>
<p>1428<br>00:59:11,260 –&gt; 00:59:13,579<br>because you’re gonna have this contention</p>
<p>1429<br>00:59:13,579 –&gt; 00:59:15,740<br>of everyone trying to clover each other.</p>
<p>1430<br>00:59:17,019 –&gt; 00:59:17,860<br>Yes.</p>
<p>1431<br>00:59:17,860 –&gt; 00:59:19,139<br>This example looks like,</p>
<p>1432<br>00:59:19,139 –&gt; 00:59:20,900<br>would 2PC actually be the same?</p>
<p>1433<br>00:59:20,900 –&gt; 00:59:22,139<br>Because it looks like,</p>
<p>1434<br>00:59:23,099 –&gt; 00:59:24,980<br>like you said that this is a majority,</p>
<p>1435<br>00:59:24,980 –&gt; 00:59:25,820<br>it makes it be right,</p>
<p>1436<br>00:59:25,820 –&gt; 00:59:28,500<br>but it looks like here they’re all responding at the same time</p>
<p>1437<br>00:59:28,500 –&gt; 00:59:30,059<br>and they’re working for the same.</p>
<p>1438<br>00:59:30,059 –&gt; 00:59:31,659<br>So the statement is,</p>
<p>1439<br>00:59:31,659 –&gt; 00:59:33,500<br>would 2PC have the same problem</p>
<p>1440<br>00:59:34,900 –&gt; 00:59:36,340<br>if you have multiple coordinators?</p>
<p>1441<br>00:59:36,340 –&gt; 00:59:37,179<br>Yes.</p>
<p>1442<br>00:59:38,460 –&gt; 00:59:43,460<br>So again, the way we’re gonna handle this is through leases,</p>
<p>1443<br>00:59:44,259 –&gt; 00:59:45,420<br>to limit the number of,</p>
<p>1444<br>00:59:45,420 –&gt; 00:59:49,500<br>or limit which node can propose commit transactions.</p>
<p>1445<br>00:59:49,500 –&gt; 00:59:52,259<br>Basically, how do I know which one’s gonna be</p>
<p>1446<br>00:59:52,259 –&gt; 00:59:56,619<br>the primary, which one’s gonna be the coordinator</p>
<p>1447<br>00:59:56,619 –&gt; 00:59:59,259<br>or the proposer for a distributed database system?</p>
<p>1448<br>01:00:00,139 –&gt; 01:00:02,980<br>So this came from a Google paper called multi-paxos.</p>
<p>1449<br>01:00:03,980 –&gt; 01:00:06,539<br>The idea here is that you run leader election</p>
<p>1450<br>01:00:06,539 –&gt; 01:00:08,059<br>every so often to say, okay,</p>
<p>1451<br>01:00:08,059 –&gt; 01:00:10,820<br>this node here is anointed as the proposer.</p>
<p>1452<br>01:00:10,820 –&gt; 01:00:13,779<br>And then in some cases now you can skip the proposed phase</p>
<p>1453<br>01:00:13,779 –&gt; 01:00:15,940<br>because now the coordinator or the proposer can say,</p>
<p>1454<br>01:00:15,940 –&gt; 01:00:17,299<br>here’s the transaction I wanna go out to commit,</p>
<p>1455<br>01:00:17,299 –&gt; 01:00:20,460<br>everyone agree that we’re all gonna commit this.</p>
<p>1456<br>01:00:20,460 –&gt; 01:00:22,219<br>And then if at any time there’s a failure,</p>
<p>1457<br>01:00:22,219 –&gt; 01:00:25,659<br>either like the leader goes down or some node goes down,</p>
<p>1458<br>01:00:25,659 –&gt; 01:00:27,779<br>then you just run the leader election all over again.</p>
<p>1459<br>01:00:27,780 –&gt; 01:00:30,100<br>Which is gen, just running Paxos.</p>
<p>1460<br>01:00:30,100 –&gt; 01:00:32,300<br>Again, think of the state machine is,</p>
<p>1461<br>01:00:32,300 –&gt; 01:00:34,460<br>here’s the order in which transactions commit.</p>
<p>1462<br>01:00:34,460 –&gt; 01:00:35,420<br>And as part of that state machine,</p>
<p>1463<br>01:00:35,420 –&gt; 01:00:39,140<br>here’s the, which node is the proposer for the coordinator.</p>
<p>1464<br>01:00:40,500 –&gt; 01:00:41,740<br>Right?</p>
<p>1465<br>01:00:41,740 –&gt; 01:00:45,540<br>So you would send heartbeats out between the different nodes</p>
<p>1466<br>01:00:45,540 –&gt; 01:00:46,860<br>to figure out who’s actually alive</p>
<p>1467<br>01:00:46,860 –&gt; 01:00:48,820<br>and responding to requests.</p>
<p>1468<br>01:00:48,820 –&gt; 01:00:50,220<br>And if you don’t get a heartbeat when it’s certain</p>
<p>1469<br>01:00:50,220 –&gt; 01:00:53,100<br>out of time, then you say, okay, this node is down</p>
<p>1470<br>01:00:53,100 –&gt; 01:00:55,300<br>and run, rerun leader election, right?</p>
<p>1471<br>01:00:56,300 –&gt; 01:00:58,580<br>And then you set the least time out to be like,</p>
<p>1472<br>01:00:58,580 –&gt; 01:01:00,700<br>okay, every 10 minutes or so,</p>
<p>1473<br>01:01:00,700 –&gt; 01:01:04,260<br>then I automatically run leader election all over again.</p>
<p>1474<br>01:01:04,260 –&gt; 01:01:06,380<br>And maybe the case, I’d re-elect the same leader,</p>
<p>1475<br>01:01:06,380 –&gt; 01:01:09,620<br>which is ideal, but at least you’re running that</p>
<p>1476<br>01:01:09,620 –&gt; 01:01:11,260<br>election over and over again.</p>
<p>1477<br>01:01:11,260 –&gt; 01:01:12,980<br>And different systems are gonna run that leader election</p>
<p>1478<br>01:01:12,980 –&gt; 01:01:14,420<br>at different time intervals.</p>
<p>1479<br>01:01:14,420 –&gt; 01:01:16,420<br>Spanner runs at every 10 seconds,</p>
<p>1480<br>01:01:16,420 –&gt; 01:01:18,500<br>you go by it is every like 30 seconds,</p>
<p>1481<br>01:01:18,500 –&gt; 01:01:22,340<br>and I think cockroach in the source code is like every five minutes.</p>
<p>1482<br>01:01:22,340 –&gt; 01:01:25,019<br>And it depends on how reactive you wanna be</p>
<p>1483<br>01:01:25,860 –&gt; 01:01:27,099<br>to the failures.</p>
<p>1484<br>01:01:30,300 –&gt; 01:01:31,699<br>You go by it is two seconds,</p>
<p>1485<br>01:01:31,699 –&gt; 01:01:33,659<br>you go by it is less than Spanner, it’s two seconds.</p>
<p>1486<br>01:01:36,059 –&gt; 01:01:37,820<br>But again, generally this technique</p>
<p>1487<br>01:01:37,820 –&gt; 01:01:41,019<br>is falls on the umbrella called multi-packsis.</p>
<p>1488<br>01:01:41,019 –&gt; 01:01:42,980<br>So most people say they’re running packsis,</p>
<p>1489<br>01:01:42,980 –&gt; 01:01:45,619<br>they’re most often running multi-packsis.</p>
<p>1490<br>01:01:48,099 –&gt; 01:01:49,739<br>All right, again, I’ve already covered this already,</p>
<p>1491<br>01:01:49,739 –&gt; 01:01:52,619<br>but that the main idea is the main difference between</p>
<p>1492<br>01:01:52,619 –&gt; 01:01:54,259<br>two base commit packsis and raft,</p>
<p>1493<br>01:01:54,260 –&gt; 01:01:56,300<br>is there two base commit that if the coordinator fails</p>
<p>1494<br>01:01:56,300 –&gt; 01:01:58,220<br>or any node fails, we have the block until the coordinator</p>
<p>1495<br>01:01:58,220 –&gt; 01:02:01,180<br>comes back, in packsis, along with the majority of our</p>
<p>1496<br>01:02:01,180 –&gt; 01:02:04,980<br>participants are alive, and we waited long enough</p>
<p>1497<br>01:02:04,980 –&gt; 01:02:08,500<br>to make sure that there’s no further failures.</p>
<p>1498<br>01:02:08,500 –&gt; 01:02:10,500<br>They’ve been going ahead to commit, and raft, as I said,</p>
<p>1499<br>01:02:10,500 –&gt; 01:02:13,740<br>is basically the same thing, fewer node roles.</p>
<p>1500<br>01:02:13,740 –&gt; 01:02:15,940<br>And when you do a leader election,</p>
<p>1501<br>01:02:15,940 –&gt; 01:02:18,460<br>you choose the ones that have the most updated logs.</p>
<p>1502<br>01:02:18,460 –&gt; 01:02:19,300<br>Yes.</p>
<p>1503<br>01:02:20,500 –&gt; 01:02:23,700<br>Packsis has proposers, acceptors,</p>
<p>1504<br>01:02:23,699 –&gt; 01:02:26,500<br>and then there’s learners, which are just</p>
<p>1505<br>01:02:26,500 –&gt; 01:02:28,219<br>down stream from the acceptors to say,</p>
<p>1506<br>01:02:28,219 –&gt; 01:02:31,179<br>hey, here’s the changes, here’s what we just committed.</p>
<p>1507<br>01:02:31,179 –&gt; 01:02:32,019<br>We can ignore that.</p>
<p>1508<br>01:02:35,739 –&gt; 01:02:36,259<br>Okay.</p>
<p>1509<br>01:02:37,259 –&gt; 01:02:40,179<br>So most of the modern, just you get a data systems,</p>
<p>1510<br>01:02:40,179 –&gt; 01:02:42,259<br>they’re gonna be running packsis or rafts.</p>
<p>1511<br>01:02:42,259 –&gt; 01:02:44,859<br>Rapt is probably way more common than packsis,</p>
<p>1512<br>01:02:44,859 –&gt; 01:02:47,939<br>just because when it came out in 2013,</p>
<p>1513<br>01:02:47,939 –&gt; 01:02:49,379<br>a bunch of people took the protocol</p>
<p>1514<br>01:02:49,379 –&gt; 01:02:51,579<br>and they re-implemented it in different languages.</p>
<p>1515<br>01:02:51,579 –&gt; 01:02:53,860<br>So for a long time, there wasn’t a lib pack so,</p>
<p>1516<br>01:02:53,860 –&gt; 01:02:54,699<br>so you could download and just like,</p>
<p>1517<br>01:02:54,699 –&gt; 01:02:56,779<br>oh, let me put this in my distributed areas.</p>
<p>1518<br>01:02:56,779 –&gt; 01:03:01,059<br>But in raft, there was a bunch of correct implementations</p>
<p>1519<br>01:03:01,059 –&gt; 01:03:03,179<br>in rust or rust wasn’t around.</p>
<p>1520<br>01:03:03,179 –&gt; 01:03:05,900<br>In go, in Python, in C++,</p>
<p>1521<br>01:03:05,900 –&gt; 01:03:07,619<br>there were a bunch of libraries that you could just</p>
<p>1522<br>01:03:07,619 –&gt; 01:03:10,179<br>plop in and get raft, because sense of saturday.</p>
<p>1523<br>01:03:10,179 –&gt; 01:03:13,219<br>So I think that helped evangelize a bit more.</p>
<p>1524<br>01:03:13,219 –&gt; 01:03:14,059<br>Yes.</p>
<p>1525<br>01:03:14,059 –&gt; 01:03:16,219<br>What’s the difference between multi-packsis and rafts?</p>
<p>1526<br>01:03:16,219 –&gt; 01:03:17,699<br>It’s questions, what’s the difference between multi-packsis</p>
<p>1527<br>01:03:17,699 –&gt; 01:03:18,539<br>and rafts?</p>
<p>1528<br>01:03:18,539 –&gt; 01:03:19,539<br>Same thing.</p>
<p>1529<br>01:03:19,539 –&gt; 01:03:20,779<br>You run leader election.</p>
<p>1530<br>01:03:21,900 –&gt; 01:03:24,900<br>What do you think about multi-packsis?</p>
<p>1531<br>01:03:24,900 –&gt; 01:03:27,980<br>Multi-packsis, like, 2004 or five-ish?</p>
<p>1532<br>01:03:27,980 –&gt; 01:03:31,019<br>What do you think about multi-packsis?</p>
<p>1533<br>01:03:31,019 –&gt; 01:03:35,539<br>I mean, the question is, what did rafts invent?</p>
<p>1534<br>01:03:35,539 –&gt; 01:03:38,860<br>Oh, so again, they don’t have…</p>
<p>1535<br>01:03:38,860 –&gt; 01:03:42,500<br>Rap is meant to be a more understandable version of packsis,</p>
<p>1536<br>01:03:42,500 –&gt; 01:03:43,099<br>right?</p>
<p>1537<br>01:03:43,099 –&gt; 01:03:45,299<br>At a high level, they’re the same, right?</p>
<p>1538<br>01:03:45,299 –&gt; 01:03:47,739<br>But in terms of implementation,</p>
<p>1539<br>01:03:47,739 –&gt; 01:03:49,980<br>you don’t have to have these learners,</p>
<p>1540<br>01:03:50,260 –&gt; 01:03:52,940<br>either participants or proposers.</p>
<p>1541<br>01:03:52,940 –&gt; 01:03:54,860<br>So there’s only two no types.</p>
<p>1542<br>01:03:54,860 –&gt; 01:04:00,340<br>When you do a leader election, then you choose the one</p>
<p>1543<br>01:04:00,340 –&gt; 01:04:02,460<br>that has the most up-to-date log versus packsis.</p>
<p>1544<br>01:04:02,460 –&gt; 01:04:04,940<br>Anybody can be the leader.</p>
<p>1545<br>01:04:04,940 –&gt; 01:04:07,059<br>And I think packsis had, or sorry, in raft,</p>
<p>1546<br>01:04:07,059 –&gt; 01:04:09,300<br>there’s explicit like timeouts for our beats</p>
<p>1547<br>01:04:09,300 –&gt; 01:04:11,019<br>and things like that, where in packsis, people add them,</p>
<p>1548<br>01:04:11,019 –&gt; 01:04:11,980<br>but I don’t think the original protocol</p>
<p>1549<br>01:04:11,980 –&gt; 01:04:13,340<br>talks about those things.</p>
<p>1550<br>01:04:14,340 –&gt; 01:04:15,179<br>Yes.</p>
<p>1551<br>01:04:15,179 –&gt; 01:04:16,860<br>So I’m going to look at these on multi-packsis,</p>
<p>1552<br>01:04:16,860 –&gt; 01:04:17,780<br>which is packsis.</p>
<p>1553<br>01:04:17,780 –&gt; 01:04:19,940<br>Is the main difference that multi-packsis will carry</p>
<p>1554<br>01:04:19,940 –&gt; 01:04:21,980<br>out of any shuffle with a leader?</p>
<p>1555<br>01:04:21,980 –&gt; 01:04:23,460<br>They’re the main difference in multi-packsis.</p>
<p>1556<br>01:04:23,460 –&gt; 01:04:25,100<br>Yeah.</p>
<p>1557<br>01:04:25,100 –&gt; 01:04:30,700<br>Yes, but in packsis, anybody can be reposed,</p>
<p>1558<br>01:04:30,700 –&gt; 01:04:32,500<br>anybody can be a leader.</p>
<p>1559<br>01:04:32,500 –&gt; 01:04:34,140<br>To propose changes, to updates.</p>
<p>1560<br>01:04:34,140 –&gt; 01:04:34,980<br>Oh, I see.</p>
<p>1561<br>01:04:34,980 –&gt; 01:04:35,980<br>Yeah.</p>
<p>1562<br>01:04:35,980 –&gt; 01:04:39,700<br>And so it’s the last one, and then all the changes get</p>
<p>1563<br>01:04:39,700 –&gt; 01:04:41,019<br>set there to be for a leader.</p>
<p>1564<br>01:04:41,019 –&gt; 01:04:41,820<br>Yes.</p>
<p>1565<br>01:04:41,820 –&gt; 01:04:43,180<br>Because otherwise, anybody’s proposing,</p>
<p>1566<br>01:04:43,180 –&gt; 01:04:45,860<br>and you just clobber each other,</p>
<p>1567<br>01:04:45,860 –&gt; 01:04:47,220<br>and so you have to do back-off, just like,</p>
<p>1568<br>01:04:47,219 –&gt; 01:04:52,139<br>OK, my transaction, I got overwritten, I couldn’t commit it.</p>
<p>1569<br>01:04:52,139 –&gt; 01:04:55,059<br>So maybe wait a certain amount of time, and commit another one.</p>
<p>1570<br>01:04:55,059 –&gt; 01:04:58,259<br>So instead of back and forth, they say, OK, you’re the leader.</p>
<p>1571<br>01:04:58,259 –&gt; 01:05:01,299<br>Everything goes to you, and you don’t</p>
<p>1572<br>01:05:01,299 –&gt; 01:05:02,819<br>worry about conflicting proposals coming in.</p>
<p>1573<br>01:05:05,819 –&gt; 01:05:06,819<br>Yes.</p>
<p>1574<br>01:05:06,819 –&gt; 01:05:08,139<br>So what do you think of the sub-proposar?</p>
<p>1575<br>01:05:08,139 –&gt; 01:05:10,819<br>And you technically have one proposal</p>
<p>1576<br>01:05:10,819 –&gt; 01:05:16,819<br>within some boundary in multi-packsis, yes.</p>
<p>1577<br>01:05:16,820 –&gt; 01:05:19,700<br>So whether that boundary is like a rack of machines</p>
<p>1578<br>01:05:19,700 –&gt; 01:05:22,780<br>or like a data center, depends on the representation.</p>
<p>1579<br>01:05:27,460 –&gt; 01:05:29,220<br>All right, let’s finish up.</p>
<p>1580<br>01:05:29,220 –&gt; 01:05:30,500<br>So cap there.</p>
<p>1581<br>01:05:30,500 –&gt; 01:05:33,300<br>This was the hot thing in distributed systems.</p>
<p>1582<br>01:05:33,300 –&gt; 01:05:35,700<br>The buzzword everyone used in the 2000s</p>
<p>1583<br>01:05:35,700 –&gt; 01:05:37,740<br>to describe the distributed data systems.</p>
<p>1584<br>01:05:37,740 –&gt; 01:05:44,140<br>And it was a way to characterize what the system could handle</p>
<p>1585<br>01:05:44,139 –&gt; 01:05:47,139<br>in the face of failures.</p>
<p>1586<br>01:05:47,139 –&gt; 01:05:50,379<br>So the cap theorem, the C, is consistent.</p>
<p>1587<br>01:05:50,379 –&gt; 01:05:52,779<br>So basically, the strong consistent,</p>
<p>1588<br>01:05:52,779 –&gt; 01:05:54,059<br>the A is always available.</p>
<p>1589<br>01:05:54,059 –&gt; 01:05:56,219<br>So if there’s a failure or a network partition,</p>
<p>1590<br>01:05:56,219 –&gt; 01:05:59,659<br>you can still run any possible query.</p>
<p>1591<br>01:05:59,659 –&gt; 01:06:01,659<br>And that’s sort of tied to the network partition</p>
<p>1592<br>01:06:01,659 –&gt; 01:06:02,379<br>tolerant.</p>
<p>1593<br>01:06:02,379 –&gt; 01:06:04,139<br>What happens when there’s a network partition</p>
<p>1594<br>01:06:04,139 –&gt; 01:06:06,420<br>can you handle updates in that environment?</p>
<p>1595<br>01:06:06,420 –&gt; 01:06:10,699<br>So it was proven to be correct the way to describe systems.</p>
<p>1596<br>01:06:10,699 –&gt; 01:06:13,819<br>The idea is you can pick two out of three.</p>
<p>1597<br>01:06:13,820 –&gt; 01:06:15,300<br>The way to think of a boyfriend and girlfriend,</p>
<p>1598<br>01:06:15,300 –&gt; 01:06:18,860<br>are they good looking, crazy, or smart, picked two out of three?</p>
<p>1599<br>01:06:18,860 –&gt; 01:06:21,420<br>Same thing for your chip at a database.</p>
<p>1600<br>01:06:21,420 –&gt; 01:06:23,019<br>And so this is proven to be correct.</p>
<p>1601<br>01:06:23,019 –&gt; 01:06:25,019<br>But a very important aspect of this</p>
<p>1602<br>01:06:25,019 –&gt; 01:06:28,180<br>is that the cap theorem describes what happens if there’s</p>
<p>1603<br>01:06:28,180 –&gt; 01:06:31,780<br>a failure, but most of the time there is an failure.</p>
<p>1604<br>01:06:31,780 –&gt; 01:06:33,980<br>So what happens when you’re running no operations?</p>
<p>1605<br>01:06:33,980 –&gt; 01:06:38,700<br>So it got extended by Dan Abadi, who did a lot of the early</p>
<p>1606<br>01:06:38,700 –&gt; 01:06:43,019<br>column store stuff in MIT and just now professor at Maryland.</p>
<p>1607<br>01:06:43,699 –&gt; 01:06:45,780<br>The first part is the cap theorem.</p>
<p>1608<br>01:06:45,780 –&gt; 01:06:47,820<br>Partition tolerant always available consistent.</p>
<p>1609<br>01:06:47,820 –&gt; 01:06:49,300<br>But then during no more operations,</p>
<p>1610<br>01:06:49,300 –&gt; 01:06:52,300<br>you have this trade-off between your latency tolerance</p>
<p>1611<br>01:06:52,300 –&gt; 01:06:55,019<br>and your consistency tolerance.</p>
<p>1612<br>01:06:55,019 –&gt; 01:06:57,139<br>And we’ll see what that looks like in a second.</p>
<p>1613<br>01:07:00,380 –&gt; 01:07:02,739<br>So let’s go through some examples.</p>
<p>1614<br>01:07:02,739 –&gt; 01:07:06,860<br>So with consistency, the idea is that if I do a commit</p>
<p>1615<br>01:07:06,860 –&gt; 01:07:09,699<br>or a change to a copy of an object in my database,</p>
<p>1616<br>01:07:09,699 –&gt; 01:07:13,219<br>and there’s replicas, when do I tell the outside world</p>
<p>1617<br>01:07:13,219 –&gt; 01:07:15,659<br>that my change has been propagated?</p>
<p>1618<br>01:07:15,659 –&gt; 01:07:19,619<br>And can anybody see an intermediate state?</p>
<p>1619<br>01:07:19,619 –&gt; 01:07:20,779<br>So we talked about this before, between</p>
<p>1620<br>01:07:20,779 –&gt; 01:07:22,939<br>venture-criticism, trunk consistency, same idea.</p>
<p>1621<br>01:07:22,939 –&gt; 01:07:25,619<br>So if I do an update to A here, this is the primary,</p>
<p>1622<br>01:07:25,619 –&gt; 01:07:28,779<br>this is the replica, I make the change to the primary,</p>
<p>1623<br>01:07:28,779 –&gt; 01:07:30,819<br>I then propagate the update to the replica</p>
<p>1624<br>01:07:30,819 –&gt; 01:07:32,859<br>or if it’s active-active, they both run at the same time.</p>
<p>1625<br>01:07:32,859 –&gt; 01:07:34,179<br>It doesn’t matter.</p>
<p>1626<br>01:07:34,179 –&gt; 01:07:36,059<br>And then once I get the acknowledgement</p>
<p>1627<br>01:07:36,059 –&gt; 01:07:39,259<br>from the replica that the change is durable and safe,</p>
<p>1628<br>01:07:39,260 –&gt; 01:07:40,500<br>then I can tell the outside world</p>
<p>1629<br>01:07:40,500 –&gt; 01:07:41,940<br>my transaction has committed.</p>
<p>1630<br>01:07:41,940 –&gt; 01:07:44,300<br>So now if any other application comes along</p>
<p>1631<br>01:07:44,300 –&gt; 01:07:46,260<br>and does a read on A, they’re guaranteed</p>
<p>1632<br>01:07:46,260 –&gt; 01:07:48,740<br>to see the update from the committed transaction.</p>
<p>1633<br>01:07:51,500 –&gt; 01:07:55,460<br>So for single objects, this is doable.</p>
<p>1634<br>01:07:55,460 –&gt; 01:07:57,820<br>Really, it starts to matter when you have multiple objects.</p>
<p>1635<br>01:07:57,820 –&gt; 01:08:00,660<br>If I update A and B at the same time,</p>
<p>1636<br>01:08:00,660 –&gt; 01:08:02,860<br>can I guarantee that I’ll see a consistent view</p>
<p>1637<br>01:08:02,860 –&gt; 01:08:03,700<br>of the database?</p>
<p>1638<br>01:08:06,700 –&gt; 01:08:08,540<br>Availability determines what happens</p>
<p>1639<br>01:08:08,619 –&gt; 01:08:11,460<br>if there’s a failure to the overall system.</p>
<p>1640<br>01:08:11,460 –&gt; 01:08:14,380<br>So say this node goes down here for whatever reason.</p>
<p>1641<br>01:08:14,380 –&gt; 01:08:17,819<br>So my application server here, they can read the copy</p>
<p>1642<br>01:08:17,819 –&gt; 01:08:19,460<br>of the primary that’s just fine.</p>
<p>1643<br>01:08:19,460 –&gt; 01:08:23,019<br>But what happens with this application server over there?</p>
<p>1644<br>01:08:23,019 –&gt; 01:08:26,340<br>Well, assuming they can connect to this other replica,</p>
<p>1645<br>01:08:26,340 –&gt; 01:08:28,579<br>then they can still access this content</p>
<p>1646<br>01:08:28,579 –&gt; 01:08:30,260<br>and read the database over there.</p>
<p>1647<br>01:08:30,260 –&gt; 01:08:33,779<br>Like, assuming the network has a min7.</p>
<p>1648<br>01:08:34,779 –&gt; 01:08:38,300<br>And no matter how many nodes go down.</p>
<p>1649<br>01:08:40,939 –&gt; 01:08:44,739<br>Partition tolerance says, if the network gets severed</p>
<p>1650<br>01:08:44,739 –&gt; 01:08:48,059<br>and now these two nodes can’t talk to each other.</p>
<p>1651<br>01:08:48,059 –&gt; 01:08:50,659<br>So what’s going to happen here on their paxes?</p>
<p>1652<br>01:08:52,619 –&gt; 01:08:54,659<br>This guy is the primary, right?</p>
<p>1653<br>01:08:54,659 –&gt; 01:08:56,340<br>He’s holding lease on that.</p>
<p>1654<br>01:08:56,340 –&gt; 01:08:58,539<br>And now that there’s a, there’s a,</p>
<p>1655<br>01:08:58,539 –&gt; 01:09:00,099<br>the network gets severed.</p>
<p>1656<br>01:09:00,099 –&gt; 01:09:02,099<br>So the replica can’t call it this guy.</p>
<p>1657<br>01:09:02,100 –&gt; 01:09:03,940<br>So he says, oh, well, this guy’s down.</p>
<p>1658<br>01:09:03,940 –&gt; 01:09:05,060<br>So let me run a leader election.</p>
<p>1659<br>01:09:05,060 –&gt; 01:09:06,579<br>Up, look at that.</p>
<p>1660<br>01:09:06,579 –&gt; 01:09:08,660<br>I’m not a leader, right?</p>
<p>1661<br>01:09:08,660 –&gt; 01:09:10,380<br>So it becomes the primary.</p>
<p>1662<br>01:09:10,380 –&gt; 01:09:11,420<br>What’s the problem here?</p>
<p>1663<br>01:09:12,539 –&gt; 01:09:16,180<br>So now the first application send updates to A.</p>
<p>1664<br>01:09:17,220 –&gt; 01:09:19,780<br>Both of them think they’re the primary.</p>
<p>1665<br>01:09:19,780 –&gt; 01:09:20,900<br>And they said, okay, yeah, great.</p>
<p>1666<br>01:09:20,900 –&gt; 01:09:22,180<br>We’ll go ahead and commit your changes.</p>
<p>1667<br>01:09:22,180 –&gt; 01:09:23,780<br>That’s fine, all right?</p>
<p>1668<br>01:09:23,780 –&gt; 01:09:25,180<br>And they get, you get back acknowledged</p>
<p>1669<br>01:09:25,180 –&gt; 01:09:27,140<br>that those changes got persisted.</p>
<p>1670<br>01:09:27,140 –&gt; 01:09:29,460<br>But then now the network comes back up</p>
<p>1671<br>01:09:29,460 –&gt; 01:09:31,260<br>and now there’s a problem.</p>
<p>1672<br>01:09:31,260 –&gt; 01:09:32,820<br>Where they both think they’re the primary</p>
<p>1673<br>01:09:32,820 –&gt; 01:09:34,460<br>and they both think they have the latest version</p>
<p>1674<br>01:09:34,460 –&gt; 01:09:38,579<br>of the object, but who’s correct?</p>
<p>1675<br>01:09:40,659 –&gt; 01:09:43,699<br>So this is called split brain, right?</p>
<p>1676<br>01:09:43,699 –&gt; 01:09:48,659<br>And in most systems, when you have this problem,</p>
<p>1677<br>01:09:48,659 –&gt; 01:09:50,100<br>like this goes back to the key safety thing.</p>
<p>1678<br>01:09:50,100 –&gt; 01:09:54,940<br>Once I don’t have enough copies of my data,</p>
<p>1679<br>01:09:54,940 –&gt; 01:09:56,619<br>I’m gonna stop the system.</p>
<p>1680<br>01:09:58,860 –&gt; 01:10:01,020<br>A small number of no-seical systems back in the day</p>
<p>1681<br>01:10:01,020 –&gt; 01:10:03,300<br>used were to call vector clocks,</p>
<p>1682<br>01:10:03,300 –&gt; 01:10:05,540<br>and then it by Leslie Lamport was basically,</p>
<p>1683<br>01:10:05,540 –&gt; 01:10:06,620<br>it’s almost like multi-version.</p>
<p>1684<br>01:10:06,620 –&gt; 01:10:08,380<br>And you’re keeping track of the different versions</p>
<p>1685<br>01:10:08,380 –&gt; 01:10:10,420<br>of the object over time.</p>
<p>1686<br>01:10:10,420 –&gt; 01:10:13,980<br>So now when the network gets connected up again,</p>
<p>1687<br>01:10:13,980 –&gt; 01:10:15,900<br>you said, okay, well, you have these changes</p>
<p>1688<br>01:10:15,900 –&gt; 01:10:16,900<br>and I have these changes this time</p>
<p>1689<br>01:10:16,900 –&gt; 01:10:19,780<br>and you merge the two vector clocks together.</p>
<p>1690<br>01:10:19,780 –&gt; 01:10:21,540<br>But then now you several bunch of different copies</p>
<p>1691<br>01:10:21,540 –&gt; 01:10:24,540<br>of different versions in your database for these objects.</p>
<p>1692<br>01:10:24,540 –&gt; 01:10:25,780<br>So now in your application code,</p>
<p>1693<br>01:10:25,780 –&gt; 01:10:27,980<br>you have to write stuff to go reason about</p>
<p>1694<br>01:10:27,980 –&gt; 01:10:29,660<br>what is actually the correct version.</p>
<p>1695<br>01:10:30,659 –&gt; 01:10:31,979<br>So like you as the application,</p>
<p>1696<br>01:10:31,979 –&gt; 01:10:33,139<br>but we have to write a bunch of sh** here</p>
<p>1697<br>01:10:33,139 –&gt; 01:10:35,619<br>that people always get wrong.</p>
<p>1698<br>01:10:35,619 –&gt; 01:10:37,420<br>It’s super hard, right?</p>
<p>1699<br>01:10:38,420 –&gt; 01:10:40,420<br>So in the no-seical world,</p>
<p>1700<br>01:10:40,420 –&gt; 01:10:44,699<br>they would, in some cases, they would actually still allow</p>
<p>1701<br>01:10:44,699 –&gt; 01:10:48,420<br>this to happen, but then when the network gets,</p>
<p>1702<br>01:10:48,420 –&gt; 01:10:49,819<br>connect it back up again,</p>
<p>1703<br>01:10:49,819 –&gt; 01:10:52,420<br>they’ll just pick what everyone has the latest timestamp</p>
<p>1704<br>01:10:52,420 –&gt; 01:10:54,699<br>and say that’s the latest version.</p>
<p>1705<br>01:10:54,699 –&gt; 01:10:56,539<br>And whether or not that’s the right or wrong,</p>
<p>1706<br>01:10:56,539 –&gt; 01:10:58,300<br>depends on whether the application cares or not.</p>
<p>1707<br>01:10:58,300 –&gt; 01:11:00,420<br>Oh, someone will notice.</p>
<p>1708<br>01:11:00,420 –&gt; 01:11:01,260<br>Yes.</p>
<p>1709<br>01:11:01,260 –&gt; 01:11:02,579<br>Why would that be wrong?</p>
<p>1710<br>01:11:02,579 –&gt; 01:11:04,619<br>So I should, why would that be wrong?</p>
<p>1711<br>01:11:04,619 –&gt; 01:11:06,779<br>My bank account has $100.</p>
<p>1712<br>01:11:06,779 –&gt; 01:11:08,539<br>This guy pulls out $100.</p>
<p>1713<br>01:11:08,539 –&gt; 01:11:10,140<br>This guy pulls out $100.</p>
<p>1714<br>01:11:10,140 –&gt; 01:11:13,020<br>I now come back and now I have negative $100.</p>
<p>1715<br>01:11:13,020 –&gt; 01:11:13,900<br>That’s definitely wrong.</p>
<p>1716<br>01:11:18,699 –&gt; 01:11:20,180<br>But I already give it out,</p>
<p>1717<br>01:11:20,180 –&gt; 01:11:22,180<br>but you give out $100 twice.</p>
<p>1718<br>01:11:23,619 –&gt; 01:11:24,460<br>All right.</p>
<p>1719<br>01:11:25,539 –&gt; 01:11:26,460<br>You’re happy.</p>
<p>1720<br>01:11:26,460 –&gt; 01:11:27,619<br>Bank’s not happy.</p>
<p>1721<br>01:11:27,779 –&gt; 01:11:28,460<br>All right.</p>
<p>1722<br>01:11:30,739 –&gt; 01:11:31,739<br>Or think about it.</p>
<p>1723<br>01:11:31,739 –&gt; 01:11:33,140<br>It’s the, it’s the,</p>
<p>1724<br>01:11:33,140 –&gt; 01:11:34,939<br>whether the, the, the,</p>
<p>1725<br>01:11:35,939 –&gt; 01:11:37,779<br>the tuition payment, they take it out twice.</p>
<p>1726<br>01:11:37,779 –&gt; 01:11:39,579<br>You definitely would care, all right.</p>
<p>1727<br>01:11:43,180 –&gt; 01:11:45,180<br>All right. So in, again, in the cap there,</p>
<p>1728<br>01:11:45,180 –&gt; 01:11:46,819<br>you kind of, going back here quickly,</p>
<p>1729<br>01:11:46,819 –&gt; 01:11:48,220<br>you can kind of see why like,</p>
<p>1730<br>01:11:48,220 –&gt; 01:11:51,140<br>you can’t get all three of those properties, right?</p>
<p>1731<br>01:11:52,140 –&gt; 01:11:55,739<br>I can’t do, I can’t guarantee consistency</p>
<p>1732<br>01:11:55,739 –&gt; 01:11:57,579<br>if I’m gonna start doing things like,</p>
<p>1733<br>01:11:57,579 –&gt; 01:11:59,460<br>allowing both sides to get updated.</p>
<p>1734<br>01:11:59,460 –&gt; 01:12:02,539<br>Because that’s not a consistent view of the database, right?</p>
<p>1735<br>01:12:02,539 –&gt; 01:12:05,819<br>And so what typical happen is like, say,</p>
<p>1736<br>01:12:05,819 –&gt; 01:12:08,699<br>you know, say even odd number of, of, of, of, of,</p>
<p>1737<br>01:12:08,699 –&gt; 01:12:10,539<br>replicas, I have three.</p>
<p>1738<br>01:12:10,539 –&gt; 01:12:12,300<br>So in this case here, maybe two is over here,</p>
<p>1739<br>01:12:12,300 –&gt; 01:12:13,420<br>and one’s over here.</p>
<p>1740<br>01:12:13,420 –&gt; 01:12:15,340<br>It knew that there was three before,</p>
<p>1741<br>01:12:15,340 –&gt; 01:12:17,420<br>but it says now I don’t, I can’t get a majority at it,</p>
<p>1742<br>01:12:17,420 –&gt; 01:12:18,539<br>you know, two out of three.</p>
<p>1743<br>01:12:18,539 –&gt; 01:12:21,100<br>So this guy then just says, okay, I’m not available.</p>
<p>1744<br>01:12:21,100 –&gt; 01:12:22,140<br>And then this guy, you know,</p>
<p>1745<br>01:12:22,140 –&gt; 01:12:23,859<br>could run the election just fine.</p>
<p>1746<br>01:12:23,859 –&gt; 01:12:28,859<br>Right, so, okay, this is all what happens when there’s a failure.</p>
<p>1747<br>01:12:30,500 –&gt; 01:12:32,779<br>But again, on our normal operations,</p>
<p>1748<br>01:12:33,859 –&gt; 01:12:35,979<br>even if we have these different properties</p>
<p>1749<br>01:12:35,979 –&gt; 01:12:38,539<br>under the cap theorem, there’s this trade-off</p>
<p>1750<br>01:12:38,539 –&gt; 01:12:42,579<br>between how long we wanna wait for changes to get propagated</p>
<p>1751<br>01:12:42,579 –&gt; 01:12:47,299<br>and acknowledge from our replicas versus guaranteeing</p>
<p>1752<br>01:12:47,299 –&gt; 01:12:49,019<br>that everything’s gonna be consistent.</p>
<p>1753<br>01:12:50,579 –&gt; 01:12:53,699<br>And so again, so say my application would say an update on A,</p>
<p>1754<br>01:12:53,699 –&gt; 01:12:55,579<br>it’s gonna set it to two,</p>
<p>1755<br>01:12:55,579 –&gt; 01:12:58,460<br>but then it’s gonna propagate those changes to the replicas.</p>
<p>1756<br>01:12:58,460 –&gt; 01:13:00,979<br>And say these replicas are in different data centers,</p>
<p>1757<br>01:13:00,979 –&gt; 01:13:02,619<br>like, you know, one’s going across the country,</p>
<p>1758<br>01:13:02,619 –&gt; 01:13:05,099<br>one’s going over the ocean to Europe.</p>
<p>1759<br>01:13:05,099 –&gt; 01:13:07,220<br>And now the question is how long do we wanna wait</p>
<p>1760<br>01:13:07,220 –&gt; 01:13:11,300<br>for the acknowledgments from those other replicas</p>
<p>1761<br>01:13:11,300 –&gt; 01:13:15,179<br>before we tell the application server we, we got those changes.</p>
<p>1762<br>01:13:16,019 –&gt; 01:13:17,739<br>Again, this goes back to that strong consistency</p>
<p>1763<br>01:13:17,739 –&gt; 01:13:18,739<br>versus eventual consistency.</p>
<p>1764<br>01:13:18,739 –&gt; 01:13:21,019<br>And I was saying that somewhere in the middle.</p>
<p>1765<br>01:13:21,020 –&gt; 01:13:25,460<br>So maybe just waiting for the update from,</p>
<p>1766<br>01:13:25,460 –&gt; 01:13:30,460<br>or the acknowledgment from US West, maybe that’s good enough.</p>
<p>1767<br>01:13:30,460 –&gt; 01:13:32,460<br>Because now if I crash and come back,</p>
<p>1768<br>01:13:32,460 –&gt; 01:13:36,180<br>I can make sure that the,</p>
<p>1769<br>01:13:36,180 –&gt; 01:13:38,860<br>I at least pull the change from one of the locations.</p>
<p>1770<br>01:13:38,860 –&gt; 01:13:41,460<br>But depending on how much I really care about my data,</p>
<p>1771<br>01:13:41,460 –&gt; 01:13:44,700<br>which is actually not something the data system can reason about.</p>
<p>1772<br>01:13:44,700 –&gt; 01:13:46,740<br>Because depends on the application, depends on the organization,</p>
<p>1773<br>01:13:46,740 –&gt; 01:13:49,380<br>depends on whether you’re a bank and it’s financial things,</p>
<p>1774<br>01:13:49,380 –&gt; 01:13:52,340<br>or it’s like, you know, some, some massacron website,</p>
<p>1775<br>01:13:52,340 –&gt; 01:13:54,500<br>for who care, to be loose and stuff, right?</p>
<p>1776<br>01:13:55,460 –&gt; 01:13:58,380<br>So there’s no hard and fast rules saying, okay,</p>
<p>1777<br>01:13:58,380 –&gt; 01:14:00,500<br>this is the right way to do this no matter what.</p>
<p>1778<br>01:14:00,500 –&gt; 01:14:02,539<br>It really depends for a human to decide</p>
<p>1779<br>01:14:02,539 –&gt; 01:14:05,020<br>what the, what the tolerance actually is.</p>
<p>1780<br>01:14:05,020 –&gt; 01:14:07,060<br>But you can clearly see how there’s this trade up between,</p>
<p>1781<br>01:14:07,060 –&gt; 01:14:08,900<br>I can make sure everything’s strong and consistent,</p>
<p>1782<br>01:14:08,900 –&gt; 01:14:10,659<br>but I’m gonna wait for that.</p>
<p>1783<br>01:14:10,659 –&gt; 01:14:12,420<br>Because there’s, there’s the speed of light issues</p>
<p>1784<br>01:14:12,420 –&gt; 01:14:15,020<br>of sending and propagating messages that I can’t,</p>
<p>1785<br>01:14:15,020 –&gt; 01:14:17,460<br>you know, there’s no magic wand to make that go away.</p>
<p>1786<br>01:14:18,460 –&gt; 01:14:21,539<br>And then if, but if, but if I don’t wait,</p>
<p>1787<br>01:14:21,539 –&gt; 01:14:23,260<br>then I could have inconsistent data.</p>
<p>1788<br>01:14:25,980 –&gt; 01:14:26,819<br>Right?</p>
<p>1789<br>01:14:27,739 –&gt; 01:14:31,460<br>So as I said, most distributed relational database systems,</p>
<p>1790<br>01:14:31,460 –&gt; 01:14:34,460<br>both the traditional ones like, the ones from the 1980s,</p>
<p>1791<br>01:14:34,460 –&gt; 01:14:36,939<br>like DB2 and Oracle RAC and others,</p>
<p>1792<br>01:14:36,939 –&gt; 01:14:41,939<br>they will, they will lean heavily towards strong consistency</p>
<p>1793<br>01:14:42,659 –&gt; 01:14:46,060<br>and over availability and partition tolerance.</p>
<p>1794<br>01:14:46,060 –&gt; 01:14:47,300<br>Meaning a bunch of nodes go down,</p>
<p>1795<br>01:14:47,300 –&gt; 01:14:49,659<br>they’re just gonna stop the world until those nodes</p>
<p>1796<br>01:14:49,659 –&gt; 01:14:52,940<br>come back up because they don’t wanna have inconsistent data,</p>
<p>1797<br>01:14:52,940 –&gt; 01:14:56,500<br>they don’t wanna cause you to, you know, integrity issues.</p>
<p>1798<br>01:14:56,500 –&gt; 01:14:58,579<br>Whereas the noticeable guys in the original,</p>
<p>1799<br>01:14:58,579 –&gt; 01:15:00,180<br>a lot of the original versions,</p>
<p>1800<br>01:15:00,180 –&gt; 01:15:02,380<br>they would not support multi-node consistency</p>
<p>1801<br>01:15:02,380 –&gt; 01:15:05,180<br>because they were trying to support high availability</p>
<p>1802<br>01:15:05,180 –&gt; 01:15:07,340<br>and be able to scale out.</p>
<p>1803<br>01:15:07,340 –&gt; 01:15:08,420<br>And they would do something really simple</p>
<p>1804<br>01:15:08,420 –&gt; 01:15:10,260<br>like last update wins.</p>
<p>1805<br>01:15:10,260 –&gt; 01:15:12,140<br>And this last one here, these are the vector clocks</p>
<p>1806<br>01:15:12,140 –&gt; 01:15:14,220<br>and as I said, this is pretty rare.</p>
<p>1807<br>01:15:14,220 –&gt; 01:15:15,659<br>Very few systems do this.</p>
<p>1808<br>01:15:18,140 –&gt; 01:15:18,980<br>Right?</p>
<p>1809<br>01:15:21,699 –&gt; 01:15:22,699<br>All right, in the last five minutes,</p>
<p>1810<br>01:15:22,699 –&gt; 01:15:26,820<br>let’s go through a very complicated database system</p>
<p>1811<br>01:15:26,820 –&gt; 01:15:29,020<br>that Google has spent years and years working on,</p>
<p>1812<br>01:15:29,020 –&gt; 01:15:29,739<br>called Spanner.</p>
<p>1813<br>01:15:30,739 –&gt; 01:15:34,100<br>So the background is, Google was one of the biggest</p>
<p>1814<br>01:15:34,100 –&gt; 01:15:37,100<br>proponents of no SQL systems in the day, right?</p>
<p>1815<br>01:15:37,100 –&gt; 01:15:40,659<br>They wrote this paper called Bigtable in 2004</p>
<p>1816<br>01:15:40,659 –&gt; 01:15:42,739<br>where they said, transactions, we don’t need them,</p>
<p>1817<br>01:15:42,739 –&gt; 01:15:44,100<br>SQL, we don’t need that.</p>
<p>1818<br>01:15:44,100 –&gt; 01:15:45,260<br>They didn’t explicitly call no SQL,</p>
<p>1819<br>01:15:45,260 –&gt; 01:15:47,180<br>but a bunch of people read those papers</p>
<p>1820<br>01:15:47,380 –&gt; 01:15:48,619<br>and said, oh yeah, let’s build the same things,</p>
<p>1821<br>01:15:48,619 –&gt; 01:15:50,460<br>Google’s building, because Google’s making a lot of money,</p>
<p>1822<br>01:15:50,460 –&gt; 01:15:51,460<br>we want to make a lot of money,</p>
<p>1823<br>01:15:51,460 –&gt; 01:15:53,060<br>and it’s clearly because of their database.</p>
<p>1824<br>01:15:53,060 –&gt; 01:15:57,020<br>So a lot of people re-implemented what Google</p>
<p>1825<br>01:15:57,020 –&gt; 01:15:58,140<br>talked about in their papers.</p>
<p>1826<br>01:15:59,659 –&gt; 01:16:03,260<br>But then, so Bigtable came out in 2004</p>
<p>1827<br>01:16:03,260 –&gt; 01:16:04,060<br>and didn’t have transactions.</p>
<p>1828<br>01:16:04,060 –&gt; 01:16:06,980<br>I think a lot of their stuff had vector clocks</p>
<p>1829<br>01:16:06,980 –&gt; 01:16:08,579<br>where you had to reason about inconsistent data</p>
<p>1830<br>01:16:08,579 –&gt; 01:16:10,180<br>in the application code.</p>
<p>1831<br>01:16:10,180 –&gt; 01:16:11,539<br>But why everyone else in Silicon Valley</p>
<p>1832<br>01:16:11,539 –&gt; 01:16:12,780<br>was re-implemented Google’s papers,</p>
<p>1833<br>01:16:12,780 –&gt; 01:16:14,940<br>Google was realizing, hey, which SQL transactions</p>
<p>1834<br>01:16:14,940 –&gt; 01:16:16,659<br>are actually a good idea.</p>
<p>1835<br>01:16:16,659 –&gt; 01:16:19,779<br>And they then, over five year period,</p>
<p>1836<br>01:16:19,779 –&gt; 01:16:20,899<br>when no SQL was a hot thing,</p>
<p>1837<br>01:16:20,899 –&gt; 01:16:24,539<br>they were building this thing called Spanner, right?</p>
<p>1838<br>01:16:24,539 –&gt; 01:16:25,579<br>And what is Spanner?</p>
<p>1839<br>01:16:25,579 –&gt; 01:16:28,619<br>It’s a, the original version was not relational database</p>
<p>1840<br>01:16:28,619 –&gt; 01:16:30,220<br>system, it was, it didn’t support SQL,</p>
<p>1841<br>01:16:30,220 –&gt; 01:16:31,300<br>they eventually added that.</p>
<p>1842<br>01:16:32,300 –&gt; 01:16:34,500<br>But it’s going to be a decentralized shared</p>
<p>1843<br>01:16:34,500 –&gt; 01:16:35,619<br>disc architecture,</p>
<p>1844<br>01:16:35,619 –&gt; 01:16:37,500<br>using log structure on this storage.</p>
<p>1845<br>01:16:37,500 –&gt; 01:16:38,699<br>And for the concurrency tool,</p>
<p>1846<br>01:16:38,699 –&gt; 01:16:40,019<br>it’s going to hit all of our favorite buzzwords</p>
<p>1847<br>01:16:40,019 –&gt; 01:16:41,500<br>where we talked about this semester.</p>
<p>1848<br>01:16:41,500 –&gt; 01:16:42,779<br>They’re going to do strict 2PL,</p>
<p>1849<br>01:16:42,779 –&gt; 01:16:44,220<br>multi-versus-concurrency tool,</p>
<p>1850<br>01:16:44,220 –&gt; 01:16:46,860<br>multi-paxos, and two-based commit.</p>
<p>1851<br>01:16:46,860 –&gt; 01:16:49,180<br>Now, hopefully, at this point in the semester,</p>
<p>1852<br>01:16:49,180 –&gt; 01:16:50,900<br>all these words just start clicking.</p>
<p>1853<br>01:16:50,900 –&gt; 01:16:52,180<br>And you see, oh yeah, I know what those things are.</p>
<p>1854<br>01:16:52,180 –&gt; 01:16:55,020<br>And you see now, when you see them in the context</p>
<p>1855<br>01:16:55,020 –&gt; 01:16:57,180<br>of someone describing a database system,</p>
<p>1856<br>01:16:57,180 –&gt; 01:16:59,420<br>you now can’t get a big picture of what they’re actually</p>
<p>1857<br>01:16:59,420 –&gt; 01:17:03,420<br>doing, whether it actually makes sense, all right?</p>
<p>1858<br>01:17:03,420 –&gt; 01:17:05,140<br>Now, the one thing Google does that is very</p>
<p>1859<br>01:17:05,140 –&gt; 01:17:07,500<br>rad that most people don’t do is that they’re going to support</p>
<p>1860<br>01:17:07,500 –&gt; 01:17:09,340<br>what is called external consistency</p>
<p>1861<br>01:17:09,340 –&gt; 01:17:11,980<br>or strict or strong serialized ability,</p>
<p>1862<br>01:17:11,980 –&gt; 01:17:13,940<br>which I think we might have talked about.</p>
<p>1863<br>01:17:13,939 –&gt; 01:17:17,539<br>And the basic idea here is that the commit order transactions</p>
<p>1864<br>01:17:17,539 –&gt; 01:17:20,299<br>is going to be equivalent to the arrival order</p>
<p>1865<br>01:17:20,299 –&gt; 01:17:22,460<br>of transactions, which is not something</p>
<p>1866<br>01:17:22,460 –&gt; 01:17:24,779<br>we talked about when we talked about serialized</p>
<p>1867<br>01:17:24,779 –&gt; 01:17:26,899<br>ability on a single node.</p>
<p>1868<br>01:17:26,899 –&gt; 01:17:28,779<br>We said, oh yeah, this transaction could</p>
<p>1869<br>01:17:28,779 –&gt; 01:17:29,939<br>go right after this one, but could still</p>
<p>1870<br>01:17:29,939 –&gt; 01:17:31,299<br>commit for the other one.</p>
<p>1871<br>01:17:31,299 –&gt; 01:17:33,699<br>In their role, they need a guarantee that transactions</p>
<p>1872<br>01:17:33,699 –&gt; 01:17:37,299<br>arrive and commit it in the same order that they arrive.</p>
<p>1873<br>01:17:37,299 –&gt; 01:17:41,299<br>They claim in the papers because of something about ads.</p>
<p>1874<br>01:17:41,300 –&gt; 01:17:44,340<br>They built Spanner for running their behemoth ad</p>
<p>1875<br>01:17:44,340 –&gt; 01:17:46,820<br>infrastructure.</p>
<p>1876<br>01:17:46,820 –&gt; 01:17:49,060<br>Very few people need this.</p>
<p>1877<br>01:17:49,060 –&gt; 01:17:51,980<br>And very few systems actually support this.</p>
<p>1878<br>01:17:51,980 –&gt; 01:17:54,539<br>We can ignore lock free transactions for now.</p>
<p>1879<br>01:17:54,539 –&gt; 01:17:57,539<br>So the way it’s going to work is that they’re</p>
<p>1880<br>01:17:57,539 –&gt; 01:18:01,340<br>going to guarantee the ordering of transactions</p>
<p>1881<br>01:18:01,340 –&gt; 01:18:03,940<br>through globally unique timestamps that are going to be</p>
<p>1882<br>01:18:03,940 –&gt; 01:18:06,619<br>generated through a combination of atomic clocks</p>
<p>1883<br>01:18:06,619 –&gt; 01:18:10,340<br>and GPS receivers in every data center.</p>
<p>1884<br>01:18:10,340 –&gt; 01:18:11,940<br>So they’re going to have some satellite dish on top of every</p>
<p>1885<br>01:18:11,940 –&gt; 01:18:15,020<br>single data center to pull down the timestamps coming out</p>
<p>1886<br>01:18:15,020 –&gt; 01:18:17,060<br>of the GPS satellites.</p>
<p>1887<br>01:18:17,060 –&gt; 01:18:21,380<br>Now, it’s not going to guarantee that timestamps are good.</p>
<p>1888<br>01:18:21,380 –&gt; 01:18:24,980<br>It’s not going to guarantee that it knows the exact ordering</p>
<p>1889<br>01:18:24,980 –&gt; 01:18:27,220<br>at any given time for any transaction,</p>
<p>1890<br>01:18:27,220 –&gt; 01:18:30,060<br>but it’s going to allow us to bound how long we have to wait</p>
<p>1891<br>01:18:30,060 –&gt; 01:18:32,940<br>before we expect a transaction to show up with a lower time</p>
<p>1892<br>01:18:32,940 –&gt; 01:18:36,860<br>stamp than an action transaction when we have to commit.</p>
<p>1893<br>01:18:36,860 –&gt; 01:18:38,300<br>And that’s the novel aspect about this.</p>
<p>1894<br>01:18:38,300 –&gt; 01:18:42,779<br>Because otherwise, if you wanted to do this global ordering</p>
<p>1895<br>01:18:42,779 –&gt; 01:18:45,020<br>across different data centers, across the wider network,</p>
<p>1896<br>01:18:45,020 –&gt; 01:18:46,860<br>you’re going to have to wait.</p>
<p>1897<br>01:18:46,860 –&gt; 01:18:50,300<br>But because the clocks could be skewed,</p>
<p>1898<br>01:18:50,300 –&gt; 01:18:52,539<br>slightly off from every one data center than other,</p>
<p>1899<br>01:18:52,539 –&gt; 01:18:54,300<br>you might have to wait a little bit longer than you would,</p>
<p>1900<br>01:18:54,300 –&gt; 01:18:56,820<br>otherwise, if you have this.</p>
<p>1901<br>01:18:56,820 –&gt; 01:19:00,260<br>And as far as I know, I don’t know of any other people.</p>
<p>1902<br>01:19:00,260 –&gt; 01:19:01,260<br>I don’t know any other company that</p>
<p>1903<br>01:19:01,260 –&gt; 01:19:04,300<br>publicly talks about having this kind of infrastructure.</p>
<p>1904<br>01:19:04,300 –&gt; 01:19:06,100<br>The high-frequency trading guys might,</p>
<p>1905<br>01:19:06,100 –&gt; 01:19:07,340<br>but they don’t write papers, and they don’t</p>
<p>1906<br>01:19:07,340 –&gt; 01:19:09,819<br>share what they’re doing because they’re too busy counting</p>
<p>1907<br>01:19:09,819 –&gt; 01:19:10,819<br>their money.</p>
<p>1908<br>01:19:14,819 –&gt; 01:19:18,340<br>Fun fact, when I was in grad school, one</p>
<p>1909<br>01:19:18,340 –&gt; 01:19:20,699<br>I earlier was, I was sponsored by the research</p>
<p>1910<br>01:19:20,699 –&gt; 01:19:22,819<br>funding was sponsored by this company</p>
<p>1911<br>01:19:22,819 –&gt; 01:19:26,579<br>at Chicago, who their claim to fame was in the 90s.</p>
<p>1912<br>01:19:26,579 –&gt; 01:19:28,340<br>They figured out if you put the database server</p>
<p>1913<br>01:19:28,340 –&gt; 01:19:30,380<br>on the floor above the stock exchange,</p>
<p>1914<br>01:19:30,380 –&gt; 01:19:32,500<br>you make money faster.</p>
<p>1915<br>01:19:32,500 –&gt; 01:19:33,900<br>They obviously did a lot more stuff since then,</p>
<p>1916<br>01:19:33,900 –&gt; 01:19:36,300<br>but this thing they were telling me they would do</p>
<p>1917<br>01:19:36,779 –&gt; 01:19:37,779<br>was insane.</p>
<p>1918<br>01:19:37,779 –&gt; 01:19:40,699<br>We’re talking about digging trenches to run their own fiber</p>
<p>1919<br>01:19:40,699 –&gt; 01:19:43,420<br>out to cables, because that’ll get them five milliseconds less.</p>
<p>1920<br>01:19:43,420 –&gt; 01:19:47,180<br>Because again, in their world, that matters a lot.</p>
<p>1921<br>01:19:47,180 –&gt; 01:19:51,659<br>So the way Spain is going to do is going to break the database</p>
<p>1922<br>01:19:51,659 –&gt; 01:19:53,060<br>up into what they call tablets.</p>
<p>1923<br>01:19:53,060 –&gt; 01:19:54,539<br>These are just partitions.</p>
<p>1924<br>01:19:54,539 –&gt; 01:19:56,420<br>And they’re going to use Paxos to do leader election</p>
<p>1925<br>01:19:56,420 –&gt; 01:19:57,539<br>in the tablet group.</p>
<p>1926<br>01:19:57,539 –&gt; 01:20:01,980<br>But then if I have to update data across multiple tablets,</p>
<p>1927<br>01:20:01,980 –&gt; 01:20:04,980<br>then it’ll just use regular two-phase commit for this.</p>
<p>1928<br>01:20:04,979 –&gt; 01:20:06,500<br>So visually it looks like this.</p>
<p>1929<br>01:20:06,500 –&gt; 01:20:08,899<br>You like to leader within my data center.</p>
<p>1930<br>01:20:08,899 –&gt; 01:20:11,500<br>So there’s the tablet and there’s</p>
<p>1931<br>01:20:11,500 –&gt; 01:20:13,139<br>replicate across different data centers.</p>
<p>1932<br>01:20:13,139 –&gt; 01:20:15,579<br>There’s some data center that’s a leader.</p>
<p>1933<br>01:20:15,579 –&gt; 01:20:18,179<br>All reason rights have to go to this guy.</p>
<p>1934<br>01:20:18,179 –&gt; 01:20:21,219<br>And then use Paxos to propagate them to everyone else.</p>
<p>1935<br>01:20:21,219 –&gt; 01:20:23,379<br>And then any snapshot reads, which again,</p>
<p>1936<br>01:20:23,379 –&gt; 01:20:25,539<br>think of like existing snapshot on time,</p>
<p>1937<br>01:20:25,539 –&gt; 01:20:30,419<br>I can then run on the non-leader tablets</p>
<p>1938<br>01:20:30,419 –&gt; 01:20:32,219<br>to read any data that they have.</p>
<p>1939<br>01:20:32,219 –&gt; 01:20:33,299<br>But if I have a transaction that’s</p>
<p>1940<br>01:20:33,300 –&gt; 01:20:35,300<br>updated another tablet group, whether or not</p>
<p>1941<br>01:20:35,300 –&gt; 01:20:37,140<br>send my same data center or not, and they’re</p>
<p>1942<br>01:20:37,140 –&gt; 01:20:39,180<br>well, they’re replicating across multiple data centers,</p>
<p>1943<br>01:20:39,180 –&gt; 01:20:41,980<br>I’m going to use two-phase commit to then do updates that</p>
<p>1944<br>01:20:41,980 –&gt; 01:20:45,260<br>get propagated to those other tablets, which then go to their leader</p>
<p>1945<br>01:20:45,260 –&gt; 01:20:48,820<br>who then propagates those changes using Paxos.</p>
<p>1946<br>01:20:48,820 –&gt; 01:20:50,779<br>So this is a good example where the things</p>
<p>1947<br>01:20:50,779 –&gt; 01:20:53,380<br>aren’t mutually exclusive like Paxos and two-phase commit.</p>
<p>1948<br>01:20:53,380 –&gt; 01:20:56,539<br>You can use a combination of both of them.</p>
<p>1949<br>01:20:56,539 –&gt; 01:20:59,180<br>Those systems just do one or the other.</p>
<p>1950<br>01:20:59,940 –&gt; 01:21:04,300<br>All right, I’m going to skip this slide.</p>
<p>1951<br>01:21:04,300 –&gt; 01:21:07,460<br>This basically says how they guarantee</p>
<p>1952<br>01:21:07,460 –&gt; 01:21:09,980<br>strict sterilized ability and due time sample.</p>
<p>1953<br>01:21:09,980 –&gt; 01:21:12,420<br>So, all right, so there you go.</p>
<p>1954<br>01:21:12,420 –&gt; 01:21:16,900<br>Three minutes to cover Paxos or sorry, to cover Spanner.</p>
<p>1955<br>01:21:16,900 –&gt; 01:21:17,980<br>If you guys want to learn more about it,</p>
<p>1956<br>01:21:17,980 –&gt; 01:21:18,940<br>we can vote for it.</p>
<p>1957<br>01:21:18,940 –&gt; 01:21:22,220<br>We can cover it on the speed run at the end of the semester</p>
<p>1958<br>01:21:22,220 –&gt; 01:21:23,060<br>next week.</p>
<p>1959<br>01:21:23,060 –&gt; 01:21:27,659<br>All right, so the main takeaway from all this for this would</p>
<p>1960<br>01:21:27,979 –&gt; 01:21:30,899<br>be that maintaining consistent view of the database</p>
<p>1961<br>01:21:30,899 –&gt; 01:21:32,500<br>across multiple nodes is hard.</p>
<p>1962<br>01:21:33,619 –&gt; 01:21:35,059<br>And it’s important to get this right</p>
<p>1963<br>01:21:35,059 –&gt; 01:21:37,139<br>because there will be failures.</p>
<p>1964<br>01:21:37,139 –&gt; 01:21:39,579<br>Not just the machine goes down, but like weird things</p>
<p>1965<br>01:21:39,579 –&gt; 01:21:41,220<br>that outside of your control, the purview of the data,</p>
<p>1966<br>01:21:41,220 –&gt; 01:21:44,899<br>some like GC pauses or network hiccups that again,</p>
<p>1967<br>01:21:44,899 –&gt; 01:21:47,500<br>so you have to prepare for all these things.</p>
<p>1968<br>01:21:47,500 –&gt; 01:21:49,619<br>And then they said blockchains are waste of time</p>
<p>1969<br>01:21:49,619 –&gt; 01:21:52,139<br>because most applications don’t run in this world.</p>
<p>1970<br>01:21:52,139 –&gt; 01:21:53,340<br>Bitcoin is the only really useful thing</p>
<p>1971<br>01:21:53,340 –&gt; 01:21:54,779<br>you can use a blockchain for.</p>
<p>1972<br>01:21:54,779 –&gt; 01:21:55,619<br>Right?</p>
<p>1973<br>01:21:56,460 –&gt; 01:21:59,220<br>Most, you know, most people running transactions</p>
<p>1974<br>01:21:59,220 –&gt; 01:22:01,340<br>are gonna trust people to, you know,</p>
<p>1975<br>01:22:01,340 –&gt; 01:22:03,979<br>you’re gonna trust the machines and trust the authority</p>
<p>1976<br>01:22:03,979 –&gt; 01:22:05,340<br>because this is sort of how the real world works.</p>
<p>1977<br>01:22:05,340 –&gt; 01:22:06,859<br>If you buy something, you give me your credit card number,</p>
<p>1978<br>01:22:06,859 –&gt; 01:22:08,819<br>you trust them to go charge your credit card number.</p>
<p>1979<br>01:22:08,819 –&gt; 01:22:11,260<br>All of those are to be trusted transactions.</p>
<p>1980<br>01:22:11,260 –&gt; 01:22:12,619<br>And so you don’t need blockchain.</p>
<p>1981<br>01:22:12,619 –&gt; 01:22:14,939<br>So the overhead of gaining visiting fault tolerance</p>
<p>1982<br>01:22:14,939 –&gt; 01:22:15,859<br>is unnecessary.</p>
<p>1983<br>01:22:16,819 –&gt; 01:22:19,739<br>So, this self is super interesting to you.</p>
<p>1984<br>01:22:19,739 –&gt; 01:22:23,579<br>There’s a great blog article or blog from Skycow Kingsbury.</p>
<p>1985<br>01:22:23,619 –&gt; 01:22:26,180<br>He has this thing called the Jepsen Project.</p>
<p>1986<br>01:22:26,180 –&gt; 01:22:29,100<br>10 years ago at Stripe, he basically wrote a torture chamber</p>
<p>1987<br>01:22:30,220 –&gt; 01:22:32,460<br>for distributed data bases to prove</p>
<p>1988<br>01:22:32,460 –&gt; 01:22:35,859<br>that they don’t achieve all the guarantees</p>
<p>1989<br>01:22:35,859 –&gt; 01:22:36,979<br>that they’re claiming.</p>
<p>1990<br>01:22:36,979 –&gt; 01:22:38,460<br>They’re not strong in the ecosystem,</p>
<p>1991<br>01:22:38,460 –&gt; 01:22:40,100<br>they can’t handle this kind of failure.</p>
<p>1992<br>01:22:40,100 –&gt; 01:22:41,779<br>They can think of the context of the cap theorem.</p>
<p>1993<br>01:22:41,779 –&gt; 01:22:45,140<br>Are they truly partitioned, tellin’ or so forth?</p>
<p>1994<br>01:22:45,140 –&gt; 01:22:47,059<br>And so his blog articles are fascinating.</p>
<p>1995<br>01:22:47,059 –&gt; 01:22:48,140<br>They’re very, very detailed</p>
<p>1996<br>01:22:48,140 –&gt; 01:22:50,619<br>and they go into all the theories that occur.</p>
<p>1997<br>01:22:50,619 –&gt; 01:22:52,659<br>He was really just doing this as a hobby,</p>
<p>1998<br>01:22:52,659 –&gt; 01:22:54,579<br>but then now he’s spun it off as a consultancy company.</p>
<p>1999<br>01:22:54,579 –&gt; 01:22:56,819<br>So a bunch of the distributed data companies hire him</p>
<p>2000<br>01:22:56,819 –&gt; 01:23:00,979<br>to then run his torture chamber on their data bases</p>
<p>2001<br>01:23:00,979 –&gt; 01:23:03,300<br>and then he writes about all the failures.</p>
<p>2002<br>01:23:03,300 –&gt; 01:23:05,300<br>And what’s awesome is that a bunch of companies claim</p>
<p>2003<br>01:23:05,300 –&gt; 01:23:07,539<br>that they could do this feature or that feature,</p>
<p>2004<br>01:23:07,539 –&gt; 01:23:09,180<br>he comes in and destroys them.</p>
<p>2005<br>01:23:09,180 –&gt; 01:23:10,899<br>And they have to change their marketing language</p>
<p>2006<br>01:23:10,899 –&gt; 01:23:13,939<br>to reflect that like, oh yeah, we’re not actually this</p>
<p>2007<br>01:23:13,939 –&gt; 01:23:15,139<br>until they eventually actually fix it.</p>
<p>2008<br>01:23:15,139 –&gt; 01:23:16,979<br>So again, this stuff is,</p>
<p>2009<br>01:23:18,539 –&gt; 01:23:20,579<br>don’t read this blog article.</p>
<p>2010<br>01:23:21,579 –&gt; 01:23:22,739<br>You’ll see why.</p>
<p>2011<br>01:23:22,739 –&gt; 01:23:23,579<br>Okay.</p>
<p>2012<br>01:23:25,019 –&gt; 01:23:26,659<br>Next week or sorry, next Wednesday,</p>
<p>2013<br>01:23:26,659 –&gt; 01:23:27,659<br>oh, a lot of systems.</p>
<p>2014<br>01:23:27,659 –&gt; 01:23:29,380<br>They ain’t, we won’t worry about transactions,</p>
<p>2015<br>01:23:29,380 –&gt; 01:23:30,500<br>but the big problem we’re gonna face now</p>
<p>2016<br>01:23:30,500 –&gt; 01:23:32,739<br>is how do we do joins in a distributed environment?</p>
<p>2017<br>01:23:32,739 –&gt; 01:23:33,739<br>Okay?</p>
<p>2018<br>01:23:33,739 –&gt; 01:23:36,420<br>I wouldn’t normally say hit it, he’s not here, he’s sick.</p>
<p>2019<br>01:23:37,260 –&gt; 01:23:38,100<br>Yeah.</p>
<p>2020<br>01:23:38,100 –&gt; 01:23:38,940<br>Yeah.</p>
<p>2021<br>01:23:38,940 –&gt; 01:23:39,579<br>Now listen.</p>
<p>2022<br>01:23:39,579 –&gt; 01:23:42,180<br>I’m the poppy with the motherfuckin hood up.</p>
<p>2023<br>01:23:42,180 –&gt; 01:23:44,380<br>28th gram, depending on if it’s cop-up.</p>
<p>2024<br>01:23:44,380 –&gt; 01:23:45,739<br>You ain’t hit a mob yet.</p>
<p>2025<br>01:23:45,739 –&gt; 01:23:47,060<br>Still got your shut up.</p>
<p>2026<br>01:23:47,060 –&gt; 01:23:49,340<br>I smack you with the bottom of the clip to tell you.</p>
<p>2027<br>01:23:49,340 –&gt; 01:23:50,180<br>Look up.</p>
<p>2028<br>01:23:50,180 –&gt; 01:23:51,779<br>Show me what it’s safe set for.</p>
<p>2029<br>01:23:51,779 –&gt; 01:23:53,420<br>I blow your finger up.</p>
<p>2030<br>01:23:53,420 –&gt; 01:23:54,699<br>And I hit it, I hit it.</p>
<p>2031<br>01:23:54,699 –&gt; 01:23:55,699<br>I hit it.</p>
<p>2032<br>01:23:55,699 –&gt; 01:23:56,539<br>I hit it.</p>
<p>2033<br>01:23:56,539 –&gt; 01:23:57,380<br>I hit it.</p>
<p>2034<br>01:23:57,380 –&gt; 01:23:58,220<br>I hit it.</p>
<p>2035<br>01:23:58,220 –&gt; 01:23:59,220<br>I hit it.</p>
<p>2036<br>01:23:59,220 –&gt; 01:24:00,220<br>I hit it.</p>
<p>2037<br>01:24:00,220 –&gt; 01:24:01,220<br>I hit it.</p>
<p>2038<br>01:24:01,220 –&gt; 01:24:02,220<br>I hit it.</p>
<p>2039<br>01:24:02,220 –&gt; 01:24:03,220<br>I hit it.</p>
<p>2040<br>01:24:03,220 –&gt; 01:24:04,220<br>I hit it.</p>
<p>2041<br>01:24:04,220 –&gt; 01:24:05,220<br>I hit it.</p>
<p>2042<br>01:24:05,220 –&gt; 01:24:06,220<br>I hit it.</p>
<p>2043<br>01:24:06,220 –&gt; 01:24:07,220<br>I hit it.</p>
<p>2044<br>01:24:07,220 –&gt; 01:24:08,220<br>I hit it.</p>
<p>2045<br>01:24:08,220 –&gt; 01:24:09,220<br>I hit it.</p>
<p>2046<br>01:24:09,220 –&gt; 01:24:10,220<br>I hit it.</p>
<p>2047<br>01:24:10,220 –&gt; 01:24:11,220<br>I hit it.</p>
<p>2048<br>01:24:11,220 –&gt; 01:24:12,220<br>I hit it.</p>
<p>2049<br>01:24:12,220 –&gt; 01:24:13,220<br>I hit it.</p>
<p>2050<br>01:24:13,220 –&gt; 01:24:14,220<br>I hit it.</p>
<p>2051<br>01:24:14,220 –&gt; 01:24:15,220<br>I hit it.</p>
<p>2052<br>01:24:15,220 –&gt; 01:24:16,220<br>I hit it.</p>
<p>2053<br>01:24:16,220 –&gt; 01:24:17,220<br>I hit it.</p>
<p>2054<br>01:24:17,220 –&gt; 01:24:18,220<br>I hit it.</p>
<p>2055<br>01:24:18,220 –&gt; 01:24:19,220<br>I hit it.</p>
<p>2056<br>01:24:19,220 –&gt; 01:24:20,220<br>I hit it.</p>
<p>2057<br>01:24:20,220 –&gt; 01:24:21,220<br>I hit it.</p>
<p>2058<br>01:24:21,220 –&gt; 01:24:22,220<br>I hit it.</p>
<p>2059<br>01:24:22,220 –&gt; 01:24:23,220<br>I hit it.</p>
<p>2060<br>01:24:23,220 –&gt; 01:24:24,220<br>I hit it.</p>
<p>2061<br>01:24:24,220 –&gt; 01:24:25,220<br>I hit it.</p>
<p>2062<br>01:24:25,220 –&gt; 01:24:26,220<br>I hit it.</p>
<p>2063<br>01:24:26,220 –&gt; 01:24:27,220<br>I hit it.</p>
<p>2064<br>01:24:27,220 –&gt; 01:24:28,220<br>I hit it.</p>
<p>2065<br>01:24:28,220 –&gt; 01:24:29,220<br>I hit it.</p>
<p>2066<br>01:24:29,220 –&gt; 01:24:30,220<br>I hit it.</p>
<p>2067<br>01:24:30,220 –&gt; 01:24:31,220<br>I hit it.</p>
<p>2068<br>01:24:31,220 –&gt; 01:24:32,220<br>I hit it.</p>
<p>2069<br>01:24:32,220 –&gt; 01:24:33,220<br>I hit it.</p>
<p>2070<br>01:24:33,220 –&gt; 01:24:34,220<br>I hit it.</p>
<p>2071<br>01:24:34,220 –&gt; 01:24:35,220<br>I hit it.</p>
<p>2072<br>01:24:35,220 –&gt; 01:24:36,220<br>I hit it.</p>
<p>2073<br>01:24:36,220 –&gt; 01:24:37,220<br>I hit it.</p>
<p>2074<br>01:24:37,220 –&gt; 01:24:38,220<br>I hit it.</p>
<p>2075<br>01:24:38,220 –&gt; 01:24:39,220<br>I hit it.</p>
<p>2076<br>01:24:39,220 –&gt; 01:24:40,220<br>I hit it.</p>
<p>2077<br>01:24:40,220 –&gt; 01:24:41,220<br>I hit it.</p>
<p>2078<br>01:24:41,220 –&gt; 01:24:42,220<br>I hit it.</p>
<p>2079<br>01:24:42,220 –&gt; 01:24:43,220<br>I hit it.</p>
<p>2080<br>01:24:43,220 –&gt; 01:24:44,220<br>I hit it.</p>
<p>2081<br>01:24:44,220 –&gt; 01:24:45,220<br>I hit it.</p>
<p>2082<br>01:24:45,220 –&gt; 01:24:46,220<br>I hit it.</p>
<p>2083<br>01:24:46,220 –&gt; 01:24:47,220<br>I hit it.</p>
<p>2084<br>01:24:47,220 –&gt; 01:24:48,220<br>I hit it.</p>
<p>2085<br>01:24:48,220 –&gt; 01:24:49,220<br>I hit it.</p>
<p>2086<br>01:24:49,220 –&gt; 01:24:50,220<br>I hit it.</p>
<p>2087<br>01:24:50,220 –&gt; 01:24:51,220<br>I hit it.</p>
<p>2088<br>01:24:51,220 –&gt; 01:24:52,220<br>I hit it.</p>
<p>2089<br>01:24:52,220 –&gt; 01:24:53,220<br>I hit it.</p>
<p>2090<br>01:24:53,220 –&gt; 01:24:54,220<br>I hit it.</p>
<p>2091<br>01:24:54,220 –&gt; 01:24:55,220<br>I hit it.</p>
<p>2092<br>01:24:55,220 –&gt; 01:24:56,220<br>I hit it.</p>
<p>2093<br>01:24:56,220 –&gt; 01:24:57,220<br>I hit it.</p>
<p>2094<br>01:24:57,220 –&gt; 01:24:58,220<br>I hit it.</p>
<p>2095<br>01:24:58,220 –&gt; 01:24:59,220<br>I hit it.</p>
<p>2096<br>01:24:59,220 –&gt; 01:25:00,220<br>I hit it.</p>
<p>2097<br>01:25:00,220 –&gt; 01:25:01,220<br>I hit it.</p>
<p>2098<br>01:25:01,220 –&gt; 01:25:02,220<br>I hit it.</p>
<p>2099<br>01:25:02,220 –&gt; 01:25:03,220<br>I hit it.</p>
<p>2100<br>01:25:03,220 –&gt; 01:25:04,220<br>I hit it.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CMU15445 P23F202322 DistributedTransactionProcessingDatabases</div>
      <div>http://example.com/2025/10/24/CMU15445 P23F202322-DistributedTransactionProcessingDatabases/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/24/CMU15445%20P26F202325-PotpourriRedisCockroachDBSnowflakeMangoDBTabDB/" title="CMU15445 P26F202325 PotpourriRedisCockroachDBSnowflakeMangoDBTabDB">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CMU15445 P26F202325 PotpourriRedisCockroachDBSnowflakeMangoDBTabDB</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/24/CMU15445%20P24F202323-DistributedDataWarehouseOLAPDatabases/" title="CMU15445 P24F202323 DistributedDataWarehouseOLAPDatabases">
                        <span class="hidden-mobile">CMU15445 P24F202323 DistributedDataWarehouseOLAPDatabases</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
