

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:14,320Ponadznimo 200:00:14,320 –&gt; 00:00:23,780ова 300:00:23,780 –&gt; 00:00:35,980All right, let me make sure I do backup recording. 400:00:35,980 –&gt; 00:00:42,820All ri">
<meta property="og:type" content="article">
<meta property="og:title" content="CMU15445 P3F202302 ModernSQL">
<meta property="og:url" content="http://example.com/2025/10/24/CMU15445%20P3F202302-ModernSQL/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:14,320Ponadznimo 200:00:14,320 –&gt; 00:00:23,780ова 300:00:23,780 –&gt; 00:00:35,980All right, let me make sure I do backup recording. 400:00:35,980 –&gt; 00:00:42,820All ri">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-24T12:00:44.476Z">
<meta property="article:modified_time" content="2025-10-24T12:06:28.543Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>CMU15445 P3F202302 ModernSQL - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CMU15445 P3F202302 ModernSQL"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-24 20:00" pubdate>
          2025年10月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          15k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          129 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CMU15445 P3F202302 ModernSQL</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:14,320<br>Ponadznimo</p>
<p>2<br>00:00:14,320 –&gt; 00:00:23,780<br>ова</p>
<p>3<br>00:00:23,780 –&gt; 00:00:35,980<br>All right, let me make sure I do backup recording.</p>
<p>4<br>00:00:35,980 –&gt; 00:00:42,820<br>All right, so some quick things, administrative things from last class.</p>
<p>5<br>00:00:42,820 –&gt; 00:00:46,260<br>It’s only been one day we already got emails.</p>
<p>6<br>00:00:46,260 –&gt; 00:00:49,340<br>So the first thing is that I made a mistake last class.</p>
<p>7<br>00:00:49,340 –&gt; 00:00:52,100<br>I said Ted Cobb got his PhD at Penn.</p>
<p>8<br>00:00:52,100 –&gt; 00:00:53,740<br>He got his PhD at Michigan.</p>
<p>9<br>00:00:53,740 –&gt; 00:00:56,700<br>We’re all the great data he got to their PhDs.</p>
<p>10<br>00:00:56,700 –&gt; 00:00:59,579<br>So my extrobreaker got his PhD there.</p>
<p>11<br>00:00:59,579 –&gt; 00:01:00,620<br>Ted Cobb got his PhD there.</p>
<p>12<br>00:01:00,620 –&gt; 00:01:02,260<br>David DeWitt, another famous David’s guy.</p>
<p>13<br>00:01:02,260 –&gt; 00:01:03,179<br>So he was not Penn.</p>
<p>14<br>00:01:03,179 –&gt; 00:01:05,060<br>It was Michigan.</p>
<p>15<br>00:01:05,060 –&gt; 00:01:08,700<br>All right, the other thing is people complain about the audio.</p>
<p>16<br>00:01:08,700 –&gt; 00:01:10,340<br>Do you’re Andy, the audio for your class sucks.</p>
<p>17<br>00:01:10,340 –&gt; 00:01:11,939<br>Why can’t seem you afford a sound engineer?</p>
<p>18<br>00:01:11,939 –&gt; 00:01:12,700<br>Do it right.</p>
<p>19<br>00:01:12,700 –&gt; 00:01:14,180<br>Andy, I love the course, but I can’t listen to it</p>
<p>20<br>00:01:14,180 –&gt; 00:01:15,099<br>because the audio is messed up.</p>
<p>21<br>00:01:15,099 –&gt; 00:01:15,659<br>What happened?</p>
<p>22<br>00:01:15,659 –&gt; 00:01:16,379<br>Why are you doing this?</p>
<p>23<br>00:01:16,379 –&gt; 00:01:18,219<br>I lost the will to live.</p>
<p>24<br>00:01:18,219 –&gt; 00:01:20,579<br>So that was my fault last time.</p>
<p>25<br>00:01:20,579 –&gt; 00:01:21,579<br>So we’re double recordings.</p>
<p>26<br>00:01:21,579 –&gt; 00:01:25,579<br>So hopefully we won’t have any issues with posting it this time.</p>
<p>27<br>00:01:25,579 –&gt; 00:01:27,980<br>And then we actually got emails about you.</p>
<p>28<br>00:01:27,980 –&gt; 00:01:30,179<br>Which is surprising, right?</p>
<p>29<br>00:01:30,179 –&gt; 00:01:34,140<br>I saw DJ2PL last month performing at the bridge, 21</p>
<p>30<br>00:01:34,140 –&gt; 00:01:35,379<br>and overshoot on Pittsburgh.</p>
<p>31<br>00:01:35,379 –&gt; 00:01:36,579<br>Is that true?</p>
<p>32<br>00:01:36,579 –&gt; 00:01:37,459<br>All right.</p>
<p>33<br>00:01:37,459 –&gt; 00:01:38,900<br>You’re very lucky to get a DJ like that.</p>
<p>34<br>00:01:38,900 –&gt; 00:01:40,900<br>He is expensive.</p>
<p>35<br>00:01:40,900 –&gt; 00:01:43,259<br>Seemies have a lot of money.</p>
<p>36<br>00:01:43,259 –&gt; 00:01:44,259<br>Even does not have a lot of money.</p>
<p>37<br>00:01:44,259 –&gt; 00:01:45,299<br>OK.</p>
<p>38<br>00:01:45,299 –&gt; 00:01:48,420<br>Yo, DJ2PL is ridiculous.</p>
<p>39<br>00:01:48,420 –&gt; 00:01:49,299<br>Is he single?</p>
<p>40<br>00:01:49,299 –&gt; 00:01:50,299<br>I’m asking for my friend.</p>
<p>41<br>00:01:54,219 –&gt; 00:01:56,979<br>And then she’s like Taylor Swift without any thumbs.</p>
<p>42<br>00:01:56,979 –&gt; 00:01:57,979<br>I don’t know what that means.</p>
<p>43<br>00:02:00,859 –&gt; 00:02:02,099<br>Are you single?</p>
<p>44<br>00:02:02,099 –&gt; 00:02:03,259<br>I’m not important.</p>
<p>45<br>00:02:03,259 –&gt; 00:02:04,259<br>OK.</p>
<p>46<br>00:02:04,259 –&gt; 00:02:05,859<br>I’m not important.</p>
<p>47<br>00:02:05,859 –&gt; 00:02:06,299<br>All right.</p>
<p>48<br>00:02:06,299 –&gt; 00:02:10,900<br>So anyway, that’s their problem.</p>
<p>49<br>00:02:10,900 –&gt; 00:02:12,060<br>All right.</p>
<p>50<br>00:02:12,060 –&gt; 00:02:15,300<br>So today’s class we’re going to talk about SQL.</p>
<p>51<br>00:02:15,300 –&gt; 00:02:18,340<br>The last class we spent time talking about the relational model,</p>
<p>52<br>00:02:18,340 –&gt; 00:02:20,140<br>we talked about how, in my opinion,</p>
<p>53<br>00:02:20,140 –&gt; 00:02:23,340<br>that it’s a superior data model for every possible database</p>
<p>54<br>00:02:23,340 –&gt; 00:02:24,939<br>you can think of.</p>
<p>55<br>00:02:24,939 –&gt; 00:02:28,740<br>The relational data model can be used to represent,</p>
<p>56<br>00:02:28,740 –&gt; 00:02:31,699<br>produce all the different schemes that are out there.</p>
<p>57<br>00:02:31,699 –&gt; 00:02:32,980<br>And then we showed how relational algebra</p>
<p>58<br>00:02:32,980 –&gt; 00:02:35,980<br>was the building block for how we would execute queries</p>
<p>59<br>00:02:35,980 –&gt; 00:02:41,060<br>or define queries to operate over on a relational database.</p>
<p>60<br>00:02:41,060 –&gt; 00:02:43,460<br>So today’s class is really now to talk about SQL,</p>
<p>61<br>00:02:43,460 –&gt; 00:02:47,020<br>which is a declarative or non-procedural language</p>
<p>62<br>00:02:47,020 –&gt; 00:02:50,700<br>for interacting with a database system.</p>
<p>63<br>00:02:50,700 –&gt; 00:02:53,100<br>And what we’ll see over time is that SQL</p>
<p>64<br>00:02:53,100 –&gt; 00:02:56,180<br>has evolved where, in the beginning in the 1970s,</p>
<p>65<br>00:02:56,180 –&gt; 00:02:59,100<br>when it was first defined, it was very strict about what</p>
<p>66<br>00:02:59,100 –&gt; 00:03:01,020<br>a relational database should look like.</p>
<p>67<br>00:03:01,020 –&gt; 00:03:04,020<br>But in the last 40 years, it’s expanded</p>
<p>68<br>00:03:04,020 –&gt; 00:03:06,820<br>to support things that don’t look relational, like JSON,</p>
<p>69<br>00:03:06,820 –&gt; 00:03:08,700<br>for example.</p>
<p>70<br>00:03:08,700 –&gt; 00:03:09,740<br>So let’s start at the beginning.</p>
<p>71<br>00:03:09,740 –&gt; 00:03:10,900<br>Talk about how SQL got started.</p>
<p>72<br>00:03:10,900 –&gt; 00:03:14,980<br>And then we’ll talk about the sort of more interesting things</p>
<p>73<br>00:03:14,979 –&gt; 00:03:17,859<br>you can do in modern versions of it.</p>
<p>74<br>00:03:17,859 –&gt; 00:03:22,859<br>So the SQL goes back to the 1970s.</p>
<p>75<br>00:03:22,859 –&gt; 00:03:25,979<br>And again, for Ted Cobb, when he wrote that first paper,</p>
<p>76<br>00:03:25,979 –&gt; 00:03:27,819<br>he didn’t define a programming language</p>
<p>77<br>00:03:27,819 –&gt; 00:03:29,379<br>for operating relational databases.</p>
<p>78<br>00:03:29,379 –&gt; 00:03:31,019<br>It was all mathematical.</p>
<p>79<br>00:03:31,019 –&gt; 00:03:35,979<br>People said, oh, the paper was so inscrutable,</p>
<p>80<br>00:03:35,979 –&gt; 00:03:37,819<br>never can understand it.</p>
<p>81<br>00:03:37,819 –&gt; 00:03:39,379<br>If you actually read it, it’s actually pretty easily</p>
<p>82<br>00:03:39,379 –&gt; 00:03:40,219<br>understandable.</p>
<p>83<br>00:03:40,219 –&gt; 00:03:43,179<br>It’s just people who didn’t like math back in the day, I guess.</p>
<p>84<br>00:03:43,180 –&gt; 00:03:46,740<br>So then he, some people at IBM,</p>
<p>85<br>00:03:46,740 –&gt; 00:03:49,180<br>saw his paper and tried to start building</p>
<p>86<br>00:03:49,180 –&gt; 00:03:51,180<br>experimental relational databases to see whether they</p>
<p>87<br>00:03:51,180 –&gt; 00:03:53,420<br>can actually take his mathematical ideas</p>
<p>88<br>00:03:53,420 –&gt; 00:03:55,540<br>and put it out, put it into practice.</p>
<p>89<br>00:03:55,540 –&gt; 00:03:58,300<br>And so the very first relational database language,</p>
<p>90<br>00:03:58,300 –&gt; 00:04:01,740<br>as far as I know, was this thing called Square,</p>
<p>91<br>00:04:01,740 –&gt; 00:04:05,300<br>that IBM invented in 1971.</p>
<p>92<br>00:04:05,300 –&gt; 00:04:07,300<br>And this was for an earlier project</p>
<p>93<br>00:04:07,300 –&gt; 00:04:10,340<br>that IBM was developing for one of the first relational database</p>
<p>94<br>00:04:10,340 –&gt; 00:04:12,740<br>systems, I’d probably be first one,</p>
<p>95<br>00:04:12,740 –&gt; 00:04:15,420<br>which sounds like a weird experimental rock band.</p>
<p>96<br>00:04:15,420 –&gt; 00:04:18,100<br>It’s called the Peter Lee relational test vehicle.</p>
<p>97<br>00:04:18,100 –&gt; 00:04:20,980<br>But that was the first thing they built as an early prototype</p>
<p>98<br>00:04:20,980 –&gt; 00:04:23,019<br>to show that you could take Ted Cobb’s ideas</p>
<p>99<br>00:04:23,019 –&gt; 00:04:25,579<br>and actually put it into a real system.</p>
<p>100<br>00:04:25,579 –&gt; 00:04:28,699<br>The problem with Square, though, is that you can never actually</p>
<p>101<br>00:04:28,699 –&gt; 00:04:31,860<br>reuse it because you had to write in weird notation</p>
<p>102<br>00:04:31,860 –&gt; 00:04:35,540<br>and vertically, which you can’t really do.</p>
<p>103<br>00:04:35,540 –&gt; 00:04:39,500<br>So this is from one of the virtual papers.</p>
<p>104<br>00:04:39,500 –&gt; 00:04:42,540<br>You would write, this is how to do a scan</p>
<p>105<br>00:04:42,900 –&gt; 00:04:44,500<br>on the sales table by department.</p>
<p>106<br>00:04:44,500 –&gt; 00:04:46,500<br>You would write in this weird vertical way</p>
<p>107<br>00:04:46,500 –&gt; 00:04:48,420<br>with characters that you wouldn’t have on the keyboard,</p>
<p>108<br>00:04:48,420 –&gt; 00:04:49,580<br>even today.</p>
<p>109<br>00:04:49,580 –&gt; 00:04:51,660<br>So no one actually ever did this.</p>
<p>110<br>00:04:51,660 –&gt; 00:04:54,900<br>So then IBM threw that away and they started</p>
<p>111<br>00:04:54,900 –&gt; 00:05:00,300<br>building a new query language called SQL, spelled S-E-Q-E-L,</p>
<p>112<br>00:05:00,300 –&gt; 00:05:02,379<br>for the system R project, which is a system</p>
<p>113<br>00:05:02,379 –&gt; 00:05:03,980<br>we’ll talk about throughout the semester.</p>
<p>114<br>00:05:03,980 –&gt; 00:05:06,259<br>But this was the second relational database system</p>
<p>115<br>00:05:06,259 –&gt; 00:05:09,780<br>that IBM started building to try to show that Ted Cobb’s work</p>
<p>116<br>00:05:09,780 –&gt; 00:05:10,660<br>could actually done.</p>
<p>117<br>00:05:10,900 –&gt; 00:05:12,580<br>The Peter Lee one, that was in the UK,</p>
<p>118<br>00:05:12,580 –&gt; 00:05:13,620<br>that was a small team.</p>
<p>119<br>00:05:13,620 –&gt; 00:05:17,620<br>The system R project was in San Jose at IBM Research</p>
<p>120<br>00:05:17,620 –&gt; 00:05:19,500<br>and that was a major, major undertaking.</p>
<p>121<br>00:05:20,580 –&gt; 00:05:22,940<br>So they defined SQL back in 1972.</p>
<p>122<br>00:05:22,940 –&gt; 00:05:25,940<br>This was Don Chamberlain and Voice.</p>
<p>123<br>00:05:25,940 –&gt; 00:05:27,140<br>They work in this query language.</p>
<p>124<br>00:05:28,180 –&gt; 00:05:31,860<br>And the idea was to be the structured English query language.</p>
<p>125<br>00:05:31,860 –&gt; 00:05:35,340<br>But in the 1980s, when IBM put out a commercial</p>
<p>126<br>00:05:35,340 –&gt; 00:05:38,700<br>relational database system, they got sued for the term SQL,</p>
<p>127<br>00:05:38,700 –&gt; 00:05:39,940<br>like the name SQL.</p>
<p>128<br>00:05:40,300 –&gt; 00:05:43,019<br>There was some other system, or some other piece of software</p>
<p>129<br>00:05:43,019 –&gt; 00:05:43,899<br>that was using it.</p>
<p>130<br>00:05:43,899 –&gt; 00:05:48,500<br>So then they just reverted it back to SQL,</p>
<p>131<br>00:05:48,500 –&gt; 00:05:50,980<br>just the letters, the structured query language.</p>
<p>132<br>00:05:52,699 –&gt; 00:05:56,060<br>There was another very famous project at the same time</p>
<p>133<br>00:05:56,060 –&gt; 00:05:59,699<br>at a Berkeley in the 1970s when system R was getting started</p>
<p>134<br>00:05:59,699 –&gt; 00:06:00,980<br>called Ingress.</p>
<p>135<br>00:06:00,980 –&gt; 00:06:02,339<br>Who here has heard of Ingress?</p>
<p>136<br>00:06:03,860 –&gt; 00:06:04,779<br>Nobody.</p>
<p>137<br>00:06:04,779 –&gt; 00:06:06,139<br>Who here has heard of Postgres?</p>
<p>138<br>00:06:07,300 –&gt; 00:06:08,980<br>Everyone know why Postgres is called Postgres</p>
<p>139<br>00:06:08,980 –&gt; 00:06:10,860<br>because it’s Post-Ingress.</p>
<p>140<br>00:06:10,860 –&gt; 00:06:13,740<br>The guy that built Stonebreak, when he built Ingress,</p>
<p>141<br>00:06:13,740 –&gt; 00:06:16,379<br>he commercialized it in the late 1970s</p>
<p>142<br>00:06:16,379 –&gt; 00:06:18,060<br>and then went back to Berkeley in 1980s</p>
<p>143<br>00:06:18,060 –&gt; 00:06:21,259<br>to build their new system that was supposed to be Post-Ingress.</p>
<p>144<br>00:06:21,259 –&gt; 00:06:22,540<br>That’s why it’s called Postgres.</p>
<p>145<br>00:06:23,620 –&gt; 00:06:25,700<br>So they Postgres, sorry Ingress,</p>
<p>146<br>00:06:25,700 –&gt; 00:06:28,700<br>had this other query language called Quail.</p>
<p>147<br>00:06:28,700 –&gt; 00:06:30,500<br>And so SQL, the plan in the words,</p>
<p>148<br>00:06:30,500 –&gt; 00:06:33,100<br>is that it’s supposed to be the SQL to Quail.</p>
<p>149<br>00:06:33,100 –&gt; 00:06:35,060<br>Because the IBM guys knew up with the Berkeley people</p>
<p>150<br>00:06:35,060 –&gt; 00:06:37,540<br>were doing and they were trying to build a better query language.</p>
<p>151<br>00:06:37,540 –&gt; 00:06:40,260<br>Stonebreak would argue that Quail is better,</p>
<p>152<br>00:06:40,260 –&gt; 00:06:42,540<br>but of course no one uses that today.</p>
<p>153<br>00:06:42,540 –&gt; 00:06:44,860<br>IBM released a couple of,</p>
<p>154<br>00:06:44,860 –&gt; 00:06:49,540<br>in the 1970s IBM was making a lot of money off of IMS,</p>
<p>155<br>00:06:49,540 –&gt; 00:06:51,100<br>which is a non-relational system,</p>
<p>156<br>00:06:51,100 –&gt; 00:06:52,340<br>not didn’t support SQL.</p>
<p>157<br>00:06:52,340 –&gt; 00:06:54,980<br>And then they realized that SQL was gonna go somewhere,</p>
<p>158<br>00:06:54,980 –&gt; 00:06:56,340<br>a relational data, so we’re gonna go somewhere.</p>
<p>159<br>00:06:56,340 –&gt; 00:06:57,900<br>So they released a much early prototypes,</p>
<p>160<br>00:06:57,900 –&gt; 00:07:00,780<br>like System 38, SQL DS.</p>
<p>161<br>00:07:00,780 –&gt; 00:07:04,340<br>But the big one that really took off was DB2,</p>
<p>162<br>00:07:04,340 –&gt; 00:07:05,660<br>which is still around today.</p>
<p>163<br>00:07:06,620 –&gt; 00:07:09,340<br>Again, IBM was the big juggernaut in the computing world.</p>
<p>164<br>00:07:09,340 –&gt; 00:07:11,540<br>So whatever IBM said they were gonna do,</p>
<p>165<br>00:07:11,540 –&gt; 00:07:13,700<br>that sort of became the de facto standard.</p>
<p>166<br>00:07:13,700 –&gt; 00:07:15,540<br>So when IBM came out with a relational database</p>
<p>167<br>00:07:15,540 –&gt; 00:07:16,780<br>that supported SQL,</p>
<p>168<br>00:07:16,780 –&gt; 00:07:19,100<br>even though they were competing languages like Quail,</p>
<p>169<br>00:07:19,100 –&gt; 00:07:22,940<br>everyone coalesced around SQL.</p>
<p>170<br>00:07:24,500 –&gt; 00:07:27,060<br>So SQL became a standard in an anti-standard,</p>
<p>171<br>00:07:27,060 –&gt; 00:07:29,860<br>it was an American standard’s body in 1986,</p>
<p>172<br>00:07:29,860 –&gt; 00:07:33,060<br>and then it became a international standard in 1987.</p>
<p>173<br>00:07:33,939 –&gt; 00:07:38,939<br>And so even though it’s a 56 year old language now,</p>
<p>174<br>00:07:39,180 –&gt; 00:07:41,699<br>it has evolved and expanded over time.</p>
<p>175<br>00:07:41,699 –&gt; 00:07:43,699<br>So the latest version of the SQL standard</p>
<p>176<br>00:07:43,699 –&gt; 00:07:46,180<br>actually came out in March this year in 2023.</p>
<p>177<br>00:07:47,220 –&gt; 00:07:48,180<br>And you see sort of lists here,</p>
<p>178<br>00:07:48,180 –&gt; 00:07:49,699<br>the history of all the updates,</p>
<p>179<br>00:07:49,699 –&gt; 00:07:52,060<br>the various features they’ve added over time.</p>
<p>180<br>00:07:52,060 –&gt; 00:07:55,259<br>And the main takeaway from this listing here is that,</p>
<p>181<br>00:07:57,060 –&gt; 00:07:59,060<br>as programs evolve, applications evolve,</p>
<p>182<br>00:07:59,060 –&gt; 00:08:02,459<br>or the trends in development, software development has evolved,</p>
<p>183<br>00:08:02,459 –&gt; 00:08:06,579<br>SQL has moved along with it and adopted the ideas</p>
<p>184<br>00:08:06,579 –&gt; 00:08:08,939<br>and adopted new capabilities.</p>
<p>185<br>00:08:08,939 –&gt; 00:08:12,299<br>So in 2023, the big two features that have come out</p>
<p>186<br>00:08:12,299 –&gt; 00:08:16,740<br>is now you can do property graph queries directly in SQL.</p>
<p>187<br>00:08:16,740 –&gt; 00:08:19,459<br>So so many brought up Neo4j last class,</p>
<p>188<br>00:08:19,459 –&gt; 00:08:24,219<br>that’s a special purpose graph data model database system.</p>
<p>189<br>00:08:24,219 –&gt; 00:08:25,379<br>But now you don’t need that anymore,</p>
<p>190<br>00:08:25,379 –&gt; 00:08:28,259<br>because now you can run graph queries directly in SQL,</p>
<p>191<br>00:08:28,259 –&gt; 00:08:30,219<br>because the SQL standard supports it.</p>
<p>192<br>00:08:30,220 –&gt; 00:08:33,259<br>You also add a support for multi-dimensional arrays.</p>
<p>193<br>00:08:33,259 –&gt; 00:08:35,340<br>So I said before that a lot of machine learning stuff</p>
<p>194<br>00:08:35,340 –&gt; 00:08:37,460<br>is based on arrays or matrices.</p>
<p>195<br>00:08:37,460 –&gt; 00:08:40,220<br>Now you can operate directly on SQL, these things.</p>
<p>196<br>00:08:40,220 –&gt; 00:08:42,500<br>Now just because the standard has defined it doesn’t mean</p>
<p>197<br>00:08:42,500 –&gt; 00:08:44,899<br>every system is going to support it, right?</p>
<p>198<br>00:08:44,899 –&gt; 00:08:47,220<br>I don’t think any system really supports</p>
<p>199<br>00:08:47,220 –&gt; 00:08:49,580<br>the multi-dimensional array stuff.</p>
<p>200<br>00:08:49,580 –&gt; 00:08:51,180<br>But Oracle supports the property graph stuff,</p>
<p>201<br>00:08:51,180 –&gt; 00:08:52,460<br>post-gressal eventually if there are ducty-b,</p>
<p>202<br>00:08:52,460 –&gt; 00:08:54,540<br>ducty-b has a prototype for it.</p>
<p>203<br>00:08:54,540 –&gt; 00:08:56,460<br>But because it’s in the standard,</p>
<p>204<br>00:08:56,460 –&gt; 00:08:59,180<br>not everyone’s going to actually be able to support it.</p>
<p>205<br>00:08:59,179 –&gt; 00:09:00,859<br>So I would say in my opinion,</p>
<p>206<br>00:09:00,859 –&gt; 00:09:03,259<br>the minimum support you need for SQL</p>
<p>207<br>00:09:03,259 –&gt; 00:09:05,139<br>to say that your database support SQL</p>
<p>208<br>00:09:05,139 –&gt; 00:09:07,899<br>is defined in the SQL 92 standard, right?</p>
<p>209<br>00:09:07,899 –&gt; 00:09:10,620<br>That’s like select, insert, update, delete, create tables.</p>
<p>210<br>00:09:10,620 –&gt; 00:09:13,259<br>That’s the basic functionality.</p>
<p>211<br>00:09:13,259 –&gt; 00:09:15,339<br>So again, even though SQL is over 50 years old,</p>
<p>212<br>00:09:15,339 –&gt; 00:09:18,339<br>it’s not a dead language and those updates all the time.</p>
<p>213<br>00:09:18,339 –&gt; 00:09:20,739<br>And of course every 10 years or every five years,</p>
<p>214<br>00:09:20,739 –&gt; 00:09:23,179<br>some new technology comes out and people say</p>
<p>215<br>00:09:23,179 –&gt; 00:09:27,179<br>that SQL is dead and it’s about to be replaced.</p>
<p>216<br>00:09:27,179 –&gt; 00:09:28,939<br>10 years ago it was no SQL.</p>
<p>217<br>00:09:28,940 –&gt; 00:09:33,060<br>And the hot thing now is chat GBT or vector databases.</p>
<p>218<br>00:09:33,060 –&gt; 00:09:35,180<br>So you see a lot of these kind of things on Twitter</p>
<p>219<br>00:09:35,180 –&gt; 00:09:38,500<br>or social media where they claim SQL is going to die</p>
<p>220<br>00:09:38,500 –&gt; 00:09:40,700<br>because chat GBT is going to replace it</p>
<p>221<br>00:09:40,700 –&gt; 00:09:42,860<br>or natural language is going to replace it, right?</p>
<p>222<br>00:09:42,860 –&gt; 00:09:45,860<br>This is all a bunch of hype.</p>
<p>223<br>00:09:45,860 –&gt; 00:09:48,260<br>It’s interesting, but it’s not going to replace SQL.</p>
<p>224<br>00:09:48,260 –&gt; 00:09:50,060<br>Like SQL was here before you were born,</p>
<p>225<br>00:09:50,060 –&gt; 00:09:52,140<br>and SQL be here when you die, OK?</p>
<p>226<br>00:09:52,140 –&gt; 00:09:57,300<br>And I’ve made public statements to basically about this.</p>
<p>227<br>00:09:57,299 –&gt; 00:10:01,299<br>So there’s an article they quoted me in last year</p>
<p>228<br>00:10:01,299 –&gt; 00:10:03,379<br>and some magazines and something.</p>
<p>229<br>00:10:03,379 –&gt; 00:10:04,819<br>I basically said, you need to know SQL</p>
<p>230<br>00:10:04,819 –&gt; 00:10:07,740<br>if you want to do anything in computer science.</p>
<p>231<br>00:10:07,740 –&gt; 00:10:09,579<br>All right.</p>
<p>232<br>00:10:09,579 –&gt; 00:10:12,620<br>So in a relational language like SQL,</p>
<p>233<br>00:10:12,620 –&gt; 00:10:15,019<br>it’s going to have sort of three parts.</p>
<p>234<br>00:10:15,019 –&gt; 00:10:17,979<br>There’s going to be the DML, the data manipulation language.</p>
<p>235<br>00:10:17,979 –&gt; 00:10:20,179<br>That’s how we’re going to, that’s</p>
<p>236<br>00:10:20,179 –&gt; 00:10:21,620<br>our select, insert, update, delete queries</p>
<p>237<br>00:10:21,620 –&gt; 00:10:23,620<br>that interact within our database.</p>
<p>238<br>00:10:23,620 –&gt; 00:10:25,539<br>The D to L, the data definition language.</p>
<p>239<br>00:10:25,539 –&gt; 00:10:27,779<br>That’s the create table statements, the create views,</p>
<p>240<br>00:10:27,779 –&gt; 00:10:32,019<br>to create the entities, the objects in our database.</p>
<p>241<br>00:10:32,019 –&gt; 00:10:33,139<br>And then they’ll be, we’re not really</p>
<p>242<br>00:10:33,139 –&gt; 00:10:35,299<br>going to cover this, but they’ll be the DCL, the data control</p>
<p>243<br>00:10:35,299 –&gt; 00:10:35,980<br>language.</p>
<p>244<br>00:10:35,980 –&gt; 00:10:38,419<br>That’s for like security and access control.</p>
<p>245<br>00:10:38,419 –&gt; 00:10:40,579<br>Some systems allow you have like, you</p>
<p>246<br>00:10:40,579 –&gt; 00:10:43,019<br>can specify what users are allowed to see what rows</p>
<p>247<br>00:10:43,019 –&gt; 00:10:44,860<br>or what columns or what tables and so forth.</p>
<p>248<br>00:10:44,860 –&gt; 00:10:48,339<br>I said the SQL standards specifies for these things.</p>
<p>249<br>00:10:48,339 –&gt; 00:10:50,500<br>Another big thing we’ll see later in the semester</p>
<p>250<br>00:10:50,500 –&gt; 00:10:52,980<br>is definition of transactions.</p>
<p>251<br>00:10:52,980 –&gt; 00:10:55,019<br>How do you define a bunch of SQL statements</p>
<p>252<br>00:10:55,179 –&gt; 00:10:58,419<br>you want to happen automatically in an isolated way?</p>
<p>253<br>00:10:58,419 –&gt; 00:11:00,939<br>And again, the SQL standards supports this.</p>
<p>254<br>00:11:00,939 –&gt; 00:11:02,579<br>So again, we’ll see bits and pieces of this</p>
<p>255<br>00:11:02,579 –&gt; 00:11:03,779<br>as we go without the semester.</p>
<p>256<br>00:11:03,779 –&gt; 00:11:05,699<br>But for today’s lecture, we’re really</p>
<p>257<br>00:11:05,699 –&gt; 00:11:08,579<br>going to focus on the first one, the DML.</p>
<p>258<br>00:11:08,579 –&gt; 00:11:11,860<br>And in reminder from picking up where we were all left,</p>
<p>259<br>00:11:11,860 –&gt; 00:11:14,939<br>we talked about last class, SQL is going to be based on bags,</p>
<p>260<br>00:11:14,939 –&gt; 00:11:18,139<br>meaning there could be duplicates, whereas</p>
<p>261<br>00:11:18,139 –&gt; 00:11:20,340<br>relational algebra was based on sets.</p>
<p>262<br>00:11:20,340 –&gt; 00:11:22,220<br>And we see some cases where we’ll have</p>
<p>263<br>00:11:22,220 –&gt; 00:11:28,660<br>to add extra stuff in our SQL statements to deal with that.</p>
<p>264<br>00:11:28,660 –&gt; 00:11:31,580<br>So today again, it’s just to be a crash course on modern SQL.</p>
<p>265<br>00:11:31,580 –&gt; 00:11:34,300<br>I’m assuming everyone, whether or not you know it or not,</p>
<p>266<br>00:11:34,300 –&gt; 00:11:37,139<br>you know enough from the SQL 92 standard, right?</p>
<p>267<br>00:11:37,139 –&gt; 00:11:38,779<br>Select insert update leads.</p>
<p>268<br>00:11:38,779 –&gt; 00:11:43,820<br>And I want to talk about the more sophisticated things</p>
<p>269<br>00:11:43,820 –&gt; 00:11:46,060<br>you can do with them.</p>
<p>270<br>00:11:46,060 –&gt; 00:11:48,100<br>But the overarching theme also will be</p>
<p>271<br>00:11:48,100 –&gt; 00:11:49,820<br>is that we will open up the terminal,</p>
<p>272<br>00:11:49,820 –&gt; 00:11:52,500<br>we’ll try a bunch of these queries in different database systems.</p>
<p>273<br>00:11:52,500 –&gt; 00:11:55,420<br>And we will see that even though there is a SQL standard,</p>
<p>274<br>00:11:55,420 –&gt; 00:11:58,340<br>there is an internationally recognized document that says,</p>
<p>275<br>00:11:58,340 –&gt; 00:12:00,420<br>here’s what SQL should look like.</p>
<p>276<br>00:12:00,420 –&gt; 00:12:03,540<br>Nobody implements it exactly that way, right?</p>
<p>277<br>00:12:03,540 –&gt; 00:12:05,540<br>Everyone’s going to have these weird nuances and quirks,</p>
<p>278<br>00:12:05,540 –&gt; 00:12:08,180<br>whether they have different features or different nomenclature</p>
<p>279<br>00:12:08,180 –&gt; 00:12:10,900<br>or syntax to do certain things.</p>
<p>280<br>00:12:10,900 –&gt; 00:12:12,660<br>And in some cases, different semantics</p>
<p>281<br>00:12:12,660 –&gt; 00:12:16,660<br>of different operations, where even though there’s a SQL standard,</p>
<p>282<br>00:12:16,660 –&gt; 00:12:19,780<br>it’s going to be different form one system to the next.</p>
<p>283<br>00:12:19,779 –&gt; 00:12:24,179<br>Who do you think is the biggest offender for the worst SQL implementation?</p>
<p>284<br>00:12:24,179 –&gt; 00:12:25,100<br>Worst is not the right word.</p>
<p>285<br>00:12:25,100 –&gt; 00:12:28,939<br>But the one that deviates from the standard the most.</p>
<p>286<br>00:12:28,939 –&gt; 00:12:31,860<br>Let me take a guess.</p>
<p>287<br>00:12:31,860 –&gt; 00:12:34,699<br>All right, to top four out of the, yes, in the back, yes.</p>
<p>288<br>00:12:34,699 –&gt; 00:12:35,899<br>My SQL, he got it right, yes.</p>
<p>289<br>00:12:35,899 –&gt; 00:12:39,019<br>My SQL is going to be the **** out of all these,</p>
<p>290<br>00:12:39,019 –&gt; 00:12:41,539<br>where they’re going to do all sorts of weird ****.</p>
<p>291<br>00:12:41,539 –&gt; 00:12:44,819<br>More recently, they now have a flag where you can make it be more strict</p>
<p>292<br>00:12:44,819 –&gt; 00:12:48,299<br>and try to be more closer to the SQL standard.</p>
<p>293<br>00:12:48,299 –&gt; 00:12:50,339<br>But for the longest time, they do a bunch of weird things.</p>
<p>294<br>00:12:50,339 –&gt; 00:12:53,179<br>And my problem is that I first started using the 80 basis,</p>
<p>295<br>00:12:53,179 –&gt; 00:12:56,099<br>or relational basis, when I was in high school in the 90s,</p>
<p>296<br>00:12:56,099 –&gt; 00:12:57,779<br>and we were using my SQL 3.</p>
<p>297<br>00:12:57,779 –&gt; 00:13:00,939<br>So I have all these bad habits that I picked up from my SQL.</p>
<p>298<br>00:13:00,939 –&gt; 00:13:02,419<br>And I’m like, oh, yeah, this is what SQL is.</p>
<p>299<br>00:13:02,419 –&gt; 00:13:04,459<br>Then you realize when you start playing other systems,</p>
<p>300<br>00:13:04,459 –&gt; 00:13:05,819<br>like, this is **** crazy.</p>
<p>301<br>00:13:05,819 –&gt; 00:13:07,779<br>They’re doing some weird stuff.</p>
<p>302<br>00:13:07,779 –&gt; 00:13:08,939<br>But it’s gotten better.</p>
<p>303<br>00:13:08,939 –&gt; 00:13:12,019<br>And my SQL 8 has certainly improved a lot.</p>
<p>304<br>00:13:12,019 –&gt; 00:13:14,379<br>All right, so we’ll go through all of these aggregations,</p>
<p>305<br>00:13:14,379 –&gt; 00:13:17,059<br>group eyes, the string date time operations.</p>
<p>306<br>00:13:17,059 –&gt; 00:13:19,099<br>That’s going to be the one where we see all the problems.</p>
<p>307<br>00:13:19,099 –&gt; 00:13:20,379<br>And then a bunch of other different ways</p>
<p>308<br>00:13:20,379 –&gt; 00:13:22,939<br>to interact with SQL queries.</p>
<p>309<br>00:13:22,939 –&gt; 00:13:25,059<br>And then another theme about what we’ll talk about</p>
<p>310<br>00:13:25,059 –&gt; 00:13:28,059<br>is the goal of writing SQL statement oftentimes</p>
<p>311<br>00:13:28,059 –&gt; 00:13:32,099<br>is to try to do all the computation on the database server</p>
<p>312<br>00:13:32,099 –&gt; 00:13:35,699<br>itself within one overarching SQL query.</p>
<p>313<br>00:13:35,699 –&gt; 00:13:37,459<br>I mean, we don’t want to have to do a select,</p>
<p>314<br>00:13:37,459 –&gt; 00:13:39,899<br>get some data back into a Python program or something,</p>
<p>315<br>00:13:39,899 –&gt; 00:13:42,939<br>then operate on it, and then push it back and do more queries.</p>
<p>316<br>00:13:42,939 –&gt; 00:13:46,899<br>We want to try to do everything we can on the server side.</p>
<p>317<br>00:13:46,899 –&gt; 00:13:48,579<br>That’s the database system because we</p>
<p>318<br>00:13:48,579 –&gt; 00:13:50,379<br>want to be able to push the query to the data,</p>
<p>319<br>00:13:50,379 –&gt; 00:13:54,019<br>not pull the data to the query.</p>
<p>320<br>00:13:54,019 –&gt; 00:13:57,620<br>Again, this makes more sense as we go along.</p>
<p>321<br>00:13:57,620 –&gt; 00:14:01,419<br>So for today, we’re using a simple example database like this.</p>
<p>322<br>00:14:01,419 –&gt; 00:14:04,579<br>It has three tables, student enrolled in course.</p>
<p>323<br>00:14:04,579 –&gt; 00:14:06,939<br>It’s basically trying to mimic a university.</p>
<p>324<br>00:14:06,939 –&gt; 00:14:10,379<br>There are students that take classes and they’re enrolled</p>
<p>325<br>00:14:10,379 –&gt; 00:14:13,379<br>and they get grades in the various courses that are there.</p>
<p>326<br>00:14:13,379 –&gt; 00:14:18,580<br>So we’ll use this as the sample database as we go along.</p>
<p>327<br>00:14:18,580 –&gt; 00:14:20,259<br>First things, aggregations.</p>
<p>328<br>00:14:20,259 –&gt; 00:14:26,939<br>So aggregate functions are a way to compute some mathematical</p>
<p>329<br>00:14:26,939 –&gt; 00:14:32,019<br>computation on a sequence of data or a bag of tuples.</p>
<p>330<br>00:14:32,019 –&gt; 00:14:33,899<br>And you’re basically going to call us it down</p>
<p>331<br>00:14:33,899 –&gt; 00:14:35,580<br>into a single value.</p>
<p>332<br>00:14:35,580 –&gt; 00:14:41,580<br>So the classic things would be average min max some account.</p>
<p>333<br>00:14:41,580 –&gt; 00:14:46,180<br>And you’re trying to compute the min value of a column</p>
<p>334<br>00:14:46,180 –&gt; 00:14:50,620<br>across all tuples within a relation.</p>
<p>335<br>00:14:50,620 –&gt; 00:14:51,740<br>So a next simple example like this is</p>
<p>336<br>00:14:51,740 –&gt; 00:14:53,580<br>say we want to get off for the students.</p>
<p>337<br>00:14:53,580 –&gt; 00:14:55,940<br>We want to count the number of students</p>
<p>338<br>00:14:55,940 –&gt; 00:15:01,100<br>who have a login where the login ends with atcs.</p>
<p>339<br>00:15:01,100 –&gt; 00:15:04,020<br>Like you have an atcs email address.</p>
<p>340<br>00:15:04,020 –&gt; 00:15:07,460<br>And so we just put the account function here.</p>
<p>341<br>00:15:07,460 –&gt; 00:15:09,500<br>And then the inside of it actually doesn’t matter for account.</p>
<p>342<br>00:15:09,659 –&gt; 00:15:11,700<br>We’re just going to count the logins.</p>
<p>343<br>00:15:11,700 –&gt; 00:15:13,220<br>And then we have a where call specifying</p>
<p>344<br>00:15:13,220 –&gt; 00:15:17,019<br>when or what tuples should qualify.</p>
<p>345<br>00:15:17,019 –&gt; 00:15:19,460<br>So again, my example here I’m putting login.</p>
<p>346<br>00:15:19,460 –&gt; 00:15:20,700<br>You don’t actually have to do that.</p>
<p>347<br>00:15:20,700 –&gt; 00:15:22,659<br>You could put a star.</p>
<p>348<br>00:15:22,659 –&gt; 00:15:23,820<br>That’s equivalent.</p>
<p>349<br>00:15:23,820 –&gt; 00:15:26,940<br>Because again, it’s just counting the number of entries.</p>
<p>350<br>00:15:26,940 –&gt; 00:15:28,460<br>You can actually put one.</p>
<p>351<br>00:15:28,460 –&gt; 00:15:29,940<br>Again, also equivalent.</p>
<p>352<br>00:15:29,940 –&gt; 00:15:31,460<br>It doesn’t matter.</p>
<p>353<br>00:15:31,460 –&gt; 00:15:32,940<br>Inside you can really put anything.</p>
<p>354<br>00:15:32,940 –&gt; 00:15:35,220<br>You can put one plus one plus one.</p>
<p>355<br>00:15:35,220 –&gt; 00:15:37,299<br>And the deity system should be smart up to realize that,</p>
<p>356<br>00:15:37,819 –&gt; 00:15:40,379<br>in this last example here, I don’t</p>
<p>357<br>00:15:40,379 –&gt; 00:15:42,779<br>care what the expression is inside of the account.</p>
<p>358<br>00:15:42,779 –&gt; 00:15:44,379<br>And I won’t actually do that math.</p>
<p>359<br>00:15:44,379 –&gt; 00:15:49,500<br>Because I didn’t care about what’s the count tuples that I have.</p>
<p>360<br>00:15:49,500 –&gt; 00:15:52,099<br>You can have multiple aggregates in a single select output.</p>
<p>361<br>00:15:52,099 –&gt; 00:15:55,019<br>So here now we’re going to compute the average GPA</p>
<p>362<br>00:15:55,019 –&gt; 00:15:58,339<br>and the counting the number of students.</p>
<p>363<br>00:15:58,339 –&gt; 00:16:03,099<br>Again, that have the atcs login.</p>
<p>364<br>00:16:03,099 –&gt; 00:16:06,539<br>And you would get back a single entry or single record</p>
<p>365<br>00:16:06,539 –&gt; 00:16:10,059<br>in the output result for the two computations.</p>
<p>366<br>00:16:13,179 –&gt; 00:16:14,139<br>Poor thing don’t stand though.</p>
<p>367<br>00:16:14,139 –&gt; 00:16:17,299<br>With aggregations, since you’re trying to coalesce down</p>
<p>368<br>00:16:17,299 –&gt; 00:16:21,539<br>a multiple tuples to a single scalar value,</p>
<p>369<br>00:16:21,539 –&gt; 00:16:25,819<br>you can’t reference anything in the select output</p>
<p>370<br>00:16:25,819 –&gt; 00:16:29,099<br>that isn’t part of the aggregate.</p>
<p>371<br>00:16:29,099 –&gt; 00:16:30,179<br>So I can’t do something like this.</p>
<p>372<br>00:16:30,179 –&gt; 00:16:34,019<br>I can’t go select the average GPA after you join the student</p>
<p>373<br>00:16:34,019 –&gt; 00:16:36,059<br>table, the enroll table, and then also</p>
<p>374<br>00:16:36,059 –&gt; 00:16:42,659<br>spit out the course ID of the enroll table.</p>
<p>375<br>00:16:42,659 –&gt; 00:16:43,579<br>Because this is not defined.</p>
<p>376<br>00:16:43,579 –&gt; 00:16:46,419<br>This doesn’t make any sense.</p>
<p>377<br>00:16:46,419 –&gt; 00:16:49,619<br>There isn’t, again, you’re taking multiple rows,</p>
<p>378<br>00:16:49,619 –&gt; 00:16:51,859<br>you’re can nesting it down, closing it down,</p>
<p>379<br>00:16:51,859 –&gt; 00:16:54,019<br>collapsing it down for the average.</p>
<p>380<br>00:16:54,019 –&gt; 00:16:57,299<br>What is the course ID in this context?</p>
<p>381<br>00:16:57,299 –&gt; 00:16:59,019<br>It’s nothing.</p>
<p>382<br>00:16:59,019 –&gt; 00:17:02,059<br>So in this case here, what you sort of look at this,</p>
<p>383<br>00:17:02,059 –&gt; 00:17:03,419<br>what you’re really trying to do is you’re</p>
<p>384<br>00:17:03,419 –&gt; 00:17:08,059<br>trying to get for each course ID get the average GPA.</p>
<p>385<br>00:17:08,059 –&gt; 00:17:09,539<br>So what you need to do is use this what</p>
<p>386<br>00:17:09,539 –&gt; 00:17:12,059<br>is called a group-wide clause, where you’re</p>
<p>387<br>00:17:12,059 –&gt; 00:17:16,259<br>going to project tuples into buckets based on whatever</p>
<p>388<br>00:17:16,259 –&gt; 00:17:18,940<br>the parameters are in the group-wide clause,</p>
<p>389<br>00:17:18,940 –&gt; 00:17:23,220<br>and then compute the aggregate on each individual bucket.</p>
<p>390<br>00:17:23,220 –&gt; 00:17:24,139<br>So you sort of think it like this.</p>
<p>391<br>00:17:24,139 –&gt; 00:17:27,700<br>If I first do the join between the enroll table</p>
<p>392<br>00:17:27,700 –&gt; 00:17:31,379<br>and the student table, I have all possible combinations</p>
<p>393<br>00:17:31,379 –&gt; 00:17:32,779<br>based on the join.</p>
<p>394<br>00:17:32,779 –&gt; 00:17:35,339<br>And then now I’m going to split them up based on the course</p>
<p>395<br>00:17:35,339 –&gt; 00:17:39,579<br>ID, because that’s what I have in my group-wide clause.</p>
<p>396<br>00:17:39,579 –&gt; 00:17:43,299<br>And then now I compute the average for the GPA</p>
<p>397<br>00:17:43,299 –&gt; 00:17:46,940<br>for each of those buckets.</p>
<p>398<br>00:17:46,940 –&gt; 00:17:47,420<br>Does that sense?</p>
<p>399<br>00:17:50,899 –&gt; 00:17:53,700<br>And this matches up like this.</p>
<p>400<br>00:17:53,700 –&gt; 00:17:55,059<br>So again, the main takeaway this game,</p>
<p>401<br>00:17:55,059 –&gt; 00:17:58,899<br>you have to have anything that’s in a,</p>
<p>402<br>00:17:58,899 –&gt; 00:18:01,259<br>anything that’s not part of an aggregation</p>
<p>403<br>00:18:01,259 –&gt; 00:18:03,140<br>has to appear in the group-wide clause.</p>
<p>404<br>00:18:03,140 –&gt; 00:18:05,579<br>So again, in this case here, I don’t have the student name.</p>
<p>405<br>00:18:05,579 –&gt; 00:18:07,379<br>I can’t put that there.</p>
<p>406<br>00:18:07,379 –&gt; 00:18:10,500<br>I’d have to put it in the group-wide clause.</p>
<p>407<br>00:18:10,500 –&gt; 00:18:11,700<br>We can open the terminal if you want.</p>
<p>408<br>00:18:11,700 –&gt; 00:18:13,740<br>My SQL used to let you do this in some cases.</p>
<p>409<br>00:18:16,700 –&gt; 00:18:20,940<br>Or we can actually list this, try this, if it happens.</p>
<p>410<br>00:18:20,940 –&gt; 00:18:23,779<br>I hate typing on my surface.</p>
<p>411<br>00:18:23,779 –&gt; 00:18:25,980<br>I’m going to use this laptop here.</p>
<p>412<br>00:18:25,980 –&gt; 00:18:26,579<br>I’ll log into it.</p>
<p>413<br>00:18:32,259 –&gt; 00:18:35,579<br>All right, so we want to do this.</p>
<p>414<br>00:18:35,579 –&gt; 00:18:37,299<br>Sorry, I have Postgres.</p>
<p>415<br>00:18:37,299 –&gt; 00:18:39,019<br>I have a bunch of data sets of running.</p>
<p>416<br>00:18:39,019 –&gt; 00:18:41,140<br>So the query we were trying to do was,</p>
<p>417<br>00:18:45,900 –&gt; 00:18:51,140<br>essentially this, select average GPA, course ID from a rule,</p>
<p>418<br>00:18:51,140 –&gt; 00:18:53,980<br>joining a rule table and student name.</p>
<p>419<br>00:18:53,980 –&gt; 00:18:55,299<br>So Postgres doesn’t let you do this,</p>
<p>420<br>00:18:55,299 –&gt; 00:18:58,700<br>because it says the course ID has appear in the group-wide clause.</p>
<p>421<br>00:18:58,700 –&gt; 00:18:59,379<br>That’s good.</p>
<p>422<br>00:18:59,379 –&gt; 00:19:01,059<br>That’s what we expect.</p>
<p>423<br>00:19:01,059 –&gt; 00:19:03,779<br>Let’s go over to my SQL.</p>
<p>424<br>00:19:03,779 –&gt; 00:19:06,299<br>My SQL doesn’t let you do it.</p>
<p>425<br>00:19:06,299 –&gt; 00:19:09,259<br>But let me see if I put it in the right mode by default.</p>
<p>426<br>00:19:12,619 –&gt; 00:19:19,579<br>But there’s a way to, it’s enforcing the what mode it sends.</p>
<p>427<br>00:19:19,579 –&gt; 00:19:24,779<br>If I go to traditional, then now from the same query,</p>
<p>428<br>00:19:24,779 –&gt; 00:19:26,460<br>it lets me do it.</p>
<p>429<br>00:19:26,460 –&gt; 00:19:29,539<br>And it spits out course ID 15445.</p>
<p>430<br>00:19:29,539 –&gt; 00:19:32,579<br>Is that correct?</p>
<p>431<br>00:19:32,579 –&gt; 00:19:33,899<br>No, right, because what does that mean?</p>
<p>432<br>00:19:33,899 –&gt; 00:19:35,740<br>It’s the average GPA for all courses,</p>
<p>433<br>00:19:35,740 –&gt; 00:19:37,539<br>but it’s spitting out one of them.</p>
<p>434<br>00:19:37,539 –&gt; 00:19:39,619<br>So that’s bad.</p>
<p>435<br>00:19:39,619 –&gt; 00:19:41,779<br>So let’s go now, take the same query,</p>
<p>436<br>00:19:41,779 –&gt; 00:19:45,259<br>and we’ll go over to SQLite.</p>
<p>437<br>00:19:45,259 –&gt; 00:19:50,220<br>All right, who thinks it’s going to work?</p>
<p>438<br>00:19:50,220 –&gt; 00:19:52,099<br>Raise your hand if you say yes.</p>
<p>439<br>00:19:52,099 –&gt; 00:19:54,379<br>And the man work meaning it’ll actually run the query.</p>
<p>440<br>00:19:54,379 –&gt; 00:19:57,500<br>I’m not saying the result’s correct.</p>
<p>441<br>00:19:57,500 –&gt; 00:19:58,980<br>We have one yes, two yeses.</p>
<p>442<br>00:19:58,980 –&gt; 00:20:01,299<br>Who says no?</p>
<p>443<br>00:20:01,299 –&gt; 00:20:03,579<br>Who says no?</p>
<p>444<br>00:20:03,579 –&gt; 00:20:06,299<br>You did it.</p>
<p>445<br>00:20:06,299 –&gt; 00:20:08,220<br>And I also spit out 15445.</p>
<p>446<br>00:20:08,220 –&gt; 00:20:10,500<br>Is that the same value as my SQL?</p>
<p>447<br>00:20:10,500 –&gt; 00:20:16,180<br>Yeah, GPA looks the same.</p>
<p>448<br>00:20:16,180 –&gt; 00:20:17,339<br>All right, let’s go to Oracle.</p>
<p>449<br>00:20:20,420 –&gt; 00:20:21,700<br>Oracle doesn’t like it.</p>
<p>450<br>00:20:21,700 –&gt; 00:20:22,500<br>It’s got to duck DB.</p>
<p>451<br>00:20:25,339 –&gt; 00:20:26,339<br>Duck DB didn’t like it.</p>
<p>452<br>00:20:26,339 –&gt; 00:20:27,899<br>So my SQL, you can do it.</p>
<p>453<br>00:20:27,899 –&gt; 00:20:31,259<br>If you make it be more like my SQL 5.7.8,</p>
<p>454<br>00:20:31,259 –&gt; 00:20:32,819<br>but SQLite will do it.</p>
<p>455<br>00:20:32,819 –&gt; 00:20:35,659<br>So again, this is the first example.</p>
<p>456<br>00:20:35,659 –&gt; 00:20:37,459<br>We’ll see it many times.</p>
<p>457<br>00:20:37,459 –&gt; 00:20:40,579<br>SQL says one thing, but different systems</p>
<p>458<br>00:20:40,579 –&gt; 00:20:41,339<br>are doing different things.</p>
<p>459<br>00:20:45,099 –&gt; 00:20:46,659<br>All right, next thing you do is you</p>
<p>460<br>00:20:46,659 –&gt; 00:20:47,779<br>have a having clause.</p>
<p>461<br>00:20:47,779 –&gt; 00:20:49,379<br>Like say, if you want to start filtering</p>
<p>462<br>00:20:49,379 –&gt; 00:20:53,819<br>on the aggregate commissary generating,</p>
<p>463<br>00:20:53,819 –&gt; 00:20:57,299<br>you can add a having clause to specify</p>
<p>464<br>00:20:57,299 –&gt; 00:21:00,299<br>whether what two-pool should match</p>
<p>465<br>00:21:00,299 –&gt; 00:21:02,379<br>after you complete the aggregation.</p>
<p>466<br>00:21:02,379 –&gt; 00:21:05,899<br>So say I want to get only the students that</p>
<p>467<br>00:21:05,899 –&gt; 00:21:10,539<br>have an average GPA, that’s greater than 3.9.</p>
<p>468<br>00:21:10,539 –&gt; 00:21:13,339<br>So in this case here, I’m computing the aggregation,</p>
<p>469<br>00:21:13,339 –&gt; 00:21:16,419<br>select average GPA as a standard GPA.</p>
<p>470<br>00:21:16,419 –&gt; 00:21:19,939<br>And I’m trying to reference it here inside of my wear clause.</p>
<p>471<br>00:21:19,939 –&gt; 00:21:22,859<br>I can’t do that because at this point, when the system</p>
<p>472<br>00:21:22,859 –&gt; 00:21:24,899<br>is actually calculating the query,</p>
<p>473<br>00:21:24,899 –&gt; 00:21:27,099<br>it’s computing the aggregation as it goes along.</p>
<p>474<br>00:21:27,099 –&gt; 00:21:30,979<br>It doesn’t know what the final result is.</p>
<p>475<br>00:21:30,979 –&gt; 00:21:34,299<br>So the easy fix for this is to have a having clause, which</p>
<p>476<br>00:21:34,299 –&gt; 00:21:35,859<br>is basically telling the system, OK,</p>
<p>477<br>00:21:35,859 –&gt; 00:21:39,259<br>performative aggregation is produce the output that’s</p>
<p>478<br>00:21:39,259 –&gt; 00:21:41,539<br>defined in the select statement, and then</p>
<p>479<br>00:21:41,539 –&gt; 00:21:43,539<br>apply this additional filter for having.</p>
<p>480<br>00:21:46,500 –&gt; 00:21:48,539<br>This is actually not correct either, in some cases.</p>
<p>481<br>00:21:48,539 –&gt; 00:21:50,859<br>I don’t think the SQL student lets you do this either,</p>
<p>482<br>00:21:50,859 –&gt; 00:21:52,500<br>because even though I have an alias</p>
<p>483<br>00:21:52,500 –&gt; 00:21:56,579<br>appear for average GPA, the data system can say,</p>
<p>484<br>00:21:56,579 –&gt; 00:21:58,819<br>I don’t know what this is.</p>
<p>485<br>00:21:58,819 –&gt; 00:22:01,219<br>My SQL lets you do it.</p>
<p>486<br>00:22:01,219 –&gt; 00:22:02,059<br>Postgres does not.</p>
<p>487<br>00:22:02,059 –&gt; 00:22:05,939<br>So instead, you have to basically write the aggregation</p>
<p>488<br>00:22:05,939 –&gt; 00:22:07,459<br>clause again.</p>
<p>489<br>00:22:07,459 –&gt; 00:22:08,939<br>And again, the data system should be smarter</p>
<p>490<br>00:22:08,939 –&gt; 00:22:11,619<br>if they recognize that this average from the GPA</p>
<p>491<br>00:22:11,619 –&gt; 00:22:13,299<br>is the same as that average GPA up there,</p>
<p>492<br>00:22:13,299 –&gt; 00:22:15,379<br>and therefore compute the same computation.</p>
<p>493<br>00:22:15,379 –&gt; 00:22:17,500<br>Don’t perform the same computation twice.</p>
<p>494<br>00:22:18,019 –&gt; 00:22:20,859<br>So essentially just doing this.</p>
<p>495<br>00:22:20,859 –&gt; 00:22:23,220<br>Again, compute the aggregation and then do the additional</p>
<p>496<br>00:22:23,220 –&gt; 00:22:26,660<br>filter throughout things you don’t.</p>
<p>497<br>00:22:26,660 –&gt; 00:22:29,660<br>Does that sense?</p>
<p>498<br>00:22:29,660 –&gt; 00:22:31,420<br>All right.</p>
<p>499<br>00:22:31,420 –&gt; 00:22:36,220<br>Strings and timestamps are dates are when things get really</p>
<p>500<br>00:22:36,220 –&gt; 00:22:40,539<br>weird, not weird, but really inconsistent.</p>
<p>501<br>00:22:40,539 –&gt; 00:22:46,500<br>So for string data types, the SQL standard specifies</p>
<p>502<br>00:22:46,579 –&gt; 00:22:49,900<br>that the case of the strings within the values,</p>
<p>503<br>00:22:49,900 –&gt; 00:22:51,420<br>that I mean the strings and the select statements,</p>
<p>504<br>00:22:51,420 –&gt; 00:22:53,460<br>I mean like the actual data you’re storing,</p>
<p>505<br>00:22:53,460 –&gt; 00:22:55,460<br>that they should be case sensitive,</p>
<p>506<br>00:22:55,460 –&gt; 00:22:58,700<br>and that when you want to have in your SQL statement</p>
<p>507<br>00:22:58,700 –&gt; 00:23:02,380<br>constant strings, you want to use single quotes.</p>
<p>508<br>00:23:02,380 –&gt; 00:23:05,819<br>Postgres, SQL server, and Oracle follow the standard.</p>
<p>509<br>00:23:05,819 –&gt; 00:23:11,819<br>My SQL is, by default, case insensitive.</p>
<p>510<br>00:23:11,819 –&gt; 00:23:14,859<br>And then they both SQLite and my SQL support,</p>
<p>511<br>00:23:14,859 –&gt; 00:23:18,459<br>but single and double quotation marks</p>
<p>512<br>00:23:18,459 –&gt; 00:23:21,299<br>to represent constants and strings.</p>
<p>513<br>00:23:21,299 –&gt; 00:23:25,299<br>So let’s see what my SQL does and see how weird this is.</p>
<p>514<br>00:23:25,299 –&gt; 00:23:26,339<br>So let’s go back here.</p>
<p>515<br>00:23:30,539 –&gt; 00:23:35,339<br>Right, so you can represent a constant like this.</p>
<p>516<br>00:23:35,339 –&gt; 00:23:39,500<br>Right, so you can have a select statement without a from clause</p>
<p>517<br>00:23:39,500 –&gt; 00:23:42,419<br>in my SQL, right, and I can represent,</p>
<p>518<br>00:23:42,419 –&gt; 00:23:44,219<br>it basically takes whatever the input is,</p>
<p>519<br>00:23:44,220 –&gt; 00:23:45,539<br>and it’ll spit it out.</p>
<p>520<br>00:23:45,539 –&gt; 00:23:52,220<br>So I put a comma, I can do like one, two, three, like that.</p>
<p>521<br>00:23:52,220 –&gt; 00:23:55,299<br>It’ll make columns for all the things in the output.</p>
<p>522<br>00:23:55,299 –&gt; 00:24:00,740<br>So for strings, I can have it as double quotes</p>
<p>523<br>00:24:00,740 –&gt; 00:24:03,299<br>and single quotes.</p>
<p>524<br>00:24:03,299 –&gt; 00:24:06,940<br>In the case of postgres, it won’t let me do double quotes.</p>
<p>525<br>00:24:09,900 –&gt; 00:24:11,860<br>Can’t do that because it’s trying to look for a column name</p>
<p>526<br>00:24:12,259 –&gt; 00:24:14,939<br>that’s the way you sort of escape columns names.</p>
<p>527<br>00:24:14,939 –&gt; 00:24:18,699<br>But it’ll support single quotes.</p>
<p>528<br>00:24:19,699 –&gt; 00:24:22,419<br>So in SQLite, they support both.</p>
<p>529<br>00:24:24,219 –&gt; 00:24:26,019<br>So I can go two-pock like this,</p>
<p>530<br>00:24:27,019 –&gt; 00:24:30,099<br>and I can go with single quotes, like that.</p>
<p>531<br>00:24:30,099 –&gt; 00:24:35,099<br>In Oracle, it’s single quotes,</p>
<p>532<br>00:24:36,979 –&gt; 00:24:39,219<br>but it doesn’t like queries without a from clause.</p>
<p>533<br>00:24:40,220 –&gt; 00:24:44,220<br>So in Oracle, they have this weird thing called the dual table,</p>
<p>534<br>00:24:44,220 –&gt; 00:24:47,940<br>and this is a fake table that comes with Oracle,</p>
<p>535<br>00:24:47,940 –&gt; 00:24:49,940<br>to allow you to write these kind of queries</p>
<p>536<br>00:24:49,940 –&gt; 00:24:52,980<br>that against tables that don’t actually exist.</p>
<p>537<br>00:24:52,980 –&gt; 00:24:54,980<br>Right, so then I can get that.</p>
<p>538<br>00:24:54,980 –&gt; 00:24:57,980<br>If you try to do like select star from from dual,</p>
<p>539<br>00:25:01,380 –&gt; 00:25:03,380<br>right, you just get like an X.</p>
<p>540<br>00:25:04,660 –&gt; 00:25:06,380<br>I think the newer version they got rid of the dual,</p>
<p>541<br>00:25:06,380 –&gt; 00:25:08,860<br>you don’t need any more of this is, this is Oracle 21,</p>
<p>542<br>00:25:09,139 –&gt; 00:25:11,379<br>so it’s a rather newer version, right?</p>
<p>543<br>00:25:13,019 –&gt; 00:25:17,740<br>So like you can’t do this, but like in Postgres,</p>
<p>544<br>00:25:17,740 –&gt; 00:25:20,859<br>any other data system, you can treat SQL as like a calculator,</p>
<p>545<br>00:25:20,859 –&gt; 00:25:24,459<br>you can put whatever you want and call it like that, right?</p>
<p>546<br>00:25:24,459 –&gt; 00:25:26,339<br>So, all right, let’s go back to my SQL,</p>
<p>547<br>00:25:27,740 –&gt; 00:25:30,179<br>and let’s look at some string functions.</p>
<p>548<br>00:25:30,179 –&gt; 00:25:34,379<br>So I can call now.</p>
<p>549<br>00:25:35,220 –&gt; 00:25:38,380<br>I can do like select star from student,</p>
<p>550<br>00:25:38,380 –&gt; 00:25:41,820<br>where name equals two-pock with, you know, weird casing,</p>
<p>551<br>00:25:41,820 –&gt; 00:25:46,020<br>and then it matched on the string two-pock, right?</p>
<p>552<br>00:25:46,020 –&gt; 00:25:48,860<br>Because internally my SQL is treating the varchard</p>
<p>553<br>00:25:48,860 –&gt; 00:25:50,380<br>as case insensitive.</p>
<p>554<br>00:25:51,620 –&gt; 00:25:53,300<br>So if you want to now,</p>
<p>555<br>00:25:56,300 –&gt; 00:26:00,140<br>if you want to treat it like any other database system</p>
<p>556<br>00:26:00,140 –&gt; 00:26:01,740<br>where it actually is actually looking at the case</p>
<p>557<br>00:26:01,740 –&gt; 00:26:04,340<br>as a true varchar, you can add this binary flag,</p>
<p>558<br>00:26:04,339 –&gt; 00:26:08,379<br>in front of the keyword in front of the column name,</p>
<p>559<br>00:26:08,379 –&gt; 00:26:11,019<br>and that’ll treat it as like a binary string,</p>
<p>560<br>00:26:11,019 –&gt; 00:26:12,819<br>like any other system.</p>
<p>561<br>00:26:12,819 –&gt; 00:26:14,179<br>In this case here, now it doesn’t match,</p>
<p>562<br>00:26:14,179 –&gt; 00:26:16,539<br>but now it doesn’t have a warning.</p>
<p>563<br>00:26:16,539 –&gt; 00:26:18,740<br>So now I gotta go now call show warnings,</p>
<p>564<br>00:26:18,740 –&gt; 00:26:20,980<br>and this is again, this is my SQL specific.</p>
<p>565<br>00:26:20,980 –&gt; 00:26:24,980<br>So now they tell me that the binary expression is deprecated</p>
<p>566<br>00:26:24,980 –&gt; 00:26:27,980<br>and be removed, and they tell me at least how to write it</p>
<p>567<br>00:26:27,980 –&gt; 00:26:28,500<br>correctly.</p>
<p>568<br>00:26:29,459 –&gt; 00:26:33,980<br>So now I have to cast the name as a binary,</p>
<p>569<br>00:26:33,980 –&gt; 00:26:35,579<br>and then I can call it.</p>
<p>570<br>00:26:35,579 –&gt; 00:26:38,420<br>So if I change the casing again, then I get two-pock.</p>
<p>571<br>00:26:39,860 –&gt; 00:26:40,940<br>So this burns a lot of people,</p>
<p>572<br>00:26:40,940 –&gt; 00:26:42,620<br>because you end up like thinking,</p>
<p>573<br>00:26:42,620 –&gt; 00:26:47,220<br>oh, if you don’t know that your varchar is case insensitive,</p>
<p>574<br>00:26:47,220 –&gt; 00:26:49,420<br>you could store things multiple times,</p>
<p>575<br>00:26:49,420 –&gt; 00:26:52,940<br>and thinking that it’s gonna be different,</p>
<p>576<br>00:26:52,940 –&gt; 00:26:54,099<br>because the case is different,</p>
<p>577<br>00:26:54,099 –&gt; 00:26:56,700<br>but then my SQL says they’re the same.</p>
<p>578<br>00:26:56,700 –&gt; 00:26:57,860<br>Again, this is only my SQL.</p>
<p>579<br>00:26:57,860 –&gt; 00:27:00,500<br>I don’t know any other database system that actually does this.</p>
<p>580<br>00:27:00,500 –&gt; 00:27:01,539<br>So that’s a weird one.</p>
<p>581<br>00:27:02,220 –&gt; 00:27:03,220<br>Yes?</p>
<p>582<br>00:27:03,220 –&gt; 00:27:04,059<br>Yes?</p>
<p>583<br>00:27:04,059 –&gt; 00:27:07,899<br>Why is the name house in the database is capitalized?</p>
<p>584<br>00:27:07,899 –&gt; 00:27:10,379<br>So what you’ve for is the database.</p>
<p>585<br>00:27:10,379 –&gt; 00:27:11,539<br>Is it the case?</p>
<p>586<br>00:27:11,539 –&gt; 00:27:14,180<br>The question is, why is the name capitalized?</p>
<p>587<br>00:27:14,180 –&gt; 00:27:15,019<br>Yeah.</p>
<p>588<br>00:27:15,019 –&gt; 00:27:15,859<br>Yes.</p>
<p>589<br>00:27:15,859 –&gt; 00:27:17,379<br>If I wanted to answer your questions,</p>
<p>590<br>00:27:17,379 –&gt; 00:27:18,940<br>I thought it was really capitalized</p>
<p>591<br>00:27:18,940 –&gt; 00:27:20,899<br>and I was working out over writing,</p>
<p>592<br>00:27:20,899 –&gt; 00:27:22,420<br>or working out.</p>
<p>593<br>00:27:22,420 –&gt; 00:27:23,420<br>So this question is,</p>
<p>594<br>00:27:25,500 –&gt; 00:27:28,259<br>I’m telling you, so there’s the data is being stored</p>
<p>595<br>00:27:28,259 –&gt; 00:27:29,819<br>with the case sensitivity.</p>
<p>596<br>00:27:29,819 –&gt; 00:27:33,299<br>The comparison operator when actually exudes the wear clause</p>
<p>597<br>00:27:33,299 –&gt; 00:27:34,539<br>is ignoring case.</p>
<p>598<br>00:27:35,859 –&gt; 00:27:38,659<br>Right? So it’s not calling whenever string compare</p>
<p>599<br>00:27:38,659 –&gt; 00:27:40,659<br>that you’d have in live C,</p>
<p>600<br>00:27:40,659 –&gt; 00:27:42,659<br>it’s calling either their own version of it</p>
<p>601<br>00:27:42,659 –&gt; 00:27:44,740<br>or the case insensitive version of it.</p>
<p>602<br>00:27:45,779 –&gt; 00:27:47,419<br>Because that was some decision that somebody made</p>
<p>603<br>00:27:47,419 –&gt; 00:27:50,059<br>in the 1990s that kids carried over today.</p>
<p>604<br>00:27:51,299 –&gt; 00:27:52,139<br>Yes?</p>
<p>605<br>00:27:53,299 –&gt; 00:27:54,500<br>Why did they make the decision?</p>
<p>606<br>00:27:57,379 –&gt; 00:27:58,779<br>Ask me that question at the very end,</p>
<p>607<br>00:27:58,779 –&gt; 00:28:00,500<br>every get through all the b****.</p>
<p>608<br>00:28:00,500 –&gt; 00:28:04,059<br>Again, it’s probably because somebody did it the one way,</p>
<p>609<br>00:28:04,059 –&gt; 00:28:05,700<br>they started out to do it.</p>
<p>610<br>00:28:05,700 –&gt; 00:28:08,059<br>Or my sequel of the guy was actually,</p>
<p>611<br>00:28:08,059 –&gt; 00:28:10,859<br>many cases trying to follow what Oracle did in some cases,</p>
<p>612<br>00:28:10,859 –&gt; 00:28:12,180<br>but Oracle doesn’t do this.</p>
<p>613<br>00:28:12,180 –&gt; 00:28:13,180<br>I have no idea.</p>
<p>614<br>00:28:14,619 –&gt; 00:28:15,779<br>We can email the guy.</p>
<p>615<br>00:28:16,700 –&gt; 00:28:17,539<br>He’s still alive.</p>
<p>616<br>00:28:21,299 –&gt; 00:28:25,180<br>So yeah, I mean, there’s a lot of times where people just did stuff</p>
<p>617<br>00:28:25,180 –&gt; 00:28:26,940<br>because like one person did it without like thinking</p>
<p>618<br>00:28:26,940 –&gt; 00:28:28,500<br>through the implications of it.</p>
<p>619<br>00:28:29,980 –&gt; 00:28:31,500<br>Or they’re trying to copy some other system,</p>
<p>620<br>00:28:31,500 –&gt; 00:28:32,660<br>or they liked some other,</p>
<p>621<br>00:28:32,660 –&gt; 00:28:35,059<br>you know, a particular feature of functionality.</p>
<p>622<br>00:28:35,059 –&gt; 00:28:35,900<br>Right?</p>
<p>623<br>00:28:39,460 –&gt; 00:28:40,779<br>Another question.</p>
<p>624<br>00:28:42,340 –&gt; 00:28:43,620<br>I will see many examples where like,</p>
<p>625<br>00:28:43,620 –&gt; 00:28:44,900<br>why would anyone ever do this?</p>
<p>626<br>00:28:44,900 –&gt; 00:28:46,299<br>So do it this way.</p>
<p>627<br>00:28:47,620 –&gt; 00:28:49,580<br>All right, so I think I showed a query like this before,</p>
<p>628<br>00:28:49,580 –&gt; 00:28:50,660<br>just make sure you see it.</p>
<p>629<br>00:28:50,660 –&gt; 00:28:52,500<br>So there’s this like,</p>
<p>630<br>00:28:52,500 –&gt; 00:28:54,460<br>like operation in in sequel,</p>
<p>631<br>00:28:54,460 –&gt; 00:28:57,380<br>and you use this for sort of really primitive string matching</p>
<p>632<br>00:28:57,380 –&gt; 00:28:58,860<br>and pattern matching.</p>
<p>633<br>00:28:58,860 –&gt; 00:29:00,940<br>So you would use a, you call it like,</p>
<p>634<br>00:29:00,940 –&gt; 00:29:04,819<br>and then you would say you would have a percent sign</p>
<p>635<br>00:29:04,819 –&gt; 00:29:05,819<br>to represent a wild card.</p>
<p>636<br>00:29:05,819 –&gt; 00:29:08,460<br>So instead of, if you’re coming from like the Unix World star,</p>
<p>637<br>00:29:08,460 –&gt; 00:29:09,259<br>or regular expression,</p>
<p>638<br>00:29:09,259 –&gt; 00:29:12,579<br>you shouldn’t mean match anything or dot.</p>
<p>639<br>00:29:12,579 –&gt; 00:29:15,299<br>In sequel, it’s the percent sign,</p>
<p>640<br>00:29:15,299 –&gt; 00:29:17,980<br>and that’ll match any substring,</p>
<p>641<br>00:29:17,980 –&gt; 00:29:19,180<br>including empty strings.</p>
<p>642<br>00:29:19,180 –&gt; 00:29:20,819<br>But if you just want to match one character,</p>
<p>643<br>00:29:20,819 –&gt; 00:29:22,940<br>you would use the underscore.</p>
<p>644<br>00:29:22,940 –&gt; 00:29:24,900<br>And there is support for regular expressions.</p>
<p>645<br>00:29:24,900 –&gt; 00:29:27,460<br>I forget whether that is in the sequel standard,</p>
<p>646<br>00:29:27,460 –&gt; 00:29:29,980<br>but everyone does it slightly different.</p>
<p>647<br>00:29:29,980 –&gt; 00:29:34,500<br>You can write more complex string matching pattern.</p>
<p>648<br>00:29:36,220 –&gt; 00:29:37,140<br>There’s a bunch of string functions</p>
<p>649<br>00:29:37,140 –&gt; 00:29:38,460<br>that also come in the sequel standard.</p>
<p>650<br>00:29:38,460 –&gt; 00:29:39,940<br>To do things you would expect,</p>
<p>651<br>00:29:39,940 –&gt; 00:29:40,940<br>like if you’re familiar with Python,</p>
<p>652<br>00:29:40,940 –&gt; 00:29:43,420<br>there’s like all the Python functions,</p>
<p>653<br>00:29:43,420 –&gt; 00:29:46,820<br>uppercase, lowercase, substrings, replacing strings,</p>
<p>654<br>00:29:46,820 –&gt; 00:29:48,980<br>all that, all that’s in the sequel standard.</p>
<p>655<br>00:29:48,980 –&gt; 00:29:50,100<br>And for the most part,</p>
<p>656<br>00:29:50,100 –&gt; 00:29:51,660<br>these are gonna be pretty consistent</p>
<p>657<br>00:29:51,660 –&gt; 00:29:54,620<br>across the various systems.</p>
<p>658<br>00:29:55,940 –&gt; 00:29:58,100<br>Where things go wrong is,</p>
<p>659<br>00:29:58,100 –&gt; 00:29:58,779<br>what you would think would be</p>
<p>660<br>00:29:58,779 –&gt; 00:30:01,300<br>the most simple operation, concatenating two strings,</p>
<p>661<br>00:30:01,300 –&gt; 00:30:02,580<br>that’s where everyone likes to do something</p>
<p>662<br>00:30:02,580 –&gt; 00:30:03,940<br>slightly different.</p>
<p>663<br>00:30:03,940 –&gt; 00:30:08,019<br>So the sequel standard says the double bar</p>
<p>664<br>00:30:08,019 –&gt; 00:30:09,500<br>is the way you can catch strings.</p>
<p>665<br>00:30:10,820 –&gt; 00:30:14,620<br>In sequel server, they use the plus sign.</p>
<p>666<br>00:30:15,980 –&gt; 00:30:18,779<br>And then in my sequel, they don’t have,</p>
<p>667<br>00:30:18,779 –&gt; 00:30:21,139<br>these under the default mode,</p>
<p>668<br>00:30:21,139 –&gt; 00:30:22,660<br>they don’t have the double bar.</p>
<p>669<br>00:30:22,660 –&gt; 00:30:23,940<br>They don’t sort the plus sign.</p>
<p>670<br>00:30:23,940 –&gt; 00:30:26,339<br>You have to use the concaten function.</p>
<p>671<br>00:30:28,180 –&gt; 00:30:29,500<br>You can see that real quickly.</p>
<p>672<br>00:30:30,740 –&gt; 00:30:33,019<br>So, going back to my sequel.</p>
<p>673<br>00:30:38,220 –&gt; 00:30:39,099<br>So,</p>
<p>674<br>00:30:42,420 –&gt; 00:30:44,899<br>I’m gonna do something like this, right?</p>
<p>675<br>00:30:44,899 –&gt; 00:30:46,980<br>I get another warning, I share warnings.</p>
<p>676<br>00:30:49,619 –&gt; 00:30:53,099<br>And it tells me, it doesn’t like my syntax, right?</p>
<p>677<br>00:30:54,740 –&gt; 00:30:57,139<br>Oh my goodness, that was the first warning, sorry.</p>
<p>678<br>00:30:57,139 –&gt; 00:30:58,379<br>Boom.</p>
<p>679<br>00:30:58,379 –&gt; 00:30:59,460<br>I got two warnings.</p>
<p>680<br>00:30:59,460 –&gt; 00:31:02,779<br>Says the double bar is synonym for the OR,</p>
<p>681<br>00:31:02,779 –&gt; 00:31:04,619<br>and therefore it’s been to be deprecated.</p>
<p>682<br>00:31:05,619 –&gt; 00:31:10,339<br>And they didn’t like the way I was sending along</p>
<p>683<br>00:31:10,339 –&gt; 00:31:12,460<br>the app sign in CS.</p>
<p>684<br>00:31:12,460 –&gt; 00:31:14,700<br>So, we now try to call,</p>
<p>685<br>00:31:14,700 –&gt; 00:31:17,700<br>we change the sequel mode in my sequel</p>
<p>686<br>00:31:17,700 –&gt; 00:31:19,940<br>to follow the sequel standard.</p>
<p>687<br>00:31:19,940 –&gt; 00:31:23,100<br>Now I can get the concatenation that I want.</p>
<p>688<br>00:31:26,259 –&gt; 00:31:27,860<br>So again, it’s concatenation,</p>
<p>689<br>00:31:27,860 –&gt; 00:31:29,259<br>I think it would be super, super,</p>
<p>690<br>00:31:29,259 –&gt; 00:31:31,180<br>it would be everyone should do the same thing,</p>
<p>691<br>00:31:31,180 –&gt; 00:31:33,500<br>but again, it’s some, in case of my sequel,</p>
<p>692<br>00:31:33,500 –&gt; 00:31:35,059<br>it’s some legacy thing from the 90s</p>
<p>693<br>00:31:35,059 –&gt; 00:31:36,900<br>that they’re trying to slowly undo.</p>
<p>694<br>00:31:39,380 –&gt; 00:31:43,700<br>All right, date and time is probably the worst one.</p>
<p>695<br>00:31:43,700 –&gt; 00:31:46,059<br>So, the sequel standard defines a bunch of ways</p>
<p>696<br>00:31:46,059 –&gt; 00:31:50,179<br>to define date types, time types,</p>
<p>697<br>00:31:50,179 –&gt; 00:31:52,299<br>also time with time stamps,</p>
<p>698<br>00:31:53,339 –&gt; 00:31:54,339<br>different calendar types,</p>
<p>699<br>00:31:54,339 –&gt; 00:31:56,579<br>Julian calendar, Gugorian calendar,</p>
<p>700<br>00:31:56,579 –&gt; 00:32:00,019<br>but again, how the syntax is going to vary</p>
<p>701<br>00:32:00,019 –&gt; 00:32:02,299<br>is going to be pretty annoying.</p>
<p>702<br>00:32:02,299 –&gt; 00:32:04,539<br>So I want to give it now a demo where,</p>
<p>703<br>00:32:04,539 –&gt; 00:32:07,779<br>try to do what would seem like a simple calculation,</p>
<p>704<br>00:32:07,779 –&gt; 00:32:09,059<br>a simple computation.</p>
<p>705<br>00:32:09,059 –&gt; 00:32:11,579<br>We just want to count the number days</p>
<p>706<br>00:32:11,579 –&gt; 00:32:14,940<br>since from today to the beginning of the year.</p>
<p>707<br>00:32:14,940 –&gt; 00:32:17,420<br>It’s like 230 something, 247, right?</p>
<p>708<br>00:32:17,420 –&gt; 00:32:20,500<br>Just the total number of calendar days.</p>
<p>709<br>00:32:20,500 –&gt; 00:32:22,820<br>So I’m going to do this first in Postgres,</p>
<p>710<br>00:32:22,820 –&gt; 00:32:26,180<br>and then we’ll do this in my sequel,</p>
<p>711<br>00:32:26,180 –&gt; 00:32:28,539<br>I do this in SQL Server.</p>
<p>712<br>00:32:28,539 –&gt; 00:32:29,820<br>So the first thing we need to do is figure out</p>
<p>713<br>00:32:29,820 –&gt; 00:32:33,539<br>how to get the current date, the current time.</p>
<p>714<br>00:32:34,820 –&gt; 00:32:39,420<br>Well, there’s in Postgres, there’s a function called now,</p>
<p>715<br>00:32:39,420 –&gt; 00:32:40,500<br>and that’ll give you,</p>
<p>716<br>00:32:42,580 –&gt; 00:32:44,900<br>you’ll get back a time stamp with the current date.</p>
<p>717<br>00:32:45,460 –&gt; 00:32:50,460<br>In my sequel, you can do the same thing in SQL Lite.</p>
<p>718<br>00:32:55,059 –&gt; 00:32:58,100<br>You don’t have a now function in DuckDB.</p>
<p>719<br>00:32:58,100 –&gt; 00:33:00,340<br>DuckDB is going to follow up pretty much Postgres</p>
<p>720<br>00:33:00,340 –&gt; 00:33:05,019<br>for a lot of things because they use the same SQL grammar.</p>
<p>721<br>00:33:05,019 –&gt; 00:33:07,180<br>So they have a now function,</p>
<p>722<br>00:33:07,180 –&gt; 00:33:08,180<br>I’m going to Oracle.</p>
<p>723<br>00:33:10,140 –&gt; 00:33:12,380<br>Oracle does not have a now function.</p>
<p>724<br>00:33:12,380 –&gt; 00:33:14,420<br>All right, so there’s another way you can get the time stamp.</p>
<p>725<br>00:33:14,460 –&gt; 00:33:15,940<br>So in the SQL standard,</p>
<p>726<br>00:33:15,940 –&gt; 00:33:19,380<br>there’s something called a function called current time stamp.</p>
<p>727<br>00:33:20,860 –&gt; 00:33:24,100<br>All right, except it’s not a function, it’s a keyword.</p>
<p>728<br>00:33:25,820 –&gt; 00:33:29,100<br>And then in my sequel, they have the function,</p>
<p>729<br>00:33:30,140 –&gt; 00:33:33,340<br>they have the keyword in SQL Lite,</p>
<p>730<br>00:33:35,380 –&gt; 00:33:36,380<br>they don’t have the function,</p>
<p>731<br>00:33:38,420 –&gt; 00:33:40,900<br>they have the keyword, and an Oracle</p>
<p>732<br>00:33:41,900 –&gt; 00:33:44,900<br>doesn’t give us a weird error,</p>
<p>733<br>00:33:44,900 –&gt; 00:33:46,900<br>about that one, come back to that in a second,</p>
<p>734<br>00:33:46,900 –&gt; 00:33:48,660<br>and then on the keyword.</p>
<p>735<br>00:33:48,660 –&gt; 00:33:51,100<br>So they have the function, but we’re getting this other weird error.</p>
<p>736<br>00:33:51,100 –&gt; 00:33:53,900<br>Date time interval precision at a range.</p>
<p>737<br>00:33:53,900 –&gt; 00:33:55,900<br>Okay, so what’s that?</p>
<p>738<br>00:33:55,900 –&gt; 00:33:58,900<br>So now we got to go back, maybe,</p>
<p>739<br>00:33:58,900 –&gt; 00:34:00,900<br>oh, it’s great, it’s Oracle.</p>
<p>740<br>00:34:00,900 –&gt; 00:34:03,900<br>It doesn’t like having a select clause without a front,</p>
<p>741<br>00:34:03,900 –&gt; 00:34:05,900<br>a select statement without a front clause.</p>
<p>742<br>00:34:05,900 –&gt; 00:34:07,900<br>So let’s add our fake table, dual,</p>
<p>743<br>00:34:07,900 –&gt; 00:34:09,900<br>all right, then we get it, right?</p>
<p>744<br>00:34:10,460 –&gt; 00:34:14,460<br>But it’s the keyword, and not the timestamp, all right?</p>
<p>745<br>00:34:15,260 –&gt; 00:34:18,420<br>All right, so now we can get the current time stamp,</p>
<p>746<br>00:34:18,420 –&gt; 00:34:20,260<br>the current day.</p>
<p>747<br>00:34:21,619 –&gt; 00:34:22,820<br>And so what we can do is now,</p>
<p>748<br>00:34:22,820 –&gt; 00:34:27,660<br>we can start casting strings or varcharis into date types,</p>
<p>749<br>00:34:27,660 –&gt; 00:34:29,740<br>and then there’s this extract function in the SQL standard</p>
<p>750<br>00:34:29,740 –&gt; 00:34:33,460<br>that allows us to extract some part of that data timestamp.</p>
<p>751<br>00:34:33,460 –&gt; 00:34:35,940<br>So this is saying extract the day from,</p>
<p>752<br>00:34:35,940 –&gt; 00:34:40,940<br>and then today’s date as a string cast it into a date type,</p>
<p>753<br>00:34:42,139 –&gt; 00:34:44,940<br>right? And again, there’s syntactic sugar</p>
<p>754<br>00:34:44,940 –&gt; 00:34:47,420<br>for all these different systems that are like non-standard.</p>
<p>755<br>00:34:47,420 –&gt; 00:34:50,659<br>So in Postgres, if I try to just give the string,</p>
<p>756<br>00:34:50,659 –&gt; 00:34:51,420<br>it’s gonna throw an error,</p>
<p>757<br>00:34:51,420 –&gt; 00:34:53,300<br>because it says I can’t, I need to operate,</p>
<p>758<br>00:34:53,300 –&gt; 00:34:54,659<br>the extract function needs to operate on the date,</p>
<p>759<br>00:34:54,659 –&gt; 00:34:56,420<br>or you’re giving me a varchar,</p>
<p>760<br>00:34:56,420 –&gt; 00:34:58,980<br>but I can add these two columns at the end,</p>
<p>761<br>00:34:58,980 –&gt; 00:35:00,740<br>and then put date at the end,</p>
<p>762<br>00:35:00,740 –&gt; 00:35:04,659<br>and then that’s gonna cast it to a date type.</p>
<p>763<br>00:35:05,379 –&gt; 00:35:07,500<br>Can you see that or no, sorry?</p>
<p>764<br>00:35:07,500 –&gt; 00:35:08,339<br>Yeah.</p>
<p>765<br>00:35:10,940 –&gt; 00:35:11,779<br>Shoot, sorry.</p>
<p>766<br>00:35:14,219 –&gt; 00:35:15,539<br>You do this, yeah.</p>
<p>767<br>00:35:17,819 –&gt; 00:35:19,940<br>I know it’s wrong, sorry, let’s try it again.</p>
<p>768<br>00:35:23,019 –&gt; 00:35:24,019<br>All right, so here,</p>
<p>769<br>00:35:25,940 –&gt; 00:35:27,139<br>I can give it a string,</p>
<p>770<br>00:35:27,139 –&gt; 00:35:28,779<br>and then I put colon colon date,</p>
<p>771<br>00:35:28,779 –&gt; 00:35:31,420<br>and that converts it to a date,</p>
<p>772<br>00:35:31,420 –&gt; 00:35:35,260<br>but that’s only in Postgres,</p>
<p>773<br>00:35:36,220 –&gt; 00:35:38,700<br>I can’t do this in any other system,</p>
<p>774<br>00:35:38,700 –&gt; 00:35:39,539<br>except for duct Db,</p>
<p>775<br>00:35:39,539 –&gt; 00:35:41,579<br>because they follow the same standard, right?</p>
<p>776<br>00:35:41,579 –&gt; 00:35:45,420<br>So if I go to my SQL, try to do the same thing,</p>
<p>777<br>00:35:45,420 –&gt; 00:35:48,019<br>doesn’t like that, go to SQLite,</p>
<p>778<br>00:35:48,019 –&gt; 00:35:49,659<br>doesn’t like that,</p>
<p>779<br>00:35:49,659 –&gt; 00:35:52,900<br>go to duct Db, or Oracle’s not gonna like that from dual.</p>
<p>780<br>00:35:55,260 –&gt; 00:35:57,420<br>Doesn’t know what a date is,</p>
<p>781<br>00:35:57,420 –&gt; 00:35:59,940<br>and this duct Db should do it, right?</p>
<p>782<br>00:35:59,940 –&gt; 00:36:01,780<br>Cause again, duct Db follows the same grammar.</p>
<p>783<br>00:36:01,780 –&gt; 00:36:03,700<br>Okay, so we can use the distract function,</p>
<p>784<br>00:36:03,700 –&gt; 00:36:08,780<br>and maybe extract what the current date is,</p>
<p>785<br>00:36:08,780 –&gt; 00:36:11,059<br>or try to figure out how many days since,</p>
<p>786<br>00:36:11,059 –&gt; 00:36:13,260<br>from now until the beginning of the year.</p>
<p>787<br>00:36:13,260 –&gt; 00:36:14,659<br>So let’s start with Postgres.</p>
<p>788<br>00:36:15,860 –&gt; 00:36:18,860<br>So it turns out it’s pretty simple with Postgres.</p>
<p>789<br>00:36:19,940 –&gt; 00:36:24,460<br>So we can just cast the string of today’s current date</p>
<p>790<br>00:36:25,460 –&gt; 00:36:27,980<br>to a date type,</p>
<p>791<br>00:36:28,219 –&gt; 00:36:31,460<br>and then subtract it from the string of the current,</p>
<p>792<br>00:36:33,539 –&gt; 00:36:35,300<br>of the beginning of the year.</p>
<p>793<br>00:36:35,300 –&gt; 00:36:37,579<br>And we could use the, if we wanted to,</p>
<p>794<br>00:36:37,579 –&gt; 00:36:39,659<br>we could go back here and use current timestamp,</p>
<p>795<br>00:36:39,659 –&gt; 00:36:44,740<br>or maybe use the now function, this should work, right?</p>
<p>796<br>00:36:44,740 –&gt; 00:36:48,059<br>So that gets today, so cast it as a date,</p>
<p>797<br>00:36:48,059 –&gt; 00:36:51,460<br>subtracting the, taking the tays date,</p>
<p>798<br>00:36:51,460 –&gt; 00:36:53,340<br>and subtracting by the beginning of the year,</p>
<p>799<br>00:36:53,340 –&gt; 00:36:55,860<br>and we get 241, which I assume is correct.</p>
<p>800<br>00:36:58,460 –&gt; 00:37:03,460<br>So let’s try the same thing now in my SQL.</p>
<p>801<br>00:37:04,699 –&gt; 00:37:06,780<br>So again, since they don’t have the now function,</p>
<p>802<br>00:37:06,780 –&gt; 00:37:09,539<br>we’ll do it with casting, right?</p>
<p>803<br>00:37:09,539 –&gt; 00:37:11,579<br>So now we get a weird number, we get 729.</p>
<p>804<br>00:37:13,659 –&gt; 00:37:14,500<br>What’s that?</p>
<p>805<br>00:37:16,340 –&gt; 00:37:18,300<br>And surprisingly, actually, somebody on YouTube,</p>
<p>806<br>00:37:18,300 –&gt; 00:37:21,619<br>in a comment of all places, told me what it was.</p>
<p>807<br>00:37:21,619 –&gt; 00:37:23,260<br>It’s the, and this is weird.</p>
<p>808<br>00:37:23,260 –&gt; 00:37:27,420<br>So the first number is, today’s current month,</p>
<p>809<br>00:37:27,420 –&gt; 00:37:31,740<br>subtracted by January, so eight minus one is seven.</p>
<p>810<br>00:37:32,659 –&gt; 00:37:36,300<br>Then it’s, today’s what, the 30th?</p>
<p>811<br>00:37:36,300 –&gt; 00:37:38,619<br>So then it’s the, today’s day,</p>
<p>812<br>00:37:38,619 –&gt; 00:37:41,659<br>subtracted by January 1st, plus 29.</p>
<p>813<br>00:37:41,659 –&gt; 00:37:43,980<br>So you get 729, all right?</p>
<p>814<br>00:37:45,260 –&gt; 00:37:46,659<br>So that’s wrong, can’t do that.</p>
<p>815<br>00:37:48,460 –&gt; 00:37:50,900<br>So what we can do instead is we can,</p>
<p>816<br>00:37:54,380 –&gt; 00:37:55,220<br>I’m sorry.</p>
<p>817<br>00:37:56,219 –&gt; 00:37:57,899<br>We can get the,</p>
<p>818<br>00:38:00,299 –&gt; 00:38:02,059<br>sorry, 20, 20, sorry.</p>
<p>819<br>00:38:04,939 –&gt; 00:38:06,339<br>All right, there we go, sorry.</p>
<p>820<br>00:38:06,339 –&gt; 00:38:09,299<br>So what we’re doing here now is we’re getting the,</p>
<p>821<br>00:38:09,299 –&gt; 00:38:12,059<br>the units, we’re getting the date of today</p>
<p>822<br>00:38:12,059 –&gt; 00:38:15,459<br>and beginning of the year, converting it to a unit’s timestamp.</p>
<p>823<br>00:38:15,459 –&gt; 00:38:18,179<br>A unit’s timestamp is the, it’s a number of seconds</p>
<p>824<br>00:38:18,179 –&gt; 00:38:21,539<br>since the unit’s epochs, like January 1st, 1970.</p>
<p>825<br>00:38:22,539 –&gt; 00:38:24,779<br>So we’re converting it now to the number of seconds</p>
<p>826<br>00:38:24,779 –&gt; 00:38:28,380<br>from today, since 1970.</p>
<p>827<br>00:38:28,380 –&gt; 00:38:30,860<br>And then we subtract that from the number of seconds</p>
<p>828<br>00:38:30,860 –&gt; 00:38:34,860<br>since January 1st, and we divide that by 60 seconds</p>
<p>829<br>00:38:34,860 –&gt; 00:38:36,980<br>times 60 minutes times 24 hours.</p>
<p>830<br>00:38:38,259 –&gt; 00:38:39,259<br>And we get 241.</p>
<p>831<br>00:38:40,659 –&gt; 00:38:43,380<br>So this is my original idea.</p>
<p>832<br>00:38:43,380 –&gt; 00:38:46,500<br>And then turns out there’s a date diff function</p>
<p>833<br>00:38:46,500 –&gt; 00:38:50,179<br>in my state of that you can do this.</p>
<p>834<br>00:38:50,179 –&gt; 00:38:53,099<br>But, Postgres doesn’t have it,</p>
<p>835<br>00:38:54,179 –&gt; 00:38:56,299<br>if the DB doesn’t have it, see if Oracle has it.</p>
<p>836<br>00:38:58,619 –&gt; 00:38:59,460<br>I’m dual.</p>
<p>837<br>00:38:59,460 –&gt; 00:39:01,940<br>All right, they don’t have it.</p>
<p>838<br>00:39:01,940 –&gt; 00:39:05,779<br>All right, all right, so that’s my, that’s my SQL thing.</p>
<p>839<br>00:39:05,779 –&gt; 00:39:09,179<br>All right, so now let’s try in SQLite.</p>
<p>840<br>00:39:09,179 –&gt; 00:39:11,500<br>So SQLite doesn’t have date diff.</p>
<p>841<br>00:39:11,500 –&gt; 00:39:14,619<br>We can’t do that subtraction that we did in Postgres.</p>
<p>842<br>00:39:14,619 –&gt; 00:39:17,899<br>The best solution I can come up with</p>
<p>843<br>00:39:17,900 –&gt; 00:39:21,980<br>is the convert the timestamp for today,</p>
<p>844<br>00:39:21,980 –&gt; 00:39:24,180<br>beginning of year, to the Julian calendar,</p>
<p>845<br>00:39:24,180 –&gt; 00:39:27,180<br>which is the number of days since Julian Caesar’s birthday</p>
<p>846<br>00:39:27,180 –&gt; 00:39:28,420<br>in whatever you see.</p>
<p>847<br>00:39:29,700 –&gt; 00:39:31,360<br>You laugh, but a lot of the banks ran off that</p>
<p>848<br>00:39:31,360 –&gt; 00:39:33,900<br>s*** up until the 80s, right?</p>
<p>849<br>00:39:35,180 –&gt; 00:39:37,059<br>And then you get 241.</p>
<p>850<br>00:39:37,059 –&gt; 00:39:39,180<br>But of course, we’re getting it as a,</p>
<p>851<br>00:39:40,180 –&gt; 00:39:43,139<br>as a floating point number, so we can cast it as an integer,</p>
<p>852<br>00:39:43,139 –&gt; 00:39:44,500<br>and then we get 241.</p>
<p>853<br>00:39:44,500 –&gt; 00:39:45,579<br>All right.</p>
<p>854<br>00:39:46,579 –&gt; 00:39:48,259<br>I’m not, I forget how to do this in Oracle.</p>
<p>855<br>00:39:48,259 –&gt; 00:39:49,340<br>We’re not gonna do an Oracle.</p>
<p>856<br>00:39:50,340 –&gt; 00:39:54,299<br>But the main point again, it seems like it could be a simple thing,</p>
<p>857<br>00:39:54,299 –&gt; 00:39:57,179<br>but all these timestamp stuff is, is, is,</p>
<p>858<br>00:39:57,179 –&gt; 00:39:58,179<br>woefully different.</p>
<p>859<br>00:39:59,259 –&gt; 00:40:01,539<br>All right, any questions about this or far?</p>
<p>860<br>00:40:01,539 –&gt; 00:40:02,380<br>Yes.</p>
<p>861<br>00:40:02,380 –&gt; 00:40:04,380<br>So when you know like one of the lower functions,</p>
<p>862<br>00:40:04,380 –&gt; 00:40:07,139<br>when I do people do that, it’s taking some of these.</p>
<p>863<br>00:40:07,139 –&gt; 00:40:08,699<br>Why would you want a lower function?</p>
<p>864<br>00:40:09,419 –&gt; 00:40:10,259<br>Um,</p>
<p>865<br>00:40:14,419 –&gt; 00:40:15,259<br>good question.</p>
<p>866<br>00:40:16,099 –&gt; 00:40:17,699<br>I mean, you might need it for like data cleaning.</p>
<p>867<br>00:40:19,299 –&gt; 00:40:21,059<br>You might want it for,</p>
<p>868<br>00:40:22,939 –&gt; 00:40:23,779<br>yeah, it’s good question.</p>
<p>869<br>00:40:23,779 –&gt; 00:40:26,460<br>It makes it in the standard, right?</p>
<p>870<br>00:40:26,460 –&gt; 00:40:28,099<br>It could be, I mean, it doesn’t have to be for,</p>
<p>871<br>00:40:28,099 –&gt; 00:40:30,579<br>also in the wear clause, you can have it in the from clause.</p>
<p>872<br>00:40:30,579 –&gt; 00:40:31,419<br>Right?</p>
<p>873<br>00:40:31,419 –&gt; 00:40:33,699<br>So if I go back to my SQL, right?</p>
<p>874<br>00:40:33,699 –&gt; 00:40:37,259<br>So select star from students.</p>
<p>875<br>00:40:39,539 –&gt; 00:40:41,619<br>Where a name equals two-pock, right?</p>
<p>876<br>00:40:43,699 –&gt; 00:40:45,859<br>Student, singular, right?</p>
<p>877<br>00:40:45,859 –&gt; 00:40:47,379<br>So maybe I want to do this though.</p>
<p>878<br>00:40:49,659 –&gt; 00:40:51,019<br>In my output, right?</p>
<p>879<br>00:40:51,019 –&gt; 00:40:53,179<br>Get a little case like that, right?</p>
<p>880<br>00:40:55,299 –&gt; 00:40:56,379<br>Yes, sorry, yes.</p>
<p>881<br>00:40:56,379 –&gt; 00:40:57,779<br>Hey, here, using like,</p>
<p>882<br>00:40:57,779 –&gt; 00:41:00,980<br>up to the size of the size of the memory is dial that.</p>
<p>883<br>00:41:00,980 –&gt; 00:41:04,259<br>So, you know, if they are all your relational,</p>
<p>884<br>00:41:04,259 –&gt; 00:41:06,179<br>uh, messages and like,</p>
<p>885<br>00:41:06,179 –&gt; 00:41:07,179<br>their logic,</p>
<p>886<br>00:41:10,379 –&gt; 00:41:11,779<br>yeah, so her question is,</p>
<p>887<br>00:41:12,539 –&gt; 00:41:15,659<br>why do people have all these weird idioms in their,</p>
<p>888<br>00:41:15,659 –&gt; 00:41:16,779<br>in their SQL?</p>
<p>889<br>00:41:18,379 –&gt; 00:41:20,179<br>When at a high level, they seem to be all,</p>
<p>890<br>00:41:20,179 –&gt; 00:41:21,179<br>so doing the same thing,</p>
<p>891<br>00:41:21,179 –&gt; 00:41:22,859<br>but it’s these one off things are different.</p>
<p>892<br>00:41:22,859 –&gt; 00:41:23,980<br>And that’s a related to his question.</p>
<p>893<br>00:41:23,980 –&gt; 00:41:25,219<br>Why do, why are all these,</p>
<p>894<br>00:41:25,859 –&gt; 00:41:27,980<br>why are all these different nuances for these different systems?</p>
<p>895<br>00:41:28,460 –&gt; 00:41:31,219<br>Because somebody was writing in thought of was cool, right?</p>
<p>896<br>00:41:31,739 –&gt; 00:41:33,139<br>And then they showed their friends like,</p>
<p>897<br>00:41:33,139 –&gt; 00:41:34,019<br>yeah, that’s cool, right?</p>
<p>898<br>00:41:34,019 –&gt; 00:41:35,419<br>So that the double colon and postgres,</p>
<p>899<br>00:41:35,420 –&gt; 00:41:37,180<br>I agree, that’s cool, that casting thing,</p>
<p>900<br>00:41:37,180 –&gt; 00:41:39,579<br>but they only do it, right?</p>
<p>901<br>00:41:40,940 –&gt; 00:41:42,619<br>The dual table, I don’t know what,</p>
<p>902<br>00:41:43,780 –&gt; 00:41:44,619<br>I went up.</p>
<p>903<br>00:41:45,659 –&gt; 00:41:46,500<br>The,</p>
<p>904<br>00:41:47,820 –&gt; 00:41:49,619<br>yeah, so like, give another example.</p>
<p>905<br>00:41:49,619 –&gt; 00:41:52,860<br>So like, there’s a shortcut in SQL</p>
<p>906<br>00:41:52,860 –&gt; 00:41:54,659<br>to do basically select star, right?</p>
<p>907<br>00:41:54,659 –&gt; 00:41:57,820<br>So select star from student,</p>
<p>908<br>00:41:59,099 –&gt; 00:42:00,500<br>gives you all the two goals, right?</p>
<p>909<br>00:42:00,500 –&gt; 00:42:01,740<br>But in Postgres,</p>
<p>910<br>00:42:01,740 –&gt; 00:42:03,019<br>which I think is also in the SQL standard,</p>
<p>911<br>00:42:03,019 –&gt; 00:42:05,380<br>I can just write table and get that, right?</p>
<p>912<br>00:42:06,340 –&gt; 00:42:11,059<br>In my SQL, I can do that.</p>
<p>913<br>00:42:11,059 –&gt; 00:42:12,420<br>That’s cool.</p>
<p>914<br>00:42:12,420 –&gt; 00:42:13,260<br>SQL light.</p>
<p>915<br>00:42:15,860 –&gt; 00:42:17,420<br>Yep, doesn’t like it.</p>
<p>916<br>00:42:17,420 –&gt; 00:42:18,820<br>In duckDB,</p>
<p>917<br>00:42:21,579 –&gt; 00:42:23,220<br>they do it, but they also have another one.</p>
<p>918<br>00:42:23,220 –&gt; 00:42:24,539<br>I think you just go,</p>
<p>919<br>00:42:25,740 –&gt; 00:42:27,700<br>I think you just go fetch, now where is it?</p>
<p>920<br>00:42:30,860 –&gt; 00:42:33,140<br>From, right?</p>
<p>921<br>00:42:33,140 –&gt; 00:42:34,019<br>You can just do that.</p>
<p>922<br>00:42:35,820 –&gt; 00:42:37,539<br>So they all had their weird idioms.</p>
<p>923<br>00:42:37,539 –&gt; 00:42:38,660<br>I mean, so some of these things</p>
<p>924<br>00:42:38,660 –&gt; 00:42:41,140<br>where are based on customer feedback,</p>
<p>925<br>00:42:41,140 –&gt; 00:42:43,260<br>like the customer says, I need functions</p>
<p>926<br>00:42:43,260 –&gt; 00:42:44,420<br>that operate on JSON, right?</p>
<p>927<br>00:42:44,420 –&gt; 00:42:45,900<br>So it’s so many ads that.</p>
<p>928<br>00:42:45,900 –&gt; 00:42:48,460<br>And a lot of times these features get added</p>
<p>929<br>00:42:48,460 –&gt; 00:42:51,300<br>before they show up in the standard, right?</p>
<p>930<br>00:42:51,300 –&gt; 00:42:53,420<br>So like the JSON XML stuff is a good example of this.</p>
<p>931<br>00:42:53,420 –&gt; 00:42:56,780<br>They, that got out of the SQL standard like 2006,</p>
<p>932<br>00:42:56,780 –&gt; 00:42:58,660<br>but a lot of relational databases at the time,</p>
<p>933<br>00:42:58,660 –&gt; 00:43:01,940<br>they were the 2000s, had some support for XML.</p>
<p>934<br>00:43:01,940 –&gt; 00:43:03,380<br>And so what happens is like,</p>
<p>935<br>00:43:03,380 –&gt; 00:43:06,380<br>the standard body is, it’s not much of a randos,</p>
<p>936<br>00:43:06,380 –&gt; 00:43:08,099<br>it’s the people at different companies.</p>
<p>937<br>00:43:08,099 –&gt; 00:43:09,220<br>So in the SQL standard body,</p>
<p>938<br>00:43:09,220 –&gt; 00:43:10,380<br>there’s somebody from Oracle,</p>
<p>939<br>00:43:10,380 –&gt; 00:43:11,860<br>there’s somebody from Sybase,</p>
<p>940<br>00:43:11,860 –&gt; 00:43:14,380<br>somebody from IBM.</p>
<p>941<br>00:43:14,380 –&gt; 00:43:16,300<br>And they show up at the standards committee</p>
<p>942<br>00:43:16,300 –&gt; 00:43:17,820<br>and they all try to get whatever they have,</p>
<p>943<br>00:43:17,820 –&gt; 00:43:19,260<br>proprietary thing that they have,</p>
<p>944<br>00:43:19,260 –&gt; 00:43:22,140<br>they try to get that into the standard, right?</p>
<p>945<br>00:43:22,140 –&gt; 00:43:24,420<br>Oracle probably do this more,</p>
<p>946<br>00:43:24,420 –&gt; 00:43:25,460<br>the best of people more recently,</p>
<p>947<br>00:43:25,460 –&gt; 00:43:28,940<br>Oracle got their version of property graph queries</p>
<p>948<br>00:43:28,940 –&gt; 00:43:30,500<br>in the SQL standard, right?</p>
<p>949<br>00:43:30,500 –&gt; 00:43:31,860<br>They base theirs on Cypher,</p>
<p>950<br>00:43:31,860 –&gt; 00:43:33,380<br>which is in Neo4j,</p>
<p>951<br>00:43:33,380 –&gt; 00:43:37,660<br>that’s now the PGQ stuff in the SQL standard.</p>
<p>952<br>00:43:37,660 –&gt; 00:43:41,420<br>And so they got their extensions for graph queries</p>
<p>953<br>00:43:41,420 –&gt; 00:43:42,380<br>in the SQL standard,</p>
<p>954<br>00:43:42,380 –&gt; 00:43:44,460<br>because they were sort of almost ahead of the time.</p>
<p>955<br>00:43:44,460 –&gt; 00:43:46,140<br>So that’s how these things show up in the SQL standard.</p>
<p>956<br>00:43:46,140 –&gt; 00:43:48,820<br>And so if everybody has competing ideas</p>
<p>957<br>00:43:48,820 –&gt; 00:43:50,340<br>for how something should be done,</p>
<p>958<br>00:43:50,340 –&gt; 00:43:51,740<br>you end up with the lowest common denominator,</p>
<p>959<br>00:43:51,740 –&gt; 00:43:52,820<br>somebody could try to support everyone,</p>
<p>960<br>00:43:52,820 –&gt; 00:43:56,140<br>but then no one exactly supports the standard.</p>
<p>961<br>00:43:57,860 –&gt; 00:43:58,900<br>I’m not saying it’s a good thing,</p>
<p>962<br>00:43:58,900 –&gt; 00:44:00,500<br>but like, it’s,</p>
<p>963<br>00:44:00,739 –&gt; 00:44:02,059<br>we live in a different time also too,</p>
<p>964<br>00:44:02,059 –&gt; 00:44:05,699<br>where there’s so many different database companies,</p>
<p>965<br>00:44:05,699 –&gt; 00:44:07,300<br>and there’s not one,</p>
<p>966<br>00:44:07,300 –&gt; 00:44:09,500<br>there isn’t one company I say that owns the market</p>
<p>967<br>00:44:09,500 –&gt; 00:44:13,860<br>and can bend people according to the will, right?</p>
<p>968<br>00:44:13,860 –&gt; 00:44:15,820<br>So I said before,</p>
<p>969<br>00:44:15,820 –&gt; 00:44:18,539<br>in the 1980s, IBM was the huge company, right?</p>
<p>970<br>00:44:18,539 –&gt; 00:44:20,659<br>IBM was the computer company.</p>
<p>971<br>00:44:20,659 –&gt; 00:44:21,659<br>So whatever IBM said,</p>
<p>972<br>00:44:21,659 –&gt; 00:44:24,659<br>that was considered the de facto standard.</p>
<p>973<br>00:44:24,659 –&gt; 00:44:28,300<br>And so that’s sort of how we end up with SQL today.</p>
<p>974<br>00:44:28,300 –&gt; 00:44:30,099<br>But there isn’t a company like that now.</p>
<p>975<br>00:44:30,099 –&gt; 00:44:33,339<br>Like the closest thing would be Google put out</p>
<p>976<br>00:44:33,339 –&gt; 00:44:35,579<br>their standard of SQL called Zeta SQL,</p>
<p>977<br>00:44:35,579 –&gt; 00:44:36,659<br>internally it’s called something else,</p>
<p>978<br>00:44:36,659 –&gt; 00:44:38,460<br>but they open source a parser</p>
<p>979<br>00:44:39,420 –&gt; 00:44:44,420<br>and the grammar fountain and the spec for their version of SQL.</p>
<p>980<br>00:44:44,779 –&gt; 00:44:48,299<br>Nobody uses it, and Google’s huge, right?</p>
<p>981<br>00:44:48,299 –&gt; 00:44:50,099<br>The closest you’re gonna get today is Postgres.</p>
<p>982<br>00:44:50,099 –&gt; 00:44:51,819<br>A lot of these database companies, when you start out,</p>
<p>983<br>00:44:51,819 –&gt; 00:44:54,219<br>instead of building like the grammar file from scratch,</p>
<p>984<br>00:44:54,219 –&gt; 00:44:55,460<br>you go take the Postgres one,</p>
<p>985<br>00:44:55,460 –&gt; 00:44:57,940<br>hack it up and inject in your system.</p>
<p>986<br>00:44:57,940 –&gt; 00:45:00,659<br>That’s a we did, and then DuckDB took our code</p>
<p>987<br>00:45:00,659 –&gt; 00:45:02,500<br>and they put it in DuckDB, right?</p>
<p>988<br>00:45:02,500 –&gt; 00:45:05,059<br>This bunch of systems are based on Postgres grammar</p>
<p>989<br>00:45:05,059 –&gt; 00:45:07,099<br>because they, because this open source may use it.</p>
<p>990<br>00:45:07,099 –&gt; 00:45:08,179<br>That’s the closest you’re gonna get</p>
<p>991<br>00:45:08,179 –&gt; 00:45:09,780<br>to your universal standard today.</p>
<p>992<br>00:45:09,780 –&gt; 00:45:13,780<br>But again, I just showed you how there’s from in DuckDB,</p>
<p>993<br>00:45:13,780 –&gt; 00:45:18,179<br>but that’s not in Postgres, right?</p>
<p>994<br>00:45:18,179 –&gt; 00:45:19,500<br>They’ve adapted it.</p>
<p>995<br>00:45:22,380 –&gt; 00:45:23,220<br>Yes.</p>
<p>996<br>00:45:23,219 –&gt; 00:45:30,219<br>What’s the point of having a standard if no one’s gonna follow it?</p>
<p>997<br>00:45:31,899 –&gt; 00:45:33,099<br>I mean, there’s a speed limit,</p>
<p>998<br>00:45:33,099 –&gt; 00:45:34,899<br>and everyone drives over it, right?</p>
<p>999<br>00:45:34,899 –&gt; 00:45:39,899<br>Like, no, so, so, I showed you what’s the select statements</p>
<p>1000<br>00:45:41,139 –&gt; 00:45:44,059<br>like the, and they were slightly different</p>
<p>1001<br>00:45:44,059 –&gt; 00:45:45,459<br>from one system to the next,</p>
<p>1002<br>00:45:45,459 –&gt; 00:45:48,379<br>but you understood what it was doing basically, right?</p>
<p>1003<br>00:45:48,379 –&gt; 00:45:49,939<br>The nuances of different systems,</p>
<p>1004<br>00:45:49,939 –&gt; 00:45:51,299<br>yeah, you may have to go read the documentation</p>
<p>1005<br>00:45:51,299 –&gt; 00:45:53,099<br>or ask chat to BT what to do,</p>
<p>1006<br>00:45:53,099 –&gt; 00:45:57,579<br>but like, at a high level, the concepts are the same, right?</p>
<p>1007<br>00:46:00,460 –&gt; 00:46:02,259<br>Just, you know, the, the, the, the, the,</p>
<p>1008<br>00:46:02,259 –&gt; 00:46:04,579<br>the specifics, these systems gonna be different.</p>
<p>1009<br>00:46:06,619 –&gt; 00:46:07,739<br>Snowflake is a good outlier.</p>
<p>1010<br>00:46:07,739 –&gt; 00:46:09,819<br>Actually, Snowflake started from scratch in 2013.</p>
<p>1011<br>00:46:09,819 –&gt; 00:46:10,819<br>They didn’t take Postgres.</p>
<p>1012<br>00:46:10,819 –&gt; 00:46:12,339<br>They said, they just came up with their own grammar.</p>
<p>1013<br>00:46:12,339 –&gt; 00:46:14,339<br>So there’s now a Snowflake SQL grammar</p>
<p>1014<br>00:46:14,339 –&gt; 00:46:17,139<br>that has things that other systems don’t support.</p>
<p>1015<br>00:46:17,139 –&gt; 00:46:19,500<br>If I was, if I was building a new data system scratch today,</p>
<p>1016<br>00:46:19,500 –&gt; 00:46:21,579<br>I would not do it Snowflake did.</p>
<p>1017<br>00:46:21,579 –&gt; 00:46:22,739<br>It was a different time.</p>
<p>1018<br>00:46:22,739 –&gt; 00:46:24,299<br>I would start with Postgres,</p>
<p>1019<br>00:46:24,299 –&gt; 00:46:26,339<br>and then expand upon the way DuckDB did.</p>
<p>1020<br>00:46:30,299 –&gt; 00:46:31,139<br>Okay.</p>
<p>1021<br>00:46:32,500 –&gt; 00:46:34,339<br>Keep going, it’s still a lot to cover.</p>
<p>1022<br>00:46:36,299 –&gt; 00:46:39,419<br>In the sake of time, I’m gonna skip output redirection,</p>
<p>1023<br>00:46:41,259 –&gt; 00:46:44,219<br>because you’re not really gonna need that for the homework.</p>
<p>1024<br>00:46:44,219 –&gt; 00:46:46,019<br>Let’s jump ahead to window functions.</p>
<p>1025<br>00:46:47,779 –&gt; 00:46:50,419<br>All right, so before we showed aggregations,</p>
<p>1026<br>00:46:51,260 –&gt; 00:46:56,260<br>they were computing sort of sort of one shot calculation</p>
<p>1027<br>00:46:56,260 –&gt; 00:46:59,380<br>across the entire input set to,</p>
<p>1028<br>00:46:59,380 –&gt; 00:47:02,500<br>or the relation that was being inputted to the,</p>
<p>1029<br>00:47:06,220 –&gt; 00:47:07,860<br>for the aggregate function that you’re operating</p>
<p>1030<br>00:47:07,860 –&gt; 00:47:09,260<br>on the front clause.</p>
<p>1031<br>00:47:09,260 –&gt; 00:47:11,700<br>But there’s also times where you may need one</p>
<p>1032<br>00:47:11,700 –&gt; 00:47:14,019<br>of what is called a sliding calculation,</p>
<p>1033<br>00:47:14,019 –&gt; 00:47:17,460<br>where I think it would like a rolling tally,</p>
<p>1034<br>00:47:17,460 –&gt; 00:47:19,300<br>as you go from one to both of the next</p>
<p>1035<br>00:47:19,300 –&gt; 00:47:20,620<br>as you’re scanning along,</p>
<p>1036<br>00:47:20,620 –&gt; 00:47:23,780<br>you wanna update some kind of aggregate function</p>
<p>1037<br>00:47:23,780 –&gt; 00:47:27,460<br>so that for every single tuple that you’re outputting</p>
<p>1038<br>00:47:27,460 –&gt; 00:47:30,700<br>from your select statement, the aggregate is sort of a snapshot</p>
<p>1039<br>00:47:30,700 –&gt; 00:47:33,060<br>in time of when that tuple was processed.</p>
<p>1040<br>00:47:33,980 –&gt; 00:47:35,700<br>All right, so it’s like an aggregate function</p>
<p>1041<br>00:47:35,700 –&gt; 00:47:38,460<br>where you’re not grouping them to a single output</p>
<p>1042<br>00:47:38,460 –&gt; 00:47:40,980<br>for every single final output.</p>
<p>1043<br>00:47:40,980 –&gt; 00:47:43,700<br>For every single tuple, it’s gonna have its own computation</p>
<p>1044<br>00:47:43,700 –&gt; 00:47:44,620<br>for that aggregation.</p>
<p>1045<br>00:47:45,620 –&gt; 00:47:49,260<br>So the way this works is you would have like a function here,</p>
<p>1046<br>00:47:49,260 –&gt; 00:47:50,300<br>this would be all your aggregate functions,</p>
<p>1047<br>00:47:50,300 –&gt; 00:47:53,940<br>minmax, count average, as we saw before,</p>
<p>1048<br>00:47:53,940 –&gt; 00:47:56,020<br>as well as some additional ones.</p>
<p>1049<br>00:47:56,020 –&gt; 00:47:59,540<br>And then you’re gonna specify what is the sort of scope</p>
<p>1050<br>00:47:59,540 –&gt; 00:48:02,060<br>or the range that you’re going to compute</p>
<p>1051<br>00:48:02,060 –&gt; 00:48:03,580<br>this calculation for, right?</p>
<p>1052<br>00:48:03,580 –&gt; 00:48:05,140<br>Basically sort of how to slice up the data</p>
<p>1053<br>00:48:05,140 –&gt; 00:48:07,060<br>and source it and sort it.</p>
<p>1054<br>00:48:09,220 –&gt; 00:48:11,620<br>So let’s look at some examples like this.</p>
<p>1055<br>00:48:11,620 –&gt; 00:48:13,700<br>So I can have all the aggregation functions</p>
<p>1056<br>00:48:13,700 –&gt; 00:48:17,820<br>that I have before, minmax, count, and so forth.</p>
<p>1057<br>00:48:17,820 –&gt; 00:48:19,140<br>And then I have these additional ones,</p>
<p>1058<br>00:48:19,140 –&gt; 00:48:22,340<br>like the row number that tell me what row my tuples</p>
<p>1059<br>00:48:22,340 –&gt; 00:48:26,820<br>is in my output, as well as a rank if I’m sorting them.</p>
<p>1060<br>00:48:26,820 –&gt; 00:48:29,019<br>So if I have like an order by clause,</p>
<p>1061<br>00:48:29,019 –&gt; 00:48:31,140<br>like the order students by GPA,</p>
<p>1062<br>00:48:31,140 –&gt; 00:48:32,900<br>I can tell you what your position is</p>
<p>1063<br>00:48:32,900 –&gt; 00:48:35,380<br>using the rank function, right?</p>
<p>1064<br>00:48:35,380 –&gt; 00:48:37,340<br>You couldn’t do that with the aggregate</p>
<p>1065<br>00:48:37,340 –&gt; 00:48:38,780<br>or the aggregation function because there’s</p>
<p>1066<br>00:48:38,780 –&gt; 00:48:40,380<br>things that get collapsed down.</p>
<p>1067<br>00:48:41,580 –&gt; 00:48:43,220<br>All right, so in this case here, this example here,</p>
<p>1068<br>00:48:43,220 –&gt; 00:48:45,700<br>I can do select star from row number over,</p>
<p>1069<br>00:48:45,699 –&gt; 00:48:49,299<br>and then the empty parentheses, because I’m not partitioning it.</p>
<p>1070<br>00:48:49,299 –&gt; 00:48:51,980<br>And that’ll give me output like this, what it’ll tell me,</p>
<p>1071<br>00:48:51,980 –&gt; 00:48:53,939<br>again, for all my output tuples,</p>
<p>1072<br>00:48:53,939 –&gt; 00:48:56,419<br>where do I appear in the list for that?</p>
<p>1073<br>00:49:02,419 –&gt; 00:49:04,059<br>If you have the over clause, you can specify</p>
<p>1074<br>00:49:04,059 –&gt; 00:49:06,619<br>how you want to group tables together,</p>
<p>1075<br>00:49:06,619 –&gt; 00:49:07,939<br>I’m sorry, group tuples together,</p>
<p>1076<br>00:49:07,939 –&gt; 00:49:09,619<br>like if you didn’t win a function.</p>
<p>1077<br>00:49:09,619 –&gt; 00:49:12,819<br>And then you can use the partition by like a group by</p>
<p>1078<br>00:49:12,819 –&gt; 00:49:15,179<br>of how to group them up.</p>
<p>1079<br>00:49:15,179 –&gt; 00:49:17,819<br>So for this query here, we’re doing select the course ID</p>
<p>1080<br>00:49:17,819 –&gt; 00:49:19,779<br>and the student ID from the roll table.</p>
<p>1081<br>00:49:19,779 –&gt; 00:49:24,019<br>And I want to get the row number of each student record</p>
<p>1082<br>00:49:24,019 –&gt; 00:49:25,619<br>or in the roll table.</p>
<p>1083<br>00:49:26,779 –&gt; 00:49:28,859<br>But then I want to partition it by course ID.</p>
<p>1084<br>00:49:28,859 –&gt; 00:49:31,859<br>So I would get an output like this for every single course.</p>
<p>1085<br>00:49:31,859 –&gt; 00:49:34,899<br>It would tell me for every student ID,</p>
<p>1086<br>00:49:34,899 –&gt; 00:49:38,379<br>what position they are in that group.</p>
<p>1087<br>00:49:38,379 –&gt; 00:49:40,980<br>All right, this is sort of a cluster like this.</p>
<p>1088<br>00:49:42,980 –&gt; 00:49:44,219<br>Then if you have an order by clause,</p>
<p>1089<br>00:49:44,219 –&gt; 00:49:46,939<br>you can then control how the tuples will be sorted</p>
<p>1090<br>00:49:46,939 –&gt; 00:49:50,699<br>within either a partition or within the window.</p>
<p>1091<br>00:49:50,699 –&gt; 00:49:54,339<br>So in this case here, now I can order the students by</p>
<p>1092<br>00:49:55,579 –&gt; 00:49:57,539<br>by the roll table based on the course ID.</p>
<p>1093<br>00:49:59,059 –&gt; 00:50:00,379<br>So I have a more complicated example here.</p>
<p>1094<br>00:50:00,379 –&gt; 00:50:02,500<br>So we’re going to find the student with the second highest</p>
<p>1095<br>00:50:02,500 –&gt; 00:50:05,539<br>grade for each course.</p>
<p>1096<br>00:50:05,539 –&gt; 00:50:07,939<br>So for this one here, we’re going to have a nested query,</p>
<p>1097<br>00:50:07,939 –&gt; 00:50:09,459<br>which we’ll discuss in a second.</p>
<p>1098<br>00:50:09,459 –&gt; 00:50:13,379<br>But basically I have a select statement that has a from clause</p>
<p>1099<br>00:50:13,380 –&gt; 00:50:16,140<br>and the side that from clause I have another query.</p>
<p>1100<br>00:50:16,140 –&gt; 00:50:20,500<br>And inside this inner query, I can reference,</p>
<p>1101<br>00:50:21,780 –&gt; 00:50:24,500<br>actually this here, I’m doing a look up on the roll table</p>
<p>1102<br>00:50:24,500 –&gt; 00:50:26,460<br>and then the outer query can just do filtering</p>
<p>1103<br>00:50:26,460 –&gt; 00:50:29,260<br>based on the output of this nested query.</p>
<p>1104<br>00:50:29,260 –&gt; 00:50:32,059<br>Gonna cover nested queries in a second.</p>
<p>1105<br>00:50:32,059 –&gt; 00:50:32,860<br>So the first thing we’re going to do is</p>
<p>1106<br>00:50:32,860 –&gt; 00:50:37,380<br>group the tuples by the course ID and then sort them</p>
<p>1107<br>00:50:37,380 –&gt; 00:50:40,059<br>by the grade and then we’ll get the rank would be,</p>
<p>1108<br>00:50:40,059 –&gt; 00:50:43,900<br>what is their position in the sort of list of grades?</p>
<p>1109<br>00:50:45,219 –&gt; 00:50:47,259<br>And then in my where clause here, I can reference now</p>
<p>1110<br>00:50:47,259 –&gt; 00:50:52,259<br>the window function calculation for column.</p>
<p>1111<br>00:50:55,500 –&gt; 00:50:57,179<br>Any questions about this?</p>
<p>1112<br>00:50:57,179 –&gt; 00:50:58,019<br>Yes.</p>
<p>1113<br>00:50:58,019 –&gt; 00:51:01,500<br>Can you do this to a group by and also,</p>
<p>1114<br>00:51:01,500 –&gt; 00:51:06,179<br>basically can you make up with a function to do the group by?</p>
<p>1115<br>00:51:06,179 –&gt; 00:51:08,900<br>So actually, can I make a window function using group eyes?</p>
<p>1116<br>00:51:08,900 –&gt; 00:51:13,900<br>Like you do by the, let’s try it, so just say.</p>
<p>1117<br>00:51:17,460 –&gt; 00:51:18,300<br>All right, so.</p>
<p>1118<br>00:51:26,099 –&gt; 00:51:29,180<br>All right, so we’ll do this in Postgres.</p>
<p>1119<br>00:51:31,139 –&gt; 00:51:34,380<br>Right, so again, select star from the roll table</p>
<p>1120<br>00:51:34,380 –&gt; 00:51:36,900<br>and then we’ll get the row number of,</p>
<p>1121<br>00:51:37,500 –&gt; 00:51:39,579<br>where each student appears, right?</p>
<p>1122<br>00:51:41,700 –&gt; 00:51:45,139<br>And then the second, the second example was,</p>
<p>1123<br>00:51:45,139 –&gt; 00:51:48,019<br>we got a course ID, student ID, and then the row number</p>
<p>1124<br>00:51:48,019 –&gt; 00:51:50,539<br>but then partition it by the course ID.</p>
<p>1125<br>00:51:50,539 –&gt; 00:51:53,220<br>So then we’re just gonna order them and the output</p>
<p>1126<br>00:51:53,220 –&gt; 00:51:55,740<br>by the course ID, right?</p>
<p>1127<br>00:51:55,740 –&gt; 00:51:59,300<br>So in this case here, we see that we have for each course,</p>
<p>1128<br>00:51:59,300 –&gt; 00:52:02,139<br>1545, 721, and 826, right?</p>
<p>1129<br>00:52:02,139 –&gt; 00:52:03,820<br>Here’s the students that are rolling them,</p>
<p>1130<br>00:52:03,820 –&gt; 00:52:06,460<br>and then this is their position within each group.</p>
<p>1131<br>00:52:07,900 –&gt; 00:52:10,340<br>And then my last example was like this,</p>
<p>1132<br>00:52:10,340 –&gt; 00:52:13,340<br>and this is where you were asking whether you can do a group by.</p>
<p>1133<br>00:52:15,099 –&gt; 00:52:17,780<br>We’re now here again, so I can get the first,</p>
<p>1134<br>00:52:17,780 –&gt; 00:52:21,579<br>the inner query is gonna give me the rank position</p>
<p>1135<br>00:52:21,579 –&gt; 00:52:24,059<br>of every record, the rank is just where you are</p>
<p>1136<br>00:52:24,059 –&gt; 00:52:25,300<br>in the sorting output.</p>
<p>1137<br>00:52:26,380 –&gt; 00:52:29,380<br>Let me remove the part here first.</p>
<p>1138<br>00:52:31,139 –&gt; 00:52:34,539<br>Right, so here’s the output of the inner query,</p>
<p>1139<br>00:52:34,539 –&gt; 00:52:36,059<br>of the select rank.</p>
<p>1140<br>00:52:36,059 –&gt; 00:52:40,099<br>So for every course, I’m gonna get the grades</p>
<p>1141<br>00:52:40,099 –&gt; 00:52:42,259<br>and then order them by the grades.</p>
<p>1142<br>00:52:42,259 –&gt; 00:52:44,659<br>And then the rank is just where their position is</p>
<p>1143<br>00:52:44,659 –&gt; 00:52:48,860<br>in the, within the sort of the grades.</p>
<p>1144<br>00:52:48,860 –&gt; 00:52:51,059<br>And the rank can have repeat, so if I say,</p>
<p>1145<br>00:52:51,059 –&gt; 00:52:52,699<br>I’m sort of another record here,</p>
<p>1146<br>00:52:52,699 –&gt; 00:52:57,699<br>so I insert them to enrolled, values,</p>
<p>1147<br>00:52:57,699 –&gt; 00:53:01,259<br>when you have student ID, let’s do,</p>
<p>1148<br>00:53:03,539 –&gt; 00:53:04,619<br>have two pop take.</p>
<p>1149<br>00:53:07,059 –&gt; 00:53:11,059<br>The values, of course, ID would be 15, 7, 21,</p>
<p>1150<br>00:53:12,259 –&gt; 00:53:17,259<br>and let’s say he got a, it’s given me, he’s dead.</p>
<p>1151<br>00:53:23,739 –&gt; 00:53:26,739<br>That’s order by rank thing.</p>
<p>1152<br>00:53:27,739 –&gt; 00:53:31,739<br>Well, that screws up the partition, let me give it that,</p>
<p>1153<br>00:53:37,739 –&gt; 00:53:38,739<br>sorry.</p>
<p>1154<br>00:53:39,739 –&gt; 00:53:43,739<br>Right, so here what we’re doing is,</p>
<p>1155<br>00:53:43,739 –&gt; 00:53:46,939<br>everything goes, of course, again, we’re getting the grade</p>
<p>1156<br>00:53:46,939 –&gt; 00:53:48,859<br>and then with the sort in the rank.</p>
<p>1157<br>00:53:48,859 –&gt; 00:53:51,579<br>And so we inserted this record here, two pop,</p>
<p>1158<br>00:53:51,579 –&gt; 00:53:54,139<br>we gave an A, but there was also another student</p>
<p>1159<br>00:53:54,139 –&gt; 00:53:55,739<br>who got an A in the same class,</p>
<p>1160<br>00:53:55,739 –&gt; 00:53:58,579<br>and therefore they both have the same rank position of one.</p>
<p>1161<br>00:53:58,579 –&gt; 00:54:00,899<br>And then for the student that got the C,</p>
<p>1162<br>00:54:00,899 –&gt; 00:54:02,500<br>their rank position is three.</p>
<p>1163<br>00:54:02,500 –&gt; 00:54:05,139<br>So rank you can have duplicates, row numbers will not.</p>
<p>1164<br>00:54:07,419 –&gt; 00:54:09,299<br>So yeah, so you’re proposing to do what,</p>
<p>1165<br>00:54:09,299 –&gt; 00:54:10,259<br>much of random group,</p>
<p>1166<br>00:54:10,259 –&gt; 00:54:12,819<br>group by the, where?</p>
<p>1167<br>00:54:12,819 –&gt; 00:54:17,819<br>Like, sorry, in the interquery or what, sorry.</p>
<p>1168<br>00:54:18,619 –&gt; 00:54:19,619<br>Do you have a,</p>
<p>1169<br>00:54:19,619 –&gt; 00:54:24,619<br>is it possible to recreate this thing very easily by?</p>
<p>1170<br>00:54:24,619 –&gt; 00:54:26,059<br>The question is, is it possible to recreate the same query</p>
<p>1171<br>00:54:26,059 –&gt; 00:54:27,059<br>using group by?</p>
<p>1172<br>00:54:29,380 –&gt; 00:54:32,460<br>You wouldn’t, you wouldn’t be able to get the rank, right?</p>
<p>1173<br>00:54:32,460 –&gt; 00:54:33,659<br>Because you wouldn’t be able to get,</p>
<p>1174<br>00:54:33,659 –&gt; 00:54:34,900<br>what is my sort of position?</p>
<p>1175<br>00:54:34,900 –&gt; 00:54:39,900<br>There isn’t a concept of that in, in, in, in SQL, right?</p>
<p>1176<br>00:54:42,299 –&gt; 00:54:45,259<br>So row, row number is interesting because it is,</p>
<p>1177<br>00:54:47,139 –&gt; 00:54:48,460<br>let’s do that row number.</p>
<p>1178<br>00:54:55,460 –&gt; 00:54:59,299<br>Right, make the point, switch to row number, row number.</p>
<p>1179<br>00:55:01,139 –&gt; 00:55:03,139<br>So row number is interesting because,</p>
<p>1180<br>00:55:03,139 –&gt; 00:55:06,299<br>I’m, it’s calling it rank, but trust me, it’s row number.</p>
<p>1181<br>00:55:06,299 –&gt; 00:55:09,059<br>It’s cause, again, it’s bag algebra.</p>
<p>1182<br>00:55:09,059 –&gt; 00:55:11,420<br>There is no sort order in, in these relations.</p>
<p>1183<br>00:55:11,420 –&gt; 00:55:12,739<br>That’s sort of weird concept,</p>
<p>1184<br>00:55:12,739 –&gt; 00:55:14,339<br>we think about programming, like what do you mean,</p>
<p>1185<br>00:55:14,339 –&gt; 00:55:15,779<br>there’s, there’s not an ordering.</p>
<p>1186<br>00:55:15,779 –&gt; 00:55:17,859<br>Like, we’re used to programming in like, on X86,</p>
<p>1187<br>00:55:17,859 –&gt; 00:55:19,659<br>where there’s a, you know, the ordering,</p>
<p>1188<br>00:55:19,659 –&gt; 00:55:21,219<br>how memory operations occur.</p>
<p>1189<br>00:55:21,219 –&gt; 00:55:22,420<br>Right, there isn’t any of that here,</p>
<p>1190<br>00:55:22,420 –&gt; 00:55:23,819<br>everything can be unordered.</p>
<p>1191<br>00:55:23,860 –&gt; 00:55:26,580<br>So, in, without a window function,</p>
<p>1192<br>00:55:26,580 –&gt; 00:55:29,420<br>you can’t get a row number because there’s no way to say,</p>
<p>1193<br>00:55:29,420 –&gt; 00:55:31,539<br>where do I exist in this position,</p>
<p>1194<br>00:55:31,539 –&gt; 00:55:33,180<br>you know, in my position on my output.</p>
<p>1195<br>00:55:35,300 –&gt; 00:55:37,580<br>Oracle does have row number, they hide it from you,</p>
<p>1196<br>00:55:37,580 –&gt; 00:55:40,500<br>you can get it, but like, it’s, it’s, that’s just an</p>
<p>1197<br>00:55:40,500 –&gt; 00:55:41,340<br>Oracle thing.</p>
<p>1198<br>00:55:42,860 –&gt; 00:55:45,220<br>So, so the window function is allow you to,</p>
<p>1199<br>00:55:45,220 –&gt; 00:55:47,100<br>in addition to doing the averages and all the other</p>
<p>1200<br>00:55:47,100 –&gt; 00:55:51,140<br>aggregates, allows you to, to get the order of things</p>
<p>1201<br>00:55:51,140 –&gt; 00:55:53,380<br>in a way that you would not be able to get otherwise.</p>
<p>1202<br>00:55:54,820 –&gt; 00:55:55,820<br>Okay.</p>
<p>1203<br>00:55:56,820 –&gt; 00:55:57,820<br>Okay.</p>
<p>1204<br>00:56:03,300 –&gt; 00:56:04,900<br>All right, so I should have showed nested queries before,</p>
<p>1205<br>00:56:04,900 –&gt; 00:56:06,860<br>but this is going through in more detail.</p>
<p>1206<br>00:56:06,860 –&gt; 00:56:08,980<br>So a nested query, nested queries are really powerful</p>
<p>1207<br>00:56:08,980 –&gt; 00:56:11,220<br>concept, sometimes called subqueries,</p>
<p>1208<br>00:56:11,220 –&gt; 00:56:14,420<br>where it allows you to have a query inside of a query,</p>
<p>1209<br>00:56:14,420 –&gt; 00:56:15,740<br>inside of, like, inside of a query.</p>
<p>1210<br>00:56:15,740 –&gt; 00:56:17,500<br>Like, you have multiple queries inside of sort of</p>
<p>1211<br>00:56:17,500 –&gt; 00:56:19,220<br>overarching calling queries.</p>
<p>1212<br>00:56:19,220 –&gt; 00:56:20,780<br>And you would need this because you want to be able to</p>
<p>1213<br>00:56:20,780 –&gt; 00:56:23,180<br>express certain computations,</p>
<p>1214<br>00:56:23,179 –&gt; 00:56:26,339<br>without these nested queries, without taking the data out,</p>
<p>1215<br>00:56:26,339 –&gt; 00:56:28,539<br>doing some computation, and then putting it back in the</p>
<p>1216<br>00:56:28,539 –&gt; 00:56:29,539<br>database system.</p>
<p>1217<br>00:56:29,539 –&gt; 00:56:32,539<br>So it allows us to put these things together to, to create</p>
<p>1218<br>00:56:32,539 –&gt; 00:56:36,619<br>more complex logic than we would not be able to otherwise do.</p>
<p>1219<br>00:56:36,619 –&gt; 00:56:40,179<br>And these inner queries can appear almost anywhere inside of</p>
<p>1220<br>00:56:40,179 –&gt; 00:56:42,179<br>a, a select state, but are actually really animals,</p>
<p>1221<br>00:56:42,179 –&gt; 00:56:43,179<br>any query.</p>
<p>1222<br>00:56:43,179 –&gt; 00:56:44,779<br>Like, you have in the select output, the from clause,</p>
<p>1223<br>00:56:44,779 –&gt; 00:56:47,179<br>the where clause, you can put in an update queries and delete</p>
<p>1224<br>00:56:47,179 –&gt; 00:56:48,179<br>queries, right?</p>
<p>1225<br>00:56:49,179 –&gt; 00:56:52,179<br>And they can now reference other tables within your own query,</p>
<p>1226<br>00:56:53,179 –&gt; 00:56:55,179<br>like, it’s a very powerful construct.</p>
<p>1227<br>00:56:55,179 –&gt; 00:56:57,179<br>So the basic idea is something like this.</p>
<p>1228<br>00:56:57,179 –&gt; 00:57:00,179<br>So here, we’re doing select it from the name table,</p>
<p>1229<br>00:57:00,179 –&gt; 00:57:04,179<br>and then I want to get the name of a student that is</p>
<p>1230<br>00:57:04,179 –&gt; 00:57:06,179<br>at least enrolled in one course.</p>
<p>1231<br>00:57:06,179 –&gt; 00:57:09,179<br>So you can think of this out, this selects the top part,</p>
<p>1232<br>00:57:09,179 –&gt; 00:57:12,179<br>that’s called the outer query, and then this inner part here,</p>
<p>1233<br>00:57:12,179 –&gt; 00:57:14,179<br>we would call this inner query.</p>
<p>1234<br>00:57:14,179 –&gt; 00:57:16,179<br>So nested queries are, they’re</p>
<p>1235<br>00:57:16,179 –&gt; 00:57:19,179<br>terribly difficult for database systems to optimize.</p>
<p>1236<br>00:57:19,179 –&gt; 00:57:20,179<br>Right?</p>
<p>1237<br>00:57:21,179 –&gt; 00:57:23,179<br>Because you think about the stupidest way to execute this query</p>
<p>1238<br>00:57:23,179 –&gt; 00:57:26,179<br>would be for every single tuple in my student table,</p>
<p>1239<br>00:57:26,179 –&gt; 00:57:28,179<br>rerun this thing.</p>
<p>1240<br>00:57:28,179 –&gt; 00:57:29,179<br>Right?</p>
<p>1241<br>00:57:29,179 –&gt; 00:57:32,179<br>Get the list of all the student IDs, then compute the int.</p>
<p>1242<br>00:57:32,179 –&gt; 00:57:35,179<br>The way to really execute this, this is just a join for</p>
<p>1243<br>00:57:35,179 –&gt; 00:57:37,179<br>this one example here.</p>
<p>1244<br>00:57:37,179 –&gt; 00:57:38,179<br>Right?</p>
<p>1245<br>00:57:38,179 –&gt; 00:57:41,179<br>This one’s easy to do because, you know, you’re looking for this,</p>
<p>1246<br>00:57:41,179 –&gt; 00:57:44,179<br>this thing to match something here, so you can do,</p>
<p>1247<br>00:57:44,179 –&gt; 00:57:46,179<br>like, convert that to a quality predicate.</p>
<p>1248<br>00:57:46,179 –&gt; 00:57:49,179<br>Things get more complicated when there’s non-trivial relations</p>
<p>1249<br>00:57:49,179 –&gt; 00:57:51,179<br>between the inner query and the outer query.</p>
<p>1250<br>00:57:51,179 –&gt; 00:57:54,179<br>We won’t, we’ll come into that later in the semester,</p>
<p>1251<br>00:57:54,179 –&gt; 00:57:57,179<br>but this is something, this is something, again,</p>
<p>1252<br>00:57:57,179 –&gt; 00:57:59,179<br>this is the hardest, the one of the hardest part of database</p>
<p>1253<br>00:57:59,179 –&gt; 00:58:00,179<br>systems.</p>
<p>1254<br>00:58:00,179 –&gt; 00:58:03,179<br>And the only system that does nested queries correctly</p>
<p>1255<br>00:58:03,179 –&gt; 00:58:06,179<br>is the system called Umbra, which is a,</p>
<p>1256<br>00:58:06,179 –&gt; 00:58:09,179<br>is an academic system out of Germany.</p>
<p>1257<br>00:58:09,179 –&gt; 00:58:13,179<br>DuckDB does it correctly now for two reasons.</p>
<p>1258<br>00:58:13,179 –&gt; 00:58:16,179<br>One, because they copied what Umbra did,</p>
<p>1259<br>00:58:16,179 –&gt; 00:58:18,179<br>it’s in papers, it’s not like they stole the ideas.</p>
<p>1260<br>00:58:18,179 –&gt; 00:58:21,179<br>And then we also sent them patches last semester at a 721.</p>
<p>1261<br>00:58:21,179 –&gt; 00:58:24,179<br>So we fixed it for them, they can do some of these nested queries</p>
<p>1262<br>00:58:24,179 –&gt; 00:58:27,179<br>correctly, with lateral joins.</p>
<p>1263<br>00:58:27,179 –&gt; 00:58:29,179<br>So, duckDB is probably the best implementation of this.</p>
<p>1264<br>00:58:29,179 –&gt; 00:58:32,179<br>A lot of times, there’s a bunch of heuristics, hacks.</p>
<p>1265<br>00:58:32,179 –&gt; 00:58:34,179<br>Again, we’ll cover this later.</p>
<p>1266<br>00:58:34,179 –&gt; 00:58:36,179<br>My SQL is always the worst.</p>
<p>1267<br>00:58:36,179 –&gt; 00:58:38,179<br>It’s gotten much better though.</p>
<p>1268<br>00:58:38,179 –&gt; 00:58:40,179<br>Right, so the, so here’s a query like this.</p>
<p>1269<br>00:58:40,179 –&gt; 00:58:43,179<br>So we want to get the name of the students wrote in 1544-45.</p>
<p>1270<br>00:58:43,179 –&gt; 00:58:46,179<br>So we have the outer query that we say, you know,</p>
<p>1271<br>00:58:46,179 –&gt; 00:58:48,179<br>we want to get the name from the student table.</p>
<p>1272<br>00:58:48,179 –&gt; 00:58:50,179<br>And then we want to have this wear clause,</p>
<p>1273<br>00:58:50,179 –&gt; 00:58:53,179<br>we want to specify the logic that will get us the student ID,</p>
<p>1274<br>00:58:53,179 –&gt; 00:58:55,179<br>the set of people that are taking 445.</p>
<p>1275<br>00:58:55,179 –&gt; 00:58:58,179<br>So this is a way to sort of think about how you want to actually</p>
<p>1276<br>00:58:58,179 –&gt; 00:59:00,179<br>construct this, start with the outer query,</p>
<p>1277<br>00:59:00,179 –&gt; 00:59:03,179<br>or what the overarching computation of the output you want to be,</p>
<p>1278<br>00:59:03,179 –&gt; 00:59:06,179<br>and then you figure out what the inner part needs to be separately.</p>
<p>1279<br>00:59:06,179 –&gt; 00:59:09,179<br>So in this case here, we can convert this English part here</p>
<p>1280<br>00:59:09,179 –&gt; 00:59:11,179<br>into a nested query like this.</p>
<p>1281<br>00:59:11,179 –&gt; 00:59:13,179<br>But now we need to be able to reference it,</p>
<p>1282<br>00:59:13,179 –&gt; 00:59:17,179<br>or do the check that we want in the wear clause of the outer query,</p>
<p>1283<br>00:59:17,179 –&gt; 00:59:21,179<br>and we’d use that in clause that we had before.</p>
<p>1284<br>00:59:21,179 –&gt; 00:59:25,179<br>And so in this case here, now we see that the student ID</p>
<p>1285<br>00:59:25,179 –&gt; 00:59:28,179<br>in the wear clause here in the outer query,</p>
<p>1286<br>00:59:28,179 –&gt; 00:59:31,179<br>that’s referencing the student ID from the outer query.</p>
<p>1287<br>00:59:31,179 –&gt; 00:59:33,179<br>But the second student ID in the inner query,</p>
<p>1288<br>00:59:33,179 –&gt; 00:59:36,179<br>that’s referencing the student ID in the enrolled table.</p>
<p>1289<br>00:59:36,179 –&gt; 00:59:39,179<br>So the parser in the database system</p>
<p>1290<br>00:59:39,179 –&gt; 00:59:41,179<br>is smart enough to recognize the context</p>
<p>1291<br>00:59:41,179 –&gt; 00:59:46,179<br>of where a column is being referenced to know which table you’re looking at.</p>
<p>1292<br>00:59:46,179 –&gt; 00:59:50,179<br>In the cases where it doesn’t know that it’s two things have the same name,</p>
<p>1293<br>00:59:50,179 –&gt; 00:59:54,179<br>it’ll throw an error and make you qualify the table name</p>
<p>1294<br>00:59:54,179 –&gt; 00:59:58,179<br>of where a column is coming from.</p>
<p>1295<br>00:59:58,179 –&gt; 01:00:01,179<br>So there’s a bunch of ways you can interact with nested queries</p>
<p>1296<br>01:00:01,179 –&gt; 01:00:03,179<br>to do inside wear clauses.</p>
<p>1297<br>01:00:03,179 –&gt; 01:00:06,179<br>So you can have things like an all command or all operator</p>
<p>1298<br>01:00:06,179 –&gt; 01:00:10,179<br>that every row in the nested query has to satisfy some conical strain</p>
<p>1299<br>01:00:10,179 –&gt; 01:00:14,179<br>or some sometimes called sum, as the alias,</p>
<p>1300<br>01:00:14,179 –&gt; 01:00:19,179<br>SOME, where you can say at least one row must match my sub query.</p>
<p>1301<br>01:00:19,179 –&gt; 01:00:24,179<br>The in clause that I showed before is the same thing as equals any.</p>
<p>1302<br>01:00:24,179 –&gt; 01:00:27,179<br>And then exist, this means that I want to find something where I know</p>
<p>1303<br>01:00:27,179 –&gt; 01:00:31,179<br>there’s at least one match, sorry, there’s just one row being returned,</p>
<p>1304<br>01:00:31,179 –&gt; 01:00:35,179<br>but I don’t actually care what’s in it.</p>
<p>1305<br>01:00:35,179 –&gt; 01:00:38,179<br>So I can rewrite the example I have before, instead of using in,</p>
<p>1306<br>01:00:38,179 –&gt; 01:00:42,179<br>I can use equals any and it’s considered equivalent.</p>
<p>1307<br>01:00:42,179 –&gt; 01:00:46,179<br>And so we can show real quickly how Postgres picks different plans for this</p>
<p>1308<br>01:00:46,179 –&gt; 01:00:50,179<br>and you see how it’s actually being executed.</p>
<p>1309<br>01:00:57,179 –&gt; 01:00:59,179<br>Right, so here’s that query.</p>
<p>1310<br>01:00:59,179 –&gt; 01:01:02,179<br>We have RISD and 2Pock taking the class.</p>
<p>1311<br>01:01:02,179 –&gt; 01:01:05,179<br>So in SQL, you can put this explain keyword in front of it,</p>
<p>1312<br>01:01:06,179 –&gt; 01:01:10,179<br>and have any query, and what that’s going to do if the system supports it,</p>
<p>1313<br>01:01:10,179 –&gt; 01:01:14,179<br>it’ll come back with the query plan and tell you what operations</p>
<p>1314<br>01:01:14,179 –&gt; 01:01:18,179<br>would execute if it actually tried to execute this thing.</p>
<p>1315<br>01:01:18,179 –&gt; 01:01:23,179<br>Right, so when we run that, we get something like this that’s going to tell us,</p>
<p>1316<br>01:01:23,179 –&gt; 01:01:25,179<br>basically, think of this as a tree structure.</p>
<p>1317<br>01:01:25,179 –&gt; 01:01:28,179<br>So these are the leaf nodes and then it builds up this is the final output.</p>
<p>1318<br>01:01:28,179 –&gt; 01:01:32,179<br>So this is telling us that Postgres wants to do a sequential scan on the roll table</p>
<p>1319<br>01:01:32,179 –&gt; 01:01:35,179<br>and then it’s going to hash it because it’s doing a hash drawing up there</p>
<p>1320<br>01:01:35,179 –&gt; 01:01:37,179<br>which we’ll cover on a hash drawing later on.</p>
<p>1321<br>01:01:37,179 –&gt; 01:01:40,179<br>And then it does a sequential scan on the student table,</p>
<p>1322<br>01:01:40,179 –&gt; 01:01:46,179<br>and then now it does my matching with the student ID with this enroll student ID.</p>
<p>1323<br>01:01:46,179 –&gt; 01:01:51,179<br>So Postgres was smart enough to convert this nested query into a join,</p>
<p>1324<br>01:01:51,179 –&gt; 01:01:56,179<br>which is always going to be the fastest way to execute something when you have these kind of references.</p>
<p>1325<br>01:01:56,179 –&gt; 01:01:59,179<br>We can try the same thing in my SQL.</p>
<p>1326<br>01:02:02,179 –&gt; 01:02:08,179<br>But they’re explained output is terrible.</p>
<p>1327<br>01:02:08,179 –&gt; 01:02:12,179<br>There’s a way to get, I forget the syntax,</p>
<p>1328<br>01:02:12,179 –&gt; 01:02:15,179<br>you got to put like an extender to something like that.</p>
<p>1329<br>01:02:15,179 –&gt; 01:02:17,179<br>I forget how to do it in my SQL.</p>
<p>1330<br>01:02:17,179 –&gt; 01:02:20,179<br>There’s a way to get something a little bit better.</p>
<p>1331<br>01:02:20,179 –&gt; 01:02:23,179<br>In SQL Lite, I don’t think you can do this.</p>
<p>1332<br>01:02:23,179 –&gt; 01:02:26,179<br>Oh, you can do this.</p>
<p>1333<br>01:02:26,179 –&gt; 01:02:32,179<br>What’s that?</p>
<p>1334<br>01:02:32,179 –&gt; 01:02:34,179<br>What’s that?</p>
<p>1335<br>01:02:34,179 –&gt; 01:02:38,179<br>Oh, f***, is this?</p>
<p>1336<br>01:02:38,179 –&gt; 01:02:43,179<br>All right, SQL Lite.</p>
<p>1337<br>01:02:43,179 –&gt; 01:02:48,179<br>So they don’t like the select statement.</p>
<p>1338<br>01:02:48,179 –&gt; 01:02:50,179<br>They’re surprising, right?</p>
<p>1339<br>01:02:50,179 –&gt; 01:02:52,179<br>Why doesn’t that work?</p>
<p>1340<br>01:02:52,179 –&gt; 01:02:54,179<br>See if DuckDB does it.</p>
<p>1341<br>01:02:54,179 –&gt; 01:03:04,179<br>DuckDB has very pretty, they give you nice little trees.</p>
<p>1342<br>01:03:04,179 –&gt; 01:03:07,179<br>You guys are easily amused.</p>
<p>1343<br>01:03:07,179 –&gt; 01:03:12,179<br>This impresses you with unicode output for explain.</p>
<p>1344<br>01:03:12,179 –&gt; 01:03:17,179<br>But yeah, it shows you what the physical plan is.</p>
<p>1345<br>01:03:17,179 –&gt; 01:03:22,179<br>And then we can try an Oracle.</p>
<p>1346<br>01:03:22,179 –&gt; 01:03:28,179<br>Has it right output?</p>
<p>1347<br>01:03:28,179 –&gt; 01:03:31,179<br>Well, we need another time.</p>
<p>1348<br>01:03:31,179 –&gt; 01:03:34,179<br>Getting the plan out of Oracle and SQL Server is a huge pain.</p>
<p>1349<br>01:03:34,179 –&gt; 01:03:38,179<br>But I’m just surprised that SQL Lite doesn’t support this.</p>
<p>1350<br>01:03:38,179 –&gt; 01:03:44,179<br>Select.</p>
<p>1351<br>01:03:44,179 –&gt; 01:03:48,179<br>I’m not going to debug this live.</p>
<p>1352<br>01:03:48,179 –&gt; 01:03:51,179<br>Yeah, I don’t know why it doesn’t like that.</p>
<p>1353<br>01:03:51,179 –&gt; 01:03:55,179<br>Let’s try it in.</p>
<p>1354<br>01:03:55,179 –&gt; 01:03:56,179<br>Ah, there we go.</p>
<p>1355<br>01:03:56,179 –&gt; 01:03:58,179<br>It didn’t like egos and it looked in.</p>
<p>1356<br>01:03:58,179 –&gt; 01:04:05,179<br>All right, so in SQL Lite, if I run explain,</p>
<p>1357<br>01:04:05,179 –&gt; 01:04:09,179<br>I get this.</p>
<p>1358<br>01:04:09,179 –&gt; 01:04:12,179<br>So the way SQL Lite does, which is,</p>
<p>1359<br>01:04:12,179 –&gt; 01:04:17,179<br>the genius is that the way it actually took your query plan</p>
<p>1360<br>01:04:17,179 –&gt; 01:04:23,179<br>into its own DSL, opcodes, and it has its own VM that runs the opcodes.</p>
<p>1361<br>01:04:23,179 –&gt; 01:04:25,179<br>Think of like the JVM.</p>
<p>1362<br>01:04:25,179 –&gt; 01:04:27,179<br>You take Java code, convert it into Java bytecode,</p>
<p>1363<br>01:04:27,179 –&gt; 01:04:29,179<br>and then the JVM executes it or interprets it.</p>
<p>1364<br>01:04:29,179 –&gt; 01:04:32,179<br>That’s what SQL Lite does.</p>
<p>1365<br>01:04:32,179 –&gt; 01:04:36,179<br>We’ll discuss query compilation in the semester.</p>
<p>1366<br>01:04:36,179 –&gt; 01:04:41,179<br>So you got to put explain plan.</p>
<p>1367<br>01:04:41,179 –&gt; 01:04:45,179<br>There’s some syntax to get the real plan.</p>
<p>1368<br>01:04:45,179 –&gt; 01:04:48,179<br>Trust me, it’s there.</p>
<p>1369<br>01:04:48,179 –&gt; 01:04:51,179<br>All right, so.</p>
<p>1370<br>01:04:51,179 –&gt; 01:04:54,179<br>So yeah, so they all do something slightly different.</p>
<p>1371<br>01:04:54,179 –&gt; 01:04:56,179<br>And then if the system is smart,</p>
<p>1372<br>01:04:56,179 –&gt; 01:04:59,179<br>it can try to convert it into a join.</p>
<p>1373<br>01:04:59,179 –&gt; 01:05:05,179<br>All right, so skip this and say good time because we’ve got to get through.</p>
<p>1374<br>01:05:05,179 –&gt; 01:05:09,179<br>We’re going to get through lateral joins and.</p>
<p>1375<br>01:05:09,179 –&gt; 01:05:10,179<br>And CTEs.</p>
<p>1376<br>01:05:10,179 –&gt; 01:05:14,179<br>All right, so lateral joins are a newer concept,</p>
<p>1377<br>01:05:14,179 –&gt; 01:05:15,179<br>but.</p>
<p>1378<br>01:05:15,179 –&gt; 01:05:19,179<br>And not all systems are going to support it, but the basic idea is that.</p>
<p>1379<br>01:05:19,179 –&gt; 01:05:22,179<br>It’s going to allow you to have a.</p>
<p>1380<br>01:05:22,179 –&gt; 01:05:31,179<br>A nested query reference data in a, in another query that is adjacent to it.</p>
<p>1381<br>01:05:31,179 –&gt; 01:05:37,179<br>So normally in you have two nested queries, one nested query can’t reference what’s inside the other nested query.</p>
<p>1382<br>01:05:37,179 –&gt; 01:05:39,179<br>Because it doesn’t know about what’s inside of it.</p>
<p>1383<br>01:05:39,179 –&gt; 01:05:42,179<br>But with a lateral join allows you to do this.</p>
<p>1384<br>01:05:42,179 –&gt; 01:05:47,179<br>You can almost think of like it’s like a four loop, where one table for every single.</p>
<p>1385<br>01:05:47,179 –&gt; 01:05:48,179<br>Every single.</p>
<p>1386<br>01:05:48,179 –&gt; 01:05:52,179<br>Every single two in the out and out of four loop, you can do some,</p>
<p>1387<br>01:05:52,179 –&gt; 01:05:55,179<br>you can run some query, do some competition here.</p>
<p>1388<br>01:05:55,179 –&gt; 01:06:00,179<br>So in this simple example here, I have two, I have two nested queries.</p>
<p>1389<br>01:06:00,179 –&gt; 01:06:02,179<br>I’ve a select one as, as X.</p>
<p>1390<br>01:06:02,179 –&gt; 01:06:05,179<br>So this is turning back a single two has one column with a value one.</p>
<p>1391<br>01:06:05,179 –&gt; 01:06:10,179<br>And then my lateral join here can now reference the,</p>
<p>1392<br>01:06:10,179 –&gt; 01:06:14,179<br>the output of this first query here, and does do plus one on it.</p>
<p>1393<br>01:06:14,179 –&gt; 01:06:17,179<br>Right? So I get, I get, I get one and two that way.</p>
<p>1394<br>01:06:17,179 –&gt; 01:06:20,179<br>Right? Without lateral, you can’t do this.</p>
<p>1395<br>01:06:20,179 –&gt; 01:06:22,179<br>Right? Because these would be treated as,</p>
<p>1396<br>01:06:22,179 –&gt; 01:06:28,179<br>completely two separate queries, which we can do this in post-gressant and see real quickly.</p>
<p>1397<br>01:06:28,179 –&gt; 01:06:31,179<br>Right?</p>
<p>1398<br>01:06:31,179 –&gt; 01:06:38,179<br>So select star from an inner query select one as.</p>
<p>1399<br>01:06:38,179 –&gt; 01:06:41,179<br>Sorry.</p>
<p>1400<br>01:06:41,179 –&gt; 01:06:43,179<br>Yep, yep, yep.</p>
<p>1401<br>01:06:43,179 –&gt; 01:06:45,179<br>As X.</p>
<p>1402<br>01:06:45,179 –&gt; 01:06:48,179<br>That’s T1.</p>
<p>1403<br>01:06:48,179 –&gt; 01:06:52,179<br>Right? So I can get back a single two, both it has, has one in it, right?</p>
<p>1404<br>01:06:52,179 –&gt; 01:06:56,179<br>But if I try to put a nest, another nested query next to it, select,</p>
<p>1405<br>01:06:56,179 –&gt; 01:07:00,179<br>say two, has Y,</p>
<p>1406<br>01:07:00,179 –&gt; 01:07:03,179<br>as T2.</p>
<p>1407<br>01:07:03,179 –&gt; 01:07:07,179<br>Right? I’m getting the Cartesian product up, but I can’t reference inside of this thing.</p>
<p>1408<br>01:07:07,179 –&gt; 01:07:11,179<br>I can’t go T1.X plus one.</p>
<p>1409<br>01:07:11,179 –&gt; 01:07:13,179<br>Right?</p>
<p>1410<br>01:07:13,179 –&gt; 01:07:17,179<br>Because it doesn’t know about T1, because those two, those queries are running separately.</p>
<p>1411<br>01:07:17,179 –&gt; 01:07:22,179<br>If I add the lateral keyword,</p>
<p>1412<br>01:07:22,179 –&gt; 01:07:27,179<br>now my, my second nested query can, can, can reference with whatever’s in the first one.</p>
<p>1413<br>01:07:27,179 –&gt; 01:07:31,179<br>Right? And you can chain these things together,</p>
<p>1414<br>01:07:31,179 –&gt; 01:07:34,179<br>at many times as you want.</p>
<p>1415<br>01:07:34,179 –&gt; 01:07:37,179<br>So quickly, see what the query plan for this one would be.</p>
<p>1416<br>01:07:37,179 –&gt; 01:07:40,179<br>The theory should convert this to a join.</p>
<p>1417<br>01:07:40,179 –&gt; 01:07:43,179<br>Wow.</p>
<p>1418<br>01:07:43,179 –&gt; 01:07:45,179<br>All right.</p>
<p>1419<br>01:07:45,179 –&gt; 01:07:47,179<br>That, you had a shortcut, but you can order that.</p>
<p>1420<br>01:07:47,179 –&gt; 01:07:48,179<br>Okay.</p>
<p>1421<br>01:07:48,179 –&gt; 01:07:50,179<br>Because the, basically says, I, I know what the answer is.</p>
<p>1422<br>01:07:50,179 –&gt; 01:07:52,179<br>I don’t want to run anything and just spit out the answer.</p>
<p>1423<br>01:07:52,179 –&gt; 01:07:53,179<br>That’s what it did.</p>
<p>1424<br>01:07:53,179 –&gt; 01:07:54,179<br>Like select one plus one.</p>
<p>1425<br>01:07:54,179 –&gt; 01:07:57,179<br>It knows what, knows how to compute that without running a query.</p>
<p>1426<br>01:07:57,179 –&gt; 01:07:59,179<br>It’s quite, let’s look at a more complicated example.</p>
<p>1427<br>01:07:59,179 –&gt; 01:08:02,179<br>So say I want to calculate the number of students that enrolled in each course.</p>
<p>1428<br>01:08:02,179 –&gt; 01:08:08,179<br>And then I also want to get all the, the average GPA of all the students in that course.</p>
<p>1429<br>01:08:08,179 –&gt; 01:08:11,179<br>And so you, yes, you can write this without using a lateral join.</p>
<p>1430<br>01:08:11,179 –&gt; 01:08:13,179<br>That’s what I’m going to show you how to do this with a lateral join.</p>
<p>1431<br>01:08:13,179 –&gt; 01:08:17,180<br>So there’s two of them, two nested queries, where we had a select statement on the,</p>
<p>1432<br>01:08:17,180 –&gt; 01:08:18,180<br>out, out part.</p>
<p>1433<br>01:08:18,180 –&gt; 01:08:21,180<br>And then for every single two pull that’s in the course table,</p>
<p>1434<br>01:08:21,180 –&gt; 01:08:23,180<br>I want to then compute the number of enrolled students.</p>
<p>1435<br>01:08:23,180 –&gt; 01:08:26,180<br>And then again, for every single student in the course table,</p>
<p>1436<br>01:08:26,180 –&gt; 01:08:30,180<br>I want to compute the, the average GPA of all the enrolled students.</p>
<p>1437<br>01:08:30,180 –&gt; 01:08:31,180<br>Right?</p>
<p>1438<br>01:08:31,180 –&gt; 01:08:32,180<br>So we can write it as this.</p>
<p>1439<br>01:08:32,180 –&gt; 01:08:36,180<br>We have two, and two nested queries that are, that are, with the lateral keyword.</p>
<p>1440<br>01:08:36,180 –&gt; 01:08:41,180<br>Where they get the first one here, I compute the, the, the, the count.</p>
<p>1441<br>01:08:41,180 –&gt; 01:08:45,180<br>Again, inside of it, I’m able to reference what’s in the, the outer query here,</p>
<p>1442<br>01:08:45,180 –&gt; 01:08:46,180<br>the, the, the, the, json query.</p>
<p>1443<br>01:08:46,180 –&gt; 01:08:48,180<br>And then for this one down here, same thing.</p>
<p>1444<br>01:08:48,180 –&gt; 01:08:50,180<br>I can have this one reference there.</p>
<p>1445<br>01:08:50,180 –&gt; 01:08:53,180<br>Now, I’m not showing this example here, because they can try.</p>
<p>1446<br>01:08:53,180 –&gt; 01:08:57,180<br>But like, in the second lateral query, I can also reference what was in the first one.</p>
<p>1447<br>01:08:57,180 –&gt; 01:09:00,180<br>These things get changed, get, change together.</p>
<p>1448<br>01:09:00,180 –&gt; 01:09:03,180<br>And again, this is a different concept when you think of SQL, because SQL is the unordered.</p>
<p>1449<br>01:09:03,180 –&gt; 01:09:07,180<br>We’re not specifying the, we don’t want to specify the order in which the database system should,</p>
<p>1450<br>01:09:07,180 –&gt; 01:09:08,180<br>should execute anything.</p>
<p>1451<br>01:09:08,180 –&gt; 01:09:10,180<br>We’re not really doing that.</p>
<p>1452<br>01:09:10,180 –&gt; 01:09:14,180<br>We’re just telling you that the order we, we want the computation to, to be performed,</p>
<p>1453<br>01:09:14,180 –&gt; 01:09:16,180<br>to compute the answer that we want.</p>
<p>1454<br>01:09:16,180 –&gt; 01:09:20,180<br>So the database system can decide, do I want to rewrite this as a bunch of joins</p>
<p>1455<br>01:09:20,180 –&gt; 01:09:22,180<br>and just execute them all concurrently?</p>
<p>1456<br>01:09:22,180 –&gt; 01:09:27,180<br>Or we’re going to decide to do it one after another, which we can then test,</p>
<p>1457<br>01:09:27,180 –&gt; 01:09:29,180<br>post-gust, or quickly, and see what it does.</p>
<p>1458<br>01:09:29,180 –&gt; 01:09:30,180<br>I don’t think I have copied here.</p>
<p>1459<br>01:09:30,180 –&gt; 01:09:36,180<br>Yeah, I’m sorry.</p>
<p>1460<br>01:09:36,180 –&gt; 01:09:38,180<br>I don’t have copy-pasted, but quickly.</p>
<p>1461<br>01:09:38,180 –&gt; 01:09:40,180<br>So, you can try it online later.</p>
<p>1462<br>01:09:40,180 –&gt; 01:09:42,180<br>All right.</p>
<p>1463<br>01:09:42,180 –&gt; 01:09:45,180<br>All right. The last thing I want to show you is commentable expressions.</p>
<p>1464<br>01:09:45,180 –&gt; 01:09:50,180<br>And so, CTEs were added 10-ish, 20-ish years ago.</p>
<p>1465<br>01:09:50,180 –&gt; 01:09:55,180<br>And this is a sort of similar to nested queries or similar to,</p>
<p>1466<br>01:09:56,180 –&gt; 01:09:59,180<br>if you’re writing data to a 10 table or something like that.</p>
<p>1467<br>01:09:59,180 –&gt; 01:10:04,180<br>So, way for us to take, specify a query that we want to get materialized,</p>
<p>1468<br>01:10:04,180 –&gt; 01:10:06,180<br>maybe I won’t use that word.</p>
<p>1469<br>01:10:06,180 –&gt; 01:10:12,180<br>We want to specify a query that could be stored in quotation marks at some virtual table.</p>
<p>1470<br>01:10:12,180 –&gt; 01:10:16,180<br>And then we can have another query reference, whatever’s inside of it.</p>
<p>1471<br>01:10:16,180 –&gt; 01:10:18,180<br>Right?</p>
<p>1472<br>01:10:18,180 –&gt; 01:10:22,180<br>So, in my really simple example here, I have a, this width clause.</p>
<p>1473<br>01:10:23,180 –&gt; 01:10:27,180<br>I give my CTE a name, then I have my as statement.</p>
<p>1474<br>01:10:27,180 –&gt; 01:10:30,180<br>And then, whatever’s inside this parentheses, whatever select query here,</p>
<p>1475<br>01:10:30,180 –&gt; 01:10:35,180<br>is going to get bound to this, this, this, this name here.</p>
<p>1476<br>01:10:35,180 –&gt; 01:10:40,180<br>And then, editing that comes below after the width statement can then reference it</p>
<p>1477<br>01:10:40,180 –&gt; 01:10:43,180<br>as if it was a table.</p>
<p>1478<br>01:10:45,180 –&gt; 01:10:46,180<br>Right?</p>
<p>1479<br>01:10:46,180 –&gt; 01:10:49,180<br>So, again, sort of, sort of, similar to something like this.</p>
<p>1480<br>01:10:50,180 –&gt; 01:10:55,180<br>So, essentially, the as clause is binding things to names to whatever,</p>
<p>1481<br>01:10:55,180 –&gt; 01:10:57,180<br>whatever’s inside my, my with statement here.</p>
<p>1482<br>01:10:57,180 –&gt; 01:11:01,180<br>So, I have again, a no table query selected one and two that’s going to produce one two,</p>
<p>1483<br>01:11:01,180 –&gt; 01:11:04,180<br>but it has a value of one column with one, one column with two.</p>
<p>1484<br>01:11:04,180 –&gt; 01:11:08,180<br>But then, within my, with my with statement appear,</p>
<p>1485<br>01:11:08,180 –&gt; 01:11:13,180<br>I can give now names to the columns, which then can be referenced down below in, in the query.</p>
<p>1486<br>01:11:14,180 –&gt; 01:11:18,180<br>You can do weird things too, like you can actually, in Postgres,</p>
<p>1487<br>01:11:18,180 –&gt; 01:11:21,180<br>we’ll let you actually name the columns the same thing.</p>
<p>1488<br>01:11:21,180 –&gt; 01:11:25,180<br>But then, when you actually try to reference it below, it’ll throw an error.</p>
<p>1489<br>01:11:25,180 –&gt; 01:11:30,180<br>So, again, this is, example, like the syntax is, is roughly the same,</p>
<p>1490<br>01:11:30,180 –&gt; 01:11:34,180<br>but the semantics can be different across, across different systems.</p>
<p>1491<br>01:11:34,180 –&gt; 01:11:36,180<br>Let’s see how, so let’s see how we actually want to use it.</p>
<p>1492<br>01:11:36,180 –&gt; 01:11:40,180<br>So, for this one, we went again, when to find the student record that has the highest ID,</p>
<p>1493<br>01:11:40,180 –&gt; 01:11:42,180<br>that’s enrolled in the one course.</p>
<p>1494<br>01:11:42,180 –&gt; 01:11:45,180<br>Again, we’ve showed how, for example, how to do this with, with Nested queries,</p>
<p>1495<br>01:11:45,180 –&gt; 01:11:47,180<br>and we do the joins.</p>
<p>1496<br>01:11:47,180 –&gt; 01:11:50,180<br>But now, we can do this with the CTE, where inside the CTE,</p>
<p>1497<br>01:11:50,180 –&gt; 01:11:55,180<br>first thing I’m going to do is compute the, the max student ID from, from the enroll table.</p>
<p>1498<br>01:11:55,180 –&gt; 01:11:58,180<br>And then, now, in my select statement down below,</p>
<p>1499<br>01:11:58,180 –&gt; 01:12:04,180<br>I can as a reference, my CTE, get that max ID, and then do my, my join on that.</p>
<p>1500<br>01:12:06,180 –&gt; 01:12:09,180<br>Again, the data decision should be smart enough to realize that,</p>
<p>1501<br>01:12:09,180 –&gt; 01:12:13,180<br>oh, I only have to run this, the CTE once, materialize it,</p>
<p>1502<br>01:12:13,180 –&gt; 01:12:20,180<br>and then now, I can reference it as if it was a, like, a temp table in, in any query below that, that calls it.</p>
<p>1503<br>01:12:23,180 –&gt; 01:12:25,180<br>Any question about CTEs?</p>
<p>1504<br>01:12:27,180 –&gt; 01:12:29,180<br>Okay.</p>
<p>1505<br>01:12:29,180 –&gt; 01:12:30,180<br>Just to finish up.</p>
<p>1506<br>01:12:30,180 –&gt; 01:12:33,180<br>So, again, hopefully the main takeaway from all of this is that SQL is not dead language.</p>
<p>1507<br>01:12:33,180 –&gt; 01:12:35,180<br>There’s a lot of cool things you can do with it.</p>
<p>1508<br>01:12:36,180 –&gt; 01:12:40,180<br>You want to try to do as much computations you can with the inner single statement.</p>
<p>1509<br>01:12:40,180 –&gt; 01:12:44,180<br>Now, it can be nested queries, you can do much more weird stuff inside of it.</p>
<p>1510<br>01:12:44,180 –&gt; 01:12:48,180<br>We want to avoid the round trips going back and forth between the client and the server.</p>
<p>1511<br>01:12:48,180 –&gt; 01:12:55,180<br>Because, again, the database system should, in theory, be smart enough to know what’s the best way to execute the query that you’re giving to it.</p>
<p>1512<br>01:12:55,180 –&gt; 01:12:59,180<br>As soon as you take stuff out of the database, do some Python code on it.</p>
<p>1513<br>01:12:59,180 –&gt; 01:13:02,180<br>That’s obviously outside the, the, the purview of the database system.</p>
<p>1514<br>01:13:02,180 –&gt; 01:13:05,180<br>So, if you can’t optimize, it can’t optimize that Python code.</p>
<p>1515<br>01:13:05,180 –&gt; 01:13:10,180<br>If you keep everything inside of the database system, it should be able to make a good effort to how to optimize it first.</p>
<p>1516<br>01:13:10,180 –&gt; 01:13:14,180<br>And again, also, the main takeaway from all of this is that there is a SQL standard.</p>
<p>1517<br>01:13:14,180 –&gt; 01:13:15,180<br>Nobody follows it exactly.</p>
<p>1518<br>01:13:15,180 –&gt; 01:13:18,180<br>Every single database system is going to be slightly different.</p>
<p>1519<br>01:13:19,180 –&gt; 01:13:23,180<br>People claim that, oh, it’s great to be, if you support SQL, because then you can go and be portable.</p>
<p>1520<br>01:13:23,180 –&gt; 01:13:28,180<br>Like, if I write my application on my SQL, I can very easily just port it to Postgres.</p>
<p>1521<br>01:13:28,180 –&gt; 01:13:30,180<br>That is not the case, right?</p>
<p>1522<br>01:13:30,180 –&gt; 01:13:35,180<br>Often times, whatever data system you pick at the beginning, that’s what you’re going to be stuck with for a long time.</p>
<p>1523<br>01:13:35,180 –&gt; 01:13:39,180<br>It’s, it’s, it’s, it’s not, non-trivial to move over.</p>
<p>1524<br>01:13:39,180 –&gt; 01:13:42,180<br>All right, so, last thing, homework one, it’ll be out today.</p>
<p>1525<br>01:13:42,180 –&gt; 01:13:45,180<br>It’s going to be writing SQL queries to basic data analysis.</p>
<p>1526<br>01:13:45,180 –&gt; 01:13:49,180<br>This year, we’re going to acquire you to do it on SQLite and DuckDB.</p>
<p>1527<br>01:13:49,180 –&gt; 01:13:50,180<br>All right?</p>
<p>1528<br>01:13:53,180 –&gt; 01:13:55,180<br>Reason-wise, because you’re right, you’re right, the same query.</p>
<p>1529<br>01:13:55,180 –&gt; 01:13:57,180<br>The same query, the next one will be slightly different.</p>
<p>1530<br>01:13:57,180 –&gt; 01:13:58,180<br>It won’t be too bad.</p>
<p>1531<br>01:13:58,180 –&gt; 01:14:03,180<br>But you’ll run the same query in SQLite, then you run on DuckDB, and you’ll see which one’s faster.</p>
<p>1532<br>01:14:03,180 –&gt; 01:14:04,180<br>Okay?</p>
<p>1533<br>01:14:04,180 –&gt; 01:14:06,180<br>And then you’ll have a sapiphany.</p>
<p>1534<br>01:14:06,180 –&gt; 01:14:09,180<br>Oh, one of them is much faster than the other one.</p>
<p>1535<br>01:14:09,180 –&gt; 01:14:11,180<br>You ever take a guess which one’s we faster?</p>
<p>1536<br>01:14:11,180 –&gt; 01:14:12,180<br>Why?</p>
<p>1537<br>01:14:12,180 –&gt; 01:14:15,180<br>What’s that?</p>
<p>1538<br>01:14:15,180 –&gt; 01:14:18,180<br>You say there’s more efficient nest queries.</p>
<p>1539<br>01:14:18,180 –&gt; 01:14:20,180<br>Part of reason, maybe.</p>
<p>1540<br>01:14:20,180 –&gt; 01:14:22,180<br>It’s not based on Postgres.</p>
<p>1541<br>01:14:22,180 –&gt; 01:14:25,180<br>DuckDB is not in turn, and that’s not the answer either.</p>
<p>1542<br>01:14:25,180 –&gt; 01:14:26,180<br>Okay.</p>
<p>1543<br>01:14:26,180 –&gt; 01:14:27,180<br>So, yes, in the back.</p>
<p>1544<br>01:14:27,180 –&gt; 01:14:28,180<br>One last shot.</p>
<p>1545<br>01:14:28,180 –&gt; 01:14:30,180<br>DuckDB is compiled and has a bunch of data sources.</p>
<p>1546<br>01:14:30,180 –&gt; 01:14:32,180<br>So, the other one’s not in the same way.</p>
<p>1547<br>01:14:32,180 –&gt; 01:14:33,180<br>That’s all the reason.</p>
<p>1548<br>01:14:33,180 –&gt; 01:14:35,180<br>Okay, so, you’re on these queries.</p>
<p>1549<br>01:14:35,180 –&gt; 01:14:36,180<br>DuckDB should be faster.</p>
<p>1550<br>01:14:36,180 –&gt; 01:14:38,180<br>You’ll be like, okay, why?</p>
<p>1551<br>01:14:38,180 –&gt; 01:14:39,180<br>That’s the rest of the semester.</p>
<p>1552<br>01:14:39,180 –&gt; 01:14:40,180<br>Okay?</p>
<p>1553<br>01:14:40,180 –&gt; 01:14:44,180<br>All right, so next, this will be it for SQL, next class.</p>
<p>1554<br>01:14:44,180 –&gt; 01:14:46,180<br>We’re actually starting talking how do you build a system, okay?</p>
<p>1555<br>01:14:46,180 –&gt; 01:14:47,180<br>Hit it.</p>
<p>1556<br>01:14:47,180 –&gt; 01:14:48,180<br>Okay?</p>
<p>1557<br>01:14:48,180 –&gt; 01:14:49,180<br>How do you build a system?</p>
<p>1558<br>01:14:49,180 –&gt; 01:14:50,180<br>Okay?</p>
<p>1559<br>01:14:50,180 –&gt; 01:14:51,180<br>Hit it.</p>
<p>1560<br>01:14:51,180 –&gt; 01:14:55,180<br>I’m going to pop you with the motherfucking hook up.</p>
<p>1561<br>01:14:55,180 –&gt; 01:14:58,180<br>28 a gram, depending on if it’s the pop.</p>
<p>1562<br>01:14:58,180 –&gt; 01:15:00,180<br>You ain’t hit the mob yet.</p>
<p>1563<br>01:15:00,180 –&gt; 01:15:02,180<br>Still got you shut up, I smack you with the bottom.</p>
<p>1564<br>01:15:02,180 –&gt; 01:15:04,180<br>I’m going to slap you.</p>
<p>1565<br>01:15:04,180 –&gt; 01:15:05,180<br>Don’t you worry about me.</p>
<p>1566<br>01:15:05,180 –&gt; 01:15:07,180<br>I’m not going to slap you.</p>
<p>1567<br>01:15:07,180 –&gt; 01:15:08,180<br>Yeah, yeah.</p>
<p>1568<br>01:15:08,180 –&gt; 01:15:09,180<br>Now listen.</p>
<p>1569<br>01:15:09,180 –&gt; 01:15:11,180<br>I’m the poppy with the motherfucking hook up.</p>
<p>1570<br>01:15:11,180 –&gt; 01:15:12,180<br>28 a gram.</p>
<p>1571<br>01:15:12,180 –&gt; 01:15:13,180<br>The pen and all if it’s the pop.</p>
<p>1572<br>01:15:13,180 –&gt; 01:15:15,180<br>You ain’t hit the mob yet.</p>
<p>1573<br>01:15:15,180 –&gt; 01:15:16,180<br>Still got you shut up.</p>
<p>1574<br>01:15:16,180 –&gt; 01:15:18,020<br>I smack you with the bottom of the cliff</p>
<p>1575<br>01:15:18,020 –&gt; 01:15:20,260<br>And tell you, look up, show me what it’s safe set</p>
<p>1576<br>01:15:20,260 –&gt; 01:15:22,460<br>For I blow your face back, I got a block</p>
<p>1577<br>01:15:22,460 –&gt; 01:15:24,380<br>On taps, the fets can’t trace that</p>
<p>1578<br>01:15:24,380 –&gt; 01:15:25,940<br>Style is like Tampa proof</p>
<p>1579<br>01:15:25,940 –&gt; 01:15:27,980<br>You can’t lace that at the Dominican</p>
<p>1580<br>01:15:27,980 –&gt; 01:15:30,460<br>Oh you the Chome Dominican Black Skelly</p>
<p>1581<br>01:15:30,460 –&gt; 01:15:32,340<br>Black, another Black Swade Timberlands</p>
<p>1582<br>01:15:32,340 –&gt; 01:15:35,340<br>My poor black 38, send you to the perigate</p>
<p>1583<br>01:15:35,340 –&gt; 01:15:36,740<br>You get the zombie trying to skate</p>
<p>1584<br>01:15:36,740 –&gt; 01:15:38,100<br>And that’s your first mistake</p>
<p>1585<br>01:15:38,100 –&gt; 01:15:39,820<br>I ain’t lying for that cake, you’re famous</p>
<p>1586<br>01:15:39,820 –&gt; 01:15:41,659<br>See you, wait, my grandson’s happy wait</p>
<p>1587<br>01:15:41,659 –&gt; 01:15:42,900<br>The Rand through every state</p>
<p>1588<br>01:15:42,899 –&gt; 01:15:45,379<br>When he acting how I’m living, I tell him I’m living great</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CMU15445 P3F202302 ModernSQL</div>
      <div>http://example.com/2025/10/24/CMU15445 P3F202302-ModernSQL/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/24/CMU15445%20P2F202301-RelationalModelAlgebra/" title="CMU15445 P2F202301 RelationalModelAlgebra">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CMU15445 P2F202301 RelationalModelAlgebra</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/24/CMU15445%20P25F202324-SingleStoreDatabaseOverview/" title="CMU15445 P25F202324 SingleStoreDatabaseOverview">
                        <span class="hidden-mobile">CMU15445 P25F202324 SingleStoreDatabaseOverview</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
