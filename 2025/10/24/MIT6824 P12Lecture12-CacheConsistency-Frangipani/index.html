

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:07,000Okay, so good morning, good afternoon or good evening or wherever you are. 200:00:07,000 –&gt; 00:00:11,000So the point for today is to talk about the frontier pony. 30">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6824 P12Lecture12 CacheConsistency Frangipani">
<meta property="og:url" content="http://example.com/2025/10/24/MIT6824%20P12Lecture12-CacheConsistency-Frangipani/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:07,000Okay, so good morning, good afternoon or good evening or wherever you are. 200:00:07,000 –&gt; 00:00:11,000So the point for today is to talk about the frontier pony. 30">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-24T12:02:19.366Z">
<meta property="article:modified_time" content="2025-10-24T12:06:28.572Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MIT6824 P12Lecture12 CacheConsistency Frangipani - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MIT6824 P12Lecture12 CacheConsistency Frangipani"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-24 20:02" pubdate>
          2025年10月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          81 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MIT6824 P12Lecture12 CacheConsistency Frangipani</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:07,000<br>Okay, so good morning, good afternoon or good evening or wherever you are.</p>
<p>2<br>00:00:07,000 –&gt; 00:00:11,000<br>So the point for today is to talk about the frontier pony.</p>
<p>3<br>00:00:11,000 –&gt; 00:00:17,000<br>This is a paper from 1997. So it’s a bit of an older paper.</p>
<p>4<br>00:00:17,000 –&gt; 00:00:29,000<br>The context of this paper is network file systems.</p>
<p>5<br>00:00:29,000 –&gt; 00:00:40,000<br>And you should think about systems such as, you know, a FINA AFS, you know, then do a file system and a FINA Dropbox or a more modern version of this.</p>
<p>6<br>00:00:40,000 –&gt; 00:00:46,000<br>But the general goal here is to basically share files between a collection of users.</p>
<p>7<br>00:00:46,000 –&gt; 00:00:53,000<br>The frontier pony itself is not widely used or wasn’t widely used outside of the deck.</p>
<p>8<br>00:00:53,000 –&gt; 00:01:01,000<br>And so the real, the focus of the things that you should get out of this paper today are free ideas.</p>
<p>9<br>00:01:01,000 –&gt; 00:01:05,000<br>An idea is that actually we’ll show up over and over in the couple next couple weeks.</p>
<p>10<br>00:01:05,000 –&gt; 00:01:09,000<br>First of all, cash coherence.</p>
<p>11<br>00:01:09,000 –&gt; 00:01:14,000<br>Protocols for cash coherence.</p>
<p>12<br>00:01:14,000 –&gt; 00:01:22,000<br>Second distributed locking.</p>
<p>13<br>00:01:22,000 –&gt; 00:01:33,000<br>And third distributed crash recovery.</p>
<p>14<br>00:01:33,000 –&gt; 00:01:38,000<br>And these are going to be free ideas that are going to be as I mentioned show up in the next couple of weeks.</p>
<p>15<br>00:01:38,000 –&gt; 00:01:44,000<br>In the particular, we’re going to read, you know, starting next week to sort of heavy duty transaction systems.</p>
<p>16<br>00:01:44,000 –&gt; 00:01:54,000<br>And they build a lot on, again, some of the technique or the use of the techniques that actually a frontier pony also uses.</p>
<p>17<br>00:01:54,000 –&gt; 00:02:03,000<br>And so frontier ponies are a more gently introduction to these free topics before we get to heavy duty transaction systems.</p>
<p>18<br>00:02:03,000 –&gt; 00:02:07,000<br>And the idea is also in front of itself is an interesting design.</p>
<p>19<br>00:02:07,000 –&gt; 00:02:12,000<br>And so from a distributed system perspective, it is a cool system.</p>
<p>20<br>00:02:12,000 –&gt; 00:02:20,000<br>And let me make that point by sort of trusting sort of the traditional designs for a network file system.</p>
<p>21<br>00:02:20,000 –&gt; 00:02:26,000<br>So traditional or the most common network file system designs.</p>
<p>22<br>00:02:26,000 –&gt; 00:02:34,000<br>And so if you think about like, and a F S on a few, you know, you have a set of clients.</p>
<p>23<br>00:02:34,000 –&gt; 00:02:36,000<br>And this is going to make a very simple picture.</p>
<p>24<br>00:02:36,000 –&gt; 00:02:45,000<br>You have a set of clients connected to some network represent the network basically is a single wire, you know, sharing, you know, a number of file servers.</p>
<p>25<br>00:02:45,000 –&gt; 00:02:47,000<br>And then file servers.</p>
<p>26<br>00:02:47,000 –&gt; 00:02:53,000<br>There desk.</p>
<p>27<br>00:02:53,000 –&gt; 00:02:58,000<br>And basically, all the complexity.</p>
<p>28<br>00:02:58,000 –&gt; 00:03:04,000<br>Okay, I’ll get to catch me here in detail in a second.</p>
<p>29<br>00:03:04,000 –&gt; 00:03:09,000<br>All the complexity in this design is basically here at the file server.</p>
<p>30<br>00:03:09,000 –&gt; 00:03:15,000<br>So the file server is implementing all the file system operations open closed reach right, you know, stat or everything.</p>
<p>31<br>00:03:15,000 –&gt; 00:03:19,000<br>And they write, you know, things to disk in the crash.</p>
<p>32<br>00:03:19,000 –&gt; 00:03:21,000<br>Resilient the resistant way.</p>
<p>33<br>00:03:21,000 –&gt; 00:03:24,000<br>And the clients are really sort of dumb or simple.</p>
<p>34<br>00:03:24,000 –&gt; 00:03:28,000<br>They don’t really do much, you know, perhaps they do some cashing us they do in a S.</p>
<p>35<br>00:03:28,000 –&gt; 00:03:37,000<br>But you know, most of it is they’re relaying, you know, file system operations from clients from programs that are running like whatever the irons on your client one.</p>
<p>36<br>00:03:37,000 –&gt; 00:03:39,000<br>And open closed.</p>
<p>37<br>00:03:39,000 –&gt; 00:03:43,000<br>And most of what the client does is relaying this operations to file servers.</p>
<p>38<br>00:03:43,000 –&gt; 00:03:49,000<br>In one reason that the design is, you know, popular is the because you know, like in terms of a security perspective.</p>
<p>39<br>00:03:49,000 –&gt; 00:03:57,000<br>And the client is a nice design because most of the, you know, the file servers have to be trusted, but the clients don’t have to be trusted.</p>
<p>40<br>00:03:57,000 –&gt; 00:04:04,000<br>And so, you know, setting like MIT were like the machines are just in public and you know, who is what kind of software on it.</p>
<p>41<br>00:04:04,000 –&gt; 00:04:07,000<br>You know, that is a nice property.</p>
<p>42<br>00:04:07,000 –&gt; 00:04:15,000<br>And there’s a very different design and much more decentralized design.</p>
<p>43<br>00:04:15,000 –&gt; 00:04:19,000<br>And in front of the body actually a lot of the file server.</p>
<p>44<br>00:04:19,000 –&gt; 00:04:23,000<br>It’s really there’s actually no real file server in the sort of little sense the word.</p>
<p>45<br>00:04:23,000 –&gt; 00:04:26,000<br>But the clients basically implement.</p>
<p>46<br>00:04:26,000 –&gt; 00:04:29,000<br>Run the file server code itself.</p>
<p>47<br>00:04:29,000 –&gt; 00:04:32,000<br>So let’s say we have two, you know, clients.</p>
<p>48<br>00:04:32,000 –&gt; 00:04:46,000<br>And most of the file system code itself like the thing that actually has I know manages I know updates and files creates directories all the code instead of living on the file server looks like lives on the clients.</p>
<p>49<br>00:04:46,000 –&gt; 00:04:59,000<br>And the only thing that really the file server share is a big virtual disk.</p>
<p>50<br>00:04:59,000 –&gt; 00:05:08,000<br>And if you will, you know, maybe a good image to have a year ahead or some conceptual image to have the ahead is that the virtual disk is basically like a big SSD drive.</p>
<p>51<br>00:05:08,000 –&gt; 00:05:16,000<br>And so the file servers, there’s basically share one SSD, you know, one disk with each other.</p>
<p>52<br>00:05:16,000 –&gt; 00:05:26,000<br>Now, of course, internally this virtual disk is implemented using a system called pedal and you know consists actually of many machines.</p>
<p>53<br>00:05:26,000 –&gt; 00:05:36,000<br>And you know, you know, you get another machine replicate you know disc blocks, you know, there are taxes internally to make sure that like it’s a lot of praises could apply in the right order and all what kind of stuff.</p>
<p>54<br>00:05:36,000 –&gt; 00:05:43,000<br>But from the outside perspective, you know, the interface is really read a block right a block.</p>
<p>55<br>00:05:43,000 –&gt; 00:05:46,000<br>And so it just looks like an ordinary disk.</p>
<p>56<br>00:05:46,000 –&gt; 00:05:56,000<br>And so where there’s interesting in this you know design you can contrast the two designs actually a lot of the complexity in this design is on the client side.</p>
<p>57<br>00:05:56,000 –&gt; 00:06:13,000<br>And you know, one reason they like that or why the is that you know you can grow the file system with the number of workstation, so if you increase the number of clients, you know, they’re basically get more CPU bar because you get more clients and then each of the clients can go around its own file system.</p>
<p>58<br>00:06:13,000 –&gt; 00:06:20,000<br>So a lot of the really happy to do the computation can just all be done on the client machines and doesn’t involve you know any file server at all.</p>
<p>59<br>00:06:20,000 –&gt; 00:06:25,000<br>And it’s true that in sort of in the left side, the network traditional network file system design.</p>
<p>60<br>00:06:25,000 –&gt; 00:06:41,000<br>It’s often the case that you know the performance bottom extra right, you know, in the in the file server, you know, one of the number of clients actually becomes too much often in that case, for example, we split the file system in across different file server version.</p>
<p>61<br>00:06:41,000 –&gt; 00:06:56,000<br>Okay, so that’s sort of the sort of from our perspective or least from the distributed systems design front to ponies, interesting because there’s like much more decentralized than sort of the traditional network file system designs.</p>
<p>62<br>00:06:56,000 –&gt; 00:07:06,000<br>And the reason you know they sort of wanted to explore this design is a lot to do with the use case that they imagine or that they were targeting.</p>
<p>63<br>00:07:06,000 –&gt; 00:07:11,000<br>And so I want to say a little bit about the use case because there were a lot of questions related to that in that of the email.</p>
<p>64<br>00:07:11,000 –&gt; 00:07:15,000<br>So, so what is the use case?</p>
<p>65<br>00:07:15,000 –&gt; 00:07:25,000<br>The use case is basically a number of researchers, where an engineer.</p>
<p>66<br>00:07:25,000 –&gt; 00:07:29,000<br>You know compiling.</p>
<p>67<br>00:07:29,000 –&gt; 00:07:40,000<br>Compiling editing, you know, their programs were writing documents.</p>
<p>68<br>00:07:40,000 –&gt; 00:07:52,000<br>And it’s really designing, you know, the papers from things research lab, that’s high tech, and tech, and tech, so it’s like tens of research like 50 to 100.</p>
<p>69<br>00:07:52,000 –&gt; 00:07:57,000<br>And they’re really worth it is designing a file system for their use case.</p>
<p>70<br>00:07:57,000 –&gt; 00:08:03,000<br>And so everybody is trusted. All the machines are trusted, all the software running that are untrusted.</p>
<p>71<br>00:08:03,000 –&gt; 00:08:07,000<br>And so the security side of things is really not an issue for that.</p>
<p>72<br>00:08:07,000 –&gt; 00:08:21,000<br>All the research are sort of heavy duty computer users and you know, and they want to, but mostly they’re working on their own private files and they’re writing their own programs, they’re writing their own documents.</p>
<p>73<br>00:08:21,000 –&gt; 00:08:26,000<br>And so there’s one to interact with the files with a high performance file system.</p>
<p>74<br>00:08:26,000 –&gt; 00:08:33,000<br>Of course, you know, they might share otherwise sharing would not be interesting.</p>
<p>75<br>00:08:33,000 –&gt; 00:08:37,000<br>So they post potentially share files and directories.</p>
<p>76<br>00:08:37,000 –&gt; 00:08:39,000<br>It shows up in sort of two ways.</p>
<p>77<br>00:08:39,000 –&gt; 00:08:45,000<br>You know, they may work together to collaborate together on writing a paper like the paper that we’re reading today.</p>
<p>78<br>00:08:45,000 –&gt; 00:08:52,000<br>And so they want to access the shared files, you know, for the director that holds that particular paper.</p>
<p>79<br>00:08:52,000 –&gt; 00:08:58,000<br>So use the user sharing.</p>
<p>80<br>00:08:58,000 –&gt; 00:09:11,000<br>And then there’s a second form of sharing that like the same user might log into multiple workstations.</p>
<p>81<br>00:09:11,000 –&gt; 00:09:13,000<br>One more workstation.</p>
<p>82<br>00:09:13,000 –&gt; 00:09:16,000<br>You know, there’s a lot of different ways of getting whatever.</p>
<p>83<br>00:09:16,000 –&gt; 00:09:22,000<br>You’re one of the research goes to the public library of Dexerrk or their library and the logs in one of the public workstation within Dexerrk.</p>
<p>84<br>00:09:22,000 –&gt; 00:09:24,000<br>And it wants to be able to be the right there.</p>
<p>85<br>00:09:24,000 –&gt; 00:09:26,000<br>Their files from that, you know, that machine too.</p>
<p>86<br>00:09:26,000 –&gt; 00:09:28,000<br>So that’s the use case.</p>
<p>87<br>00:09:28,000 –&gt; 00:09:35,000<br>And this use case has sort of a number of design implications.</p>
<p>88<br>00:09:35,000 –&gt; 00:09:41,000<br>Or you know design choices that were motivated by the use case.</p>
<p>89<br>00:09:41,000 –&gt; 00:09:52,000<br>And one of the primary ones that was motivated by this use case is caching.</p>
<p>90<br>00:09:52,000 –&gt; 00:09:58,000<br>So instead of leaving the data for example, all in pedal and every read and write operation goes through pedal.</p>
<p>91<br>00:09:58,000 –&gt; 00:10:02,000<br>They want to arrange it so that most of actually the action happens on the workstations.</p>
<p>92<br>00:10:02,000 –&gt; 00:10:08,000<br>And so that the researchers, since they’re mostly working on their own private files, you know, since it’s like make a lot of sense.</p>
<p>93<br>00:10:08,000 –&gt; 00:10:16,000<br>And if you’re able to make a lot of data locally on the workstation, then as you read the right files, there’s like basically no network traffic really necessary.</p>
<p>94<br>00:10:16,000 –&gt; 00:10:19,000<br>And you can sort of write at high performance.</p>
<p>95<br>00:10:19,000 –&gt; 00:10:29,000<br>And you know, one reason one way they avoid, you know, having seen a lot of traffic to pedal is they have a right back cash instead of a right through.</p>
<p>96<br>00:10:29,000 –&gt; 00:10:35,000<br>And so if operations happen actually, they just stay in the cash and at some point later they’re frequently related to pedal us.</p>
<p>97<br>00:10:35,000 –&gt; 00:10:38,000<br>And so that’s what I mean in the second one.</p>
<p>98<br>00:10:38,000 –&gt; 00:10:46,000<br>And so combined with that, like even though they’re doing mostly, you know, workloads are going to be sort of private where there’s not sharing going on.</p>
<p>99<br>00:10:46,000 –&gt; 00:11:02,000<br>Of course, indicates they do share they want to have strong consistency or sometimes called you know career is.</p>
<p>100<br>00:11:02,000 –&gt; 00:11:18,000<br>And so meaning, for example, if one user writes a file, then another user on the auto workstation reads the file, the great if that user actually saw the changes that the other workstation, the other user has made.</p>
<p>101<br>00:11:18,000 –&gt; 00:11:23,000<br>And so they want strong consistency.</p>
<p>102<br>00:11:23,000 –&gt; 00:11:43,000<br>So those are the two design choices that really drive this design as well as this, you know, basically performance.</p>
<p>103<br>00:11:43,000 –&gt; 00:11:55,000<br>And maybe it’s helpful, you know, to think a little bit about like what other use cases could you have a file system. So maybe one good one that we talked a lot about is to think about gfs.</p>
<p>104<br>00:11:55,000 –&gt; 00:12:01,000<br>You know, would gfs be substitute from front to bottom or the other way around like how do they contrast.</p>
<p>105<br>00:12:01,000 –&gt; 00:12:07,000<br>And one way to think about this is that you know gfs is really file system designed from that produce applications.</p>
<p>106<br>00:12:07,000 –&gt; 00:12:13,000<br>And so it’s a file system where files are not cashed.</p>
<p>107<br>00:12:13,000 –&gt; 00:12:19,000<br>And in fact, you know, the file system tend to be so big that they wouldn’t even fit in the type of cashers that we’re talking about.</p>
<p>108<br>00:12:19,000 –&gt; 00:12:23,000<br>The files are basically sort of wrapped in sequentially from beginning to end. And that’s it.</p>
<p>109<br>00:12:23,000 –&gt; 00:12:29,000<br>And then maybe you know some other computer will read that file because some other map produce application running on it.</p>
<p>110<br>00:12:29,000 –&gt; 00:12:31,000<br>And so I think you think about gfs.</p>
<p>111<br>00:12:31,000 –&gt; 00:12:39,000<br>There’s really no data cash going on at all. There was a little bit of cash going on to keep track of where the trunk servers were.</p>
<p>112<br>00:12:39,000 –&gt; 00:12:45,000<br>But there’s actually no cash from data going on at all in gfs. And so there’s also no cash consistency problem in gfs.</p>
<p>113<br>00:12:45,000 –&gt; 00:12:50,000<br>And so there’s a type of applications that they were targeting that just didn’t make a sense at all.</p>
<p>114<br>00:12:50,000 –&gt; 00:12:56,000<br>Similarly in gfs, gfs actually is not really a real file system in the sense of the here.</p>
<p>115<br>00:12:56,000 –&gt; 00:13:00,000<br>There’s not intended to run like vi gcc.</p>
<p>116<br>00:13:00,000 –&gt; 00:13:08,000<br>And so it didn’t provide like strips or it’s a positive or unique compatibility in the front of the you can just run your standard units applications.</p>
<p>117<br>00:13:08,000 –&gt; 00:13:17,000<br>And things just work out and the application behave in the same way as if there was not a distributed file system but basically single file system.</p>
<p>118<br>00:13:17,000 –&gt; 00:13:32,000<br>And again, in gfs, you know, there’s the there was not where there’s a little library, you know, not actually application use this for read or write files in gfs, but it was not like you know 100% doing this compatible at all.</p>
<p>119<br>00:13:32,000 –&gt; 00:13:36,000<br>So let me give you a sense that we’re going to these workloads.</p>
<p>120<br>00:13:36,000 –&gt; 00:13:44,000<br>And so it’s a very bright, you know, really the design of these different of these systems in the case of duty fast, and it’s the map reduce application that drove the design.</p>
<p>121<br>00:13:44,000 –&gt; 00:13:55,000<br>In the case of frontipani of the shared files is literally collection users working on some shared file system with most of the operations, you know, they’re performing a probably just on files day on.</p>
<p>122<br>00:13:55,000 –&gt; 00:13:58,000<br>And sort of getting the before we look at it.</p>
<p>123<br>00:13:58,000 –&gt; 00:14:16,000<br>Does that make sense? In turn for contrast and settings. So you see actually there are quite a different number of file systems around like a zookeeper’s yet another sort of provides this file system interface, but it’s not really a file system, you know, it’s like more of a tenant as a coordination service, you wouldn’t store big files in zookeeper.</p>
<p>124<br>00:14:16,000 –&gt; 00:14:22,000<br>Any questions about this setting.</p>
<p>125<br>00:14:22,000 –&gt; 00:14:35,000<br>Can you briefly repeat why having the file server code running on the client machine enhances scalability versus having the client and the file server being on different machines or on different.</p>
<p>126<br>00:14:35,000 –&gt; 00:14:43,000<br>Yeah, so for example, if you know that like to go back to this previous slide here, you know on the left, this the network file system and character, even there’s many, many, many clients.</p>
<p>127<br>00:14:43,000 –&gt; 00:14:53,000<br>Let’s think of there’s only one, you know, there’s let me simplify this picture for a second and look at the second file server there’s one file server so everybody can share the files and the free file server.</p>
<p>128<br>00:14:53,000 –&gt; 00:14:56,000<br>Then all these clients will be hammering on that single file server.</p>
<p>129<br>00:14:56,000 –&gt; 00:15:03,000<br>And so all the read and write-out breaks quick are going to be sent to the file server, the file server does the directory look up.</p>
<p>130<br>00:15:03,000 –&gt; 00:15:15,000<br>It opens files and just the security checks and all the kind of stuff so all the computation really for the file system itself is all happening on the file server itself in the sort of traditional network file system design.</p>
<p>131<br>00:15:15,000 –&gt; 00:15:17,000<br>In the front of Pony that’s not the case.</p>
<p>132<br>00:15:17,000 –&gt; 00:15:21,000<br>In front of Pony all the file system operations are executed on the workstations.</p>
<p>133<br>00:15:21,000 –&gt; 00:15:31,000<br>And so we have multiple workstations that are basically the workload that this file system can scale or can support scales with the number of workstations.</p>
<p>134<br>00:15:31,000 –&gt; 00:15:47,000<br>I see and in the traditional architecture so every file server contains or stores let’s say a section of the entire file system right so it does so it’s not the case that every single file server has a copy of the entire system.</p>
<p>135<br>00:15:47,000 –&gt; 00:15:49,000<br>It’s that it might be partitioned across.</p>
<p>136<br>00:15:49,000 –&gt; 00:16:02,000<br>Yeah, it might be a approximate example in a fast break, you know, there are different volumes and you know file servers manage different volumes and the data of all the users and my team spread across the different volumes.</p>
<p>137<br>00:16:02,000 –&gt; 00:16:05,000<br>But all the data like for one volume is going to be in one file server.</p>
<p>138<br>00:16:05,000 –&gt; 00:16:10,000<br>And so that file volume gets hit hard, you know, you’re going to get the forms bottom next.</p>
<p>139<br>00:16:10,000 –&gt; 00:16:14,000<br>Okay, awesome. Thank you.</p>
<p>140<br>00:16:14,000 –&gt; 00:16:26,000<br>Any more questions about sort of the setting here before we dive in to more front and pine.</p>
<p>141<br>00:16:26,000 –&gt; 00:16:28,000<br>Okay, good.</p>
<p>142<br>00:16:28,000 –&gt; 00:16:34,000<br>So now the design choices they made, I mean, it leads to a number of challenges.</p>
<p>143<br>00:16:34,000 –&gt; 00:16:42,000<br>So I want to talk a little bit about the challenges.</p>
<p>144<br>00:16:42,000 –&gt; 00:16:52,000<br>And the main one, you know, the drives almost a ton of the design is like so you have one workstations workstation one.</p>
<p>145<br>00:16:52,000 –&gt; 00:16:58,000<br>And those days when people have workstations and laptops were actually not really existed yet.</p>
<p>146<br>00:16:58,000 –&gt; 00:17:05,000<br>Today probably will be all kinds of laptops, but you know, so there’s a workstation and somebody like whatever reach a file.</p>
<p>147<br>00:17:05,000 –&gt; 00:17:10,000<br>Whatever, you know, maybe the great day to day today. So the great file.</p>
<p>148<br>00:17:10,000 –&gt; 00:17:16,000<br>And so that basically that means that that file actually is cashed inside of the workstation.</p>
<p>149<br>00:17:16,000 –&gt; 00:17:23,000<br>And so the client, you know, whatever program running, you know, the I you know, get an update and manipulate the file.</p>
<p>150<br>00:17:23,000 –&gt; 00:17:30,000<br>And then you know, sometimes later the result will be written back, you know, to pedal the disk, if you will.</p>
<p>151<br>00:17:30,000 –&gt; 00:17:35,000<br>And so the challenges that are basically run this model at free fault.</p>
<p>152<br>00:17:35,000 –&gt; 00:17:42,000<br>One somebody else in workstation to maybe at some point do a cat of F.</p>
<p>153<br>00:17:42,000 –&gt; 00:17:54,000<br>And get it the file F. And of course, it should be the case that you know, at least like normally expected we have a traditional unit file system that you know you will see the last right to that particular F.</p>
<p>154<br>00:17:54,000 –&gt; 00:18:04,000<br>So even though the right might have happened at a different workstation, when the second workstation reach the file, we would like to see that data show up.</p>
<p>155<br>00:18:04,000 –&gt; 00:18:11,000<br>And this is what they, you know, we’re going to be roughly this broadly comes to cash to hear us.</p>
<p>156<br>00:18:11,000 –&gt; 00:18:22,000<br>And other war synonyms for coherence are cash consistency, which is like the term that we have seen more in the previous papers, but in the sort of the</p>
<p>157<br>00:18:22,000 –&gt; 00:18:28,000<br>architecture world actually the term coherence comes comes from that world.</p>
<p>158<br>00:18:28,000 –&gt; 00:18:33,000<br>And so you can think about that as a synonyms.</p>
<p>159<br>00:18:33,000 –&gt; 00:18:43,000<br>To the second problem that you know, you that’s going to occur and we need to deal with is that let’s say that workstation one.</p>
<p>160<br>00:18:43,000 –&gt; 00:18:48,000<br>And workstation two both want to create a file in the particular in the shared directory.</p>
<p>161<br>00:18:48,000 –&gt; 00:18:58,000<br>So like when you’re in workstation one creates the file F in the directory D and workstation two also creates a file say G in directory D.</p>
<p>162<br>00:18:58,000 –&gt; 00:19:11,000<br>And we want to be arranged it at least that like it works as you want makes the changes and then workstation two makes the changes that like both files appear and that like one file doesn’t overwrite say the directory.</p>
<p>163<br>00:19:11,000 –&gt; 00:19:17,000<br>And the other or basically overwrite the directory in a way that actually the other files of disappears.</p>
<p>164<br>00:19:17,000 –&gt; 00:19:24,000<br>So this has to sort of second topic you really is on the city.</p>
<p>165<br>00:19:24,000 –&gt; 00:19:33,000<br>These operations of creating a file really has to be has to be sort of an atomic operation so that they don’t get introduced and we get wrong results.</p>
<p>166<br>00:19:33,000 –&gt; 00:19:41,000<br>So that’s a problem that we need to deal with is that you know workstation one.</p>
<p>167<br>00:19:41,000 –&gt; 00:19:51,000<br>You know my crash while doing one of these complex file system operations.</p>
<p>168<br>00:19:51,000 –&gt; 00:19:56,000<br>And so that has to be a story you know how actually the file system recovers.</p>
<p>169<br>00:19:56,000 –&gt; 00:20:02,000<br>And so this is really story about crash recovery.</p>
<p>170<br>00:20:02,000 –&gt; 00:20:07,000<br>So for example like in this first case where like workstation makes a file in a directory D.</p>
<p>171<br>00:20:07,000 –&gt; 00:20:14,000<br>Now there’s actually a complex operation you know the director needs to be modified and I know needs to be allocated and I know needs to be initialized.</p>
<p>172<br>00:20:14,000 –&gt; 00:20:17,000<br>And then the I know number needs to be written into the directory.</p>
<p>173<br>00:20:17,000 –&gt; 00:20:27,000<br>So there’s multiple sort of file system operation involved in it and we wanted to be the case that you know if the files through crashes between any of these steps in this sort of complex file system operation.</p>
<p>174<br>00:20:27,000 –&gt; 00:20:30,000<br>The better the case that the file system recovers correctly.</p>
<p>175<br>00:20:30,000 –&gt; 00:20:35,000<br>And more meaning we file some recovery correctly at least that it’s internal data structure are correct.</p>
<p>176<br>00:20:35,000 –&gt; 00:20:40,000<br>And so again, well that the I know is not lost because it doesn’t show up in the directory, etc, etc.</p>
<p>177<br>00:20:40,000 –&gt; 00:20:44,000<br>Or like even that the whole sort of internal structure is consistent.</p>
<p>178<br>00:20:44,000 –&gt; 00:20:46,000<br>So this is a topic of crash recovery.</p>
<p>179<br>00:20:46,000 –&gt; 00:20:54,000<br>And so panel basically were for defining each the address in all of these through problems and my client assistant go.</p>
<p>180<br>00:20:54,000 –&gt; 00:21:01,000<br>Walk through them one by one and discuss how front to party address system.</p>
<p>181<br>00:21:01,000 –&gt; 00:21:10,000<br>Any questions about the top level challenges.</p>
<p>182<br>00:21:10,000 –&gt; 00:21:28,000<br>Okay, let’s proceed. So the first thing is cash ringer for cash consistency.</p>
<p>183<br>00:21:28,000 –&gt; 00:21:39,000<br>And so the key aspect in the solution that front to bottom uses is that actually use a lock server somewhere.</p>
<p>184<br>00:21:39,000 –&gt; 00:21:46,000<br>And so and the lock server basically has a table.</p>
<p>185<br>00:21:46,000 –&gt; 00:21:52,000<br>And for every file and an X instance, I know number but for every file.</p>
<p>186<br>00:21:52,000 –&gt; 00:21:58,000<br>Who has to walk at this particular point of time. So who’s the owner.</p>
<p>187<br>00:21:58,000 –&gt; 00:22:08,000<br>So we might have a file F and basically says work and for which the lock server has a record that the work station one own staff particular why.</p>
<p>188<br>00:22:08,000 –&gt; 00:22:17,000<br>And the lock server itself is a distributed service and you can almost think about it or sort of almost like zookeeper.</p>
<p>189<br>00:22:17,000 –&gt; 00:22:21,000<br>And it is that it provides your acquire your leasing of locks.</p>
<p>190<br>00:22:21,000 –&gt; 00:22:29,000<br>It’s fault tolerance in the case of front to bunny that use some taxes based implementation.</p>
<p>191<br>00:22:29,000 –&gt; 00:22:36,000<br>But it’s spread over across multiple machines highly fault tolerance, etc, etc.</p>
<p>192<br>00:22:36,000 –&gt; 00:22:41,000<br>So that’s the lock server.</p>
<p>193<br>00:22:41,000 –&gt; 00:22:47,000<br>The turns out that the work station sort of also keep a table for their locks.</p>
<p>194<br>00:22:47,000 –&gt; 00:22:56,000<br>So here’s work station one. And you know, that might be, you know, let’s say work station one cash is filed F and G.</p>
<p>195<br>00:22:56,000 –&gt; 00:23:03,000<br>Maybe age is cash by work station works, station one, ages maybe cash by work station two.</p>
<p>196<br>00:23:03,000 –&gt; 00:23:15,000<br>And then work station one has a similar table and that list for every file, every lock that it holds when it’s either busy or idle.</p>
<p>197<br>00:23:15,000 –&gt; 00:23:19,000<br>So like it may be F, you know, the lock status is busy.</p>
<p>198<br>00:23:19,000 –&gt; 00:23:26,000<br>And that really means that actually the file servers just operating on that file. So it’s actively using that file.</p>
<p>199<br>00:23:26,000 –&gt; 00:23:34,000<br>But there’s a second state, namely, let’s say we have filed G was also cash there. And maybe G is actually in the state, but they call idle.</p>
<p>200<br>00:23:34,000 –&gt; 00:23:44,000<br>That means actually the G at that point is not being modified and we’re not being worked on by the file server that particular instant time.</p>
<p>201<br>00:23:44,000 –&gt; 00:23:48,000<br>But it’s basically what they call a sticky lock.</p>
<p>202<br>00:23:48,000 –&gt; 00:24:07,000<br>If you know the file server at some point soon, you know, it’s going to use a G again, it can actually do so without actually having to communicate the pedal or reload its cash or anything like that at all, because it has a sticky lock knows that nobody else actually has acquired no other work station has required the lock in the meantime.</p>
<p>203<br>00:24:07,000 –&gt; 00:24:27,000<br>That’s the sticky lock and turns out that the the the these are just two building blocks that then are then being used to what they call what’s what’s called a cash be here protocol and set a message is worse and a rules that are being followed to actually get cash consistency.</p>
<p>204<br>00:24:27,000 –&gt; 00:24:39,000<br>And the basic rule is that you know the guiding rule is to cash a file.</p>
<p>205<br>00:24:39,000 –&gt; 00:24:44,000<br>You first must acquire the lock.</p>
<p>206<br>00:24:44,000 –&gt; 00:24:53,000<br>So you know that rule is sort of the stepping stone for actually getting cash to his consistency or cash be here.</p>
<p>207<br>00:24:53,000 –&gt; 00:25:02,000<br>And I’m going to make a small simplification in the paper to describe the blocks basically being exclusive or read or write or walks.</p>
<p>208<br>00:25:02,000 –&gt; 00:25:13,000<br>I’m just going to assume for the rest of the lecture that they’re exclusive doesn’t really matter, but there’s an optimization that basically multiple workstations can have a file cash in read only mode.</p>
<p>209<br>00:25:13,000 –&gt; 00:25:23,000<br>So with that, let me talk a little bit about the cut shout out of the protocol that for him to finally uses.</p>
<p>210<br>00:25:23,000 –&gt; 00:25:28,000<br>And again, you know, cash coherence or cash consistency.</p>
<p>211<br>00:25:28,000 –&gt; 00:25:35,000<br>The goal actually for even though the file system is distributed should behave like a single file system.</p>
<p>212<br>00:25:35,000 –&gt; 00:25:41,000<br>So one file server you want to basically that the same results would be returned by the distributed file system.</p>
<p>213<br>00:25:41,000 –&gt; 00:25:45,000<br>So you can’t cut the difference where it’s distributed or not.</p>
<p>214<br>00:25:45,000 –&gt; 00:25:53,000<br>And so this is a sure you remind me of like linearizability. So I think you know I believe actually what from Japan.</p>
<p>215<br>00:25:53,000 –&gt; 00:25:57,000<br>So it’s actually a linearizable file system operations.</p>
<p>216<br>00:25:57,000 –&gt; 00:26:01,000<br>Okay, so we got the lock server.</p>
<p>217<br>00:26:01,000 –&gt; 00:26:04,000<br>We got workstation one.</p>
<p>218<br>00:26:04,000 –&gt; 00:26:08,000<br>And there’s workstations to.</p>
<p>219<br>00:26:08,000 –&gt; 00:26:19,000<br>And there’s sort of four messages that are important to hear does not namely requesting the lock granting the lock and revoking a lock and actually releasing the locks.</p>
<p>220<br>00:26:19,000 –&gt; 00:26:27,000<br>And the message is the flyer between back and forward between workstations and lock server and lock server and other workstations.</p>
<p>221<br>00:26:27,000 –&gt; 00:26:35,000<br>So let’s look at this. Let’s say the lock server has nobody has any locks at any time. So let’s trust and timelines.</p>
<p>222<br>00:26:35,000 –&gt; 00:26:47,000<br>And workstation in one wants the request wants to reach right file F, you know, basically sense and request for the lock to the lock server for file F.</p>
<p>223<br>00:26:47,000 –&gt; 00:26:51,000<br>So workstation can do anything really at this point yet.</p>
<p>224<br>00:26:51,000 –&gt; 00:27:04,000<br>The lock server no checks, it’s table and sees that F actually is not used by anybody else, you know, less workstation one as the lock owner and sends basically invested back and granting.</p>
<p>225<br>00:27:04,000 –&gt; 00:27:07,000<br>The lock for F.</p>
<p>226<br>00:27:07,000 –&gt; 00:27:20,000<br>And then you know, workstation one required to walk for F now it can actually read a right or not it can actually read the file from pedal.</p>
<p>227<br>00:27:20,000 –&gt; 00:27:29,000<br>And actually can make modifications to it to know those part of the case and just stay local, nothing really happens is right back cash, not a right through catch.</p>
<p>228<br>00:27:29,000 –&gt; 00:27:33,000<br>So just this stays happily on the decline side.</p>
<p>229<br>00:27:33,000 –&gt; 00:27:43,000<br>In fact, the workstation can even release the lock, you know, here and basically go from busy to idle.</p>
<p>230<br>00:27:43,000 –&gt; 00:27:53,000<br>And so we have it actually would need to walk again, for example, once the right F where we write F again, you know, you can actually do the completely local without any interaction with the lock server.</p>
<p>231<br>00:27:53,000 –&gt; 00:27:59,000<br>And there’s slight simplification here, you know, there’s as we’ll see in a second that the lock has a least associated with it.</p>
<p>232<br>00:27:59,000 –&gt; 00:28:09,000<br>So the client at least has to refresh the least periodically, but it doesn’t have to rewrite re re re re re re re re file F from actually pedal if the least hasn’t expired.</p>
<p>233<br>00:28:09,000 –&gt; 00:28:16,000<br>Okay, so so the instant case of course happens like, you know, what if workstation two wants to read the file F.</p>
<p>234<br>00:28:16,000 –&gt; 00:28:28,000<br>And so, you know, what happened when I say workstation two wants to read and basically it will do the same thing it will send in an acquire or a request message, sorry request message to lock server for saying I want F.</p>
<p>235<br>00:28:28,000 –&gt; 00:28:43,000<br>And the way it then works is that the lock server actually looks at the stable sees that the F is actually owned by workstation one and then we’ll send the revoke message to workstation one asking the lock back.</p>
<p>236<br>00:28:43,000 –&gt; 00:28:57,000<br>So the revoke F and at this point, pedal actually has to be a little bit of from defining actually a little bit of work, because then we have to make sure that workstation two observes the rights that workstation one is done.</p>
<p>237<br>00:28:57,000 –&gt; 00:29:02,000<br>And so the way that is done is the basically this instant of time.</p>
<p>238<br>00:29:02,000 –&gt; 00:29:06,000<br>The workstation one writes actually F, you know, two pedal.</p>
<p>239<br>00:29:06,000 –&gt; 00:29:13,000<br>And we’ll see in a second that actually writing F to pedals actually slightly complicated operations more sophisticated than I’m just making it out to be.</p>
<p>240<br>00:29:13,000 –&gt; 00:29:20,000<br>But just think about it like at this point workstation one is basically flashing it state related to F to pedal.</p>
<p>241<br>00:29:20,000 –&gt; 00:29:32,000<br>Once that actually is completed so like once pedal for the knowledge that actually it actually has received all the data and actually sends a message back releasing F.</p>
<p>242<br>00:29:32,000 –&gt; 00:29:45,000<br>And you know once locks are because the release of F you know that can update it’s stable you know and allocate the lock to workstation two and since you know a grant for F to two.</p>
<p>243<br>00:29:45,000 –&gt; 00:30:01,000<br>And at this point the workstation two requires lock and now it can actually read all the information from the file F and pedal.</p>
<p>244<br>00:30:01,000 –&gt; 00:30:18,000<br>At that point it is guaranteed that we’ll see the latest changes to the file F because the previous owner must have flush you know the state you know to the to pedal before it actually released the lock and get it back to the lock server.</p>
<p>245<br>00:30:18,000 –&gt; 00:30:30,000<br>And so workstation two is guaranteed to actually observe those changes and so the usual are strong consistency comes in these strong consistency are tight into the lock management.</p>
<p>246<br>00:30:30,000 –&gt; 00:30:35,000<br>And of course it’s about this.</p>
<p>247<br>00:30:35,000 –&gt; 00:30:37,000<br>There’s a question.</p>
<p>248<br>00:30:37,000 –&gt; 00:30:40,000<br>Yeah okay.</p>
<p>249<br>00:30:40,000 –&gt; 00:30:52,000<br>We need to write what one question in the chat let me do the address the first would we need to write to pedal when releasing both read and write locks why we need to write to pedal when releasing a read lock.</p>
<p>250<br>00:30:52,000 –&gt; 00:31:17,000<br>Let’s ignore read write read the things in between read and write exclusive locks and read right locks in the and just focus on exclusive locks read read read things just a small up you know it’s an important optimization but it doesn’t really change the designer system doctor mad.</p>
<p>251<br>00:31:17,000 –&gt; 00:31:20,000<br>And the other questions.</p>
<p>252<br>00:31:20,000 –&gt; 00:31:27,000<br>So this sort of design would be really inefficient if we have like two different workstations that are both modifying the same file.</p>
<p>253<br>00:31:27,000 –&gt; 00:31:30,000<br>Yeah you just get like cash bouncing back and forth.</p>
<p>254<br>00:31:30,000 –&gt; 00:31:40,000<br>Yeah you would be if you’re two board stations or two different engineers at the expert will be banging on the same file you know the file would go back or forth.</p>
<p>255<br>00:31:40,000 –&gt; 00:31:52,000<br>And so it is not really suitable so you can see here the influence of like the workload that they’re designing for you know the really assumption is that basically you know most engineers are working on their private files.</p>
<p>256<br>00:31:52,000 –&gt; 00:32:03,000<br>And you know once a while they’ll share files but they’re probably not banging on the same shared file.</p>
<p>257<br>00:32:03,000 –&gt; 00:32:15,000<br>And then we’re not using it but like you could imagine like if they have a shared code repository you check out your own copy of the code repository make all the modifications and at some point get right to back.</p>
<p>258<br>00:32:15,000 –&gt; 00:32:23,000<br>I’m sorry just to make sure you say you can release the lock while you still have the file in a cash rate.</p>
<p>259<br>00:32:23,000 –&gt; 00:32:26,000<br>You can.</p>
<p>260<br>00:32:26,000 –&gt; 00:32:37,000<br>Okay so I’m going to be very careful with what I meant with releasing the lock there is not releasing it to the lock server but locally you know changing the status from busy to idle.</p>
<p>261<br>00:32:37,000 –&gt; 00:32:49,000<br>And since you know the lock is sticky you know it still sits at workstation one and the lock server still things that actually workstation one has to lock.</p>
<p>262<br>00:32:49,000 –&gt; 00:32:52,000<br>Not answering your question.</p>
<p>263<br>00:32:52,000 –&gt; 00:32:55,000<br>Yeah yeah thank you.</p>
<p>264<br>00:32:55,000 –&gt; 00:33:02,000<br>So what happens if the request from two comes a while busy.</p>
<p>265<br>00:33:02,000 –&gt; 00:33:10,000<br>Yeah it’s a good question what do you think that happens.</p>
<p>266<br>00:33:10,000 –&gt; 00:33:12,000<br>Is it just rejected?</p>
<p>267<br>00:33:12,000 –&gt; 00:33:30,000<br>No that’s I think it doesn’t reject it but just waits and wait until workstation one is done you know modifying the file after executing its file system operation and then the france upon the code will release locally the lock will see that somebody is waiting for it.</p>
<p>268<br>00:33:30,000 –&gt; 00:33:38,000<br>And so that doesn’t change it into busy but actually starts flushing all the operations to pedal and then releases the lock.</p>
<p>269<br>00:33:38,000 –&gt; 00:33:46,000<br>So this comes actually nicely to the second point which is this automissory point so maybe that will make it more clear.</p>
<p>270<br>00:33:46,000 –&gt; 00:33:57,000<br>Let me talk a little bit about the missity because they’re also use of the same walks to actually achieve atomic after file system operations.</p>
<p>271<br>00:33:57,000 –&gt; 00:34:03,000<br>So using locks.</p>
<p>272<br>00:34:03,000 –&gt; 00:34:13,000<br>So when, for example, you do a create operation like you execute to create file system operation, whatever create F.</p>
<p>273<br>00:34:13,000 –&gt; 00:34:16,000<br>You know what are the usual arguments.</p>
<p>274<br>00:34:16,000 –&gt; 00:34:25,000<br>So if you work internally even though the application makes this create file system called this internally actually has multiple file system modifications.</p>
<p>275<br>00:34:25,000 –&gt; 00:34:31,000<br>For example, the directory needs to be modified actually let me do it in a slightly different order.</p>
<p>276<br>00:34:31,000 –&gt; 00:34:35,000<br>You need to allocate an I note for F.</p>
<p>277<br>00:34:35,000 –&gt; 00:34:38,000<br>You need to initialize that I note.</p>
<p>278<br>00:34:38,000 –&gt; 00:34:44,000<br>And then you know update the directory.</p>
<p>279<br>00:34:44,000 –&gt; 00:34:53,000<br>Update the directory to happen at an entry basically for you know the cheap old F and whatever I know number was allocated for F.</p>
<p>280<br>00:34:53,000 –&gt; 00:34:57,000<br>So stick away in which a unique file system that I implement files.</p>
<p>281<br>00:34:57,000 –&gt; 00:35:02,000<br>And so we need the range that these operations happen atomically.</p>
<p>282<br>00:35:02,000 –&gt; 00:35:10,000<br>Because we don’t want to sort of intermediate results be visible to other workstations in the way that happens is using you know by acquiring those locks.</p>
<p>283<br>00:35:10,000 –&gt; 00:35:14,000<br>Required the lock.</p>
<p>284<br>00:35:14,000 –&gt; 00:35:19,000<br>For this particular I note, you know, for example, I know 10 so you’re quite a lot of ref.</p>
<p>285<br>00:35:19,000 –&gt; 00:35:27,000<br>I’m just going to use half as the lock thing but you know it’s going to be an I know number and then at some point the releases.</p>
<p>286<br>00:35:27,000 –&gt; 00:35:31,000<br>So the system at the implementation itself releases the lock.</p>
<p>287<br>00:35:31,000 –&gt; 00:35:43,000<br>And again this releases a local release operation that doesn’t really mean immediately releasing it back to the lock server just made changing the status from PC to idle.</p>
<p>288<br>00:35:43,000 –&gt; 00:35:51,000<br>And so, so if at any particular point of time, as we just ask, you know there’s a request coming in for.</p>
<p>289<br>00:35:51,000 –&gt; 00:36:06,000<br>So if you have a request for a local release operation that is not actually being served into the local file system that is not actually being served into the file system the local front simply file system of workstation one.</p>
<p>290<br>00:36:06,000 –&gt; 00:36:09,000<br>Has calls the local release operation.</p>
<p>291<br>00:36:09,000 –&gt; 00:36:15,000<br>And then it sees that when the dust or local release operation it sees that there’s a revoke waiting.</p>
<p>292<br>00:36:15,000 –&gt; 00:36:22,000<br>And at this point it’s going to flush, you know, is cast state.</p>
<p>293<br>00:36:22,000 –&gt; 00:36:26,000<br>Is cast state to pedal.</p>
<p>294<br>00:36:26,000 –&gt; 00:36:44,000<br>And once it actually has a faucet cast state to pedal it will grant basically the revoke or accept the revoke and send back a release to the locks server so that then the lock can be assigned to workstation to.</p>
<p>295<br>00:36:44,000 –&gt; 00:37:04,000<br>So just to make sure so in this create operation here we have to modify the I node for so we have to modify the I node for F and the I node for the directory that contains F because we have to update the references and so that means that.</p>
<p>296<br>00:37:04,000 –&gt; 00:37:12,000<br>Like technically speaking we’re actually holding two locks and we have to release both of them before we reply back to the revoke.</p>
<p>297<br>00:37:12,000 –&gt; 00:37:27,000<br>Yes, absolutely so so again there’s a whole section about this over in the paper and then really talk about this and do but basically they sort of have not very of course great locks but also not very fine grained plot of garage locks that basically have a lock in a prior I know.</p>
<p>298<br>00:37:27,000 –&gt; 00:37:52,000<br>The director’s nine out files and I know and in fact the director’s nothing else than a file with sort of specific format format and so we really to create F you know we actually have to allocate first allocate the lock or acquired the lock in the directory D and then you know would allocate or acquired the walk on I note for F and so hold two locks.</p>
<p>299<br>00:37:52,000 –&gt; 00:38:14,000<br>And as you probably have noticed you know the course of your shoes you have to acquire multiple locks there’s a potential risk of debt lock you know you have like one workstation allocates locks into different order you could have that lock and so for Japan you follow rules that basically all walks are ordered in a particular way and you acquired the locks in the fixed order.</p>
<p>300<br>00:38:14,000 –&gt; 00:38:21,000<br>I see thank you I think the locks are ordered by walk number I know number.</p>
<p>301<br>00:38:21,000 –&gt; 00:38:28,000<br>So I know they said yeah so there’s a bunch of more complexity there.</p>
<p>302<br>00:38:28,000 –&gt; 00:38:50,000<br>Okay so the you know so having discussed sort of the other misidio file system operations at least during crashes you know if there’s no crashes you know at least it’s guaranteed that these operations happen automatically because the locks ensure automaticity of course it could be the case that like we’re unlucky right and so the work.</p>
<p>303<br>00:38:50,000 –&gt; 00:39:04,000<br>The workstation one crashes like right in the middle of these operations for example it has allocated allocated the I note actually has not updated the directory and let’s say the crash happens here.</p>
<p>304<br>00:39:04,000 –&gt; 00:39:17,000<br>You know and if we don’t do anything special like what about us to concern that we might have.</p>
<p>305<br>00:39:17,000 –&gt; 00:39:25,000<br>Okay let me concern that we might have is that you know some file system operation actually is only partially applied to pedal.</p>
<p>306<br>00:39:25,000 –&gt; 00:39:40,000<br>And that becomes more clear if we actually think about the scenario what actually happens in this particular state like when the state of the cash actually flushed you know to pedal and so this is the topic of correction covering.</p>
<p>307<br>00:39:47,000 –&gt; 00:39:53,000<br>It turns out that actually updating the state in.</p>
<p>308<br>00:39:53,000 –&gt; 00:40:22,000<br>In updating the state in that pedal also follows actually pretty careful protocol in this protocol so it’s a typically called right ahead logging.</p>
<p>309<br>00:40:22,000 –&gt; 00:40:51,000<br>This is probably the term you already have seen many have seen the probably six or three three and you know pedal uses the two which are a very common technique and it will also play a big important role in subsequent papers that we’ll see and so pedals actually nice reintroduction to this idea of right ahead logging and the way to think about right now you know it’s a pedals designed right to let it hog use of right ahead logging is very similar to any other right ahead logging scheme.</p>
<p>310<br>00:40:51,000 –&gt; 00:41:08,000<br>And so you know the way to think about it is as follows you know we have our disk a virtual disk and we just think about the disk as like a long gene long array of blocks and what they’ve done is part of the disk is reserved as a log.</p>
<p>311<br>00:41:08,000 –&gt; 00:41:17,000<br>In fact in the case of pedal there’s a lot of per server but let’s refer now let’s just assume there’s like one single log and then there’s the file system.</p>
<p>312<br>00:41:17,000 –&gt; 00:41:38,000<br>So there’s part of the disk is the reserve for the logging you know part of the disk is the file system in the file system contains the I notes you know some data blocks etc etc and and the rule is that when you update the state and pedal first thing you do is actually your first log update.</p>
<p>313<br>00:41:38,000 –&gt; 00:41:50,000<br>So when if we go back to the previous picture and after at the point the.</p>
<p>314<br>00:41:50,000 –&gt; 00:42:19,000<br>The front of the workstation one I want to give back the lock you know to the lock server it first has to write it state you know to pedal and that goes in two steps the first step is what the update description of the update you know to the log to the lock version so you have example you know we’ll get a record that says like you know create basically describes the create operation so that we’ll have you know whatever allocate I note.</p>
<p>315<br>00:42:19,000 –&gt; 00:42:31,000<br>I know number whatever it basically the result of what happened if you allocate it I know number and the directory change.</p>
<p>316<br>00:42:31,000 –&gt; 00:42:57,000<br>And will be a little bit more specific in a second that’s sort of the update contains the modifications need to be made to happen to the file system blocks to actually reflect the change so you first you know walk to the first log the update and then once you have updated the log then we the second operation of the client executes the word station executes is actually installing the update.</p>
<p>317<br>00:43:01,000 –&gt; 00:43:23,000<br>And the reason you know for doing it in sort of two steps is that you know once you know you’ve logged all your changes then it’s completely safe to update the data box because they always will end up in all the data files and workers are always will end up in a consistent state.</p>
<p>318<br>00:43:23,000 –&gt; 00:43:33,000<br>And the way to see this is basically let’s assume you know the client workstation that was actually flashing it state to the pedal you know crashes right here.</p>
<p>319<br>00:43:37,000 –&gt; 00:43:37,599<br>Is that okay.</p>
<p>320<br>00:43:37,599 –&gt; 00:43:51,599<br>Yes, because since everything is locked the what was it called like the demon recovery service.</p>
<p>321<br>00:43:51,599 –&gt; 00:44:02,599<br>Yeah, correct. So yeah, the demon is going to go back to there’s going to be a demon or when there’s a crash there’s basically demons sees if there’s anything in the log if there’s anything in the log of use of quite to file system.</p>
<p>322<br>00:44:03,599 –&gt; 00:44:09,599<br>And why actually do this in this way why not just write immediately update the file system.</p>
<p>323<br>00:44:14,599 –&gt; 00:44:19,599<br>Because we can crash in the middle of the update and we don’t know what we’ve done and we didn’t.</p>
<p>324<br>00:44:19,599 –&gt; 00:44:29,599<br>Yeah, exactly right so we’ve been in this or been there’s our previous example you know the allocating and I noticed usually you know to making some change somewhere like to an I know block.</p>
<p>325<br>00:44:29,599 –&gt; 00:44:38,599<br>And actually adding the directory to add in the file after you know to a particular directory of data directory block or a data block somewhere.</p>
<p>326<br>00:44:38,599 –&gt; 00:44:47,599<br>And so these are two separate rights right to separate this watch and they’re not atomic so we would crash between one of the two then we might have allocated the I know but not stuck in the directory.</p>
<p>327<br>00:44:47,599 –&gt; 00:44:56,599<br>And basically what will happen if we crash and recover is basically we lose the I know unless you know we can scan the whole disk but that’s very expensive.</p>
<p>328<br>00:44:57,599 –&gt; 00:45:08,599<br>And so instead we’re doing is we’re basically logging the two changes first where we were logging a record describing both changes first and then you know apply the changes.</p>
<p>329<br>00:45:08,599 –&gt; 00:45:20,599<br>So how do we ensure that operation one is atomic so the first log to update the first log update yeah that’s interesting so the paper section down 100% crisp on this but there’s a couple ways of doing it.</p>
<p>330<br>00:45:20,599 –&gt; 00:45:38,599<br>They mentioned that every log record has a check zone and so they use the check zone to see if there’s actually so before the read the log record you know the read the log record we compute to check some just to make sure that the whole record is complete.</p>
<p>331<br>00:45:38,599 –&gt; 00:45:39,599<br>I see thank you.</p>
<p>332<br>00:45:39,599 –&gt; 00:45:46,599<br>Another way of doing it which is a couple of ways doing it is you’re right you know a couple blocks like one to you and then you write a commit record.</p>
<p>333<br>00:45:46,599 –&gt; 00:45:54,599<br>And the assumption is that writing a single block a single five in the 12 sector is an atomic operation so it either happens that it doesn’t happen.</p>
<p>334<br>00:45:54,599 –&gt; 00:45:58,599<br>And so you do commit records says rights are done or rights are not done.</p>
<p>335<br>00:45:58,599 –&gt; 00:46:09,599<br>And so you can just look at the commit record and if the commit records is not there then you know that you know the operation is not completely recorded yet and you should not execute any effect.</p>
<p>336<br>00:46:09,599 –&gt; 00:46:25,599<br>I see and also to double check to the previous slide if the crash happens before we flush things to pedal then this is not a problem right because if the workstation crashes will the cash goes with the workstation but there’s no you can still stay for any other workstation.</p>
<p>337<br>00:46:25,599 –&gt; 00:46:36,599<br>That’s correct. Yeah just the data would be lost that’s it and but it will since it’s not written that will be any visibility problem so it’s really you know the crash crash here correct.</p>
<p>338<br>00:46:36,599 –&gt; 00:46:43,599<br>Not one doesn’t really matter in some ways the one actually matters is the crash during this flush operation.</p>
<p>339<br>00:46:43,599 –&gt; 00:46:50,599<br>Thank you.</p>
<p>340<br>00:46:50,599 –&gt; 00:47:03,599<br>Okay so there’s a warning subtly in front of panee which we’ll talk about in a second a little bit more deeper detail namely that in front of panee there’s a</p>
<p>341<br>00:47:03,599 –&gt; 00:47:09,599<br>unlock per server and that’s sort of unusual.</p>
<p>342<br>00:47:09,599 –&gt; 00:47:22,599<br>And we’ll see in a second you know how that one that actually creates some problems and so we’ll see those are there’s a small extension to the protocol to actually make this all work at.</p>
<p>343<br>00:47:22,599 –&gt; 00:47:32,599<br>Okay let me say a little bit about what is in one of those lock records.</p>
<p>344<br>00:47:32,599 –&gt; 00:47:43,599<br>That turns out to be important for the crash recovery particularly because we have front to panee is multiple logs per server.</p>
<p>345<br>00:47:43,599 –&gt; 00:48:00,599<br>So here we log as a so you’re our log basically you know the records in it they have a sequence number and whatever it’s a good number to one to and you know what the end of the log is if the next sequence number is not hired one hired in the</p>
<p>346<br>00:48:00,599 –&gt; 00:48:03,599<br>order.</p>
<p>347<br>00:48:03,599 –&gt; 00:48:13,599<br>So there’s an other way they market up and basically in one of these records you know is an array is an array of updates.</p>
<p>348<br>00:48:13,599 –&gt; 00:48:38,599<br>So we have to describe the file system operation and so it contains the block number that needs to be updated to example in our case that would be would be the I know number the block that contains the I note that would be allocated a version number is in that record and we’ll see in second why that is important and basically the new bytes for that block number.</p>
<p>349<br>00:48:38,599 –&gt; 00:48:49,599<br>For example in the case of creating in a file creating F there’s going to be two entries in this array you know two entries.</p>
<p>350<br>00:48:49,599 –&gt; 00:49:05,599<br>One describing you know the update to the I know block and one describing you update to the directory block the data block of the directory.</p>
<p>351<br>00:49:05,599 –&gt; 00:49:19,599<br>So basically what happens on the replication just to make you know the abundantly clear right when a request to record local lock comes in you know the first thing that happens is for the log.</p>
<p>352<br>00:49:19,599 –&gt; 00:49:34,599<br>To pedal once then is done send the updates or send the blocks the updated blocks to pedal.</p>
<p>353<br>00:49:34,599 –&gt; 00:49:41,599<br>And then release the lock.</p>
<p>354<br>00:49:41,599 –&gt; 00:49:47,599<br>And then disinsure that you know there’s a couple things that we need to sort of think about.</p>
<p>355<br>00:49:47,599 –&gt; 00:50:02,599<br>If there’s no crashes in the middle then you know this is always a pretty discreet really you know the interesting case is one crash happens right after forcing the law to be before updating pedal.</p>
<p>356<br>00:50:02,599 –&gt; 00:50:06,599<br>So let’s talk a little bit about that.</p>
<p>357<br>00:50:06,599 –&gt; 00:50:10,599<br>Sorry what do you mean by new bytes.</p>
<p>358<br>00:50:10,599 –&gt; 00:50:20,599<br>Let me go back so we’ve been out of meaning the changes to do I know block so for example the I know block.</p>
<p>359<br>00:50:20,599 –&gt; 00:50:36,599<br>Maybe you updating you know some part of the I know that you sort of write down what the what the bytes have changed like you know the bytes zero to five and a 12 at the volume value or bytes you know 10 to 20 half the volume value.</p>
<p>360<br>00:50:36,599 –&gt; 00:50:48,599<br>So can those changes be like because each one of these blocks is at most 512 bytes right yeah but the modifications that you make to be like a lot larger than 512 bytes.</p>
<p>361<br>00:50:48,599 –&gt; 00:50:52,599<br>There’s going to be a record for every block.</p>
<p>362<br>00:50:52,599 –&gt; 00:50:55,599<br>So in fact, the okay so a couple points.</p>
<p>363<br>00:50:55,599 –&gt; 00:50:58,599<br>First of all.</p>
<p>364<br>00:50:58,599 –&gt; 00:51:03,599<br>Data rights actually are not going through the lock. So there’s actually important points for thank you for asking that question.</p>
<p>365<br>00:51:03,599 –&gt; 00:51:12,599<br>So when you write a file in the application recalls like right file F and a whole bunch of data all that data actually does not go through the lock.</p>
<p>366<br>00:51:12,599 –&gt; 00:51:17,599<br>That just goes straight to pedal like once you’re flush state.</p>
<p>367<br>00:51:17,599 –&gt; 00:51:25,599<br>The only changes that go through the log are meta update changes so meta data changes.</p>
<p>368<br>00:51:25,599 –&gt; 00:51:30,599<br>And what metadata means is really information about files.</p>
<p>369<br>00:51:30,599 –&gt; 00:51:35,599<br>So I know it’s directories not kind of stuff that actually goes through the lock.</p>
<p>370<br>00:51:35,599 –&gt; 00:51:43,599<br>And so the description that you see in here is really you know the updates to the metadata blocks in our file system.</p>
<p>371<br>00:51:43,599 –&gt; 00:51:48,599<br>So I know it’s and directory data.</p>
<p>372<br>00:51:48,599 –&gt; 00:51:59,599<br>And the application level data like the file blocks that actually constitute a file that actually those blocks are just written straight to pedal and don’t go for the lock.</p>
<p>373<br>00:51:59,599 –&gt; 00:52:06,599<br>So it’s interesting to contemplate and what is the implications of that like that design choice.</p>
<p>374<br>00:52:06,599 –&gt; 00:52:12,599<br>What’s the downside of not writing everything through the log.</p>
<p>375<br>00:52:12,599 –&gt; 00:52:17,599<br>First.</p>
<p>376<br>00:52:17,599 –&gt; 00:52:21,599<br>The case of the data can be lost.</p>
<p>377<br>00:52:21,599 –&gt; 00:52:23,599<br>Did it get good luck.</p>
<p>378<br>00:52:23,599 –&gt; 00:52:29,599<br>What other sort of scenarios are possible. So let’s say you know the file consists of 10 blocks.</p>
<p>379<br>00:52:29,599 –&gt; 00:52:31,599<br>We’re starting writing the 10 blocks.</p>
<p>380<br>00:52:31,599 –&gt; 00:52:37,599<br>You know what’s in what what states can the file actually end up.</p>
<p>381<br>00:52:37,599 –&gt; 00:52:39,599<br>Being consistent.</p>
<p>382<br>00:52:39,599 –&gt; 00:52:42,599<br>Yeah, well, yeah, consistent. You could have some of the rights none of the rights.</p>
<p>383<br>00:52:42,599 –&gt; 00:52:44,599<br>You know what correct.</p>
<p>384<br>00:52:44,599 –&gt; 00:52:48,599<br>But it’s not guaranteed that all 10 of them will be applied together.</p>
<p>385<br>00:52:48,599 –&gt; 00:52:57,599<br>Um, so is this important when you have like, like this like need for atomic rights.</p>
<p>386<br>00:52:57,599 –&gt; 00:52:58,599<br>Yeah.</p>
<p>387<br>00:52:58,599 –&gt; 00:53:02,599<br>Like if you didn’t need at the, at the messity.</p>
<p>388<br>00:53:02,599 –&gt; 00:53:08,599<br>What this like, could we get rid of that of the log.</p>
<p>389<br>00:53:08,599 –&gt; 00:53:11,599<br>I think it’s a whole not a whole lot of questions in a second.</p>
<p>390<br>00:53:11,599 –&gt; 00:53:14,599<br>Let’s first talk into the applications. And then we’ll come back to that.</p>
<p>391<br>00:53:14,599 –&gt; 00:53:17,599<br>So, um,</p>
<p>392<br>00:53:17,599 –&gt; 00:53:20,599<br>the,</p>
<p>393<br>00:53:20,599 –&gt; 00:53:23,599<br>the.</p>
<p>394<br>00:53:23,599 –&gt; 00:53:26,599<br>So the applications can really write, you know, their data, atomically,</p>
<p>395<br>00:53:26,599 –&gt; 00:53:30,599<br>for the log because the data is now written through the log and,</p>
<p>396<br>00:53:30,599 –&gt; 00:53:32,599<br>so not written to the log and then applied.</p>
<p>397<br>00:53:32,599 –&gt; 00:53:37,599<br>So, so that means that, for example, if some application you want on the missity of,</p>
<p>398<br>00:53:37,599 –&gt; 00:53:41,599<br>of your rights, you know, to a particular file, then you have to arrange that for that yourself.</p>
<p>399<br>00:53:41,599 –&gt; 00:53:45,599<br>And this actually turns out to be the case on most units files in any way.</p>
<p>400<br>00:53:45,599 –&gt; 00:53:49,599<br>And so like in that way from Japan, it doesn’t really change the game.</p>
<p>401<br>00:53:49,599 –&gt; 00:53:52,599<br>You know, if you write a file on the unit file system,</p>
<p>402<br>00:53:52,599 –&gt; 00:54:01,599<br>you write like a Vm image, you know, it’s not guaranteed that like the whole image is written consistently in one single shot, you know, to the file system.</p>
<p>403<br>00:54:01,599 –&gt; 00:54:03,599<br>Even when there are crashes.</p>
<p>404<br>00:54:03,599 –&gt; 00:54:10,599<br>And so the typical way, you know, people solve this problem in applications is that if you first write a temporary file, right,</p>
<p>405<br>00:54:10,599 –&gt; 00:54:15,599<br>everything in the temporary file and then do an atomic rename, you know, to the destination file.</p>
<p>406<br>00:54:15,599 –&gt; 00:54:23,599<br>And so, front to party basically relies exactly on the same setup, sort of normal units would do.</p>
<p>407<br>00:54:23,599 –&gt; 00:54:26,599<br>So like the front to party doesn’t change the game. And this is why,</p>
<p>408<br>00:54:26,599 –&gt; 00:54:31,599<br>the rights of files are actually not logged, you know, through the log.</p>
<p>409<br>00:54:31,599 –&gt; 00:54:37,599<br>And what does the advantage of not logging so clearly there’s a downside, right, because you can’t do a file right,</p>
<p>410<br>00:54:37,599 –&gt; 00:54:41,599<br>automatically using the log, you have to have your own plan for doing not amicity.</p>
<p>411<br>00:54:41,599 –&gt; 00:54:45,599<br>And what does the advantage?</p>
<p>412<br>00:54:45,599 –&gt; 00:54:50,599<br>Well, performance because metadata is very small compared to the actual user data.</p>
<p>413<br>00:54:50,599 –&gt; 00:54:53,599<br>Yeah, and also memory as well.</p>
<p>414<br>00:54:53,599 –&gt; 00:54:59,599<br>Yeah, exactly. So the, so like if you write like a gigantic file, correct, you’re like saying gigabyte file,</p>
<p>415<br>00:54:59,599 –&gt; 00:55:03,599<br>and it really means you have to write two gigabytes, right, first, you know, write the gigabytes through the log,</p>
<p>416<br>00:55:03,599 –&gt; 00:55:05,599<br>and then you write a gigabyte through the disk.</p>
<p>417<br>00:55:05,599 –&gt; 00:55:09,599<br>And so basically this cuts, you know, performance in pretty dramatically.</p>
<p>418<br>00:55:09,599 –&gt; 00:55:16,599<br>And so which is why, you know, typically, you know, the user data that is not written for the law.</p>
<p>419<br>00:55:16,599 –&gt; 00:55:23,599<br>You know, it’s very important of course when I come back to this earlier question, it’s very important that the internal file system structures are kept consistent, right.</p>
<p>420<br>00:55:23,599 –&gt; 00:55:27,599<br>And so, you know, the data is not, you know, are not inconsistent.</p>
<p>421<br>00:55:27,599 –&gt; 00:55:32,599<br>And so therefore the metadata updates all go through the log.</p>
<p>422<br>00:55:32,599 –&gt; 00:55:37,599<br>And so that basically, you know, like when you create a file, you need to update the idle block, and you need to update the directory block.</p>
<p>423<br>00:55:37,599 –&gt; 00:55:42,599<br>That’s guaranteed to happen together.</p>
<p>424<br>00:55:42,599 –&gt; 00:55:50,599<br>So the data blocks of dates go between step 23.</p>
<p>425<br>00:55:50,599 –&gt; 00:56:13,599<br>I think the user sent them out, and they probably after one they probably sent the data blocks in parallel to, you know, as part of step two and straight to add up to the file system area.</p>
<p>426<br>00:56:13,599 –&gt; 00:56:15,599<br>Okay.</p>
<p>427<br>00:56:15,599 –&gt; 00:56:26,599<br>So I had a question. I think I don’t remember exactly how big the log was, but I believe it could span like two blocks.</p>
<p>428<br>00:56:26,599 –&gt; 00:56:30,599<br>Is that possible? Yeah, the log is multiple records.</p>
<p>429<br>00:56:30,599 –&gt; 00:56:34,599<br>Oh yeah, yeah, that’s right.</p>
<p>430<br>00:56:34,599 –&gt; 00:56:44,599<br>Up to two terrible. So what happens if we, if we send like a lot like part of a log and then it crashes as you send the log.</p>
<p>431<br>00:56:44,599 –&gt; 00:56:51,599<br>When we get like an issue with like, I don’t know, it’s exactly this is one of the.</p>
<p>432<br>00:56:51,599 –&gt; 00:56:53,599<br>Thank you.</p>
<p>433<br>00:56:53,599 –&gt; 00:56:57,599<br>So there was a bunch of crashes that could happen, correct? Like so.</p>
<p>434<br>00:56:57,599 –&gt; 00:57:11,599<br>So if we crash, so it’s considered a bunch of cases like we read crashed before writing to the law.</p>
<p>435<br>00:57:11,599 –&gt; 00:57:19,599<br>So what in that case, what’s the outcome?</p>
<p>436<br>00:57:19,599 –&gt; 00:57:25,599<br>It’s lost. Yeah, lost.</p>
<p>437<br>00:57:25,599 –&gt; 00:57:39,599<br>So then we’re going to scenario like we crash after writing the lock.</p>
<p>438<br>00:57:39,599 –&gt; 00:57:42,599<br>What happens then?</p>
<p>439<br>00:57:42,599 –&gt; 00:57:45,599<br>Is actually slightly complicated scenario.</p>
<p>440<br>00:57:45,599 –&gt; 00:57:49,599<br>Is this after writing like the log to pedal?</p>
<p>441<br>00:57:49,599 –&gt; 00:57:51,599<br>Yeah.</p>
<p>442<br>00:57:51,599 –&gt; 00:57:53,599<br>Then the demon steps in.</p>
<p>443<br>00:57:53,599 –&gt; 00:57:55,599<br>Yes, the demon steps in.</p>
<p>444<br>00:57:55,599 –&gt; 00:57:58,599<br>And there’s a little bit of a complicated story, correct? Because you know, what?</p>
<p>445<br>00:57:58,599 –&gt; 00:58:02,599<br>So how does this all discovered? Like what actually happens?</p>
<p>446<br>00:58:02,599 –&gt; 00:58:05,599<br>So presumably what happens is somebody else wants the law, the lock, correct?</p>
<p>447<br>00:58:05,599 –&gt; 00:58:10,599<br>So that you know, that the crashed workstation holds.</p>
<p>448<br>00:58:10,599 –&gt; 00:58:15,599<br>And you know, here’s where at least it’s coming in importance for it’s sort of every lock has a lease.</p>
<p>449<br>00:58:15,599 –&gt; 00:58:24,599<br>And what the lockshift will do, it will not grant, you know, the lockshift will ask and workstation one, please give me your lock.</p>
<p>450<br>00:58:24,599 –&gt; 00:58:27,599<br>Workstation one and what doesn’t respond because it’s crashed.</p>
<p>451<br>00:58:27,599 –&gt; 00:58:36,599<br>And what the lockshift does it waits until the lease expires on the lock.</p>
<p>452<br>00:58:36,599 –&gt; 00:58:44,599<br>And why doesn’t wait until the lock the lease is expired?</p>
<p>453<br>00:58:44,599 –&gt; 00:59:00,599<br>I think I think in this case, the, the server that or yeah, the server that crashed like also knows it didn’t like renew its lease so it can clean up by it like its own.</p>
<p>454<br>00:59:00,599 –&gt; 00:59:10,599<br>Yeah, can clean up his own stuff. So like what is the sort of what’s the fundamental problem here that we’re actually trying to challenge almost like the scenario that we’ve seen over and over in previous lectures that there’s always a challenge.</p>
<p>455<br>00:59:10,599 –&gt; 00:59:13,599<br>Partition, no.</p>
<p>456<br>00:59:13,599 –&gt; 00:59:28,599<br>It could be the case that you know, actually workstation one did not crash, but the lockshift can’t talk to the workstation because of the network petition, but the one and the workstation can talk to pedal.</p>
<p>457<br>00:59:28,599 –&gt; 00:59:31,599<br>And so it might not still may may may may may may changes, right.</p>
<p>458<br>00:59:31,599 –&gt; 00:59:39,599<br>But whatever we guaranteed as you just pointed out once the lease expires workstation one will definitely not make any changes.</p>
<p>459<br>00:59:39,599 –&gt; 00:59:44,599<br>It is not allowed to, you know, follows the protocol is not allowed to make any changes anymore.</p>
<p>460<br>00:59:44,599 –&gt; 00:59:55,599<br>And so this is so why the lockshift awaits until the lease expires now in that point and knows for sure that nobody else is locking them more or couldn’t hold the lock if nobody’s writing to pedal anymore.</p>
<p>461<br>00:59:55,599 –&gt; 01:00:06,599<br>At this point, it will ask one of the remaining workstations to basically what they call the demon.</p>
<p>462<br>01:00:06,599 –&gt; 01:00:22,599<br>The recovery demon, the recovery, the recovery demon and the recovery demon basically will apply will read the log of the workstation one, you know, its log and basically apply the operation that are in that lock.</p>
<p>463<br>01:00:22,599 –&gt; 01:00:31,599<br>And the way to think about the demon, it’s just sort of like this is like terminology.</p>
<p>464<br>01:00:31,599 –&gt; 01:00:43,599<br>It’s typically just a surface or server or serve a process that basically does sort of house cleaning or house cleaning tasks and those kind of services that are sort of not really used.</p>
<p>465<br>01:00:43,599 –&gt; 01:00:49,599<br>But then, you know, they’re often called demons.</p>
<p>466<br>01:00:49,599 –&gt; 01:00:59,599<br>So once the demon is done, then actually the lock, you know, can be the lock server can reassign the lock or grant the lock to somebody to another workstation.</p>
<p>467<br>01:00:59,599 –&gt; 01:01:10,599<br>But just to double check. So if you crash after writing the log, then you’ll get you’re going to have a consistent state to come to the metadata, but the user’s not guaranteed to have finished writing the user data.</p>
<p>468<br>01:01:10,599 –&gt; 01:01:23,599<br>So there’s no guarantees about the user data. So the only thing the guarantees that like really the logging system helps achieving is basically consistency of the internal file system data structures.</p>
<p>469<br>01:01:23,599 –&gt; 01:01:26,599<br>Okay, sounds.</p>
<p>470<br>01:01:26,599 –&gt; 01:01:37,599<br>Which is important, correct, because we’d be pretty bad if the internal file system data structures are messed up, you know, everybody might lose their data.</p>
<p>471<br>01:01:37,599 –&gt; 01:01:42,599<br>Okay, so then there’s another instant case.</p>
<p>472<br>01:01:42,599 –&gt; 01:02:05,599<br>What can happen, okay, so writing the lock to you, what happens if we crash during writing the law.</p>
<p>473<br>01:02:05,599 –&gt; 01:02:12,599<br>So this is what you mentioned before that there are checksums and we can check whether it was like completed or not.</p>
<p>474<br>01:02:12,599 –&gt; 01:02:25,599<br>Yeah, so what, okay, so good point. So, so what happens in this case, correct, is that a prefix might end up in the prefix in my end up in the log, correct.</p>
<p>475<br>01:02:25,599 –&gt; 01:02:36,599<br>But each of the prefix might contain multiple log records of multiple operations, correct, like, you know, whatever sequence number one, six number two, the multiple records.</p>
<p>476<br>01:02:36,599 –&gt; 01:02:47,599<br>If we crash during one of these records updates, you know, then the checksums will check out and so we’ll basically stop the recovery team and stop at that record.</p>
<p>477<br>01:02:47,599 –&gt; 01:02:53,599<br>What will be in the log will be a correct prefix of the operations.</p>
<p>478<br>01:02:53,599 –&gt; 01:03:02,599<br>So, for example, you know, the create of file F is in there, maybe the create file, file G is in there, not the creative file H is not in there.</p>
<p>479<br>01:03:02,599 –&gt; 01:03:10,599<br>But each individual record that describes one atomic, you know, file system operation is in there and is complete.</p>
<p>480<br>01:03:10,599 –&gt; 01:03:31,599<br>What will happen is that basically will apply a prefix of the operations that the workstation is doing and we basically lose the end of the prefix or the end of the its updates, we don’t know, indesirable, but you know totally okay because, you know, in the other case, we might have lost all of this.</p>
<p>481<br>01:03:31,599 –&gt; 01:03:40,599<br>In the first case, we were crashed before the log, we would have nothing on this.</p>
<p>482<br>01:03:40,599 –&gt; 01:03:46,599<br>Does it all make sense?</p>
<p>483<br>01:03:46,599 –&gt; 01:03:52,599<br>Okay, then there’s one one more tricky case that we need to consider.</p>
<p>484<br>01:03:52,599 –&gt; 01:03:59,599<br>And that has to do with the fact that actually pedal has a walk per server or log per server.</p>
<p>485<br>01:03:59,599 –&gt; 01:04:06,599<br>So I thought a little bit about that and this is related to the question in a post, you know, for the reading.</p>
<p>486<br>01:04:06,599 –&gt; 01:04:13,599<br>This is about many logs and so let’s say we have workstations between their own log.</p>
<p>487<br>01:04:13,599 –&gt; 01:04:19,599<br>So here’s workstation one workstation two workstation three.</p>
<p>488<br>01:04:19,599 –&gt; 01:04:27,599<br>And workstation one at some point does a delete of a file F that happened to exist before.</p>
<p>489<br>01:04:27,599 –&gt; 01:04:33,599<br>Then workstation to create.</p>
<p>490<br>01:04:33,599 –&gt; 01:04:38,599<br>And that’s created remember is written to its own log.</p>
<p>491<br>01:04:38,599 –&gt; 01:04:47,599<br>This delete is written to the log of workstation one. This create is written to the log of workstation two.</p>
<p>492<br>01:04:47,599 –&gt; 01:04:53,599<br>And now let’s say workstation one crashes.</p>
<p>493<br>01:04:53,599 –&gt; 01:05:07,599<br>And then workstation three, you know, basically, you know, the recovery team to runs.</p>
<p>494<br>01:05:07,599 –&gt; 01:05:14,599<br>For workstation one.</p>
<p>495<br>01:05:14,599 –&gt; 01:05:19,599<br>And you know, the bad possible outcome correct is that it would would would replay the delete.</p>
<p>496<br>01:05:19,599 –&gt; 01:05:25,599<br>Which would overwrite, you know, the changes that workstation two made to pedal.</p>
<p>497<br>01:05:25,599 –&gt; 01:05:27,599<br>So that’s the context.</p>
<p>498<br>01:05:27,599 –&gt; 01:05:41,599<br>And the question is how is this fixed and I think this the way I would like to address this is by actually having you spend a couple of minutes in the breakout room debate this with each other or any other aspect of pedal if you want to.</p>
<p>499<br>01:05:41,599 –&gt; 01:05:47,599<br>So, uh, Lily or anybody else any of the other T.</p>
<p>500<br>01:05:47,599 –&gt; 01:06:01,599<br>So you sign people do break up rooms.</p>
<p>501<br>01:06:01,599 –&gt; 01:06:06,599<br>So, uh, I think that’s the way I would like to do it.</p>
<p>502<br>01:06:06,599 –&gt; 01:06:07,599<br>Try to do it or.</p>
<p>503<br>01:06:07,599 –&gt; 01:06:08,599<br>Yeah, that’d be great.</p>
<p>504<br>01:06:08,599 –&gt; 01:06:09,599<br>Okay.</p>
<p>505<br>01:06:09,599 –&gt; 01:06:16,599<br>All right.</p>
<p>506<br>01:06:16,599 –&gt; 01:06:19,599<br>I’ll close them in about five minutes.</p>
<p>507<br>01:06:19,599 –&gt; 01:06:29,599<br>Okay.</p>
<p>508<br>01:06:49,599 –&gt; 01:06:52,599<br>You</p>
<p>509<br>01:07:19,599 –&gt; 01:07:22,599<br>You</p>
<p>510<br>01:07:49,599 –&gt; 01:07:52,599<br>You</p>
<p>511<br>01:08:19,600 –&gt; 01:08:22,600<br>You</p>
<p>512<br>01:08:49,600 –&gt; 01:08:52,600<br>You</p>
<p>513<br>01:09:19,600 –&gt; 01:09:21,600<br>You</p>
<p>514<br>01:09:49,600 –&gt; 01:09:51,600<br>You</p>
<p>515<br>01:10:20,600 –&gt; 01:10:21,600<br>You</p>
<p>516<br>01:10:21,600 –&gt; 01:10:22,600<br>You</p>
<p>517<br>01:10:22,600 –&gt; 01:10:23,600<br>You</p>
<p>518<br>01:10:23,600 –&gt; 01:10:24,600<br>You</p>
<p>519<br>01:10:24,600 –&gt; 01:10:25,600<br>You</p>
<p>520<br>01:10:25,600 –&gt; 01:10:26,600<br>You</p>
<p>521<br>01:10:26,600 –&gt; 01:10:27,600<br>You</p>
<p>522<br>01:10:27,600 –&gt; 01:10:28,600<br>You</p>
<p>523<br>01:10:28,600 –&gt; 01:10:29,600<br>You</p>
<p>524<br>01:10:29,600 –&gt; 01:10:30,600<br>You</p>
<p>525<br>01:10:30,600 –&gt; 01:10:31,600<br>You</p>
<p>526<br>01:10:31,600 –&gt; 01:10:32,600<br>You</p>
<p>527<br>01:10:32,600 –&gt; 01:10:33,600<br>You</p>
<p>528<br>01:10:33,600 –&gt; 01:10:34,600<br>You</p>
<p>529<br>01:10:34,600 –&gt; 01:10:35,600<br>You</p>
<p>530<br>01:10:35,600 –&gt; 01:10:36,600<br>You</p>
<p>531<br>01:10:36,600 –&gt; 01:10:37,600<br>You</p>
<p>532<br>01:10:37,600 –&gt; 01:10:38,600<br>You</p>
<p>533<br>01:10:38,600 –&gt; 01:10:39,600<br>You</p>
<p>534<br>01:10:39,600 –&gt; 01:10:40,600<br>You</p>
<p>535<br>01:10:40,600 –&gt; 01:10:41,600<br>You</p>
<p>536<br>01:10:41,600 –&gt; 01:10:42,600<br>You</p>
<p>537<br>01:10:42,600 –&gt; 01:10:43,600<br>You</p>
<p>538<br>01:10:43,600 –&gt; 01:10:44,600<br>You</p>
<p>539<br>01:10:44,600 –&gt; 01:10:45,600<br>You</p>
<p>540<br>01:10:45,600 –&gt; 01:10:46,600<br>You</p>
<p>541<br>01:10:46,600 –&gt; 01:10:47,600<br>You</p>
<p>542<br>01:10:47,600 –&gt; 01:10:48,600<br>You</p>
<p>543<br>01:10:48,600 –&gt; 01:10:49,600<br>You</p>
<p>544<br>01:10:49,600 –&gt; 01:10:50,600<br>You</p>
<p>545<br>01:10:50,600 –&gt; 01:10:51,600<br>You</p>
<p>546<br>01:10:51,600 –&gt; 01:10:52,600<br>You</p>
<p>547<br>01:10:52,600 –&gt; 01:10:53,600<br>You</p>
<p>548<br>01:10:53,600 –&gt; 01:10:54,600<br>You</p>
<p>549<br>01:10:54,600 –&gt; 01:10:55,600<br>You</p>
<p>550<br>01:10:55,600 –&gt; 01:10:56,600<br>You</p>
<p>551<br>01:10:56,600 –&gt; 01:10:57,600<br>You</p>
<p>552<br>01:10:57,600 –&gt; 01:10:58,600<br>You</p>
<p>553<br>01:10:58,600 –&gt; 01:10:59,600<br>You</p>
<p>554<br>01:10:59,600 –&gt; 01:11:00,600<br>You</p>
<p>555<br>01:11:00,600 –&gt; 01:11:01,600<br>You</p>
<p>556<br>01:11:01,600 –&gt; 01:11:02,600<br>You</p>
<p>557<br>01:11:02,600 –&gt; 01:11:03,600<br>You</p>
<p>558<br>01:11:03,600 –&gt; 01:11:04,600<br>You</p>
<p>559<br>01:11:04,600 –&gt; 01:11:05,600<br>You</p>
<p>560<br>01:11:05,600 –&gt; 01:11:06,600<br>You</p>
<p>561<br>01:11:06,600 –&gt; 01:11:07,600<br>You</p>
<p>562<br>01:11:07,600 –&gt; 01:11:08,600<br>You</p>
<p>563<br>01:11:08,600 –&gt; 01:11:09,600<br>You</p>
<p>564<br>01:11:09,600 –&gt; 01:11:10,600<br>You</p>
<p>565<br>01:11:10,600 –&gt; 01:11:11,600<br>You</p>
<p>566<br>01:11:11,600 –&gt; 01:11:12,600<br>You</p>
<p>567<br>01:11:12,600 –&gt; 01:11:13,600<br>You</p>
<p>568<br>01:11:13,600 –&gt; 01:11:14,600<br>You</p>
<p>569<br>01:11:14,600 –&gt; 01:11:15,600<br>You</p>
<p>570<br>01:11:15,600 –&gt; 01:11:16,600<br>You</p>
<p>571<br>01:11:16,600 –&gt; 01:11:17,600<br>You</p>
<p>572<br>01:11:17,600 –&gt; 01:11:18,600<br>You</p>
<p>573<br>01:11:18,600 –&gt; 01:11:19,600<br>You</p>
<p>574<br>01:11:19,600 –&gt; 01:11:20,600<br>You</p>
<p>575<br>01:11:20,600 –&gt; 01:11:21,600<br>You</p>
<p>576<br>01:11:21,600 –&gt; 01:11:22,600<br>You</p>
<p>577<br>01:11:22,600 –&gt; 01:11:23,600<br>You</p>
<p>578<br>01:11:23,600 –&gt; 01:11:24,600<br>You</p>
<p>579<br>01:11:24,600 –&gt; 01:11:25,600<br>You</p>
<p>580<br>01:11:25,600 –&gt; 01:11:26,600<br>You</p>
<p>581<br>01:11:26,600 –&gt; 01:11:27,600<br>You</p>
<p>582<br>01:11:27,600 –&gt; 01:11:28,600<br>You</p>
<p>583<br>01:11:28,600 –&gt; 01:11:29,600<br>You</p>
<p>584<br>01:11:29,600 –&gt; 01:11:30,600<br>You</p>
<p>585<br>01:11:30,600 –&gt; 01:11:31,600<br>You</p>
<p>586<br>01:11:31,600 –&gt; 01:11:32,600<br>You</p>
<p>587<br>01:11:32,600 –&gt; 01:11:33,600<br>You</p>
<p>588<br>01:11:33,600 –&gt; 01:11:34,600<br>You</p>
<p>589<br>01:11:34,600 –&gt; 01:11:35,600<br>You</p>
<p>590<br>01:11:35,600 –&gt; 01:11:36,600<br>You</p>
<p>591<br>01:11:36,600 –&gt; 01:11:37,600<br>You</p>
<p>592<br>01:11:37,600 –&gt; 01:11:38,600<br>You</p>
<p>593<br>01:11:38,600 –&gt; 01:11:39,600<br>You</p>
<p>594<br>01:11:39,600 –&gt; 01:11:40,600<br>You</p>
<p>595<br>01:11:40,600 –&gt; 01:11:41,600<br>You</p>
<p>596<br>01:11:41,600 –&gt; 01:11:42,600<br>You</p>
<p>597<br>01:11:42,600 –&gt; 01:11:43,600<br>You</p>
<p>598<br>01:11:43,600 –&gt; 01:11:44,600<br>You</p>
<p>599<br>01:11:44,600 –&gt; 01:11:45,600<br>You</p>
<p>600<br>01:11:45,600 –&gt; 01:11:46,600<br>You</p>
<p>601<br>01:11:46,600 –&gt; 01:11:47,600<br>You</p>
<p>602<br>01:11:47,600 –&gt; 01:11:48,600<br>You</p>
<p>603<br>01:11:48,600 –&gt; 01:11:49,600<br>You</p>
<p>604<br>01:11:49,600 –&gt; 01:11:50,600<br>You</p>
<p>605<br>01:11:50,600 –&gt; 01:11:51,600<br>You</p>
<p>606<br>01:11:51,600 –&gt; 01:11:52,600<br>You</p>
<p>607<br>01:11:52,600 –&gt; 01:11:53,600<br>You</p>
<p>608<br>01:11:53,600 –&gt; 01:11:54,600<br>You</p>
<p>609<br>01:11:54,600 –&gt; 01:11:55,600<br>You</p>
<p>610<br>01:11:55,600 –&gt; 01:11:56,600<br>You</p>
<p>611<br>01:11:56,600 –&gt; 01:11:57,600<br>You</p>
<p>612<br>01:11:57,600 –&gt; 01:11:58,600<br>You</p>
<p>613<br>01:11:58,600 –&gt; 01:11:59,600<br>You</p>
<p>614<br>01:11:59,600 –&gt; 01:12:00,600<br>You</p>
<p>615<br>01:12:00,600 –&gt; 01:12:01,600<br>You</p>
<p>616<br>01:12:01,600 –&gt; 01:12:02,600<br>You</p>
<p>617<br>01:12:02,600 –&gt; 01:12:03,600<br>You</p>
<p>618<br>01:12:03,600 –&gt; 01:12:04,600<br>You</p>
<p>619<br>01:12:04,600 –&gt; 01:12:05,600<br>You</p>
<p>620<br>01:12:05,600 –&gt; 01:12:06,600<br>You</p>
<p>621<br>01:12:06,600 –&gt; 01:12:07,600<br>You</p>
<p>622<br>01:12:07,600 –&gt; 01:12:08,600<br>You</p>
<p>623<br>01:12:08,600 –&gt; 01:12:09,600<br>You</p>
<p>624<br>01:12:09,600 –&gt; 01:12:10,600<br>You</p>
<p>625<br>01:12:10,600 –&gt; 01:12:11,600<br>You</p>
<p>626<br>01:12:11,600 –&gt; 01:12:12,600<br>You</p>
<p>627<br>01:12:12,600 –&gt; 01:12:13,600<br>You</p>
<p>628<br>01:12:13,600 –&gt; 01:12:14,600<br>You</p>
<p>629<br>01:12:14,600 –&gt; 01:12:15,600<br>You</p>
<p>630<br>01:12:15,600 –&gt; 01:12:16,600<br>You</p>
<p>631<br>01:12:16,600 –&gt; 01:12:17,600<br>You</p>
<p>632<br>01:12:17,600 –&gt; 01:12:18,600<br>You</p>
<p>633<br>01:12:18,600 –&gt; 01:12:22,600<br>You</p>
<p>634<br>01:12:22,600 –&gt; 01:12:23,600<br>You</p>
<p>635<br>01:12:23,600 –&gt; 01:12:24,600<br>You</p>
<p>636<br>01:12:24,600 –&gt; 01:12:25,600<br>You</p>
<p>637<br>01:12:25,600 –&gt; 01:12:26,600<br>You</p>
<p>638<br>01:12:26,600 –&gt; 01:12:28,600<br>You</p>
<p>639<br>01:12:28,600 –&gt; 01:12:29,600<br>You</p>
<p>640<br>01:12:29,600 –&gt; 01:12:30,600<br>You</p>
<p>641<br>01:12:30,600 –&gt; 01:12:31,600<br>Ok.</p>
<p>642<br>01:12:31,600 –&gt; 01:12:32,600<br>I</p>
<p>643<br>01:12:32,600 –&gt; 01:12:33,600<br>Just</p>
<p>644<br>01:12:33,600 –&gt; 01:12:34,600<br>Just</p>
<p>645<br>01:12:34,600 –&gt; 01:12:35,600<br>Quickly</p>
<p>646<br>01:12:35,600 –&gt; 01:12:36,600<br>Summarise.</p>
<p>647<br>01:12:36,600 –&gt; 01:12:38,600<br>So we have free workstations.</p>
<p>648<br>01:12:38,600 –&gt; 01:12:39,600<br>Workstation</p>
<p>649<br>01:12:39,600 –&gt; 01:12:40,600<br>One</p>
<p>650<br>01:12:40,600 –&gt; 01:12:42,600<br>It’s</p>
<p>651<br>01:12:42,600 –&gt; 01:12:43,600<br>Light</p>
<p>652<br>01:12:43,600 –&gt; 01:12:44,600<br>The</p>
<p>653<br>01:12:44,600 –&gt; 01:12:49,600<br>at some point later created a file F, it is in this log.</p>
<p>654<br>01:12:49,800 –&gt; 01:12:52,800<br>And then one crashes and workstation free action runs</p>
<p>655<br>01:12:52,800 –&gt; 01:12:56,000<br>and recovery demon on the log of workstation one.</p>
<p>656<br>01:12:56,000 –&gt; 01:12:59,840<br>And of course, we be disaster if the lead would be replayed</p>
<p>657<br>01:12:59,840 –&gt; 01:13:02,079<br>because the later create has happened on another workstation</p>
<p>658<br>01:13:02,079 –&gt; 01:13:03,120<br>but it’s in another log.</p>
<p>659<br>01:13:03,120 –&gt; 01:13:06,600<br>So the demon doesn’t know how is this problem solved</p>
<p>660<br>01:13:07,880 –&gt; 01:13:10,680<br>or how is this potentially disaster avoided?</p>
<p>661<br>01:13:15,560 –&gt; 01:13:17,240<br>We said version numbers.</p>
<p>662<br>01:13:17,240 –&gt; 01:13:18,079<br>Yeah.</p>
<p>663<br>01:13:19,560 –&gt; 01:13:22,000<br>Yeah, so can you say a little bit more if you want to?</p>
<p>664<br>01:13:22,000 –&gt; 01:13:23,240<br>Sure.</p>
<p>665<br>01:13:23,240 –&gt; 01:13:27,079<br>So it’s guaranteed because we had the log</p>
<p>666<br>01:13:27,079 –&gt; 01:13:32,079<br>that the operations have already completed for server one.</p>
<p>667<br>01:13:35,079 –&gt; 01:13:40,280<br>And so the version number for the log</p>
<p>668<br>01:13:40,280 –&gt; 01:13:43,880<br>is written in a pedal like the last operation.</p>
<p>669<br>01:13:43,880 –&gt; 01:13:47,960<br>And so the recovery demon won’t do anything previous</p>
<p>670<br>01:13:47,960 –&gt; 01:13:50,880<br>to the current version number.</p>
<p>671<br>01:13:50,880 –&gt; 01:13:53,239<br>Yeah, guys, let’s say we have absolute right.</p>
<p>672<br>01:13:53,239 –&gt; 01:13:54,640<br>So we’ll just summarize these.</p>
<p>673<br>01:13:54,640 –&gt; 01:13:58,800<br>So we have two logs that actually have importance</p>
<p>674<br>01:13:58,800 –&gt; 01:14:01,400<br>and we have some file system state</p>
<p>675<br>01:14:01,400 –&gt; 01:14:02,640<br>that sits in the pedal.</p>
<p>676<br>01:14:02,640 –&gt; 01:14:05,480<br>So these are the logs and then here’s the actual file system.</p>
<p>677<br>01:14:07,840 –&gt; 01:14:11,440<br>And here was like this is directory D.</p>
<p>678<br>01:14:12,439 –&gt; 01:14:15,239<br>So that your D was modified in the file F was deleted</p>
<p>679<br>01:14:15,239 –&gt; 01:14:18,439<br>and that has a log number I say the 10.</p>
<p>680<br>01:14:20,039 –&gt; 01:14:22,879<br>And this is a workstation two.</p>
<p>681<br>01:14:22,879 –&gt; 01:14:27,199<br>And here is a D that was deleting the F and D</p>
<p>682<br>01:14:27,199 –&gt; 01:14:28,479<br>and he was creating F and D.</p>
<p>683<br>01:14:28,479 –&gt; 01:14:32,319<br>And what log number will be in this entry?</p>
<p>684<br>01:14:34,639 –&gt; 01:14:35,719<br>Version number, sorry.</p>
<p>685<br>01:14:38,000 –&gt; 01:14:38,960<br>11.</p>
<p>686<br>01:14:38,960 –&gt; 01:14:40,079<br>I’m loving, yeah.</p>
<p>687<br>01:14:40,079 –&gt; 01:14:40,919<br>Right.</p>
<p>688<br>01:14:41,519 –&gt; 01:14:43,799<br>Basically total order in the locking protocols</p>
<p>689<br>01:14:43,799 –&gt; 01:14:45,719<br>were insured at the total order.</p>
<p>690<br>01:14:45,719 –&gt; 01:14:49,199<br>And on the in the file system with the metadata blocks,</p>
<p>691<br>01:14:49,199 –&gt; 01:14:51,359<br>like for example, with the I node block for F.</p>
<p>692<br>01:14:52,439 –&gt; 01:14:56,000<br>I know that what version number is going to be on the disk</p>
<p>693<br>01:14:56,000 –&gt; 01:14:56,839<br>or in pedal.</p>
<p>694<br>01:15:04,639 –&gt; 01:15:06,119<br>11.</p>
<p>695<br>01:15:06,119 –&gt; 01:15:08,799<br>Yeah, in the case that actually the operation was applied</p>
<p>696<br>01:15:08,799 –&gt; 01:15:10,319<br>to the file system and it would be 11.</p>
<p>697<br>01:15:10,319 –&gt; 01:15:11,719<br>Correct.</p>
<p>698<br>01:15:11,719 –&gt; 01:15:17,719<br>And so when the demon re what rule does the demon follow?</p>
<p>699<br>01:15:20,719 –&gt; 01:15:25,359<br>Never replace something that’s already been applied.</p>
<p>700<br>01:15:25,359 –&gt; 01:15:27,199<br>Yeah, now just decided to apply.</p>
<p>701<br>01:15:28,799 –&gt; 01:15:30,239<br>Like a version number.</p>
<p>702<br>01:15:30,239 –&gt; 01:15:31,199<br>Yeah, the version number, correct?</p>
<p>703<br>01:15:31,199 –&gt; 01:15:33,880<br>So if the version of it only reapplies in entry</p>
<p>704<br>01:15:33,880 –&gt; 01:15:36,239<br>if the version number in the log record,</p>
<p>705<br>01:15:37,199 –&gt; 01:15:41,479<br>a lot of the version number is higher than the I node</p>
<p>706<br>01:15:41,479 –&gt; 01:15:43,359<br>when the metadata version number.</p>
<p>707<br>01:15:46,159 –&gt; 01:15:47,319<br>Then replay.</p>
<p>708<br>01:15:48,559 –&gt; 01:15:50,079<br>Okay.</p>
<p>709<br>01:15:50,079 –&gt; 01:15:52,399<br>So in this case, you know, the recovery demon</p>
<p>710<br>01:15:52,399 –&gt; 01:15:55,319<br>will see that the version number in the log record</p>
<p>711<br>01:15:55,319 –&gt; 01:15:59,199<br>is 10, which is smaller than 11 or equal to 11 doesn’t matter.</p>
<p>712<br>01:15:59,199 –&gt; 01:16:00,319<br>And so it won’t replay it.</p>
<p>713<br>01:16:00,319 –&gt; 01:16:02,519<br>And so this problem cannot appear.</p>
<p>714<br>01:16:02,519 –&gt; 01:16:04,559<br>So does the 10 necessarily not?</p>
<p>715<br>01:16:04,640 –&gt; 01:16:09,560<br>Does is it okay, such that like the 10 is not on the WS workspace</p>
<p>716<br>01:16:09,600 –&gt; 01:16:10,760<br>to log?</p>
<p>717<br>01:16:12,160 –&gt; 01:16:14,680<br>Yeah, it’s not there.</p>
<p>718<br>01:16:14,680 –&gt; 01:16:17,039<br>So like in the work because the workstation two,</p>
<p>719<br>01:16:17,039 –&gt; 01:16:21,560<br>road actually the I node after, you know,</p>
<p>720<br>01:16:21,560 –&gt; 01:16:25,000<br>workstation one and so it’s version number 11.</p>
<p>721<br>01:16:25,000 –&gt; 01:16:27,240<br>Basically, when you do a preparing update,</p>
<p>722<br>01:16:27,240 –&gt; 01:16:32,080<br>the version number in the update record is always one flush,</p>
<p>723<br>01:16:32,080 –&gt; 01:16:34,160<br>you know, the current version number in the I node.</p>
<p>724<br>01:16:35,240 –&gt; 01:16:36,240<br>Okay.</p>
<p>725<br>01:16:36,240 –&gt; 01:16:40,960<br>This is a small question, but what is the D stand for?</p>
<p>726<br>01:16:40,960 –&gt; 01:16:42,960<br>And the directory.</p>
<p>727<br>01:16:42,960 –&gt; 01:16:44,480<br>Okay.</p>
<p>728<br>01:16:44,480 –&gt; 01:16:45,360<br>Okay.</p>
<p>729<br>01:16:45,360 –&gt; 01:16:47,039<br>We’re creating a file in the directory D.</p>
<p>730<br>01:16:47,039 –&gt; 01:16:48,960<br>We’re deleting a file from the directory D.</p>
<p>731<br>01:16:50,000 –&gt; 01:16:52,000<br>And the update must include, you know,</p>
<p>732<br>01:16:52,000 –&gt; 01:16:53,800<br>the so many information about the directory.</p>
<p>733<br>01:16:57,600 –&gt; 01:16:58,600<br>Okay.</p>
<p>734<br>01:16:58,600 –&gt; 01:17:00,400<br>So I had a quick question.</p>
<p>735<br>01:17:00,400 –&gt; 01:17:03,360<br>So are the best version numbers like always tied</p>
<p>736<br>01:17:03,359 –&gt; 01:17:06,119<br>to the specific I node that’s being edited?</p>
<p>737<br>01:17:06,119 –&gt; 01:17:07,159<br>Yes.</p>
<p>738<br>01:17:07,159 –&gt; 01:17:08,159<br>Okay.</p>
<p>739<br>01:17:08,159 –&gt; 01:17:11,159<br>That doesn’t mean the version number for every update,</p>
<p>740<br>01:17:11,159 –&gt; 01:17:13,079<br>correct? Like there’s a version number for the directory,</p>
<p>741<br>01:17:13,079 –&gt; 01:17:14,319<br>there’s a version number for the file.</p>
<p>742<br>01:17:14,319 –&gt; 01:17:16,559<br>I’m like showing this a little bit wrong here.</p>
<p>743<br>01:17:16,559 –&gt; 01:17:18,239<br>Like if you go back to the log record,</p>
<p>744<br>01:17:20,199 –&gt; 01:17:23,319<br>here basically there’s a array of updates and every update</p>
<p>745<br>01:17:23,319 –&gt; 01:17:25,119<br>in the array, you know, contains block number,</p>
<p>746<br>01:17:25,119 –&gt; 01:17:26,599<br>the version number in the new bytes.</p>
<p>747<br>01:17:28,799 –&gt; 01:17:29,639<br>Thanks.</p>
<p>748<br>01:17:30,640 –&gt; 01:17:31,640<br>Okay.</p>
<p>749<br>01:17:31,640 –&gt; 01:17:34,640<br>So just stepping back and closing off</p>
<p>750<br>01:17:34,640 –&gt; 01:17:36,640<br>this discussion of this paper.</p>
<p>751<br>01:17:36,640 –&gt; 01:17:39,640<br>It’s probably the first paper that we’ve read,</p>
<p>752<br>01:17:39,640 –&gt; 01:17:42,640<br>that basically in order to system itself is not the one,</p>
<p>753<br>01:17:42,640 –&gt; 01:17:44,640<br>you know, it’s not going to be dominant use.</p>
<p>754<br>01:17:44,640 –&gt; 01:17:46,640<br>And therefore it’s really interesting to talk about.</p>
<p>755<br>01:17:46,640 –&gt; 01:17:50,640<br>But what is interesting about the system is the ideas in it.</p>
<p>756<br>01:17:50,640 –&gt; 01:17:53,640<br>And so cash per hearing protocol.</p>
<p>757<br>01:17:55,640 –&gt; 01:17:57,640<br>More cash persistence.</p>
<p>758<br>01:17:58,640 –&gt; 01:17:59,640<br>See protocol.</p>
<p>759<br>01:18:03,640 –&gt; 01:18:04,640<br>Distributed locking.</p>
<p>760<br>01:18:07,640 –&gt; 01:18:09,640<br>Lock servers, leases.</p>
<p>761<br>01:18:11,640 –&gt; 01:18:15,640<br>Grantee and acquiring and revoking.</p>
<p>762<br>01:18:15,640 –&gt; 01:18:18,640<br>And distributed recovery.</p>
<p>763<br>01:18:18,640 –&gt; 01:18:20,640<br>You know, we’re one workstation crashes,</p>
<p>764<br>01:18:20,640 –&gt; 01:18:24,640<br>but again, demon on another workstation actually does the recovery.</p>
<p>765<br>01:18:25,640 –&gt; 01:18:27,640<br>And what particularly interesting is it,</p>
<p>766<br>01:18:27,640 –&gt; 01:18:30,640<br>what’s interesting is sort of the interaction between the three pieces.</p>
<p>767<br>01:18:32,640 –&gt; 01:18:33,640<br>Then they interact.</p>
<p>768<br>01:18:35,640 –&gt; 01:18:39,640<br>And what we’ll see in the next couple of papers next week,</p>
<p>769<br>01:18:39,640 –&gt; 01:18:41,640<br>particularly not not the first day,</p>
<p>770<br>01:18:41,640 –&gt; 01:18:43,640<br>but the papers after that,</p>
<p>771<br>01:18:43,640 –&gt; 01:18:45,640<br>which we’re going to talk about some heavy duty,</p>
<p>772<br>01:18:45,640 –&gt; 01:18:47,640<br>pretty involved, you know, to exact systems.</p>
<p>773<br>01:18:47,640 –&gt; 01:18:49,640<br>We’ll see these free topics come up.</p>
<p>774<br>01:18:50,640 –&gt; 01:18:51,640<br>Two.</p>
<p>775<br>01:18:51,640 –&gt; 01:18:53,640<br>And so hopefully this will help you when reading those papers,</p>
<p>776<br>01:18:53,640 –&gt; 01:18:55,640<br>and understand actually what cash per hearing is,</p>
<p>777<br>01:18:55,640 –&gt; 01:18:57,640<br>what, you know, crash recovery is,</p>
<p>778<br>01:18:57,640 –&gt; 01:19:00,640<br>and, you know, distributed locks are.</p>
<p>779<br>01:19:02,640 –&gt; 01:19:03,640<br>And the other thing probably point,</p>
<p>780<br>01:19:03,640 –&gt; 01:19:06,640<br>and that’s interesting to make is that, you know,</p>
<p>781<br>01:19:06,640 –&gt; 01:19:08,640<br>you know, pedal is really good, you know,</p>
<p>782<br>01:19:08,640 –&gt; 01:19:12,640<br>for useful for the particular setting they designed it for.</p>
<p>783<br>01:19:13,640 –&gt; 01:19:15,640<br>And the performance part of the papers,</p>
<p>784<br>01:19:15,640 –&gt; 01:19:18,640<br>we’ve been hard to understand because it’s like for 99,</p>
<p>785<br>01:19:18,640 –&gt; 01:19:20,640<br>but now I give you look at the graphs,</p>
<p>786<br>01:19:20,640 –&gt; 01:19:24,640<br>you’ll see that the file system basically workload can increase</p>
<p>787<br>01:19:24,640 –&gt; 01:19:26,640<br>with the number of workstations.</p>
<p>788<br>01:19:26,640 –&gt; 01:19:29,640<br>And you know, that’s exactly where they were shooting for.</p>
<p>789<br>01:19:29,640 –&gt; 01:19:32,640<br>And, you know, they achieved that goal.</p>
<p>790<br>01:19:32,640 –&gt; 01:19:34,640<br>Anyway, I hope you find this interesting,</p>
<p>791<br>01:19:34,640 –&gt; 01:19:36,640<br>sort of not your usual design.</p>
<p>792<br>01:19:36,640 –&gt; 01:19:38,640<br>And so hopefully I’ll say that thought perfectly.</p>
<p>793<br>01:19:39,640 –&gt; 01:19:41,640<br>And with that, I’ll stop.</p>
<p>794<br>01:19:41,640 –&gt; 01:19:44,640<br>Of course, you know, stick around if you want to ask more questions.</p>
<p>795<br>01:19:44,640 –&gt; 01:19:46,640<br>And otherwise, we’ll see you first day.</p>
<p>796<br>01:19:50,640 –&gt; 01:19:53,640<br>Can I can ask two questions?</p>
<p>797<br>01:19:53,640 –&gt; 01:19:55,640<br>My first question was just in general,</p>
<p>798<br>01:19:55,640 –&gt; 01:19:58,640<br>the cash coherence protocol here,</p>
<p>799<br>01:19:58,640 –&gt; 01:20:02,640<br>is to not have one file cash.</p>
<p>800<br>01:20:02,640 –&gt; 01:20:04,640<br>Into places, right?</p>
<p>801<br>01:20:04,640 –&gt; 01:20:05,640<br>Yeah.</p>
<p>802<br>01:20:06,640 –&gt; 01:20:07,640<br>Okay.</p>
<p>803<br>01:20:07,640 –&gt; 01:20:09,640<br>And my other question was about the,</p>
<p>804<br>01:20:09,640 –&gt; 01:20:11,640<br>there was a,</p>
<p>805<br>01:20:11,640 –&gt; 01:20:14,640<br>a page with the log.</p>
<p>806<br>01:20:14,640 –&gt; 01:20:18,640<br>And you had the log records there.</p>
<p>807<br>01:20:18,640 –&gt; 01:20:19,640<br>Yep.</p>
<p>808<br>01:20:19,640 –&gt; 01:20:20,640<br>Let me go back here.</p>
<p>809<br>01:20:20,640 –&gt; 01:20:21,640<br>Yeah, yeah, yeah.</p>
<p>810<br>01:20:21,640 –&gt; 01:20:22,640<br>And I was,</p>
<p>811<br>01:20:22,640 –&gt; 01:20:23,640<br>I was wondering,</p>
<p>812<br>01:20:23,640 –&gt; 01:20:25,640<br>you said that each,</p>
<p>813<br>01:20:25,640 –&gt; 01:20:30,640<br>each like record is atomic.</p>
<p>814<br>01:20:30,640 –&gt; 01:20:32,640<br>But it’s not like that.</p>
<p>815<br>01:20:32,640 –&gt; 01:20:33,640<br>It’s not like that.</p>
<p>816<br>01:20:33,640 –&gt; 01:20:35,640<br>It’s not like that.</p>
<p>817<br>01:20:35,640 –&gt; 01:20:36,640<br>It’s not like that.</p>
<p>818<br>01:20:36,640 –&gt; 01:20:38,640<br>Is atomic.</p>
<p>819<br>01:20:38,640 –&gt; 01:20:41,640<br>But each record has a number of updates.</p>
<p>820<br>01:20:41,640 –&gt; 01:20:42,640<br>Two, right?</p>
<p>821<br>01:20:42,640 –&gt; 01:20:43,640<br>Yes.</p>
<p>822<br>01:20:43,640 –&gt; 01:20:45,640<br>Again, I think the paper slide.</p>
<p>823<br>01:20:45,640 –&gt; 01:20:46,640<br>We’ve been here,</p>
<p>824<br>01:20:46,640 –&gt; 01:20:47,640<br>what exactly what it does.</p>
<p>825<br>01:20:47,640 –&gt; 01:20:49,640<br>Either it always states in five or 12 bytes.</p>
<p>826<br>01:20:49,640 –&gt; 01:20:52,640<br>And then the single sector for five or 12 bytes just is,</p>
<p>827<br>01:20:52,640 –&gt; 01:20:55,640<br>atomic or they use this checksum trick.</p>
<p>828<br>01:20:55,640 –&gt; 01:20:57,640<br>So you read two and five,</p>
<p>829<br>01:20:57,640 –&gt; 01:20:58,640<br>the final bytes.</p>
<p>830<br>01:20:58,640 –&gt; 01:21:04,640<br>Okay.</p>
<p>831<br>01:21:04,640 –&gt; 01:21:06,640<br>So if it’s shorter than good,</p>
<p>832<br>01:21:06,640 –&gt; 01:21:07,640<br>if it’s not,</p>
<p>833<br>01:21:07,640 –&gt; 01:21:08,640<br>you do the check.</p>
<p>834<br>01:21:08,640 –&gt; 01:21:09,640<br>Okay.</p>
<p>835<br>01:21:09,640 –&gt; 01:21:11,640<br>I see.</p>
<p>836<br>01:21:11,640 –&gt; 01:21:12,640<br>Yeah.</p>
<p>837<br>01:21:12,640 –&gt; 01:21:14,640<br>You’re not sure what they are.</p>
<p>838<br>01:21:14,640 –&gt; 01:21:15,640<br>I’ll do.</p>
<p>839<br>01:21:15,640 –&gt; 01:21:16,640<br>Oh, okay.</p>
<p>840<br>01:21:16,640 –&gt; 01:21:17,640<br>Okay.</p>
<p>841<br>01:21:17,640 –&gt; 01:21:18,640<br>Thank you so much.</p>
<p>842<br>01:21:18,640 –&gt; 01:21:19,640<br>You’re welcome.</p>
<p>843<br>01:21:19,640 –&gt; 01:21:21,640<br>Any more questions.</p>
<p>844<br>01:21:21,640 –&gt; 01:21:22,640<br>Thank you.</p>
<p>845<br>01:21:22,640 –&gt; 01:21:28,640<br>Any more questions.</p>
<p>846<br>01:21:28,640 –&gt; 01:21:31,640<br>Oh, if you go back or forward,</p>
<p>847<br>01:21:31,640 –&gt; 01:21:32,640<br>three slides.</p>
<p>848<br>01:21:32,640 –&gt; 01:21:33,640<br>Yep.</p>
<p>849<br>01:21:33,640 –&gt; 01:21:34,640<br>Here.</p>
<p>850<br>01:21:34,640 –&gt; 01:21:35,640<br>Because this.</p>
<p>851<br>01:21:35,640 –&gt; 01:21:37,640<br>Maybe back one slide.</p>
<p>852<br>01:21:37,640 –&gt; 01:21:40,640<br>There’s a section where you talked about how.</p>
<p>853<br>01:21:40,640 –&gt; 01:21:41,640<br>If.</p>
<p>854<br>01:21:41,640 –&gt; 01:21:44,640<br>Crash happens during the middle of the right.</p>
<p>855<br>01:21:44,640 –&gt; 01:21:45,640<br>And we get like,</p>
<p>856<br>01:21:45,640 –&gt; 01:21:46,640<br>yeah, a prefix in the log.</p>
<p>857<br>01:21:46,640 –&gt; 01:21:47,640<br>That’s like,</p>
<p>858<br>01:21:47,640 –&gt; 01:21:48,640<br>okay or something.</p>
<p>859<br>01:21:48,640 –&gt; 01:21:50,640<br>Do you mind repeating what you meant there?</p>
<p>860<br>01:21:50,640 –&gt; 01:21:51,640<br>Yeah.</p>
<p>861<br>01:21:51,640 –&gt; 01:21:52,640<br>Okay.</p>
<p>862<br>01:21:52,640 –&gt; 01:21:53,640<br>So.</p>
<p>863<br>01:21:53,640 –&gt; 01:21:55,640<br>So let’s go back to this last picture.</p>
<p>864<br>01:21:55,640 –&gt; 01:21:56,640<br>I just showed.</p>
<p>865<br>01:21:56,640 –&gt; 01:21:57,640<br>Here.</p>
<p>866<br>01:21:57,640 –&gt; 01:22:00,640<br>So you have our show.</p>
<p>867<br>01:22:00,640 –&gt; 01:22:01,640<br>The.</p>
<p>868<br>01:22:01,640 –&gt; 01:22:03,640<br>The workstation one could have executed many,</p>
<p>869<br>01:22:03,640 –&gt; 01:22:05,640<br>many file system operations.</p>
<p>870<br>01:22:05,640 –&gt; 01:22:06,640<br>Correct.</p>
<p>871<br>01:22:06,640 –&gt; 01:22:07,640<br>Each one of them.</p>
<p>872<br>01:22:07,640 –&gt; 01:22:10,640<br>Described by one of these log by an entry in the log.</p>
<p>873<br>01:22:10,640 –&gt; 01:22:13,640<br>So like the first entry might be creating file F.</p>
<p>874<br>01:22:13,640 –&gt; 01:22:16,640<br>You know, second entry in the log might be creating file G.</p>
<p>875<br>01:22:16,640 –&gt; 01:22:17,640<br>You know,</p>
<p>876<br>01:22:17,640 –&gt; 01:22:19,640<br>one of the third line might creating a deleting file F.</p>
<p>877<br>01:22:19,640 –&gt; 01:22:22,640<br>And so there’s a whole sequence of operations.</p>
<p>878<br>01:22:22,640 –&gt; 01:22:27,640<br>Because we remember the workstation just keeps executing file system operations.</p>
<p>879<br>01:22:27,640 –&gt; 01:22:31,640<br>As long as it holds the locks and nobody else wants to the locks.</p>
<p>880<br>01:22:31,640 –&gt; 01:22:37,640<br>And so the log could be containing a whole bunch of file system operations.</p>
<p>881<br>01:22:37,640 –&gt; 01:22:40,640<br>Now for each file system operation for each individual one,</p>
<p>882<br>01:22:40,640 –&gt; 01:22:42,640<br>there’s a wall direct.</p>
<p>883<br>01:22:42,640 –&gt; 01:22:48,640<br>And the log record is the atomic file system operations description of the changes</p>
<p>884<br>01:22:48,640 –&gt; 01:22:52,640<br>and the actual file system blocks to reflect, you know,</p>
<p>885<br>01:22:52,640 –&gt; 01:22:54,640<br>that file system operation.</p>
<p>886<br>01:22:54,640 –&gt; 01:22:57,640<br>And so what could happen correct is that.</p>
<p>887<br>01:22:57,640 –&gt; 01:23:02,640<br>The revoke message comes in the workstation one starts writing its log,</p>
<p>888<br>01:23:02,640 –&gt; 01:23:04,640<br>you know, to pedal.</p>
<p>889<br>01:23:04,640 –&gt; 01:23:06,640<br>But it just doesn’t get all the way to the end.</p>
<p>890<br>01:23:06,640 –&gt; 01:23:09,640<br>It just happens to crash like somewhere in the middle, like anywhere.</p>
<p>891<br>01:23:09,640 –&gt; 01:23:10,640<br>Right.</p>
<p>892<br>01:23:10,640 –&gt; 01:23:16,640<br>And that case, this prefix of the workstation log is on the disk.</p>
<p>893<br>01:23:16,640 –&gt; 01:23:18,640<br>Or in pedal.</p>
<p>894<br>01:23:18,640 –&gt; 01:23:27,640<br>And that means that basically the last couple of file system operation are just walks.</p>
<p>895<br>01:23:27,640 –&gt; 01:23:31,640<br>And only the prefix will be replaced.</p>
<p>896<br>01:23:31,640 –&gt; 01:23:33,640<br>I see and we’re just saying that’s okay.</p>
<p>897<br>01:23:33,640 –&gt; 01:23:35,640<br>Yeah, we’re accepting that outcome.</p>
<p>898<br>01:23:35,640 –&gt; 01:23:36,640<br>Got it. Thank you.</p>
<p>899<br>01:23:36,640 –&gt; 01:23:39,640<br>Because we already accepted to that outcome earlier, right?</p>
<p>900<br>01:23:39,640 –&gt; 01:23:42,640<br>Because it could have been the case that we got the file system crashed.</p>
<p>901<br>01:23:42,640 –&gt; 01:23:45,640<br>And we got the file system.</p>
<p>902<br>01:23:45,640 –&gt; 01:23:46,640<br>And we got the file system.</p>
<p>903<br>01:23:46,640 –&gt; 01:23:48,640<br>Right before it or right after you got the revoke message,</p>
<p>904<br>01:23:48,640 –&gt; 01:23:56,640<br>but it actually didn’t write any log entry yet to the to pedal.</p>
<p>905<br>01:23:56,640 –&gt; 01:24:02,640<br>Any more questions.</p>
<p>906<br>01:24:02,640 –&gt; 01:24:05,640<br>I have completely unrelated question.</p>
<p>907<br>01:24:05,640 –&gt; 01:24:06,640<br>Sure.</p>
<p>908<br>01:24:06,640 –&gt; 01:24:08,640<br>I’ve been looking forward to it.</p>
<p>909<br>01:24:08,640 –&gt; 01:24:10,640<br>I’m sorry.</p>
<p>910<br>01:24:10,640 –&gt; 01:24:11,640<br>I’ve had a lot of questions.</p>
<p>911<br>01:24:11,640 –&gt; 01:24:12,640<br>I’m thinking about a.</p>
<p>912<br>01:24:12,640 –&gt; 01:24:13,640<br>A to four.</p>
<p>913<br>01:24:13,640 –&gt; 01:24:16,640<br>But I was wondering if you knew.</p>
<p>914<br>01:24:16,640 –&gt; 01:24:18,640<br>Anything about six.</p>
<p>915<br>01:24:18,640 –&gt; 01:24:19,640<br>A five.</p>
<p>916<br>01:24:19,640 –&gt; 01:24:20,640<br>Eight.</p>
<p>917<br>01:24:20,640 –&gt; 01:24:21,640<br>For next semester.</p>
<p>918<br>01:24:21,640 –&gt; 01:24:23,640<br>So, professor Saldo, it’s just going to be teaching.</p>
<p>919<br>01:24:23,640 –&gt; 01:24:24,640<br>Six.</p>
<p>920<br>01:24:24,640 –&gt; 01:24:25,640<br>So, eight.</p>
<p>921<br>01:24:25,640 –&gt; 01:24:26,640<br>Sixty.</p>
<p>922<br>01:24:26,640 –&gt; 01:24:27,640<br>Yeah.</p>
<p>923<br>01:24:27,640 –&gt; 01:24:28,640<br>I think we’re,</p>
<p>924<br>01:24:28,640 –&gt; 01:24:30,640<br>the current plan is not offer eight five eight in the fall.</p>
<p>925<br>01:24:30,640 –&gt; 01:24:32,640<br>But we’re hoping to offer it in the spring.</p>
<p>926<br>01:24:32,640 –&gt; 01:24:33,640<br>Okay.</p>
<p>927<br>01:24:33,640 –&gt; 01:24:38,640<br>What 660 is, I couldn’t find much information.</p>
<p>928<br>01:24:38,640 –&gt; 01:24:40,640<br>There’s no reason to do that.</p>
<p>929<br>01:24:40,640 –&gt; 01:24:43,640<br>That’s a good question.</p>
<p>930<br>01:24:43,640 –&gt; 01:24:48,640<br>It’s intended to be an undergrad security class.</p>
<p>931<br>01:24:48,640 –&gt; 01:24:49,640<br>Okay.</p>
<p>932<br>01:24:49,640 –&gt; 01:24:51,640<br>Okay. Nice.</p>
<p>933<br>01:24:51,640 –&gt; 01:24:57,640<br>So, like 685, 685, 858, but undergrad?</p>
<p>934<br>01:24:57,640 –&gt; 01:25:04,640<br>I thought it was sort of like maybe a name throw to both 685, 7 and 685, 8.</p>
<p>935<br>01:25:04,640 –&gt; 01:25:06,640<br>Okay.</p>
<p>936<br>01:25:06,640 –&gt; 01:25:08,640<br>Who has the number?</p>
<p>937<br>01:25:08,640 –&gt; 01:25:12,640<br>It’s an experimental number. It’s one of these experimental ones because the class doesn’t exist.</p>
<p>938<br>01:25:12,640 –&gt; 01:25:17,640<br>And it will be offered for the goals to offer it for the first time in a fall.</p>
<p>939<br>01:25:17,640 –&gt; 01:25:18,640<br>Okay.</p>
<p>940<br>01:25:18,640 –&gt; 01:25:27,640<br>So, is it going to be mostly like content from like is 858 going to keep its original form or is it?</p>
<p>941<br>01:25:27,640 –&gt; 01:25:30,640<br>I mean, you’re asking me questions.</p>
<p>942<br>01:25:30,640 –&gt; 01:25:33,640<br>Sorry.</p>
<p>943<br>01:25:33,640 –&gt; 01:25:41,640<br>I think the people involved in designing the class are people that are involved in 857 and the people involved in a fight.</p>
<p>944<br>01:25:41,640 –&gt; 01:25:42,640<br>Yeah.</p>
<p>945<br>01:25:42,640 –&gt; 01:25:44,640<br>I’m not actually involved.</p>
<p>946<br>01:25:45,640 –&gt; 01:25:46,640<br>I’m not really involved.</p>
<p>947<br>01:25:46,640 –&gt; 01:25:47,640<br>I don’t know if I can help you.</p>
<p>948<br>01:25:47,640 –&gt; 01:25:50,640<br>I mean, I think it’s going to be a great question.</p>
<p>949<br>01:25:50,640 –&gt; 01:25:54,640<br>But, um,</p>
<p>950<br>01:25:54,640 –&gt; 01:25:57,640<br>and they’re trying to work out what the curriculum exactly is going to be.</p>
<p>951<br>01:25:57,640 –&gt; 01:26:01,640<br>And then, of course, you’re going to have some percolations for 858 and 857.</p>
<p>952<br>01:26:01,640 –&gt; 01:26:02,640<br>Okay.</p>
<p>953<br>01:26:02,640 –&gt; 01:26:03,640<br>Sounds good.</p>
<p>954<br>01:26:03,640 –&gt; 01:26:05,640<br>But 858 and 857 are not going to go away.</p>
<p>955<br>01:26:05,640 –&gt; 01:26:06,640<br>That’s the.</p>
<p>956<br>01:26:06,640 –&gt; 01:26:07,640<br>Great.</p>
<p>957<br>01:26:07,640 –&gt; 01:26:08,640<br>Thanks.</p>
<p>958<br>01:26:08,640 –&gt; 01:26:09,640<br>You’re welcome.</p>
<p>959<br>01:26:09,640 –&gt; 01:26:10,640<br>That’s a question.</p>
<p>960<br>01:26:10,640 –&gt; 01:26:11,640<br>I don’t know how quick it is.</p>
<p>961<br>01:26:11,640 –&gt; 01:26:19,640<br>Or like right before section seven, they talk about a case, a failure where with like the</p>
<p>962<br>01:26:19,640 –&gt; 01:26:22,720<br>least expiring and the server not really crashing.</p>
<p>963<br>01:26:22,720 –&gt; 01:26:23,720<br>Yeah.</p>
<p>964<br>01:26:23,720 –&gt; 01:26:29,079<br>And then talk about like basically that there’s no real solution.</p>
<p>965<br>01:26:29,079 –&gt; 01:26:31,240<br>Well, there’s a solution.</p>
<p>966<br>01:26:31,240 –&gt; 01:26:33,079<br>There’s a real solution.</p>
<p>967<br>01:26:33,079 –&gt; 01:26:35,079<br>The human intervention.</p>
<p>968<br>01:26:35,079 –&gt; 01:26:36,079<br>Yeah, okay.</p>
<p>969<br>01:26:36,079 –&gt; 01:26:40,600<br>So I think the problem here really is in this sort of the theme of the paperwork, like</p>
<p>970<br>01:26:40,600 –&gt; 01:26:44,000<br>you know, pedal and front Japan, you have designed independently.</p>
<p>971<br>01:26:44,000 –&gt; 01:26:46,560<br>And that has a lot of nice properties.</p>
<p>972<br>01:26:46,560 –&gt; 01:26:49,680<br>And this is one where one one plays where it would be very helpful.</p>
<p>973<br>01:26:49,680 –&gt; 01:26:53,000<br>Hopefully that your pedal has some support, you know, to help from Japan.</p>
<p>974<br>01:26:53,000 –&gt; 01:26:58,280<br>You walk and that support would be actually half a time stamp on the right to pedal so</p>
<p>975<br>01:26:58,280 –&gt; 01:27:02,360<br>that pedal can see when it right actually is out of you know, basically tool.</p>
<p>976<br>01:27:02,360 –&gt; 01:27:03,360<br>Okay.</p>
<p>977<br>01:27:03,360 –&gt; 01:27:08,920<br>So unless you do that, you need to like fiddle around with like the margin.</p>
<p>978<br>01:27:08,920 –&gt; 01:27:09,920<br>Yes.</p>
<p>979<br>01:27:09,920 –&gt; 01:27:10,920<br>Exactly.</p>
<p>980<br>01:27:10,920 –&gt; 01:27:11,920<br>Okay.</p>
<p>981<br>01:27:11,920 –&gt; 01:27:20,560<br>And what happens if like that error occurs like outside of the bounds of the margin?</p>
<p>982<br>01:27:20,560 –&gt; 01:27:24,119<br>I mean, that’s a cool.</p>
<p>983<br>01:27:24,119 –&gt; 01:27:29,319<br>Basically you get an older right showing up in the basically somebody else might have</p>
<p>984<br>01:27:29,319 –&gt; 01:27:31,480<br>that point gotten the walk on the file, correct?</p>
<p>985<br>01:27:31,480 –&gt; 01:27:32,840<br>You’re starting writing to it.</p>
<p>986<br>01:27:32,840 –&gt; 01:27:37,440<br>And there’s old right shows up and basically it’s only overwrite some part of it.</p>
<p>987<br>01:27:37,440 –&gt; 01:27:38,440<br>Okay.</p>
<p>988<br>01:27:39,000 –&gt; 01:27:41,000<br>So we’ll break consistency.</p>
<p>989<br>01:27:41,000 –&gt; 01:27:43,000<br>So thank you.</p>
<p>990<br>01:27:43,000 –&gt; 01:27:44,000<br>You’re welcome.</p>
<p>991<br>01:27:44,000 –&gt; 01:27:45,000<br>Okay.</p>
<p>992<br>01:27:45,000 –&gt; 01:27:53,000<br>I guess we’ll stop with that.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MIT6824 P12Lecture12 CacheConsistency Frangipani</div>
      <div>http://example.com/2025/10/24/MIT6824 P12Lecture12-CacheConsistency-Frangipani/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/24/MIT6824%20P11Lecture11-ChainReplication/" title="MIT6824 P11Lecture11 ChainReplication">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MIT6824 P11Lecture11 ChainReplication</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/24/MIT6824%20P10Lecture10-GuestLectureonGo-RussCox/" title="MIT6824 P10Lecture10 GuestLectureonGo RussCox">
                        <span class="hidden-mobile">MIT6824 P10Lecture10 GuestLectureonGo RussCox</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
