

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:05,520Okay, thank you. Okay, so good afternoon, good evening, good morning, good night, whatever you are. 200:00:06,719 –&gt; 00:00:13,359We’re going to talk to you about tra">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6824 P13Lecture13 DistributedTransactions">
<meta property="og:url" content="http://example.com/2025/10/24/MIT6824%20P13Lecture13-DistributedTransactions/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:05,520Okay, thank you. Okay, so good afternoon, good evening, good morning, good night, whatever you are. 200:00:06,719 –&gt; 00:00:13,359We’re going to talk to you about tra">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-24T12:02:19.366Z">
<meta property="article:modified_time" content="2025-10-24T12:06:28.572Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MIT6824 P13Lecture13 DistributedTransactions - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MIT6824 P13Lecture13 DistributedTransactions"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-24 20:02" pubdate>
          2025年10月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          51 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MIT6824 P13Lecture13 DistributedTransactions</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:05,520<br>Okay, thank you. Okay, so good afternoon, good evening, good morning, good night, whatever you are.</p>
<p>2<br>00:00:06,719 –&gt; 00:00:13,359<br>We’re going to talk to you about transactions. And you probably noticed the reading material for</p>
<p>3<br>00:00:13,359 –&gt; 00:00:18,240<br>today is a little bit more tutorial in nature. We’re not studying a particular system and see how</p>
<p>4<br>00:00:20,160 –&gt; 00:00:25,359<br>set of IDs are implemented in that set of in that system instead. What we’re going to be doing is</p>
<p>5<br>00:00:25,359 –&gt; 00:00:34,320<br>talking about the concept of transactions because it shows up in the next two papers that will be</p>
<p>6<br>00:00:34,320 –&gt; 00:00:41,920<br>studying and those two papers have quite a lot of material in them and assume that you familiar</p>
<p>7<br>00:00:41,920 –&gt; 00:00:47,439<br>with transactions in a particular that you’re familiar with the two core ideas that we’ll see in</p>
<p>8<br>00:00:47,439 –&gt; 00:00:57,839<br>the database lecture namely two-phase locking and two-phase commit.</p>
<p>9<br>00:01:06,400 –&gt; 00:01:12,959<br>And sometimes they abbreviated as two PC for two-phase commit and two PL for two-phase locking.</p>
<p>10<br>00:01:13,919 –&gt; 00:01:20,319<br>One point of confusion that the two terms really don’t have to do much, don’t have to, don’t do it.</p>
<p>11<br>00:01:21,359 –&gt; 00:01:30,000<br>I really don’t that much related. They happen to have both the two-phase in it but they</p>
<p>12<br>00:01:30,000 –&gt; 00:01:35,199<br>solve completely different problems. They happen to also show up on typically the context of</p>
<p>13<br>00:01:35,199 –&gt; 00:01:41,759<br>transactions but they’re even outside of transactions. They are good ideas or worthy ideas.</p>
<p>14<br>00:01:42,959 –&gt; 00:01:47,919<br>They don’t let yourself confuse by the fact that they both have two-phase and they’re pretty</p>
<p>15<br>00:01:47,919 –&gt; 00:01:54,319<br>unrelated. Okay, so I’m just going to dive in a little bit and start talking about transactions in</p>
<p>16<br>00:01:54,319 –&gt; 00:02:02,639<br>general. And the reason that we’re going to care about transactions a lot is that we want to be</p>
<p>17<br>00:02:02,639 –&gt; 00:02:08,479<br>able to do cross-machine operations. So the problem that we’re going to try to tackle</p>
<p>18<br>00:02:08,560 –&gt; 00:02:15,599<br>in this lecture as well as in the two upcoming papers is cross-machine</p>
<p>19<br>00:02:20,799 –&gt; 00:02:30,319<br>atomic ops. And so for example just to make it a little bit concrete let’s say we have a client.</p>
<p>20<br>00:02:31,280 –&gt; 00:02:40,400<br>We have two we have a chart of key value server. So some of the keys are on key value server one.</p>
<p>21<br>00:02:41,840 –&gt; 00:02:48,079<br>So many are on key value server two. So the keys are split across them. So for example maybe</p>
<p>22<br>00:02:48,079 –&gt; 00:02:55,599<br>key V1 has X, key A2 has Y. And we basically want to do the atomic operation across those two</p>
<p>23<br>00:02:55,599 –&gt; 00:03:01,919<br>keys. And the easy way of the classic example in the context of transactions is always doing a</p>
<p>24<br>00:03:01,919 –&gt; 00:03:11,039<br>transfer. So let’s say the client wants to do a transfer from X to Y. Here’s our client. And</p>
<p>25<br>00:03:11,519 –&gt; 00:03:21,599<br>it’s going to do basically a put to X to maybe add or subtract from the account. So let’s do X</p>
<p>26<br>00:03:21,599 –&gt; 00:03:29,919<br>minus one. And then the client is going to do a put of Y plus one. Transfer</p>
<p>27<br>00:03:29,919 –&gt; 00:03:37,280<br>basically one dollar from the account X to the account Y. And our goal is basically going to be</p>
<p>28<br>00:03:38,240 –&gt; 00:03:49,840<br>we want automissivity. We respect the failures and concurrency.</p>
<p>29<br>00:03:56,080 –&gt; 00:04:03,520<br>So even if we’re going to want the first key value server fails after the put,</p>
<p>30<br>00:04:04,000 –&gt; 00:04:09,520<br>then we want to like to arrange it that basically the transfer didn’t happen at all. So generally</p>
<p>31<br>00:04:09,520 –&gt; 00:04:14,400<br>the semantics that we’re looking for is that both operations happen or need a one of them happens.</p>
<p>32<br>00:04:15,200 –&gt; 00:04:20,000<br>And so similarly from a concurrency perspective if another client is running and also tries to</p>
<p>33<br>00:04:20,000 –&gt; 00:04:25,280<br>inspect these accounts, then what we would like to do the case is that both puts show up</p>
<p>34<br>00:04:25,280 –&gt; 00:04:30,560<br>atomically. And so another transaction cannot observe an intermediate result. So if we’re an</p>
<p>35<br>00:04:30,560 –&gt; 00:04:35,120<br>intermediate result, as for example, the money is deducted from X but hasn’t been added to Y yet.</p>
<p>36<br>00:04:36,720 –&gt; 00:04:39,680<br>So these are the type of things we want to do. And it’s come right,</p>
<p>37<br>00:04:39,680 –&gt; 00:04:45,199<br>Kwaman, the distributed system is going to know that you would like to do operation across charge.</p>
<p>38<br>00:04:48,079 –&gt; 00:04:55,600<br>So that’s sort of the context of what we’d like to do. And the general plan for doing this</p>
<p>39<br>00:04:55,680 –&gt; 00:05:00,560<br>is come to actually from the database community. And as a general plan is transactions.</p>
<p>40<br>00:05:09,840 –&gt; 00:05:14,879<br>And what we like to do is basically group these operations, for example, in the case of the</p>
<p>41<br>00:05:14,879 –&gt; 00:05:20,640<br>transfer to two boot operations into a single transaction. And we like then the property that</p>
<p>42<br>00:05:20,719 –&gt; 00:05:26,719<br>this transaction executes atomically. And so typically, this requires some programmer annotations.</p>
<p>43<br>00:05:28,800 –&gt; 00:05:35,599<br>So begin transaction to indicate that the client wants to do start-up transaction, maybe then</p>
<p>44<br>00:05:36,879 –&gt; 00:05:48,639<br>the operations like X minus 1 and then at Y plus 1. And then you have to indicate that when</p>
<p>45<br>00:05:48,639 –&gt; 00:05:55,360<br>the transaction actually is complete. And so typically, we come to make it a commit.</p>
<p>46<br>00:05:57,599 –&gt; 00:06:03,439<br>And so the semantics that we’re looking for is that these operations are executed atomically</p>
<p>47<br>00:06:03,439 –&gt; 00:06:08,800<br>with respect to concurrency and respect to failure. And just to make it a little bit more exciting,</p>
<p>48<br>00:06:08,800 –&gt; 00:06:13,680<br>let’s look at the second transaction. So we can look at some case studies about how</p>
<p>49<br>00:06:13,680 –&gt; 00:06:22,079<br>transaction actually interact. We might have a second transaction begin X, which reads actually</p>
<p>50<br>00:06:22,079 –&gt; 00:06:41,920<br>these accounts. So t1 gets X and then t2 gets Y and then print t1, t2 and then it will commit.</p>
<p>51<br>00:06:44,639 –&gt; 00:06:51,680<br>So we have a second transaction that basically reads the accounts X and Y and then prints the values.</p>
<p>52<br>00:06:52,240 –&gt; 00:06:57,600<br>And one reason that we have two transactions is that we can look from the concurrency perspective</p>
<p>53<br>00:06:57,600 –&gt; 00:07:01,439<br>how these transactions actually are ordered and what are legal outcomes and what are</p>
<p>54<br>00:07:01,439 –&gt; 00:07:09,519<br>legal outcomes. Now transactions tend to be a general, almost like a piece of magic,</p>
<p>55<br>00:07:09,519 –&gt; 00:07:15,839<br>you know, basically programmers can annotate these begin and operations and that takes a whole</p>
<p>56<br>00:07:15,839 –&gt; 00:07:20,639<br>group of operations together, make them atomic and use the system, we’ll take care of everything,</p>
<p>57<br>00:07:20,639 –&gt; 00:07:24,799<br>it will take care of the walking, it will take care of the recovery, it’s all like the program</p>
<p>58<br>00:07:24,799 –&gt; 00:07:32,079<br>doesn’t have to worry about it. The transactions are very, very powerful constructs. And they’re</p>
<p>59<br>00:07:32,079 –&gt; 00:07:38,560<br>useful in non-distributed systems. You have a single database machine or multi-core database machine</p>
<p>60<br>00:07:38,560 –&gt; 00:07:43,120<br>and clients are remaining transactions to it. Then the transaction systems will execute these</p>
<p>61<br>00:07:43,120 –&gt; 00:07:49,040<br>transactions as much as concurrently as possible. But also even if machine fails and comes back up,</p>
<p>62<br>00:07:49,040 –&gt; 00:07:56,480<br>now you can actually expect the results to be there. And our focus of course is going to be</p>
<p>63<br>00:07:57,279 –&gt; 00:08:05,920<br>distributed transactions. Of the ones that I had on the previous slide, namely</p>
<p>64<br>00:08:08,560 –&gt; 00:08:13,120<br>one is example of cross-sharks, which is a common case in data centers.</p>
<p>65<br>00:08:14,879 –&gt; 00:08:19,600<br>The typical API of a transaction also has one more operation that I didn’t list here,</p>
<p>66<br>00:08:20,240 –&gt; 00:08:26,000<br>and that is a board. So the two transactions that I showed here are both committing,</p>
<p>67<br>00:08:26,560 –&gt; 00:08:30,399<br>but you could easily have a transaction that decides to board. For example,</p>
<p>68<br>00:08:31,359 –&gt; 00:08:38,959<br>you might discover that, for example, transaction T1, my check that X has sufficient money in it</p>
<p>69<br>00:08:38,959 –&gt; 00:08:44,720<br>in the account, and if the account doesn’t have sufficient money, instead of calling it commit,</p>
<p>70<br>00:08:44,720 –&gt; 00:08:50,879<br>it would call a board. And that payment point of the transaction would be canceled. And even if</p>
<p>71<br>00:08:50,879 –&gt; 00:08:55,279<br>the transaction board is sort of halfway through and maybe has done some put operations,</p>
<p>72<br>00:08:55,840 –&gt; 00:08:59,679<br>the still the semantics should be that none of those put operations actually happens.</p>
<p>73<br>00:09:00,720 –&gt; 00:09:07,199<br>So in all cases, when it’s a boarder commit, either all of them have or none of them have</p>
<p>74<br>00:09:07,759 –&gt; 00:09:13,759<br>never a partial result. A board also might be called by the transaction system itself.</p>
<p>75<br>00:09:14,559 –&gt; 00:09:21,039<br>So for example, as we’ll see later, if there’s a deadlock between two transactions,</p>
<p>76<br>00:09:21,039 –&gt; 00:09:26,240<br>then the transaction system actually can abort one of those transactions so that the other</p>
<p>77<br>00:09:26,240 –&gt; 00:09:30,240<br>transaction can continue and maybe retry later the transaction that was aborted.</p>
<p>78<br>00:09:32,639 –&gt; 00:09:36,960<br>Okay, so this is sort of the primitives. You begin transaction commit and abort,</p>
<p>79<br>00:09:36,960 –&gt; 00:09:47,039<br>and then for the interface operations. And then the semantics of transactions are typically summarized</p>
<p>80<br>00:09:47,919 –&gt; 00:09:58,959<br>by a single word, namely asset. And that stands for like four key properties of transactions. One,</p>
<p>81<br>00:10:00,399 –&gt; 00:10:08,639<br>it’s atomic. And here, really, atomic refers through the case where we have two transaction running,</p>
<p>82<br>00:10:09,599 –&gt; 00:10:14,719<br>and you’ve one transaction does multiple put operations or multiple add operations. All those</p>
<p>83<br>00:10:14,720 –&gt; 00:10:18,879<br>results will be all visible to the other transaction or none of them will be visible.</p>
<p>84<br>00:10:19,920 –&gt; 00:10:21,840<br>So that’s one aspect. Sorry.</p>
<p>85<br>00:10:26,879 –&gt; 00:10:33,759<br>I said this wrong. So atomic actually means through the crash recovery case. So if a transaction</p>
<p>86<br>00:10:33,759 –&gt; 00:10:41,680<br>actually is multiple put operations, the transaction crashes halfway, the rule is that all the</p>
<p>87<br>00:10:41,679 –&gt; 00:10:46,559<br>rights are visible, all the rights are on a stable storage or none of them. Because the</p>
<p>88<br>00:10:46,559 –&gt; 00:10:54,079<br>atomic sort of respect to crash recovery, the C stands for consistent, which is something we’re</p>
<p>89<br>00:10:54,079 –&gt; 00:10:59,679<br>mostly not going to talk about as more related to databases. It’s often the case that database</p>
<p>90<br>00:10:59,679 –&gt; 00:11:07,439<br>have internal invariance like referential integrity is one of them. And the transaction is supposed</p>
<p>91<br>00:11:07,840 –&gt; 00:11:13,920<br>to maintain that consistency. So no internal persistencies. This is going to be less of a topic for</p>
<p>92<br>00:11:13,920 –&gt; 00:11:26,160<br>us today. And free is isolated. The I stands for isolated. And isolated was the what I just said</p>
<p>93<br>00:11:26,160 –&gt; 00:11:29,840<br>earlier. And correctly, isolated actually refers to the case where we’re running two transactions.</p>
<p>94<br>00:11:30,400 –&gt; 00:11:35,360<br>And they don’t see the shouldn’t observe intermediate results from each other. So again,</p>
<p>95<br>00:11:36,000 –&gt; 00:11:43,600<br>all the rights are applied. All or nothing for respect to the disability do another transaction.</p>
<p>96<br>00:11:44,560 –&gt; 00:11:51,039<br>And then finally, the D stands for durable. Meaning that if the transaction commits,</p>
<p>97<br>00:11:52,080 –&gt; 00:11:57,360<br>then the results are written to a stable storage so that if the system crashes, comes back up later,</p>
<p>98<br>00:11:58,159 –&gt; 00:12:04,159<br>the latest rights or the latest transactions, the latest committed transactions are actually recorded</p>
<p>99<br>00:12:04,159 –&gt; 00:12:11,919<br>on stable storage. Any questions about sort of the quick introduction to transactions?</p>
<p>100<br>00:12:22,319 –&gt; 00:12:30,159<br>Okay, so I’m going to talk basically about two topics, quite a bit, namely the A part of the</p>
<p>101<br>00:12:30,240 –&gt; 00:12:37,360<br>transactions and the I part of transactions. I’m going to start with the I part and talk a little</p>
<p>102<br>00:12:37,360 –&gt; 00:12:46,959<br>bit about what actually correct isolation means. So basically what we’re looking for is a definition</p>
<p>103<br>00:12:47,600 –&gt; 00:12:54,240<br>for a correct execution of multiple transactions, for ground transactions. In the typical definition,</p>
<p>104<br>00:12:54,320 –&gt; 00:12:58,480<br>or the gold standard in the database literature is called serializable.</p>
<p>105<br>00:13:05,200 –&gt; 00:13:12,159<br>Or serializability. And what that means is that if you have two transactions or</p>
<p>106<br>00:13:12,159 –&gt; 00:13:18,799<br>many transactions and they execute concurrently, then the outcome has to be some serial order.</p>
<p>107<br>00:13:19,039 –&gt; 00:13:30,639<br>So either T1 executes before T2 or T2 executes before T1, but there’s some serial order.</p>
<p>108<br>00:13:35,919 –&gt; 00:13:39,919<br>And the serial order has to produce the same outcome.</p>
<p>109<br>00:13:43,039 –&gt; 00:13:47,839<br>That’s the concurrent execution. So if you’re on two transactions concurrently, they produce some</p>
<p>110<br>00:13:47,840 –&gt; 00:13:55,600<br>outcome. That outcome is only valid or legal or correct. It could have been the result of a serial</p>
<p>111<br>00:13:55,600 –&gt; 00:14:03,440<br>execution. So just to make a concrete for example, let’s say in the account case, X is start</p>
<p>112<br>00:14:03,440 –&gt; 00:14:10,960<br>out as being 10, Y starts out as being 10. We run these two transactions that we had earlier on</p>
<p>113<br>00:14:10,960 –&gt; 00:14:17,519<br>the board. So we might be able to do the two transactions are. And one basically moves one between</p>
<p>114<br>00:14:17,519 –&gt; 00:14:22,720<br>two accounts and the other one prints the result of the two. So we think a little bit about it.</p>
<p>115<br>00:14:22,720 –&gt; 00:14:31,840<br>If T1 goes first, then the outcome is going to be 9, 10. And the print statement is going to be</p>
<p>116<br>00:14:32,320 –&gt; 00:14:34,399<br>uh</p>
<p>117<br>00:14:40,399 –&gt; 00:14:46,240<br>uh yeah. And the print statement is going to say 9, 10, we’re sure 9, 11, that’s why I got confused.</p>
<p>118<br>00:14:47,519 –&gt; 00:14:53,280<br>And the print statement is also going to say X was the one that we subtracted to a 9, 11.</p>
<p>119<br>00:14:54,560 –&gt; 00:15:00,160<br>So we get a string 9, 11 out and the two dollars of the accounts are 9 and 9 and 11.</p>
<p>120<br>00:15:00,959 –&gt; 00:15:09,279<br>If T2 goes first, then the outcome is 10, 10 because nothing nobody has moved yet. And then</p>
<p>121<br>00:15:11,199 –&gt; 00:15:17,839<br>T1 goes. And so that’s the possible outcome. So that is the two legal outcomes of the two</p>
<p>122<br>00:15:17,839 –&gt; 00:15:23,679<br>transactions that we’re actually uh if we execute the two transactions concurrently and</p>
<p>123<br>00:15:24,479 –&gt; 00:15:31,199<br>the system guarantee serializability. Now you notice that serializability has probably a lot of</p>
<p>124<br>00:15:32,399 –&gt; 00:15:37,759<br>flavor of like the terminology that we used before, namely linearizability. The key difference</p>
<p>125<br>00:15:37,759 –&gt; 00:15:42,879<br>between serializability and linearizability is that in linearizability there’s a real time</p>
<p>126<br>00:15:43,439 –&gt; 00:15:52,000<br>a real time component that if it turns actually T2 starch after a T1 ends, then T2 has to show up later</p>
<p>127<br>00:15:52,000 –&gt; 00:15:57,039<br>in the total order, in the serial order. And serializability now does not require. So even the</p>
<p>128<br>00:15:57,039 –&gt; 00:16:01,600<br>of the transaction started you know a wall clock time a little bit later than another transaction</p>
<p>129<br>00:16:02,000 –&gt; 00:16:09,519<br>stopped or finished and the system is still allowed to re-order that. So serializability in some</p>
<p>130<br>00:16:09,519 –&gt; 00:16:17,600<br>ways is a little bit weaker than linearizability. Nevertheless serializability is a very convenient</p>
<p>131<br>00:16:17,600 –&gt; 00:16:23,360<br>programming area, because from a programming perspective you can always think about transactions</p>
<p>132<br>00:16:23,360 –&gt; 00:16:28,720<br>executing some serial order. And then you don’t have to consider all kinds of interleaders.</p>
<p>133<br>00:16:31,360 –&gt; 00:16:37,360<br>Okay so even though you know serializability is slightly weaker than linearizability,</p>
<p>134<br>00:16:38,240 –&gt; 00:16:45,680<br>it actually disallows a whole bunch of problematic cases. So let me talk a little bit about that</p>
<p>135<br>00:16:45,759 –&gt; 00:16:50,159<br>just to make clear that law actually serializability means.</p>
<p>136<br>00:16:52,879 –&gt; 00:16:58,479<br>And what sort of executions the transaction system actually has to forbid.</p>
<p>137<br>00:17:00,959 –&gt; 00:17:08,480<br>So let’s you know two cases like here we have the first transaction, we have the second</p>
<p>138<br>00:17:08,480 –&gt; 00:17:18,720<br>transaction running. So T1 runs T2 and you know one outcome that we could have is like one possible</p>
<p>139<br>00:17:18,720 –&gt; 00:17:26,400<br>execution that could might happen is if we don’t do some special you know T1 gets x.</p>
<p>140<br>00:17:29,039 –&gt; 00:17:33,200<br>You know here the transfer happens so the updates to x and y happen.</p>
<p>141<br>00:17:33,360 –&gt; 00:17:46,640<br>And then you know T2 does to get a y. And you know is this illegal or is this a serializable execution?</p>
<p>142<br>00:17:46,640 –&gt; 00:17:51,360<br>That’s the sort of question we have to ask. And what is the answer to that one?</p>
<p>143<br>00:17:54,480 –&gt; 00:18:00,559<br>This is not serializable. Yeah and because you know the outcome you know if you write down what</p>
<p>144<br>00:18:00,559 –&gt; 00:18:06,079<br>the outcome is correct then the outcome is going to be 9.11 here and this is going to write down</p>
<p>145<br>00:18:08,319 –&gt; 00:18:15,839<br>10 11 right? I think so. And if we go back you know through our previous slides not there’s not one</p>
<p>146<br>00:18:15,839 –&gt; 00:18:22,480<br>of the two illegal outcomes. So this is not good. So when we think about the implementation of</p>
<p>147<br>00:18:22,480 –&gt; 00:18:28,879<br>a transaction system you know it has to be the case that it forbids this particular execution schedule.</p>
<p>148<br>00:18:29,840 –&gt; 00:18:33,840<br>And you know there’s a similar version. Our transactions on these two exams are not so complicated</p>
<p>149<br>00:18:33,840 –&gt; 00:18:38,400<br>so they’re not that many in the leaving you have to that you can consider and that could go wrong.</p>
<p>150<br>00:18:38,400 –&gt; 00:18:45,920<br>But there’s at least one other one that can result in the not an incorrect outcome which is we do the</p>
<p>151<br>00:18:46,800 –&gt; 00:18:56,560<br>proof x first. So here we go. Then you know we actually print the two to do gets.</p>
<p>152<br>00:18:56,559 –&gt; 00:19:09,919<br>So get x get y and we do the food of y. And is there a serializable execution?</p>
<p>153<br>00:19:09,920 –&gt; 00:19:27,279<br>This is an execution that we should be forbidden by the serializable transaction system or is it</p>
<p>154<br>00:19:27,279 –&gt; 00:19:34,000<br>an okay execution? It should be forbidden. Yeah it should be forbidden correct because as an</p>
<p>155<br>00:19:34,000 –&gt; 00:19:41,759<br>outcome that could have not happened if we executed t1 first followed by t2 or t2 for followed by t1</p>
<p>156<br>00:19:41,759 –&gt; 00:19:48,400<br>right? Okay so you know what we clearly see is that the serializability you know excludes</p>
<p>157<br>00:19:49,359 –&gt; 00:19:56,400<br>executions just to in order to actually make it easier for programmers to think about actually</p>
<p>158<br>00:19:56,640 –&gt; 00:20:05,600<br>what a database does. And there are two broad approaches to forbidding executions and</p>
<p>159<br>00:20:06,960 –&gt; 00:20:15,360<br>you suppose this approach to a so forbidding is called concurrency control.</p>
<p>160<br>00:20:16,079 –&gt; 00:20:29,279<br>In the first approach or the first category of solutions is both called pessimistic solutions.</p>
<p>161<br>00:20:35,439 –&gt; 00:20:37,759<br>And the pessimistic distribution basically evolved walks.</p>
<p>162<br>00:20:38,400 –&gt; 00:20:47,119<br>So the idea is that like when the transaction runs or starts it requires the necessary</p>
<p>163<br>00:20:47,119 –&gt; 00:20:55,759<br>locks to maintain serializability and only release the locks. So when it’s guaranteed that the</p>
<p>164<br>00:20:55,759 –&gt; 00:21:01,039<br>execution will result in a serializable execution. So that’s the one approach and we’re going to talk</p>
<p>165<br>00:21:01,039 –&gt; 00:21:06,879<br>a little bit more about it in a second. The second approach is optimistic.</p>
<p>166<br>00:21:07,759 –&gt; 00:21:18,480<br>And in the optimistic approach is basically no locks. And in the optimistic approach you’re just</p>
<p>167<br>00:21:18,480 –&gt; 00:21:23,279<br>assuming things are going to work out. And basically when you get to the commit point</p>
<p>168<br>00:21:24,799 –&gt; 00:21:30,480<br>you know there’s actually system to sort of ask yourself the question well you know all given the</p>
<p>169<br>00:21:30,480 –&gt; 00:21:35,359<br>operation I’ve done in the past is that actually could that be the result of a linearizable</p>
<p>170<br>00:21:35,359 –&gt; 00:21:41,679<br>execution? Or could that be the result of a serializable execution? And if so think</p>
<p>171<br>00:21:41,679 –&gt; 00:21:48,639<br>to find and no problem at all then you know we’re good if it is the result does correspond to a</p>
<p>172<br>00:21:48,639 –&gt; 00:21:51,039<br>serialization execution then we’re basically just aboard.</p>
<p>173<br>00:21:51,359 –&gt; 00:22:09,759<br>And maybe and then we’ll retry probably. So we’ll see I’m not going to talk much about</p>
<p>174<br>00:22:09,759 –&gt; 00:22:14,799<br>optimistic concurrent control right now but next week we’re two weeks from now and we’re reading</p>
<p>175<br>00:22:14,879 –&gt; 00:22:21,279<br>the farm paper and we’ll see an optimistic transaction system, a distributed transaction system</p>
<p>176<br>00:22:21,279 –&gt; 00:22:25,759<br>of the type that we’re considering that uses an optimistic concurrent to your</p>
<p>177<br>00:22:26,480 –&gt; 00:22:31,519<br>concurrent control approach. But the focus for today is going to be on pessimistic.</p>
<p>178<br>00:22:33,759 –&gt; 00:22:41,839<br>And one you know sort of the flip way that these two approaches are described in the literature</p>
<p>179<br>00:22:41,839 –&gt; 00:22:46,799<br>often is that sort of pessimistic is you know you ask for permission first and then you do your</p>
<p>180<br>00:22:46,799 –&gt; 00:22:52,799<br>operations and the optimistic sort of the other way around you just go ahead and you do your operations</p>
<p>181<br>00:22:52,799 –&gt; 00:22:55,359<br>and if it turns out to be your wrong you usually apologize later.</p>
<p>182<br>00:22:57,679 –&gt; 00:23:03,759<br>And that is the analogy if you will sort of do between the two different approaches.</p>
<p>183<br>00:23:05,199 –&gt; 00:23:10,000<br>And with an each approach you know whether it’s a pessimistic or optimistic there are many</p>
<p>184<br>00:23:10,000 –&gt; 00:23:16,720<br>different concurrent control plants you know to either increase your concurrency or provide weaker</p>
<p>185<br>00:23:16,720 –&gt; 00:23:22,160<br>consistency and with more concurrency and so there’s like a there’s a huge huge literature.</p>
<p>186<br>00:23:23,839 –&gt; 00:23:31,119<br>And I’m just going to talk about one particular approach which is very popular,</p>
<p>187<br>00:23:31,759 –&gt; 00:23:36,319<br>particularly if you want to achieve serialized ability. It turns out that not although I said</p>
<p>188<br>00:23:36,319 –&gt; 00:23:40,319<br>like serialized abilities are gold standard for databases it’s often the case that</p>
<p>189<br>00:23:41,679 –&gt; 00:23:46,240<br>databases offer multiple degrees of isolation. So you know as a programmer you can sort of pick</p>
<p>190<br>00:23:46,240 –&gt; 00:23:51,039<br>you know the degree of isolation that you like and the reason that you want to make a weaker</p>
<p>191<br>00:23:51,039 –&gt; 00:23:55,919<br>degree of isolation is so that you can get more concurrency. Now we’re going to just stick to</p>
<p>192<br>00:23:55,919 –&gt; 00:24:00,399<br>the sort of the gold standard of concurrency which is namely serialized ability and if you do</p>
<p>193<br>00:24:00,400 –&gt; 00:24:04,560<br>serialized ability then a common approach is two-faced locking.</p>
<p>194<br>00:24:15,840 –&gt; 00:24:19,040<br>And in two-faced locking you know the basically you sort of a walk the record.</p>
<p>195<br>00:24:21,040 –&gt; 00:24:27,440<br>That’s the starting point for database record and you know in our little example that would be</p>
<p>196<br>00:24:27,440 –&gt; 00:24:35,759<br>sort of a lock per variable and I lock per for x and I lock for y. And there’s basically two rules.</p>
<p>197<br>00:24:37,360 –&gt; 00:24:42,240<br>One intersection acquires a lock</p>
<p>198<br>00:24:46,080 –&gt; 00:24:46,799<br>before using.</p>
<p>199<br>00:24:46,799 –&gt; 00:24:58,319<br>And so the idea is before you know you can read or write you know to x or y you first have to</p>
<p>200<br>00:24:58,319 –&gt; 00:25:01,200<br>obtain the lock and the transaction system will do this for you.</p>
<p>201<br>00:25:03,519 –&gt; 00:25:12,319<br>And two the t holds a lock and once you’re acquired you’re not allowed to release it until commit</p>
<p>202<br>00:25:12,319 –&gt; 00:25:19,119<br>or abort whatever whatever is the end of the transaction.</p>
<p>203<br>00:25:21,119 –&gt; 00:25:30,639<br>And so in our particular case if we are like t1 running and we have t2 running and t1 walks x first</p>
<p>204<br>00:25:31,359 –&gt; 00:25:37,759<br>and then you know a lock y and it has to maintain those locks until x2 reads its commit points.</p>
<p>205<br>00:25:37,759 –&gt; 00:25:46,480<br>So if t2 runs at the same time we’re roughly at the same time if t2 starts a little bit later</p>
<p>206<br>00:25:46,960 –&gt; 00:25:54,160<br>and tries to grab the lock and x t1 will have it if t2 started a little bit later and at that point</p>
<p>207<br>00:25:54,160 –&gt; 00:26:01,920<br>you know basically t2 has to wait. That sort of standard locking protocol. And the basic idea of</p>
<p>208<br>00:26:01,920 –&gt; 00:26:08,560<br>two-faced locking is that it’s sort of a refinement or an improvement over this simple locking</p>
<p>209<br>00:26:08,560 –&gt; 00:26:14,640<br>scheme that is described in the document and which sometimes is called simple locking or strict</p>
<p>210<br>00:26:14,640 –&gt; 00:26:18,720<br>locking. We’re basically at the beginning of the transaction you grab all the locks you need</p>
<p>211<br>00:26:18,720 –&gt; 00:26:22,000<br>for the whole transaction you hold them until the end and then you release them.</p>
<p>212<br>00:26:22,640 –&gt; 00:26:29,759<br>And two-faced locking is a little bit more fine-grained in that even if the transactions might</p>
<p>213<br>00:26:32,400 –&gt; 00:26:35,759<br>and then they don’t require the locks and me and me all at the same time at the beginning.</p>
<p>214<br>00:26:36,480 –&gt; 00:26:40,640<br>And instead they require the locks incrementally as the transaction runs</p>
<p>215<br>00:26:40,640 –&gt; 00:26:45,680<br>you know which allows you know certain concurrently patterns that are disallowed by strict locking.</p>
<p>216<br>00:26:47,680 –&gt; 00:26:53,840<br>Now the first rule seems pretty clear you know why you need it. The second rule might be</p>
<p>217<br>00:26:53,840 –&gt; 00:27:00,320<br>or maybe less obvious and so it’s probably a good idea to actually see what goes wrong if you</p>
<p>218<br>00:27:00,319 –&gt; 00:27:06,559<br>did not maintain the second rule. And so let’s say talk a little bit about Intel commit.</p>
<p>219<br>00:27:12,319 –&gt; 00:27:21,279<br>And so here we have our two transactions. T1 and T2, the transfer and the print statement.</p>
<p>220<br>00:27:21,919 –&gt; 00:27:28,079<br>And so let’s say you know here we do our put-of-x and so that means before the put-of-x the</p>
<p>221<br>00:27:28,079 –&gt; 00:27:34,960<br>transaction system locks x. And let’s say that we’re not following the two-faced locking rule</p>
<p>222<br>00:27:34,960 –&gt; 00:27:40,879<br>and we actually release the lock x right after the put because we’re done with it. Actually it</p>
<p>223<br>00:27:40,879 –&gt; 00:27:45,519<br>doesn’t show up in transaction T1 anymore. You know there will be a later put-of-x that does the put-of-y.</p>
<p>224<br>00:27:47,599 –&gt; 00:27:54,480<br>And let’s assume that before actually we get to the locking and y you know T2 runs and actually T2</p>
<p>225<br>00:27:54,480 –&gt; 00:28:05,680<br>basically the whole you know the two gets the get of x and the get of y run. And so since you know</p>
<p>226<br>00:28:05,680 –&gt; 00:28:13,039<br>T1 released the lock and x you know it can get the lock and x. Since T1 hasn’t gone to the put-of-y</p>
<p>227<br>00:28:13,039 –&gt; 00:28:22,000<br>yet you know it can also get the lock on y and so print x and y and reset and then release the locks.</p>
<p>228<br>00:28:24,480 –&gt; 00:28:36,000<br>So is this would this be a serializable execution?</p>
<p>229<br>00:28:41,200 –&gt; 00:28:45,680<br>No it’s the same as before. Yeah it’s exactly the same as before because basically the</p>
<p>230<br>00:28:47,039 –&gt; 00:28:51,599<br>print statements like here they sort of split in between the two to put in the get and the y</p>
<p>231<br>00:28:52,079 –&gt; 00:28:56,799<br>between the two puts of the x and y and we already concluded earlier that is not a serializable</p>
<p>232<br>00:28:56,799 –&gt; 00:29:02,879<br>conclusion. A serializable execution. So this is wrong and so this is an example of demonstrating that</p>
<p>233<br>00:29:02,879 –&gt; 00:29:09,919<br>if you release the lock to early in this case T1 released the x to early you’re not going to get a</p>
<p>234<br>00:29:09,919 –&gt; 00:29:15,439<br>serialized execution. And one way to think about it basically is that whenever there’s sort of an</p>
<p>235<br>00:29:15,440 –&gt; 00:29:24,080<br>intersection between you know two locksets so T1 has a lock set of x and y, T2 has a lock set of x</p>
<p>236<br>00:29:24,080 –&gt; 00:29:31,600<br>and y2 is important that you know during these two transactions get ordered in a particular way and</p>
<p>237<br>00:29:31,600 –&gt; 00:29:37,519<br>that means that if the lock sets intersect you know we have to make sure some polar order it.</p>
<p>238<br>00:29:37,519 –&gt; 00:29:42,080<br>And that means that we actually have to hold the locks you know to the end until the commit point</p>
<p>239<br>00:29:42,079 –&gt; 00:29:46,319<br>so that no intermediate results with the transaction are actually visible to other transactions.</p>
<p>240<br>00:29:47,519 –&gt; 00:29:52,319<br>And we release the locks before the commit point you know we might actually make a result visible</p>
<p>241<br>00:29:52,319 –&gt; 00:29:56,639<br>even though you know maybe later it’s actually even aborted right and then the whole change will go</p>
<p>242<br>00:29:56,639 –&gt; 00:30:01,439<br>away. So this is reason why you know locks must be held to the end.</p>
<p>243<br>00:30:03,839 –&gt; 00:30:11,119<br>Now an obvious problem the many of you asked about and two-faced locking is and there’s a</p>
<p>244<br>00:30:11,119 –&gt; 00:30:18,799<br>chance of deathlock. If you’re requiring the locks and the sort of the transactions execute.</p>
<p>245<br>00:30:19,439 –&gt; 00:30:25,759<br>And so let’s and this is absolutely the case and so let’s modify T2 slightly.</p>
<p>246<br>00:30:26,399 –&gt; 00:30:32,159<br>So T2 used to be you know T1 you know gets x and step we’re going to do within the opposite order</p>
<p>247<br>00:30:32,160 –&gt; 00:30:41,440<br>we’re first going to get y and then T2 gets x and we remain we keep T1 the same.</p>
<p>248<br>00:30:41,440 –&gt; 00:30:44,880<br>We’re going to T1 actually still does first to put to x and then to put the y.</p>
<p>249<br>00:30:45,519 –&gt; 00:30:53,759<br>So now we can easily get into trouble so this is T2 prime and this is just the ordinary T1 that</p>
<p>250<br>00:30:53,759 –&gt; 00:31:01,360<br>we already have it does a put of x you know before doing the put of x it needs to get the lock on x</p>
<p>251<br>00:31:01,359 –&gt; 00:31:09,359<br>so we’ll count locks x now let’s say that the ordering worked out as follows you know the same time</p>
<p>252<br>00:31:09,359 –&gt; 00:31:19,759<br>to T2 prime runs it does to get y so that means it got the lock on y and now you can easily see</p>
<p>253<br>00:31:19,759 –&gt; 00:31:27,679<br>if it goes wrong here now T1 is going to do a put of y or wants to do a put of y so it needs to get</p>
<p>254<br>00:31:27,680 –&gt; 00:31:35,920<br>the lock on y but it can’t get it because you know T2 prime actually has the lock so it has the</p>
<p>255<br>00:31:35,920 –&gt; 00:31:40,400<br>weight here that’s the block you know the same thing is going to happen of course in the other side</p>
<p>256<br>00:31:40,400 –&gt; 00:31:50,320<br>to get the one before doing to get off x T2 needs to get the lock off x and you know it can get</p>
<p>257<br>00:31:50,319 –&gt; 00:31:59,839<br>the lock of x because t1 has it and so this has to weigh two and now we have you know T1 waiting</p>
<p>258<br>00:31:59,839 –&gt; 00:32:04,879<br>on T2 prime and we have T2 prime waiting on T1 we’re basically going to have a deadlock</p>
<p>259<br>00:32:06,960 –&gt; 00:32:13,519<br>and now what is the cool part about transaction systems is that we have there’s a board operation</p>
<p>260<br>00:32:14,480 –&gt; 00:32:20,720<br>and so if the transaction system could detect a deadlock could use a board one of the two transactions</p>
<p>261<br>00:32:21,759 –&gt; 00:32:26,639<br>let the other one proceed and hopefully that will actually get to the end and commit and</p>
<p>262<br>00:32:27,279 –&gt; 00:32:32,480<br>aboard the other one and then the client or the application can decide what to do with your</p>
<p>263<br>00:32:32,480 –&gt; 00:32:36,160<br>board of transaction that can actually retry it you know maybe so wait a little bit and then</p>
<p>264<br>00:32:36,160 –&gt; 00:32:43,200<br>retry it and in the hope that at that point you’re not going to run into a deadlock and so one</p>
<p>265<br>00:32:43,200 –&gt; 00:32:47,279<br>way to think a little bit about two-phase locking is that it has a little bit of a sort of an</p>
<p>266<br>00:32:47,920 –&gt; 00:32:53,840<br>optimistic flavor to it in the sense that it’s not guaranteed that it won’t run into problems</p>
<p>267<br>00:32:53,840 –&gt; 00:32:59,600<br>but even if it runs into problems you know you can always abort and then recover from that problem</p>
<p>268<br>00:33:03,039 –&gt; 00:33:04,160<br>any questions about this</p>
<p>269<br>00:33:04,480 –&gt; 00:33:13,120<br>so how do you how do you find the deadlock?</p>
<p>270<br>00:33:13,120 –&gt; 00:33:19,440<br>ah that’s exactly what’s hoping that somebody was asking that question so the way the sort of two</p>
<p>271<br>00:33:19,440 –&gt; 00:33:30,880<br>broad approaches that people use one is one is not a solid as you will one is basically on a time</p>
<p>272<br>00:33:30,880 –&gt; 00:33:35,760<br>out basis like if the transactions are running for a long time and you know then they don’t see the</p>
<p>273<br>00:33:35,760 –&gt; 00:33:42,880<br>make-for-a-progress you just aboard one of them and so this is time out based it’s the more systematic</p>
<p>274<br>00:33:42,880 –&gt; 00:33:49,600<br>sort of way of thinking about it is to construct and wait for graph as the transaction systems you know</p>
<p>275<br>00:33:50,080 –&gt; 00:33:56,880<br>are moving so for example if you know T1 runs so in the wait-for-graph the transactions are the notes</p>
<p>276<br>00:33:56,960 –&gt; 00:34:02,560<br>so we can have a note T1 and we make a note T2 when they start with T2 prime if you will</p>
<p>277<br>00:34:03,280 –&gt; 00:34:08,960<br>and when T1 runs you know it gets x nothing bigger then you know it gets to the lock of y it can’t do</p>
<p>278<br>00:34:08,960 –&gt; 00:34:16,880<br>it so we’ll make an arrow for you know T1 to T2 prime to indicate that T1 is waiting for T2 prime</p>
<p>279<br>00:34:17,680 –&gt; 00:34:23,760<br>then at some point like on T2 is running you know T2 hits that’s T2 prime hits this point</p>
<p>280<br>00:34:23,760 –&gt; 00:34:29,360<br>where it wants to lock x it can’t do it so you know we’ll look at like we’re waiting for who’s</p>
<p>281<br>00:34:29,360 –&gt; 00:34:35,520<br>holding the lock well it’s T1 and so we’ll put an edge you know in the wait-for-graph from T2</p>
<p>282<br>00:34:35,520 –&gt; 00:34:43,680<br>to T2 prime to T1 and now we see that there’s a cycle and whenever there’s a cycle that means</p>
<p>283<br>00:34:43,680 –&gt; 00:34:47,680<br>that it’s a depth lock right because one is waiting in the other and the other is waiting on the</p>
<p>284<br>00:34:47,679 –&gt; 00:34:55,679<br>other and so the transaction system can sort of construct these graphs on the fly detect one there’s</p>
<p>285<br>00:34:55,679 –&gt; 00:35:03,599<br>a cycling to graph and then we’ll arrange either a board T1 or a board T2 prime so let’s go to wait</p>
<p>286<br>00:35:04,079 –&gt; 00:35:14,559<br>for graph what happens after the abort?</p>
<p>287<br>00:35:16,159 –&gt; 00:35:24,799<br>uh well uh so let’s say we abort T2 just for as an experiment so we’re going to kill this guy</p>
<p>288<br>00:35:25,360 –&gt; 00:35:31,039<br>so T2 basically this transaction system is going to arrange as we’ll see in a second</p>
<p>289<br>00:35:31,039 –&gt; 00:35:37,360<br>it’s going to arrange that basically none results of T2 are T2 prime invisible at that point</p>
<p>290<br>00:35:37,360 –&gt; 00:35:44,320<br>you know the lock is released right and the abort will force the lock release off the Y because T2</p>
<p>291<br>00:35:44,320 –&gt; 00:35:49,920<br>prime is backing out that means that you know T1 can get the lock on Y and proceed to finish</p>
<p>292<br>00:35:51,199 –&gt; 00:35:56,320<br>the client that called T2 prime is going to learn that the transaction aborted and for</p>
<p>293<br>00:35:56,320 –&gt; 00:36:05,280<br>example it can just choose to rerun it again so that doesn’t make sense?</p>
<p>294<br>00:36:10,960 –&gt; 00:36:16,559<br>okay so this is sort of the first part uh you know actually all of what I wanted to say about</p>
<p>295<br>00:36:16,559 –&gt; 00:36:22,559<br>two-phase locking except I wanted to address the sort of homework assignment again which is like</p>
<p>296<br>00:36:22,559 –&gt; 00:36:28,079<br>in what situations does two-phase locking allow for more concurrency than strip locking right we’re</p>
<p>297<br>00:36:28,079 –&gt; 00:36:35,279<br>strip locking what’s the protocol where the transaction acquires all the locks in advance and this</p>
<p>298<br>00:36:35,279 –&gt; 00:36:40,320<br>requires that the programmer or like the beginning of the transaction basically declares which locks</p>
<p>299<br>00:36:40,320 –&gt; 00:36:45,920<br>that transaction actually needs and so to slightly undesirable like less programmer friendly but it has</p>
<p>300<br>00:36:45,920 –&gt; 00:36:53,119<br>the advantage that you know you don’t actually you can run into these you don’t have to abort</p>
<p>301<br>00:36:53,119 –&gt; 00:36:59,920<br>an transaction at the end in the case you run into a deadlock so two-phase locking you’re allowed for</p>
<p>302<br>00:36:59,920 –&gt; 00:37:05,599<br>more concurrency in principle or it should live for more concurrency then the strip locking or</p>
<p>303<br>00:37:05,599 –&gt; 00:37:11,680<br>the simple locking scheme and so I would like to do is a quick breakout room for a couple minutes</p>
<p>304<br>00:37:11,679 –&gt; 00:37:18,960<br>like five minutes again and you know convince yourself or constructing case we’re simple locking with</p>
<p>305<br>00:37:19,519 –&gt; 00:37:24,319<br>this allows some concurrency that two-phase locking was actually able to exploit.</p>
<p>306<br>00:37:24,800 –&gt; 00:37:29,680<br>All right let’s do breakout rooms.</p>
<p>307<br>00:37:34,400 –&gt; 00:37:41,600<br>Okay see you in five minutes.</p>
<p>308<br>00:43:54,320 –&gt; 00:44:08,080<br>We can’t hear you.</p>
<p>309<br>00:44:17,760 –&gt; 00:44:18,880<br>I think you’re muted.</p>
<p>310<br>00:44:24,880 –&gt; 00:44:40,559<br>I have a question about one of the previous slides that you’re talking about.</p>
<p>311<br>00:44:40,559 –&gt; 00:44:43,119<br>Yeah.</p>
<p>312<br>00:44:43,119 –&gt; 00:44:46,320<br>Let me double check if everybody can hear me now.</p>
<p>313<br>00:44:46,320 –&gt; 00:44:48,320<br>Yes.</p>
<p>314<br>00:44:48,320 –&gt; 00:44:50,320<br>Oh yeah good.</p>
<p>315<br>00:44:50,320 –&gt; 00:44:52,320<br>Go ahead.</p>
<p>316<br>00:44:52,320 –&gt; 00:44:57,119<br>On one of your previous or I guess this is just a general question but is the lock point always the same as the commit point</p>
<p>317<br>00:44:57,119 –&gt; 00:45:01,519<br>or is it possible to start relinquishing locks before your commit point?</p>
<p>318<br>00:45:01,519 –&gt; 00:45:06,159<br>Okay this is a very good question so it depends.</p>
<p>319<br>00:45:06,960 –&gt; 00:45:13,279<br>So if you only do exclusive locking as we’ve done so far at least in my examples then the commit point</p>
<p>320<br>00:45:13,279 –&gt; 00:45:17,679<br>is similar to the lock point is similar to the commit point in the board point.</p>
<p>321<br>00:45:18,239 –&gt; 00:45:26,079<br>If you have read right locking so locks that allow both read locks and write locks then it’s</p>
<p>322<br>00:45:26,079 –&gt; 00:45:30,239<br>possible to release read locks earlier with some restrictions.</p>
<p>323<br>00:45:32,799 –&gt; 00:45:34,799<br>Thank you.</p>
<p>324<br>00:45:34,960 –&gt; 00:45:42,640<br>Okay so can somebody give me one example of where two phase locking is a lot of</p>
<p>325<br>00:45:42,640 –&gt; 00:45:47,280<br>for more concurrency than simple locking just to make sure that we all on the same page?</p>
<p>326<br>00:45:52,320 –&gt; 00:45:59,360<br>The audit function example like you can release the lock as soon as you read this person’s</p>
<p>327<br>00:46:00,240 –&gt; 00:46:02,960<br>amount like you don’t have to wait until you read everyone’s.</p>
<p>328<br>00:46:04,400 –&gt; 00:46:08,079<br>This is an example of exploring the read read locks if you have read locks.</p>
<p>329<br>00:46:15,200 –&gt; 00:46:16,000<br>Any other examples?</p>
<p>330<br>00:46:20,000 –&gt; 00:46:24,480<br>If you have a transaction where there’s like a condition that only rarely like</p>
<p>331<br>00:46:24,719 –&gt; 00:46:30,639<br>is true and you read a piece of data when it’s true so at the beginning you don’t need to acquire</p>
<p>332<br>00:46:30,639 –&gt; 00:46:33,599<br>the lock for that only when you actually need to read it.</p>
<p>333<br>00:46:33,599 –&gt; 00:46:37,119<br>Yep that’s a great example. I have a person like that example a lot. That’s a great one.</p>
<p>334<br>00:46:39,039 –&gt; 00:46:44,960<br>Good okay good so let’s move on basically into the second topic of this lecture which is</p>
<p>335<br>00:46:44,960 –&gt; 00:46:45,840<br>two phase commit.</p>
<p>336<br>00:46:49,360 –&gt; 00:46:51,039<br>And this is really dealing with crashes.</p>
<p>337<br>00:46:51,840 –&gt; 00:46:54,800<br>Switch back to blue.</p>
<p>338<br>00:47:01,840 –&gt; 00:47:03,199<br>We can’t see the slides either yet.</p>
<p>339<br>00:47:03,199 –&gt; 00:47:08,559<br>Oh I mean yeah fixed on it.</p>
<p>340<br>00:47:11,039 –&gt; 00:47:12,400<br>And the loop hold out.</p>
<p>341<br>00:47:16,000 –&gt; 00:47:16,800<br>Share screen.</p>
<p>342<br>00:47:16,960 –&gt; 00:47:17,760<br>Okay.</p>
<p>343<br>00:47:17,760 –&gt; 00:47:19,760<br>How about now?</p>
<p>344<br>00:47:19,760 –&gt; 00:47:20,560<br>All good.</p>
<p>345<br>00:47:20,560 –&gt; 00:47:21,280<br>Okay.</p>
<p>346<br>00:47:21,280 –&gt; 00:47:21,760<br>Good thing.</p>
<p>347<br>00:47:21,760 –&gt; 00:47:22,560<br>Thank you.</p>
<p>348<br>00:47:22,560 –&gt; 00:47:24,560<br>All right so two phase commit.</p>
<p>349<br>00:47:28,560 –&gt; 00:47:30,560<br>We’re two PC.</p>
<p>350<br>00:47:30,560 –&gt; 00:47:32,560<br>This is popular called.</p>
<p>351<br>00:47:32,560 –&gt; 00:47:38,560<br>Again this is a very well known popular protocol.</p>
<p>352<br>00:47:38,560 –&gt; 00:47:44,080<br>I’m going to talk about the base sort of simple straightforward or the most common</p>
<p>353<br>00:47:44,079 –&gt; 00:47:46,079<br>version of the protocol.</p>
<p>354<br>00:47:46,079 –&gt; 00:47:54,239<br>There are all kinds of variations of it but you know in they all sort of have the same</p>
<p>355<br>00:47:56,880 –&gt; 00:47:58,000<br>underlying idea.</p>
<p>356<br>00:47:58,000 –&gt; 00:48:04,799<br>And so again typically in two phase protocol and I’m going to do it in the context of the</p>
<p>357<br>00:48:04,799 –&gt; 00:48:06,400<br>transfer transaction.</p>
<p>358<br>00:48:06,400 –&gt; 00:48:13,360<br>So a client that actually wants to do a transfer you know basically submits the transfer</p>
<p>359<br>00:48:13,360 –&gt; 00:48:14,880<br>transaction through the transaction system.</p>
<p>360<br>00:48:16,640 –&gt; 00:48:20,880<br>And the machine sort of receives that transaction is called the coordinate.</p>
<p>361<br>00:48:23,519 –&gt; 00:48:31,200<br>And that machines in charge of running the transaction through the transaction system.</p>
<p>362<br>00:48:31,840 –&gt; 00:48:35,680<br>And so the coordinator will talk in our case to two different machines.</p>
<p>363<br>00:48:36,639 –&gt; 00:48:42,879<br>And a and b were a holds you know x and b holds y.</p>
<p>364<br>00:48:45,199 –&gt; 00:48:53,440<br>And and basically the you know one way that this typically goes is that the coordinator</p>
<p>365<br>00:48:53,440 –&gt; 00:48:57,119<br>first sort of does the whole transaction but in a tentative way.</p>
<p>366<br>00:48:57,119 –&gt; 00:49:03,279<br>So the put x you know results in a message to a you know locking a</p>
<p>367<br>00:49:04,240 –&gt; 00:49:11,760<br>modifying a you know put put x except you know the put is not actually visible yet in the</p>
<p>368<br>00:49:11,760 –&gt; 00:49:12,240<br>database.</p>
<p>369<br>00:49:12,240 –&gt; 00:49:19,680<br>What is done is put in a log very much like in sort of in the frontipani style where we have</p>
<p>370<br>00:49:19,680 –&gt; 00:49:24,160<br>a right-of-hand log all the upgrades that we at some point want to materialize in the database</p>
<p>371<br>00:49:24,160 –&gt; 00:49:24,640<br>itself.</p>
<p>372<br>00:49:24,640 –&gt; 00:49:30,400<br>We first put in the log until later in the discipline case until we hit commit and then we actually</p>
<p>373<br>00:49:30,400 –&gt; 00:49:32,400<br>will install everything in the database.</p>
<p>374<br>00:49:33,280 –&gt; 00:49:37,119<br>So we’ll do the put we do a second put so you have to y.</p>
<p>375<br>00:49:40,320 –&gt; 00:49:44,880<br>And not the same thing happens there you know the we get a lock on y.</p>
<p>376<br>00:49:44,880 –&gt; 00:49:48,960<br>Okay so this should have been lock and x and we’ll do the put on y.</p>
<p>377<br>00:49:50,800 –&gt; 00:49:55,920<br>And again we’re going to not actually you know really put the value in the database we</p>
<p>378<br>00:49:56,000 –&gt; 00:49:59,920<br>use are going to log x so we’re log y and here we’re log x.</p>
<p>379<br>00:50:01,519 –&gt; 00:50:08,400<br>Okay and now the coordinate has done two you know the transactions the two of the main</p>
<p>380<br>00:50:08,400 –&gt; 00:50:14,639<br>operations and now it’s already to commit and here’s where the two-phase part comes in.</p>
<p>381<br>00:50:15,599 –&gt; 00:50:22,159<br>And so the coordinator will send a prepare message and I’m first going to describe this</p>
<p>382<br>00:50:22,159 –&gt; 00:50:28,159<br>protocol in the case there’s no failures and just everything works out just a storage should</p>
<p>383<br>00:50:28,159 –&gt; 00:50:30,559<br>of the easy cases it will.</p>
<p>384<br>00:50:31,599 –&gt; 00:50:40,960<br>Since a prepare message to prepare a prepare B</p>
<p>385<br>00:50:45,279 –&gt; 00:50:50,159<br>and the prepare message of course it includes the transaction ID that is actually used for</p>
<p>386<br>00:50:50,159 –&gt; 00:50:56,000<br>you know this transaction so every transaction has an transaction ID and all the message are tagged</p>
<p>387<br>00:50:56,000 –&gt; 00:50:59,679<br>now with the transaction ID so we always know about which transaction we’re talking about.</p>
<p>388<br>00:51:01,759 –&gt; 00:51:07,599<br>When a and b received these prepare messages you know they look at their state and</p>
<p>389<br>00:51:08,399 –&gt; 00:51:12,719<br>you know see if they indeed can actually execute the transaction you know they’re holding the lock</p>
<p>390<br>00:51:12,719 –&gt; 00:51:19,359<br>on x in this case the x is actually in the log and so they sent back you know saying yep</p>
<p>391<br>00:51:19,360 –&gt; 00:51:30,880<br>while I’m ready to commit so yes yes and at this particular point you know sort of the crucial sort</p>
<p>392<br>00:51:30,880 –&gt; 00:51:38,320<br>of step is the coordinator now knows that basically both a and b are prepared to commit and</p>
<p>393<br>00:51:38,320 –&gt; 00:51:46,480<br>then so and I have basically promised to commit by actually responding to the y and at this point the</p>
<p>394<br>00:51:46,480 –&gt; 00:51:55,360<br>coordinator commits and then you know since messages you know again to the a saying commit</p>
<p>395<br>00:51:57,039 –&gt; 00:52:03,760<br>and the transaction TID similar message to B you know commit TID</p>
<p>396<br>00:52:07,119 –&gt; 00:52:13,280<br>and at this particular point a and b actually perform the operation so they basically install</p>
<p>397<br>00:52:14,080 –&gt; 00:52:20,320<br>you know at this point you know they install you know the log version of y your</p>
<p>398<br>00:52:20,320 –&gt; 00:52:28,960<br>instance actually this participants installs the x and they release the locks so release</p>
<p>399<br>00:52:28,960 –&gt; 00:52:38,880<br>of y and here they release of x and they respond back you know to the coordinator saying like yep</p>
<p>400<br>00:52:38,960 –&gt; 00:52:46,480<br>all done and at that point the you know the transaction is completely done and in the fact you know</p>
<p>401<br>00:52:46,480 –&gt; 00:52:50,000<br>the coordinator doesn’t really have to remember anything anymore about this particular transaction</p>
<p>402<br>00:52:50,800 –&gt; 00:52:55,680<br>and also we see later you know a and b you know need to remember that state a little bit longer</p>
<p>403<br>00:52:55,680 –&gt; 00:53:02,160<br>until they hear about the next intersection okay so this is the core basic cave when there’s</p>
<p>404<br>00:53:02,159 –&gt; 00:53:08,799<br>absolutely no failure and we see what we actually get you desired outcome correct you know</p>
<p>405<br>00:53:08,799 –&gt; 00:53:12,399<br>when does the coordinator commit the coordinator commits only</p>
<p>406<br>00:53:19,359 –&gt; 00:53:23,519<br>if a and b agree</p>
<p>407<br>00:53:23,920 –&gt; 00:53:34,480<br>okay it could be the case that we know example when the coordinator sends a message to</p>
<p>408<br>00:53:34,480 –&gt; 00:53:41,599<br>b that b decides well I can’t really commit maybe so it could be multiple or the reasons for it</p>
<p>409<br>00:53:42,320 –&gt; 00:53:50,400<br>maybe the b actually is in a situation where there’s a debt lock with y or you know</p>
<p>410<br>00:53:50,720 –&gt; 00:53:57,599<br>there’s no space in the log anymore or there’s not enough money in the account of y and so you know</p>
<p>411<br>00:53:57,599 –&gt; 00:54:04,320<br>the b could respond we even know let’s say in this so the other possible outcome is you know</p>
<p>412<br>00:54:04,320 –&gt; 00:54:11,039<br>the preparedness can actually be consenting that the no back and in that case the coordinator gets</p>
<p>413<br>00:54:11,039 –&gt; 00:54:17,039<br>one yes you know from a no from b so both do not agree and in that case you know the coordinator</p>
<p>414<br>00:54:17,039 –&gt; 00:54:23,199<br>cannot commit the transaction and then we’d actually abort the transaction and then say the</p>
<p>415<br>00:54:23,199 –&gt; 00:54:29,279<br>board messages to a b basically you know discontinuing the transaction so as soon as we’re the two</p>
<p>416<br>00:54:29,279 –&gt; 00:54:34,000<br>possible outcomes one in the commit case one in the board case and whether there’s always a case</p>
<p>417<br>00:54:34,000 –&gt; 00:54:39,039<br>that the transaction only commit the top level transaction only commits if the both of the participants</p>
<p>418<br>00:54:39,039 –&gt; 00:54:48,880<br>are involved in the transaction agree to do so now that’s sort of the outline of the protocols</p>
<p>419<br>00:54:48,880 –&gt; 00:54:54,880<br>I want to now go through a couple of cases you know sort of to understand you know what can go wrong</p>
<p>420<br>00:54:54,880 –&gt; 00:55:01,360<br>and you know how we do how to face commit arrangers that actually the still the right thing happens</p>
<p>421<br>00:55:02,000 –&gt; 00:55:07,599<br>actually I have a question here um so we said that like b might decide that it needs the board</p>
<p>422<br>00:55:08,000 –&gt; 00:55:14,400<br>um since back on no message what if it decides it needs to abort after it replied yes</p>
<p>423<br>00:55:14,400 –&gt; 00:55:20,159<br>would that ever be possible I know we’ll talk about it in a second but that’s absolutely not possible</p>
<p>424<br>00:55:20,159 –&gt; 00:55:27,199<br>if you promise to go commit you have to commit or you have to be ready to commit</p>
<p>425<br>00:55:27,199 –&gt; 00:55:30,719<br>well you have to be ready to commit you don’t commit right away you have to wait until the</p>
<p>426<br>00:55:30,719 –&gt; 00:55:36,719<br>commit message of course but you cannot bail out anymore so until to prepare the b can</p>
<p>427<br>00:55:36,719 –&gt; 00:55:42,239<br>you know literally abort a transaction once a promise yes it cannot you know let her be</p>
<p>428<br>00:55:42,239 –&gt; 00:55:48,319<br>aborted to section anymore so is it possible were you in that lock but you can’t get out of the</p>
<p>429<br>00:55:48,319 –&gt; 00:55:56,959<br>that lock because everyone in that cycle has agreed to prepare a commit if everybody agrees to</p>
<p>430<br>00:55:56,959 –&gt; 00:56:01,839<br>prepare and they can definitely commit then they will commit and you’re still holding walks</p>
<p>431<br>00:56:02,639 –&gt; 00:56:06,480<br>right but what if you’re in that lock because we mentioned before how one of the reasons why you might</p>
<p>432<br>00:56:06,480 –&gt; 00:56:09,840<br>want to do more of this second at lock you would you would fight it out before to prepare</p>
<p>433<br>00:56:11,199 –&gt; 00:56:16,480<br>if you get a lock so why if you did not succeed in getting those necessary walks for the transaction</p>
<p>434<br>00:56:16,480 –&gt; 00:56:24,480<br>uh then you know at that point right thank you okay so this is exactly the kind of discussion</p>
<p>435<br>00:56:24,480 –&gt; 00:56:32,000<br>is going to come up so i’m going to go i’m going to take the same board and replicate it and consider a</p>
<p>436<br>00:56:32,000 –&gt; 00:56:39,840<br>bunch of different cases so here’s the same board again nothing has changed so far it’s identical</p>
<p>437<br>00:56:40,400 –&gt; 00:56:43,920<br>and so let’s the first you know to sort of follow up on this question that we just asked</p>
<p>438<br>00:56:45,199 –&gt; 00:56:52,400<br>let’s first consider the case where b you know is in the prepared state</p>
<p>439<br>00:56:54,159 –&gt; 00:56:59,360<br>and then crash like right after so it is prepared</p>
<p>440<br>00:57:02,239 –&gt; 00:57:10,559<br>it pointed back set back to the coordinator that it actually is agreeing to go along</p>
<p>441<br>00:57:11,920 –&gt; 00:57:17,440<br>and right after it sends actually the prepared message okay message that actually crashes</p>
<p>442<br>00:57:19,119 –&gt; 00:57:26,639<br>what does that mean what needs to happen how how we’re going to resolve this or what is the risk</p>
<p>443<br>00:57:27,199 –&gt; 00:57:35,759<br>so basically b crashes uh if b crashes we need to abort the whole thing right no we cannot abort</p>
<p>444<br>00:57:35,759 –&gt; 00:57:42,400<br>anymore right because you know be already promised now this is going to commit where we’re going to use</p>
<p>445<br>00:57:42,400 –&gt; 00:57:48,159<br>the log yeah well okay so b is going to crash and then at some point it’s going to come back up</p>
<p>446<br>00:57:48,159 –&gt; 00:57:54,719<br>right it’s going to recover hopefully and what state doesn’t need to remember across crashes</p>
<p>447<br>00:57:57,199 –&gt; 00:58:05,039<br>um and it needs to remember that it prepared yeah i need to remember that it prepared for</p>
<p>448<br>00:58:05,039 –&gt; 00:58:10,879<br>transaction ID whatever the t ID was and that is holding the lock on why</p>
<p>449<br>00:58:12,879 –&gt; 00:58:18,079<br>and so when it comes back up the first thing it has to do is sort of look saying like how i was</p>
<p>450<br>00:58:18,079 –&gt; 00:58:24,400<br>in the middle of a you know participant in a distributed transaction uh and i should look at</p>
<p>451<br>00:58:24,400 –&gt; 00:58:31,119<br>the state and you’ll see that it was actually prepared for transaction ID uh t ID and it was and</p>
<p>452<br>00:58:31,119 –&gt; 00:58:36,160<br>and must hold the lock for lny what the lock for y before does anything else you know before</p>
<p>453<br>00:58:36,160 –&gt; 00:58:42,160<br>talking to anything once it is in that state you know then it is if it didn’t crash right and</p>
<p>454<br>00:58:42,880 –&gt; 00:58:47,200<br>things are sort of back to normal and hopefully at some point the coordinator will retry</p>
<p>455<br>00:58:48,000 –&gt; 00:58:53,599<br>the commit message the b will get that commit message for this transaction ID sees that</p>
<p>456<br>00:58:53,599 –&gt; 00:58:59,279<br>uh yeah i’m indeed prepared uh and i hope the lock on why and so it just goes along and installs</p>
<p>457<br>00:58:59,279 –&gt; 00:59:06,880<br>why and that’s that our finishes to transaction that makes sense so basically you know there’s</p>
<p>458<br>00:59:06,880 –&gt; 00:59:13,039<br>a little bit of refinement here that we actually have to write some stable you know some data to</p>
<p>459<br>00:59:13,039 –&gt; 00:59:18,400<br>stable storage you know as part of the transaction and what’s the first part of two-phase commit this</p>
<p>460<br>00:59:18,400 –&gt; 00:59:22,400<br>is one of the reason that two-phase commit is a little bit expensive right because not only we have to</p>
<p>461<br>00:59:22,400 –&gt; 00:59:29,119<br>send sort of multiple random messages but also a participant actually has to write things to</p>
<p>462<br>00:59:29,119 –&gt; 00:59:35,119<br>stable storage and as we talked about before writing to stable storage is quite expensive right</p>
<p>463<br>00:59:35,119 –&gt; 00:59:40,000<br>it could be easily a couple milliseconds you know let’s say it’s one millisecond you know</p>
<p>464<br>00:59:40,000 –&gt; 00:59:43,760<br>optimistically yeah that means basically that we’re immediately limited to sort of a thousand</p>
<p>465<br>00:59:43,760 –&gt; 00:59:50,000<br>to exactly per second right no more okay let’s look at consider another case</p>
<p>466<br>00:59:51,840 –&gt; 00:59:54,480<br>uh and so let me duplicate this slide again</p>
<p>467<br>01:00:01,840 –&gt; 01:00:07,920<br>and consider yet another case um let’s say uh</p>
<p>468<br>01:00:08,800 –&gt; 01:00:16,079<br>uh we uh the coordinated crashes and so uh you know we’re ready again</p>
<p>469<br>01:00:16,079 –&gt; 01:00:23,920<br>uh that’s cancelled and you know we got like one uh we got the prepared messages and the</p>
<p>470<br>01:00:23,920 –&gt; 01:00:28,559<br>coordinator again maybe you’d set out one commit message and then crash it like right here</p>
<p>471<br>01:00:29,920 –&gt; 01:00:36,159<br>uh you know what what do we need to range you know to make sure that the whole plan works out</p>
<p>472<br>01:00:38,159 –&gt; 01:00:47,760<br>so the coordinator needs to store into persistent state what uh what are the commands that were</p>
<p>473<br>01:00:47,760 –&gt; 01:00:52,639<br>promised to be committed but were not committed yet yeah so the commander is almost the same as</p>
<p>474<br>01:00:52,639 –&gt; 01:00:58,320<br>sort of the it’s an analyst and necklace to be case correct now if we commit a transaction we</p>
<p>475<br>01:00:58,320 –&gt; 01:01:01,680<br>need to write to stable storage that we’re actually committing the transaction so we need to write</p>
<p>476<br>01:01:01,759 –&gt; 01:01:09,440<br>to stable storage you know commit TID so that then when the coordinator comes back up then</p>
<p>477<br>01:01:10,159 –&gt; 01:01:15,599<br>a connection finished transaction until actually the uh amd that indeed the transaction is committed</p>
<p>478<br>01:01:15,599 –&gt; 01:01:21,440<br>because amd are waiting right amd said like yeah we’re happy to go along and they’re just waiting</p>
<p>479<br>01:01:21,440 –&gt; 01:01:26,000<br>awaiting until actually they uh hear from the coordinator to decide what’s done because</p>
<p>480<br>01:01:26,800 –&gt; 01:01:32,079<br>once they decided uh once they went along or once they agreed to go along you know they cannot</p>
<p>481<br>01:01:32,079 –&gt; 01:01:37,679<br>do you know leverly anymore bail out correct because uh let’s say they actually both said they</p>
<p>482<br>01:01:37,679 –&gt; 01:01:43,519<br>agreed along uh then it means that the coordinator they they don’t know they may the coordinator</p>
<p>483<br>01:01:43,519 –&gt; 01:01:48,639<br>may have uh send a commit message to for example a and a actually has committed to the transaction</p>
<p>484<br>01:01:48,639 –&gt; 01:01:53,119<br>you know b hasn’t heard yet maybe the message got delayed then the the coordinator crashed</p>
<p>485<br>01:01:53,119 –&gt; 01:01:57,920<br>and you know at that point it would be totally wrong for me to abort that the transaction</p>
<p>486<br>01:01:57,920 –&gt; 01:02:03,519<br>it really has to wait until the coordinator comes back to tell when actually the outcome is of the</p>
<p>487<br>01:02:03,519 –&gt; 01:02:17,679<br>transaction okay so the only uh sorry the only message that the coordinator is not going to</p>
<p>488<br>01:02:17,679 –&gt; 01:02:24,719<br>resend is prepared that one if it gets like doesn’t get a yes it’ll just abort yeah I’ll try</p>
<p>489<br>01:02:24,719 –&gt; 01:02:32,319<br>to give us the next example so let’s do that uh let me duplicate this board again and talk about</p>
<p>490<br>01:02:32,319 –&gt; 01:02:41,759<br>that case uh so just for fun let’s move it down so it looks track uh so let’s say you know the following</p>
<p>491<br>01:02:41,760 –&gt; 01:02:53,040<br>thing happens um the this prepared here message never makes it right and then you know the coordinator</p>
<p>492<br>01:02:53,040 –&gt; 01:02:59,840<br>can unilaterally decide you know to abort right and in the fact you can tell B you know to be</p>
<p>493<br>01:02:59,840 –&gt; 01:03:08,240<br>bored and you know A doesn’t really need to know anything about it English uh the uh it’s a word</p>
<p>494<br>01:03:08,239 –&gt; 01:03:12,079<br>later you know will come up and can ask the coordinator if the coordinator doesn’t know anything</p>
<p>495<br>01:03:12,079 –&gt; 01:03:16,159<br>very anymore about this transaction you can just tell IA yeah yeah now that’s the transaction we</p>
<p>496<br>01:03:16,159 –&gt; 01:03:20,959<br>abort it because I don’t have a commit record anymore and I was not waiting to inform anybody</p>
<p>497<br>01:03:22,879 –&gt; 01:03:28,639<br>so in that case we can do in the board and that means that B can release the locks correct and B</p>
<p>498<br>01:03:28,639 –&gt; 01:03:35,679<br>can just proceed you know happily trying to uh do other transactions that might involve uh why</p>
<p>499<br>01:03:38,799 –&gt; 01:03:46,159<br>okay um sorry so what will happen if the message 2a gets lost the coordinator abords</p>
<p>500<br>01:03:47,119 –&gt; 01:03:52,959<br>and then be cautious but then when it comes up it’s going to wait for a commit message from</p>
<p>501<br>01:03:53,519 –&gt; 01:04:00,719<br>the coordinator for the transaction has aborted already yeah or uh and so either there’s two cases uh</p>
<p>502<br>01:04:00,719 –&gt; 01:04:04,719<br>you know presumably you know in the most protocols actually you be well pinged the coordinator</p>
<p>503<br>01:04:04,879 –&gt; 01:04:09,439<br>because the knows you used the coordinator and ask it how you what’s the outcome of that transaction</p>
<p>504<br>01:04:15,839 –&gt; 01:04:20,079<br>okay so one more case I want to return to one case that there’s actually sort of the the most</p>
<p>505<br>01:04:20,079 –&gt; 01:04:27,679<br>interesting case uh one of the more tricky cases so I just know a brief question uh yeah hold on hold on one</p>
<p>506<br>01:04:27,679 –&gt; 01:04:35,519<br>sorry yeah yeah so the first question is that uh so so let’s so B let’s say holds the lock on Y</p>
<p>507<br>01:04:36,159 –&gt; 01:04:40,879<br>all the way through between putting Y into the log until installing Y</p>
<p>508<br>01:04:41,440 –&gt; 01:04:46,799<br>uh to the actual state so that’s okay uh and then the second question so the locks here are</p>
<p>509<br>01:04:47,440 –&gt; 01:04:53,519<br>distributed because we’re dealing with across servers or uh I mean if Y only exists on the server B</p>
<p>510<br>01:04:53,519 –&gt; 01:04:57,519<br>then maybe we don’t need distributed lockings I’m just curious on what the setup yeah the setup</p>
<p>511<br>01:04:57,519 –&gt; 01:05:02,880<br>is basically the A maintains the locks for all the shards that it has or for all the variables or</p>
<p>512<br>01:05:02,880 –&gt; 01:05:08,239<br>all the records that it has and D maintains all the locks for all the records it has okay but if we</p>
<p>513<br>01:05:08,239 –&gt; 01:05:12,960<br>for example have Y being on multiple servers then we need some sort of distributed lock them yeah</p>
<p>514<br>01:05:12,960 –&gt; 01:05:16,559<br>yeah yeah like so this is we’re talking about the shard at case right where the accounts are</p>
<p>515<br>01:05:16,559 –&gt; 01:05:20,239<br>shard at across multiple servers and only one server has a particular account</p>
<p>516<br>01:05:22,559 –&gt; 01:05:25,759<br>awesome thank you I’m coming back through this later actually one more time</p>
<p>517<br>01:05:26,960 –&gt; 01:05:33,599<br>so the first thing I wanted to point out uh is just going back to sort of the uh the</p>
<p>518<br>01:05:36,000 –&gt; 01:05:42,799<br>the case where um B or A you know said yes and then crashes</p>
<p>519<br>01:05:43,280 –&gt; 01:05:52,640<br>correct um or actually yeah let me see is this the case uh no I want the case to follow case sorry</p>
<p>520<br>01:05:54,880 –&gt; 01:06:02,400<br>oh fixed is lying so A, B promised their thing uh but I want to go back to the case where</p>
<p>521<br>01:06:02,400 –&gt; 01:06:09,039<br>that we already discussed which is right after the commit point um the coordinate crashes</p>
<p>522<br>01:06:09,519 –&gt; 01:06:18,880<br>correct and we know right this this interval of time from here to there basically</p>
<p>523<br>01:06:19,599 –&gt; 01:06:25,759<br>uh B cannot unilaterally abort anymore right because it’s promoted promised you know to go along</p>
<p>524<br>01:06:25,759 –&gt; 01:06:32,159<br>and it might have been the case that actually A did actually already did the commit and so it</p>
<p>525<br>01:06:32,159 –&gt; 01:06:38,559<br>cannot unilaterally abort anymore and so there’s only one option in this case and what is that one</p>
<p>526<br>01:06:38,559 –&gt; 01:06:40,559<br>option</p>
<p>527<br>01:06:52,480 –&gt; 01:07:00,719<br>you just wait yeah it’s unfortunate but true the only thing that B can do is wait</p>
<p>528<br>01:07:01,679 –&gt; 01:07:06,320<br>and then it’s still holding the lock on Y correct so that means that any other transaction that</p>
<p>529<br>01:07:06,320 –&gt; 01:07:13,280<br>involves Y you know it cannot proceed um one has to wait you know until the coordinator comes</p>
<p>530<br>01:07:13,280 –&gt; 01:07:19,200<br>back and announces or uh re-enounces whatever the decision was that actually was the outcome for that</p>
<p>531<br>01:07:19,200 –&gt; 01:07:25,120<br>prediction of transaction and this is one of the you know sort of the two aspects uh this is one</p>
<p>532<br>01:07:25,120 –&gt; 01:07:33,120<br>of the sort of aspects of the two-phase commit uh that are a bit undesirable right where um the</p>
<p>533<br>01:07:33,679 –&gt; 01:07:41,199<br>uh the protocol might use block uh into a machine comes back does that make sense</p>
<p>534<br>01:07:45,679 –&gt; 01:07:50,559<br>so how do people do deal deal deal this in practice well it’s a little bit of fortunate</p>
<p>535<br>01:07:51,279 –&gt; 01:07:55,759<br>but the years were you know some of our techniques from the past can come to rescue now what could</p>
<p>536<br>01:07:55,760 –&gt; 01:08:00,560<br>we do with the coordinator to make this scenario unlikely</p>
<p>537<br>01:08:06,240 –&gt; 01:08:10,400<br>and so it can make it full pattern like yeah yeah make it full tolerance how could we do it</p>
<p>538<br>01:08:13,520 –&gt; 01:08:18,239<br>well there are multiple approaches but uh we can do it with making through uh</p>
<p>539<br>01:08:18,719 –&gt; 01:08:26,079<br>uh wrap yeah you know run the raft to basically basically run the coordinator not on a single</p>
<p>540<br>01:08:26,079 –&gt; 01:08:29,599<br>machine but basically have a replicated state machine right that implements the coordinator</p>
<p>541<br>01:08:30,399 –&gt; 01:08:36,559<br>and you know we’ll use a raft to sort of uh keep the replicated state machine and the</p>
<p>542<br>01:08:36,559 –&gt; 01:08:42,239<br>implements the coordinator uh in sync uh and then if one of the machines that forms the</p>
<p>543<br>01:08:42,239 –&gt; 01:08:47,119<br>coordinated fails are hopefully the two others are still there and so we can still proceed</p>
<p>544<br>01:08:47,279 –&gt; 01:08:54,559<br>right and so it’s potentially possible you know to basically you know replicate the coordinator</p>
<p>545<br>01:08:54,559 –&gt; 01:08:59,920<br>or actually any of the participants to know using raft so let me actually</p>
<p>546<br>01:09:01,199 –&gt; 01:09:04,399<br>so we’ll put this up a little bit since a couple of little bit is more</p>
<p>547<br>01:09:09,519 –&gt; 01:09:12,960<br>so a couple discussion points which is you know we could use raft</p>
<p>548<br>01:09:17,439 –&gt; 01:09:25,840<br>to make the coordinator full tolerance or available if you will that’s really the property we care</p>
<p>549<br>01:09:25,840 –&gt; 01:09:26,079<br>about</p>
<p>550<br>01:09:31,359 –&gt; 01:09:32,000<br>does that make sense?</p>
<p>551<br>01:09:36,479 –&gt; 01:09:41,680<br>In fact if you will see if you do lap four instead of a project this is exactly actually</p>
<p>552<br>01:09:41,680 –&gt; 01:09:47,920<br>what lap four does lap four actually has a similar scheme where you know there’s a form of</p>
<p>553<br>01:09:47,920 –&gt; 01:09:55,520<br>two face commit that you know and which implement and uh move the uh the the master shard or the</p>
<p>554<br>01:09:55,520 –&gt; 01:10:03,360<br>master coordinator and rebalance the charge across uh a charge servers uses raft to replicate</p>
<p>555<br>01:10:03,360 –&gt; 01:10:07,840<br>itself and actually the charge servers itself also replicate itself using raft and so we’re</p>
<p>556<br>01:10:07,840 –&gt; 01:10:14,159<br>mainly many raft groups running in parallel and that’s sort of the essence of lap four</p>
<p>557<br>01:10:14,880 –&gt; 01:10:19,760<br>and so this is like the typical your way you know if you’re concerned about like having the</p>
<p>558<br>01:10:19,760 –&gt; 01:10:24,239<br>system being blocked for a long period of time you know one way to do it is basically make the</p>
<p>559<br>01:10:25,520 –&gt; 01:10:26,560<br>coordinated fault tolerance.</p>
<p>560<br>01:10:29,520 –&gt; 01:10:35,360<br>um so in that means you can bridge me to something else which a lot of people asked about</p>
<p>561<br>01:10:36,000 –&gt; 01:10:41,759<br>you know is raft our raft and two face commits sort of similar face</p>
<p>562<br>01:10:45,920 –&gt; 01:10:52,399<br>or could you do two face commit be raft or you know they have a little bit of a parallel</p>
<p>563<br>01:10:52,399 –&gt; 01:10:57,279<br>correct there’s like one thing is called the coordinator or raft is called the leader we got</p>
<p>564<br>01:10:58,239 –&gt; 01:11:01,439<br>you know participants you know maybe you know we can figure about these are followers</p>
<p>565<br>01:11:02,399 –&gt; 01:11:06,399<br>uh you know so you know seems to have some similarities like how do we think about like what’s</p>
<p>566<br>01:11:06,399 –&gt; 01:11:09,199<br>the relationship between raft and two pc.</p>
<p>567<br>01:11:12,159 –&gt; 01:11:18,000<br>the difference is that um in raft the the coordinator can change essentially um</p>
<p>568<br>01:11:18,000 –&gt; 01:11:20,079<br>true otherwise it’s like the single point of failure.</p>
<p>569<br>01:11:20,639 –&gt; 01:11:22,799<br>yep good point any</p>
<p>570<br>01:11:25,199 –&gt; 01:11:29,439<br>so another difference is that the raft basically depends on the concept of a majority where</p>
<p>571<br>01:11:29,439 –&gt; 01:11:34,719<br>the two face commit the coordinator needs to get a response from every single uh other server that</p>
<p>572<br>01:11:34,719 –&gt; 01:11:37,119<br>is involved in the uh the commitment. yep.</p>
<p>573<br>01:11:37,119 –&gt; 01:11:38,159<br>yep all those are good points.</p>
<p>574<br>01:11:38,159 –&gt; 01:11:43,199<br>the digital is really like protocol differences correct uh and you know we’re wondering if we can</p>
<p>575<br>01:11:43,199 –&gt; 01:11:48,479<br>we get to a point where like is there just conceptual difference like do they solve the same problem</p>
<p>576<br>01:11:50,079 –&gt; 01:11:56,719<br>um raft is for replicating the same thing and two face commit is when you do the opposite when you</p>
<p>577<br>01:11:57,199 –&gt; 01:12:02,320<br>instead of having one thing you spread across different servers then you have to take the problem.</p>
<p>578<br>01:12:02,320 –&gt; 01:12:08,079<br>exactly exactly uh um raft all servers do the same thing</p>
<p>579<br>01:12:13,840 –&gt; 01:12:15,840<br>so the implementing a replicate state mission right</p>
<p>580<br>01:12:18,159 –&gt; 01:12:23,360<br>and in two pc actually servers are all servers operate on different data</p>
<p>581<br>01:12:26,720 –&gt; 01:12:40,560<br>so the first participant was actually operating on x and second participant was operating on what</p>
<p>582<br>01:12:41,360 –&gt; 01:12:45,360<br>so in two pc really you know solves a completely different problem than raft.</p>
<p>583<br>01:12:45,359 –&gt; 01:12:48,000<br>gonna raft is really all about high availability</p>
<p>584<br>01:12:54,880 –&gt; 01:12:59,920<br>and uh two pc is really about you know atomic operations across servers</p>
<p>585<br>01:13:07,679 –&gt; 01:13:10,000<br>or across data that’s living on different servers.</p>
<p>586<br>01:13:10,720 –&gt; 01:13:16,880<br>does not make sense? so even though like maybe they have some you know internal techniques that</p>
<p>587<br>01:13:16,880 –&gt; 01:13:22,319<br>looks like very similar the two protocols you know are designed for completely different problems</p>
<p>588<br>01:13:23,600 –&gt; 01:13:27,840<br>and i’m not directly related now it’s interesting to see correct that we could make a raft</p>
<p>589<br>01:13:27,840 –&gt; 01:13:31,359<br>we can use raft to make the coordinate in more fault tolerance or the petitions may have</p>
<p>590<br>01:13:31,359 –&gt; 01:13:36,079<br>uh more highly available uh but they basically essentially they solve different problems</p>
<p>591<br>01:13:40,880 –&gt; 01:13:49,279<br>with that actually wanted to end this lecture and i’m happy to entertain more questions</p>
<p>592<br>01:13:49,920 –&gt; 01:13:55,760<br>um hopefully this will very helpful in the next two papers so the next two papers are both two</p>
<p>593<br>01:13:55,760 –&gt; 01:14:05,119<br>transaction systems one uh one from google you want to microsoft research and second one uses</p>
<p>594<br>01:14:05,199 –&gt; 01:14:10,399<br>optimistic transactions uh and you will see when you read these papers there’s a lot of machinery</p>
<p>595<br>01:14:10,399 –&gt; 01:14:15,119<br>they’re pretty complex systems uh but hopefully at least you know some of the parts that will be</p>
<p>596<br>01:14:15,119 –&gt; 01:14:19,119<br>described you will sort of know and understand because you know what two phase committees and you know</p>
<p>597<br>01:14:19,119 –&gt; 01:14:26,880<br>what two phase lockings. all right with that i’ll end uh yeah everybody we need to go and go and</p>
<p>598<br>01:14:26,960 –&gt; 01:14:29,680<br>anybody wants to ask questions no please feel free to do so.</p>
<p>599<br>01:14:36,960 –&gt; 01:14:43,359<br>uh sorry this might be a little uh a strange question but for two phase locking</p>
<p>600<br>01:14:44,079 –&gt; 01:14:53,119<br>it is also about atomic operations but there it is about one um not across servers but across one</p>
<p>601<br>01:14:53,199 –&gt; 01:14:59,439<br>server and two phases across multiple servers. yeah two phase locking is relevant to if you have a single</p>
<p>602<br>01:14:59,439 –&gt; 01:15:05,359<br>machine like a multi-core machine and you implement a transaction system on a multi-core machine uh you</p>
<p>603<br>01:15:05,359 –&gt; 01:15:10,399<br>will have to walk you know the records that are involved in the transaction uh and two phase locking is</p>
<p>604<br>01:15:10,399 –&gt; 01:15:18,399<br>a perfectly good protocol for doing so. where two phase committees really have had distributed systems.</p>
<p>605<br>01:15:18,879 –&gt; 01:15:28,239<br>I guess my question was is two phase two phase locking can it be part of two phase committee?</p>
<p>606<br>01:15:30,399 –&gt; 01:15:35,759<br>I’m not sure I know what that means. do we I think about this they yourself two different problems.</p>
<p>607<br>01:15:38,559 –&gt; 01:15:44,399<br>okay it is the case that you know you you mean maybe this is what you mean. it is the case where</p>
<p>608<br>01:15:44,399 –&gt; 01:15:51,439<br>that you know there’s a the coordinator or it’s part of like the initial setup like when the initial</p>
<p>609<br>01:15:51,439 –&gt; 01:15:56,719<br>puts are done by the transaction uh that transaction will follow two phase locking. you know</p>
<p>610<br>01:15:56,719 –&gt; 01:16:04,079<br>if you hear the lock and a axis required lock and b is required. so and we’re lock and y is</p>
<p>611<br>01:16:04,079 –&gt; 01:16:08,559<br>acquired and so the the transaction does that in the two phase locking style. it could have done</p>
<p>612<br>01:16:08,720 –&gt; 01:16:15,120<br>using strict walking too but you know from the two phase committee point of view it doesn’t really matter</p>
<p>613<br>01:16:15,120 –&gt; 01:16:19,760<br>like at some point you know the the sort of transaction is tentatively executed and the two phase</p>
<p>614<br>01:16:19,760 –&gt; 01:16:25,760<br>committees really about uh reaching agreement uh that all parties are agreed to go along.</p>
<p>615<br>01:16:28,480 –&gt; 01:16:33,680<br>yeah that makes sense thank you you’re welcome. is two phase committee exclusively for like</p>
<p>616<br>01:16:33,680 –&gt; 01:16:44,960<br>started data? no actually it came out uh although yes or no the original sort of three phase committee</p>
<p>617<br>01:16:44,960 –&gt; 01:16:50,800<br>came out of the case where like you have different organizations and they need to agree to do</p>
<p>618<br>01:16:50,800 –&gt; 01:16:57,920<br>something like you know your book a uh on some uh travel website you know you book a trip and</p>
<p>619<br>01:16:58,000 –&gt; 01:17:03,760<br>another thing you book a hotel and you want to sort of commit you know to the whole trip is</p>
<p>620<br>01:17:03,760 –&gt; 01:17:12,560<br>you know both the hotel website and uh uh the travel website that agreed to go along or</p>
<p>621<br>01:17:12,560 –&gt; 01:17:17,840<br>sort of commit to the transaction um and that’s sort of the setting where you know sort of the</p>
<p>622<br>01:17:17,840 –&gt; 01:17:22,399<br>setting that where it came up is really you know you have different organizations that need to commit</p>
<p>623<br>01:17:22,399 –&gt; 01:17:32,799<br>to a particular uh uh operation uh and uh for the reasons that uh in that setting actually uh basically</p>
<p>624<br>01:17:32,799 –&gt; 01:17:38,479<br>people don’t really want to use two phase committee uh because that would mean that uh the travel</p>
<p>625<br>01:17:38,479 –&gt; 01:17:44,719<br>agency website is dependent on the hotel reservation websites and you know these are from different</p>
<p>626<br>01:17:44,719 –&gt; 01:17:48,479<br>organizations and you know people you know the organizations don’t really trust each other</p>
<p>627<br>01:17:48,479 –&gt; 01:17:55,679<br>and if one goes down then the transaction can’t proceed and that seems all bad so in fact two phase</p>
<p>628<br>01:17:55,679 –&gt; 01:18:00,639<br>committee had a sort of a bit of a negative reputation um because it was really you know</p>
<p>629<br>01:18:01,679 –&gt; 01:18:05,279<br>really one of the original goals of two phase committee was to solve that problem with that problem</p>
<p>630<br>01:18:05,279 –&gt; 01:18:09,839<br>where people don’t really want to solve with two phase committee however in the context where like</p>
<p>631<br>01:18:09,839 –&gt; 01:18:14,399<br>you have a data center it’s a single organization and the database is sharducked two phase committee</p>
<p>632<br>01:18:14,399 –&gt; 01:18:25,439<br>is widely popular and that’s typically used awesome thank you you want to could you go back to the</p>
<p>633<br>01:18:25,439 –&gt; 01:18:32,319<br>first failure case that we talked about with two phase committee where um it fails e-fails after</p>
<p>634<br>01:18:32,319 –&gt; 01:18:40,639<br>responding prepared okay yeah I think this is the this one uh yeah I guess I think that’s wise</p>
<p>635<br>01:18:40,800 –&gt; 01:18:49,200<br>about this case but yeah yeah I guess uh I was wondering why be these to persist or like why</p>
<p>636<br>01:18:49,200 –&gt; 01:18:57,440<br>needs to remember that it received prepare um I guess my thinking was when it comes back up</p>
<p>637<br>01:18:58,079 –&gt; 01:19:04,480<br>if it receives a commit message from the coordinator couldn’t it just assume that it was prepared</p>
<p>638<br>01:19:04,480 –&gt; 01:19:10,240<br>I guess where does it use that information well yeah well we could have aborted right before the</p>
<p>639<br>01:19:10,239 –&gt; 01:19:17,840<br>crash I mean you need to remember what it did okay so there’s another slight variation of this</p>
<p>640<br>01:19:17,840 –&gt; 01:19:23,920<br>protocol where where you assume that you always commit a commit so a presumed commit one of the</p>
<p>641<br>01:19:23,920 –&gt; 01:19:28,000<br>messages is slightly different uh and you know there’s an optimization that you could consider</p>
<p>642<br>01:19:28,639 –&gt; 01:19:34,960<br>um and it makes sense in some settings uh I didn’t really talk about that particular protocol</p>
<p>643<br>01:19:34,960 –&gt; 01:19:38,559<br>but it’s a slight different you know sort of variation there’s quite a number of variations for two</p>
<p>644<br>01:19:38,560 –&gt; 01:19:55,039<br>phase commit uh the change in the minor ways uh that’s it’s that it for today</p>
<p>645<br>01:19:57,520 –&gt; 01:20:04,560<br>sorry you said that it can it could have aborted the transaction but if it did that it will never</p>
<p>646<br>01:20:04,560 –&gt; 01:20:11,760<br>receive the commit are you mean uh in response in the last question yeah yeah yeah uh you know</p>
<p>647<br>01:20:11,760 –&gt; 01:20:16,640<br>the the question was like why does he have to record on stable storage what it decided to do</p>
<p>648<br>01:20:17,600 –&gt; 01:20:23,120<br>and uh the injury is that uh when B comes up it knows it needs to know whether it actually</p>
<p>649<br>01:20:23,120 –&gt; 01:20:29,039<br>commits agreed to commit or we’re going to agree to abort um and if it doesn’t write anything it doesn’t</p>
<p>650<br>01:20:29,199 –&gt; 01:20:38,239<br>know to what it agreed because it could have aborted after yep yeah</p>
<p>651<br>01:20:40,560 –&gt; 01:20:44,000<br>okay is anything to know that to know what to do in the recovery state?</p>
<p>652<br>01:20:44,000 –&gt; 01:20:45,279<br>yes exactly</p>
<p>653<br>01:20:52,239 –&gt; 01:20:58,159<br>it also needs to record what it does because if it like aborts but the message number gets to</p>
<p>654<br>01:20:58,159 –&gt; 01:21:04,559<br>the coordinator needs to um we send the same message right yeah uh it needs to record that it</p>
<p>655<br>01:21:04,559 –&gt; 01:21:09,199<br>actually aborted that transaction idea so when the comment coordinator asks you know what do you do</p>
<p>656<br>01:21:09,199 –&gt; 01:21:12,720<br>that the actual response we’ve been known? Todd it thank you</p>
<p>657<br>01:21:17,519 –&gt; 01:21:21,359<br>thank you welcome thank you</p>
<p>658<br>01:21:21,359 –&gt; 01:21:25,359<br>okay see you all next week</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MIT6824 P13Lecture13 DistributedTransactions</div>
      <div>http://example.com/2025/10/24/MIT6824 P13Lecture13-DistributedTransactions/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/24/MIT6824%20P14Lecture14-Spanner/" title="MIT6824 P14Lecture14 Spanner">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MIT6824 P14Lecture14 Spanner</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/24/MIT6824%20P11Lecture11-ChainReplication/" title="MIT6824 P11Lecture11 ChainReplication">
                        <span class="hidden-mobile">MIT6824 P11Lecture11 ChainReplication</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
