

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:07,000Okay, good afternoon. 200:00:07,000 –&gt; 00:00:10,000Sam check. 300:00:10,000 –&gt; 00:00:13,000Double checking. 400:00:13,000 –&gt; 00:00:17,000You can hear me. 500:0">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6824 P7Lecture7 FaultTolerance Raft2">
<meta property="og:url" content="http://example.com/2025/10/24/MIT6824%20P7Lecture7-FaultTolerance-Raft2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:07,000Okay, good afternoon. 200:00:07,000 –&gt; 00:00:10,000Sam check. 300:00:10,000 –&gt; 00:00:13,000Double checking. 400:00:13,000 –&gt; 00:00:17,000You can hear me. 500:0">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-24T12:02:19.373Z">
<meta property="article:modified_time" content="2025-10-24T12:06:28.574Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MIT6824 P7Lecture7 FaultTolerance Raft2 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MIT6824 P7Lecture7 FaultTolerance Raft2"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-24 20:02" pubdate>
          2025年10月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          142 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MIT6824 P7Lecture7 FaultTolerance Raft2</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:07,000<br>Okay, good afternoon.</p>
<p>2<br>00:00:07,000 –&gt; 00:00:10,000<br>Sam check.</p>
<p>3<br>00:00:10,000 –&gt; 00:00:13,000<br>Double checking.</p>
<p>4<br>00:00:13,000 –&gt; 00:00:17,000<br>You can hear me.</p>
<p>5<br>00:00:17,000 –&gt; 00:00:18,000<br>Yeah.</p>
<p>6<br>00:00:18,000 –&gt; 00:00:19,000<br>Thank you.</p>
<p>7<br>00:00:19,000 –&gt; 00:00:23,000<br>Okay, good afternoon. Good evening. Good morning. Good night.</p>
<p>8<br>00:00:23,000 –&gt; 00:00:24,000<br>Where we are.</p>
<p>9<br>00:00:24,000 –&gt; 00:00:27,000<br>So I’m going to talk today more about draft.</p>
<p>10<br>00:00:27,000 –&gt; 00:00:30,000<br>I’m going to talk about draft.</p>
<p>11<br>00:00:30,000 –&gt; 00:00:33,000<br>I’m going to talk about draft.</p>
<p>12<br>00:00:33,000 –&gt; 00:00:36,000<br>And we want to cover the following different topics,</p>
<p>13<br>00:00:36,000 –&gt; 00:00:39,000<br>which are going to be rather than to lapse.</p>
<p>14<br>00:00:39,000 –&gt; 00:00:43,000<br>So first of all, I want to talk a little bit more about walk divergence.</p>
<p>15<br>00:00:43,000 –&gt; 00:00:47,000<br>He sort of had a cliffhanger at the end of last lecture where we got in a discussion of figure six.</p>
<p>16<br>00:00:47,000 –&gt; 00:00:49,000<br>I want to resume that discussion.</p>
<p>17<br>00:00:49,000 –&gt; 00:00:52,000<br>I want to talk about log catch up.</p>
<p>18<br>00:00:52,000 –&gt; 00:00:55,000<br>And how do we follow a first catch up.</p>
<p>19<br>00:00:55,000 –&gt; 00:00:57,000<br>Then a little bit of a persistence.</p>
<p>20<br>00:00:57,000 –&gt; 00:01:01,000<br>Like what state must be.</p>
<p>21<br>00:01:01,000 –&gt; 00:01:07,000<br>What state in a draft action must be persistence and storage, which has been really, really relevant for two C and 2D.</p>
<p>22<br>00:01:07,000 –&gt; 00:01:12,000<br>And also talk about latest to that to snapshots.</p>
<p>23<br>00:01:12,000 –&gt; 00:01:15,000<br>Yeah.</p>
<p>24<br>00:01:15,000 –&gt; 00:01:18,000<br>There’s any questions please feel for ask.</p>
<p>25<br>00:01:18,000 –&gt; 00:01:21,000<br>And then finally, I want to talk about linearizability and correctness.</p>
<p>26<br>00:01:21,000 –&gt; 00:01:27,000<br>Cuterium that comes up quite often is in the paper used also in a bunch of places.</p>
<p>27<br>00:01:27,000 –&gt; 00:01:33,000<br>And this will allow us to talk a little bit again about like how does a serve of user after.</p>
<p>28<br>00:01:33,000 –&gt; 00:01:36,000<br>So those are the top of certain time to talk about.</p>
<p>29<br>00:01:36,000 –&gt; 00:01:39,000<br>Any questions right now please feel free to ask.</p>
<p>30<br>00:01:39,000 –&gt; 00:01:47,000<br>And of course, always jump in any point.</p>
<p>31<br>00:01:47,000 –&gt; 00:01:50,000<br>Okay, so.</p>
<p>32<br>00:01:50,000 –&gt; 00:01:58,000<br>So we sound less to we restarted talking about draft, you know, we sound the leader has sort of this job of replicating its log on to the.</p>
<p>33<br>00:01:58,000 –&gt; 00:02:00,000<br>On to followers.</p>
<p>34<br>00:02:00,000 –&gt; 00:02:05,000<br>And but you know due to crashes and leader election.</p>
<p>35<br>00:02:05,000 –&gt; 00:02:12,000<br>The state of the system, you know, the logs can actually quite can diverse quite quite a bit.</p>
<p>36<br>00:02:12,000 –&gt; 00:02:15,000<br>And so there’s a lot of different scenarios.</p>
<p>37<br>00:02:15,000 –&gt; 00:02:18,000<br>And that’s where the system can end up in.</p>
<p>38<br>00:02:18,000 –&gt; 00:02:29,000<br>And so the figure six or 57 actually shows a bunch of those.</p>
<p>39<br>00:02:29,000 –&gt; 00:02:30,000<br>And the.</p>
<p>40<br>00:02:30,000 –&gt; 00:02:37,000<br>And the main reason for the figure is that it actually sharpens up the leader election rule.</p>
<p>41<br>00:02:37,000 –&gt; 00:02:42,000<br>So once the leader goes down and we need to elect a new leader.</p>
<p>42<br>00:02:42,000 –&gt; 00:03:01,000<br>There’s actually some restrictions that must be applied to actually make sure that we can get to converge on the right log in the end.</p>
<p>43<br>00:03:01,000 –&gt; 00:03:11,000<br>And so first of all, one part of that is that any leader needs to achieve a majority.</p>
<p>44<br>00:03:11,000 –&gt; 00:03:22,000<br>And this is a part of that idea to actually avoid just bringing split syndrome or split brain syndrome so that we can actually make sure that you know any two subsequent elections.</p>
<p>45<br>00:03:22,000 –&gt; 00:03:27,000<br>There’s going to be at least one note that participated in both.</p>
<p>46<br>00:03:27,000 –&gt; 00:03:37,000<br>Majorities because you know, that can only be with your two majors must overlap and that node must actually have, you know, the operations for them are recent.</p>
<p>47<br>00:03:37,000 –&gt; 00:03:39,000<br>From the recent term.</p>
<p>48<br>00:03:39,000 –&gt; 00:03:43,000<br>The majority is important, but turns out you know it’s actually a little bit more subtle.</p>
<p>49<br>00:03:43,000 –&gt; 00:03:50,000<br>You might think that like the longers log that should be sufficient because the longers log has much more information.</p>
<p>50<br>00:03:50,000 –&gt; 00:03:54,000<br>So we’ll just pick that as the next leader and then we’re in good shape.</p>
<p>51<br>00:03:54,000 –&gt; 00:03:58,000<br>And that turns out to be not the case.</p>
<p>52<br>00:03:58,000 –&gt; 00:04:01,000<br>And so.</p>
<p>53<br>00:04:01,000 –&gt; 00:04:03,000<br>And the leader rules a little bit more subtle.</p>
<p>54<br>00:04:03,000 –&gt; 00:04:10,000<br>So this is a majority plot plus at least as a date, least.</p>
<p>55<br>00:04:10,000 –&gt; 00:04:16,000<br>But that’s too late.</p>
<p>56<br>00:04:16,000 –&gt; 00:04:22,000<br>So so if two, you know, the leading election is running.</p>
<p>57<br>00:04:22,000 –&gt; 00:04:34,000<br>So if the candidate is starting to run a leader election approaches a bunch of followers and then the followers respond with a positive vote.</p>
<p>58<br>00:04:34,000 –&gt; 00:04:38,000<br>If the candidate actually is at least up to date as they are.</p>
<p>59<br>00:04:38,000 –&gt; 00:04:49,000<br>And what that means is that the last log entry must actually have the same term or in if you know they actually have the same term.</p>
<p>60<br>00:04:49,000 –&gt; 00:04:59,000<br>And so that’s the leader election rule and you know we looked at this sort of this problem last week.</p>
<p>61<br>00:04:59,000 –&gt; 00:05:07,000<br>It’s part of the homework and like what happens if you know this note, you know that was about to lead the leader actually dead.</p>
<p>62<br>00:05:07,000 –&gt; 00:05:10,000<br>As gone, you know and who could become leaders.</p>
<p>63<br>00:05:10,000 –&gt; 00:05:15,000<br>And you know quickly discovered that you know the there’s a bunch of them that cannot become leader.</p>
<p>64<br>00:05:15,000 –&gt; 00:05:20,000<br>But then there’s potentially a number of scenarios in which some can become leaders.</p>
<p>65<br>00:05:20,000 –&gt; 00:05:24,000<br>And so particular, you know, we can identify that it can become leader.</p>
<p>66<br>00:05:24,000 –&gt; 00:05:26,000<br>So you can become leader.</p>
<p>67<br>00:05:26,000 –&gt; 00:05:30,000<br>Indeed, we can come leader.</p>
<p>68<br>00:05:30,000 –&gt; 00:05:31,000<br>And so then.</p>
<p>69<br>00:05:31,000 –&gt; 00:05:35,000<br>And so there’s probably the most important part of this whole discussion.</p>
<p>70<br>00:05:35,000 –&gt; 00:05:36,000<br>Like who can become leader.</p>
<p>71<br>00:05:36,000 –&gt; 00:05:38,000<br>That’s the question.</p>
<p>72<br>00:05:38,000 –&gt; 00:05:39,000<br>Is there.</p>
<p>73<br>00:05:39,000 –&gt; 00:05:42,000<br>Hold on.</p>
<p>74<br>00:05:42,000 –&gt; 00:05:44,000<br>Okay.</p>
<p>75<br>00:05:44,000 –&gt; 00:05:45,000<br>So who become.</p>
<p>76<br>00:05:45,000 –&gt; 00:05:46,000<br>That’s the most important part.</p>
<p>77<br>00:05:46,000 –&gt; 00:05:50,000<br>So there’s a bunch of different scenarios in which a can become a leader.</p>
<p>78<br>00:05:50,000 –&gt; 00:05:55,000<br>There’s a scenario where C become become a leader and a scenario where D become become a leader.</p>
<p>79<br>00:05:55,000 –&gt; 00:05:58,000<br>Then the discussion folks a little bit about their like well.</p>
<p>80<br>00:05:58,000 –&gt; 00:06:01,000<br>And at least there’s one particular scenario in which one of these can become leader.</p>
<p>81<br>00:06:01,000 –&gt; 00:06:10,000<br>And then there’s a lot of other, you know, multiple scenarios in which they come to leader, particularly this focus this discussion focused on a.</p>
<p>82<br>00:06:10,000 –&gt; 00:06:15,000<br>Because the one way that a can become a leader is when.</p>
<p>83<br>00:06:15,000 –&gt; 00:06:17,000<br>C and D.</p>
<p>84<br>00:06:17,000 –&gt; 00:06:22,000<br>Or down.</p>
<p>85<br>00:06:22,000 –&gt; 00:06:25,000<br>Because C and D are down.</p>
<p>86<br>00:06:25,000 –&gt; 00:06:28,000<br>A will talk to B E and F.</p>
<p>87<br>00:06:28,000 –&gt; 00:06:30,000<br>For majority.</p>
<p>88<br>00:06:30,000 –&gt; 00:06:32,000<br>If I have four.</p>
<p>89<br>00:06:32,000 –&gt; 00:06:35,000<br>It has the most up to date log.</p>
<p>90<br>00:06:35,000 –&gt; 00:06:39,000<br>Notice that you know, even though F is a longer log.</p>
<p>91<br>00:06:39,000 –&gt; 00:06:42,000<br>It actually is not the most up to date one.</p>
<p>92<br>00:06:42,000 –&gt; 00:06:45,000<br>And so I will actually will succeed in becoming the leader.</p>
<p>93<br>00:06:45,000 –&gt; 00:06:48,000<br>And then things proceed from there.</p>
<p>94<br>00:06:48,000 –&gt; 00:07:00,000<br>And the interesting question that came up is are there other scenarios in which a can become a leader in particular are is the scenario where like even if C and D are up.</p>
<p>95<br>00:07:00,000 –&gt; 00:07:06,000<br>What a reachable or participate is a possibility becomes a leader.</p>
<p>96<br>00:07:06,000 –&gt; 00:07:08,000<br>And so we’ve been seeing D and up.</p>
<p>97<br>00:07:08,000 –&gt; 00:07:14,000<br>And so the question is does C and D always vote for a if a is to candidate.</p>
<p>98<br>00:07:14,000 –&gt; 00:07:17,000<br>And so it turns out this answer is slightly complicated.</p>
<p>99<br>00:07:17,000 –&gt; 00:07:19,000<br>It is not completely straight for it.</p>
<p>100<br>00:07:19,000 –&gt; 00:07:28,000<br>So if a starts this election, you know, presumably it will start the election into seven.</p>
<p>101<br>00:07:28,000 –&gt; 00:07:31,000<br>And so even context is C and D.</p>
<p>102<br>00:07:31,000 –&gt; 00:07:35,000<br>You know, C will be perfectly fine with that because the.</p>
<p>103<br>00:07:35,000 –&gt; 00:07:39,000<br>The A’s at least up to date.</p>
<p>104<br>00:07:39,000 –&gt; 00:07:47,000<br>And so we’ll be able to achieve a majority, but you know, it is possible correct the D.</p>
<p>105<br>00:07:47,000 –&gt; 00:07:52,000<br>There’s one additional rule that if.</p>
<p>106<br>00:07:52,000 –&gt; 00:08:03,000<br>D actually has a if a follower or if it yeah, if a follower has a higher term has seen a higher term, it’s current terms higher than the candidate.</p>
<p>107<br>00:08:03,000 –&gt; 00:08:13,000<br>And so it actually can it’s can stop the election because it will respond saying like hey, my term is higher than your height or my term my current terms higher than your term.</p>
<p>108<br>00:08:13,000 –&gt; 00:08:16,000<br>And so therefore you have to become a follower so able then we.</p>
<p>109<br>00:08:16,000 –&gt; 00:08:19,000<br>We change back from candidate to follow it.</p>
<p>110<br>00:08:19,000 –&gt; 00:08:21,000<br>And this can happen correctly in case of D.</p>
<p>111<br>00:08:21,000 –&gt; 00:08:28,000<br>This D might actually have seen term eight and we can’t really tell from this picture what actually the outcome is going to be.</p>
<p>112<br>00:08:28,000 –&gt; 00:08:32,000<br>But let’s assume that for example, you know, the.</p>
<p>113<br>00:08:32,000 –&gt; 00:08:39,000<br>It has run once and accents increased its term to eight.</p>
<p>114<br>00:08:39,000 –&gt; 00:08:41,000<br>Maybe didn’t become succeeded a leader.</p>
<p>115<br>00:08:41,000 –&gt; 00:08:44,000<br>And then it’s current term will eight and so it will vote.</p>
<p>116<br>00:08:44,000 –&gt; 00:08:49,000<br>Actually ask it to for its vote and people say no, I won’t vote for you.</p>
<p>117<br>00:08:49,000 –&gt; 00:08:54,000<br>And furthermore, my current term is eight. So a will see that message is higher than seven.</p>
<p>118<br>00:08:54,000 –&gt; 00:08:58,000<br>And so a will actually step down and become just a follower.</p>
<p>119<br>00:08:58,000 –&gt; 00:09:06,000<br>And then some more later, presumably, you know, D will run its election time or a little bit off and actually it will run.</p>
<p>120<br>00:09:06,000 –&gt; 00:09:17,000<br>So the short story of this, you know, the morale of this is going to really this picture is that it’s absolutely possible that AC and you can go leader in different types of scenarios.</p>
<p>121<br>00:09:17,000 –&gt; 00:09:20,000<br>And that’s probably the main thing to get out of this.</p>
<p>122<br>00:09:20,000 –&gt; 00:09:21,000<br>Professor.</p>
<p>123<br>00:09:21,000 –&gt; 00:09:22,000<br>Yeah.</p>
<p>124<br>00:09:22,000 –&gt; 00:09:32,000<br>So I just want to ask because I think I’m not sure if I understood correctly, but you said, a might be elected in term seven.</p>
<p>125<br>00:09:32,000 –&gt; 00:09:39,000<br>It is a non-sue that I cannot for any reason be elected in term seven.</p>
<p>126<br>00:09:39,000 –&gt; 00:09:50,000<br>Even if he was down, right, because people like the like already got a majority right in seven.</p>
<p>127<br>00:09:50,000 –&gt; 00:10:00,000<br>Do you got a majority in seven because it actually was able to get something done. So zoomly in right you’re right, you know, the good oxidation.</p>
<p>128<br>00:10:00,000 –&gt; 00:10:05,000<br>So it has to be the case that there’s a number of people that actually are ready in turn seven.</p>
<p>129<br>00:10:05,000 –&gt; 00:10:06,000<br>Correct.</p>
<p>130<br>00:10:06,000 –&gt; 00:10:08,000<br>And the pictures just incomplete.</p>
<p>131<br>00:10:08,000 –&gt; 00:10:12,000<br>We don’t really know what the current term is that people have seen so far.</p>
<p>132<br>00:10:12,000 –&gt; 00:10:13,000<br>Yeah.</p>
<p>133<br>00:10:13,000 –&gt; 00:10:14,000<br>Right.</p>
<p>134<br>00:10:14,000 –&gt; 00:10:23,000<br>But yeah, I mean, the only thing is like, I think like a majority of the servers already voted for someone in term seven.</p>
<p>135<br>00:10:23,000 –&gt; 00:10:24,000<br>So they will.</p>
<p>136<br>00:10:24,000 –&gt; 00:10:27,000<br>So they presumably able to go to term eight.</p>
<p>137<br>00:10:27,000 –&gt; 00:10:33,000<br>And you know, we’ll run the election for term eight, but you know, for the same reason, you might already be in nine.</p>
<p>138<br>00:10:33,000 –&gt; 00:10:41,000<br>And so it all depends on what the current term is, but these actually these participants are in.</p>
<p>139<br>00:10:41,000 –&gt; 00:10:49,000<br>But the main conclusion correct the main top level conclusion is that a can become leader, certainly even see a DR offline.</p>
<p>140<br>00:10:49,000 –&gt; 00:10:54,000<br>C can become a leader and D can become a leader.</p>
<p>141<br>00:10:54,000 –&gt; 00:10:58,000<br>Thanks.</p>
<p>142<br>00:10:58,000 –&gt; 00:10:59,000<br>Good.</p>
<p>143<br>00:10:59,000 –&gt; 00:11:01,000<br>Okay.</p>
<p>144<br>00:11:01,000 –&gt; 00:11:11,000<br>Then, let’s, so we now know that the, you know, the raft can sort of ended with the states where the logs are diverged.</p>
<p>145<br>00:11:11,000 –&gt; 00:11:13,000<br>And so that needs to be repaired.</p>
<p>146<br>00:11:13,000 –&gt; 00:11:21,000<br>And so I can want to keep component of the raft protocol is to do that like log catch up as they called.</p>
<p>147<br>00:11:21,000 –&gt; 00:11:30,000<br>So I want to talk that a little bit about that.</p>
<p>148<br>00:11:30,000 –&gt; 00:11:39,000<br>And this is basically what you’re sort of half the deal with in part B of the lab.</p>
<p>149<br>00:11:39,000 –&gt; 00:11:44,000<br>And so maybe easy to illustrate this picture.</p>
<p>150<br>00:11:44,000 –&gt; 00:11:47,000<br>And so let’s, it’s going to make it a little bit simple.</p>
<p>151<br>00:11:47,000 –&gt; 00:11:50,000<br>Let’s have free servers.</p>
<p>152<br>00:11:50,000 –&gt; 00:11:52,000<br>So this is one thing here’s S1.</p>
<p>153<br>00:11:52,000 –&gt; 00:11:55,000<br>It has, you know,</p>
<p>154<br>00:11:55,000 –&gt; 00:11:58,000<br>free in index 10.</p>
<p>155<br>00:11:58,000 –&gt; 00:12:04,000<br>In this index 11 has no entries in 10, 11, 12, 13.</p>
<p>156<br>00:12:04,000 –&gt; 00:12:10,000<br>Here we have s2.</p>
<p>157<br>00:12:10,000 –&gt; 00:12:16,000<br>And s2 has entries free, free, and 5.</p>
<p>158<br>00:12:16,000 –&gt; 00:12:20,620<br>This is index 10, 11, 12, and 13, 13,</p>
<p>159<br>00:12:20,620 –&gt; 00:12:22,460<br>just to make it complete.</p>
<p>160<br>00:12:22,460 –&gt; 00:12:27,139<br>And here is S4, sorry, S3.</p>
<p>161<br>00:12:27,139 –&gt; 00:12:32,460<br>And let’s tune, we’re in the scenario 3, 3, 4, and 10,</p>
<p>162<br>00:12:32,460 –&gt; 00:12:36,259<br>11, 12, and 13.</p>
<p>163<br>00:12:36,259 –&gt; 00:12:39,860<br>And I’m not showing the indexes before 10.</p>
<p>164<br>00:12:39,860 –&gt; 00:12:42,700<br>It’s a lot of these very relevant.</p>
<p>165<br>00:12:42,700 –&gt; 00:12:46,900<br>Let’s use the timeline, these different surfaces.</p>
<p>166<br>00:12:46,900 –&gt; 00:12:51,700<br>And just let’s start out assuming that S2 becomes the leader.</p>
<p>167<br>00:12:51,700 –&gt; 00:12:56,460<br>Because it has the highest, it is most of the date.</p>
<p>168<br>00:12:56,460 –&gt; 00:12:59,300<br>It has the highest turn number in the last large entry.</p>
<p>169<br>00:12:59,300 –&gt; 00:13:00,860<br>So it becomes leader.</p>
<p>170<br>00:13:00,860 –&gt; 00:13:04,620<br>And now we need to understand how about the protocol</p>
<p>171<br>00:13:04,620 –&gt; 00:13:07,220<br>is to synchronize these particular logs.</p>
<p>172<br>00:13:07,220 –&gt; 00:13:10,100<br>And the way this almost happens is a side effect</p>
<p>173<br>00:13:10,700 –&gt; 00:13:13,899<br>either the append entries because new log entries</p>
<p>174<br>00:13:13,899 –&gt; 00:13:15,580<br>are appended or because of hardbeats,</p>
<p>175<br>00:13:15,580 –&gt; 00:13:19,740<br>which basically are append entries with zero new entries.</p>
<p>176<br>00:13:19,740 –&gt; 00:13:22,100<br>So let’s assume that the leader actually sends a heartbeat out.</p>
<p>177<br>00:13:22,100 –&gt; 00:13:24,060<br>In fact, the dot hit correct after every election</p>
<p>178<br>00:13:24,060 –&gt; 00:13:26,060<br>and neatly sends out a heartbeat.</p>
<p>179<br>00:13:26,060 –&gt; 00:13:28,340<br>And so it will send out a heartbeat.</p>
<p>180<br>00:13:28,340 –&gt; 00:13:32,300<br>And the heartbeat basically has no log entries.</p>
<p>181<br>00:13:32,300 –&gt; 00:13:35,420<br>But it also indicates two other pieces of information,</p>
<p>182<br>00:13:35,420 –&gt; 00:13:39,980<br>namely the previous term, which</p>
<p>183<br>00:13:39,980 –&gt; 00:13:43,019<br>in this case is going to be five.</p>
<p>184<br>00:13:43,019 –&gt; 00:13:48,139<br>And the previous index is going to be 12.</p>
<p>185<br>00:13:48,139 –&gt; 00:13:52,100<br>So it sends it off to the leader, S2 sensor to S3.</p>
<p>186<br>00:13:52,100 –&gt; 00:13:55,740<br>And S3 looks at this and says, well, when we look,</p>
<p>187<br>00:13:55,740 –&gt; 00:14:00,220<br>my previous term is actually is not five,</p>
<p>188<br>00:14:00,220 –&gt; 00:14:02,340<br>it’s actually even four.</p>
<p>189<br>00:14:02,340 –&gt; 00:14:05,460<br>And so it actually sends back an message saying, no.</p>
<p>190<br>00:14:06,300 –&gt; 00:14:11,300<br>I’m in a live in principle, but I cannot do your append.</p>
<p>191<br>00:14:13,019 –&gt; 00:14:15,019<br>So I’m not at the date.</p>
<p>192<br>00:14:15,019 –&gt; 00:14:20,259<br>And so now S2 has some information to actually bring it up the date.</p>
<p>193<br>00:14:20,259 –&gt; 00:14:25,300<br>And the way it works is there’s two variables that are important.</p>
<p>194<br>00:14:25,300 –&gt; 00:14:28,740<br>One for every note,</p>
<p>195<br>00:14:28,740 –&gt; 00:14:32,139<br>S2 keeps a variable next index.</p>
<p>196<br>00:14:36,460 –&gt; 00:14:39,300<br>And next index, when it initializes it,</p>
<p>197<br>00:14:39,300 –&gt; 00:14:44,220<br>when it becomes leader, it is sort of an optimistic variable.</p>
<p>198<br>00:14:44,220 –&gt; 00:14:48,060<br>It just assumes that the logs are actually up to date.</p>
<p>199<br>00:14:48,060 –&gt; 00:14:54,060<br>And so when S2 becomes leader, it actually just sets it to 13.</p>
<p>200<br>00:14:54,060 –&gt; 00:14:57,060<br>The same value that actually it has for itself.</p>
<p>201<br>00:14:57,060 –&gt; 00:15:00,420<br>And that’s perfectly fine because it just</p>
<p>202<br>00:15:00,420 –&gt; 00:15:03,740<br>gets about what actually the where S3 might be.</p>
<p>203<br>00:15:04,740 –&gt; 00:15:07,340<br>And then because there’s no message,</p>
<p>204<br>00:15:07,340 –&gt; 00:15:10,220<br>the leader actually learns that.</p>
<p>205<br>00:15:10,220 –&gt; 00:15:12,620<br>And so in fact, one that gets this no message</p>
<p>206<br>00:15:12,620 –&gt; 00:15:16,259<br>in the unoptimized version.</p>
<p>207<br>00:15:16,259 –&gt; 00:15:19,259<br>So I’m just first talking about the unoptimized version.</p>
<p>208<br>00:15:22,899 –&gt; 00:15:25,980<br>The leader just decrements the next index by one.</p>
<p>209<br>00:15:25,980 –&gt; 00:15:29,139<br>And so it decreends 13 to 12.</p>
<p>210<br>00:15:29,139 –&gt; 00:15:33,259<br>And then we got to what some point will send another append entries.</p>
<p>211<br>00:15:33,299 –&gt; 00:15:35,779<br>And this time around, it will actually say,</p>
<p>212<br>00:15:35,779 –&gt; 00:15:37,419<br>okay, I’ll next in this is 12.</p>
<p>213<br>00:15:37,419 –&gt; 00:15:39,779<br>I’ve got a sense log entry five.</p>
<p>214<br>00:15:41,019 –&gt; 00:15:46,019<br>And the previous term is going to be three.</p>
<p>215<br>00:15:47,340 –&gt; 00:15:51,860<br>And the previous index is going to be 11.</p>
<p>216<br>00:15:53,899 –&gt; 00:15:58,139<br>And so when S3 actually receives this message,</p>
<p>217<br>00:15:58,139 –&gt; 00:15:59,460<br>it checks the previous term.</p>
<p>218<br>00:15:59,460 –&gt; 00:16:02,539<br>It’s three, the previous index is 11, that all works out.</p>
<p>219<br>00:16:02,539 –&gt; 00:16:04,539<br>It sees that it has to append five.</p>
<p>220<br>00:16:04,539 –&gt; 00:16:09,539<br>And so it will erase the four and stick a five in there</p>
<p>221<br>00:16:09,539 –&gt; 00:16:13,299<br>and basically response and yep, good.</p>
<p>222<br>00:16:16,459 –&gt; 00:16:21,459<br>And so at this point, the leader knows</p>
<p>223<br>00:16:21,459 –&gt; 00:16:23,379<br>that actually the log is up to date</p>
<p>224<br>00:16:23,379 –&gt; 00:16:25,939<br>because it got an okay message back.</p>
<p>225<br>00:16:27,500 –&gt; 00:16:29,019<br>So then there’s the second variable</p>
<p>226<br>00:16:29,019 –&gt; 00:16:31,740<br>that plays an important role in all this,</p>
<p>227<br>00:16:31,740 –&gt; 00:16:36,299<br>which is match index, which graph also maintains</p>
<p>228<br>00:16:36,299 –&gt; 00:16:40,500<br>for when the leader also maintains for every faller.</p>
<p>229<br>00:16:40,500 –&gt; 00:16:42,700<br>And so there’s a next index for S3,</p>
<p>230<br>00:16:42,700 –&gt; 00:16:43,980<br>there’s a next index for S1.</p>
<p>231<br>00:16:43,980 –&gt; 00:16:45,700<br>And same alert, there’s a match index</p>
<p>232<br>00:16:45,700 –&gt; 00:16:47,740<br>for S1, S2, S3, too.</p>
<p>233<br>00:16:48,700 –&gt; 00:16:50,180<br>And this one is sort of like you can figure out,</p>
<p>234<br>00:16:50,180 –&gt; 00:16:53,779<br>this is pessimistic, or lower bound.</p>
<p>235<br>00:16:55,299 –&gt; 00:16:58,700<br>So when the leader actually becomes a leader,</p>
<p>236<br>00:16:58,700 –&gt; 00:17:00,580<br>it actually just valid just to zero.</p>
<p>237<br>00:17:02,019 –&gt; 00:17:04,700<br>And to indicate that basically a farjit knows</p>
<p>238<br>00:17:05,740 –&gt; 00:17:09,539<br>the S3 doesn’t really have any log entries at all.</p>
<p>239<br>00:17:10,539 –&gt; 00:17:15,539<br>And so it hasn’t delivered any log entries to the application.</p>
<p>240<br>00:17:15,700 –&gt; 00:17:18,019<br>And so for S2 also has to be very careful</p>
<p>241<br>00:17:18,019 –&gt; 00:17:20,620<br>about what actually it can be delivered to the application.</p>
<p>242<br>00:17:20,620 –&gt; 00:17:22,420<br>Because you know, it needs to know</p>
<p>243<br>00:17:22,420 –&gt; 00:17:25,420<br>that at least the majority of the followers actually has</p>
<p>244<br>00:17:25,420 –&gt; 00:17:28,180<br>a copy of a particular log entry before it can deliver it.</p>
<p>245<br>00:17:29,180 –&gt; 00:17:33,740<br>And so it just starts out to be pessimistic.</p>
<p>246<br>00:17:33,740 –&gt; 00:17:36,620<br>But then once it learns that your example,</p>
<p>247<br>00:17:37,700 –&gt; 00:17:42,539<br>once it learns actually that the follower is okay,</p>
<p>248<br>00:17:42,539 –&gt; 00:17:44,660<br>and we’ve got an okay on the append message,</p>
<p>249<br>00:17:44,660 –&gt; 00:17:48,539<br>it can actually update the pessimistic lower bound</p>
<p>250<br>00:17:48,539 –&gt; 00:17:53,060<br>or the match index from zero to actually 13.</p>
<p>251<br>00:17:53,060 –&gt; 00:17:57,740<br>Because it has learned that the follower is actually</p>
<p>252<br>00:17:57,740 –&gt; 00:18:01,059<br>up to date to 13 and that is the next index</p>
<p>253<br>00:18:01,059 –&gt; 00:18:02,940<br>that is expect is 13.</p>
<p>254<br>00:18:03,900 –&gt; 00:18:05,339<br>And at this point in time, you know,</p>
<p>255<br>00:18:05,339 –&gt; 00:18:07,900<br>basically it has learned from two different,</p>
<p>256<br>00:18:07,900 –&gt; 00:18:11,859<br>in those of the particular log entry five</p>
<p>257<br>00:18:11,859 –&gt; 00:18:14,099<br>is actually now replicated at least in two notes.</p>
<p>258<br>00:18:16,900 –&gt; 00:18:18,660<br>And so you might think, well, it’s good.</p>
<p>259<br>00:18:18,660 –&gt; 00:18:20,819<br>It has been replicated in two notes.</p>
<p>260<br>00:18:20,819 –&gt; 00:18:22,339<br>We can deliver to the application</p>
<p>261<br>00:18:22,339 –&gt; 00:18:24,180<br>because the majority clearly has it</p>
<p>262<br>00:18:24,940 –&gt; 00:18:26,539<br>and we’re in good shape.</p>
<p>263<br>00:18:27,539 –&gt; 00:18:31,500<br>And unfortunately, that actually turns out not to be the case.</p>
<p>264<br>00:18:31,500 –&gt; 00:18:34,420<br>It’s close to true but not completely true.</p>
<p>265<br>00:18:34,420 –&gt; 00:18:38,299<br>And this actually has to do with figure eight.</p>
<p>266<br>00:18:38,299 –&gt; 00:18:39,899<br>So I wanna talk a little bit about figure eight.</p>
<p>267<br>00:18:39,899 –&gt; 00:18:41,779<br>And the real reason what’s going on here</p>
<p>268<br>00:18:41,779 –&gt; 00:18:43,180<br>is what can make this slightly complicated</p>
<p>269<br>00:18:43,180 –&gt; 00:18:44,460<br>and you also should think, you know,</p>
<p>270<br>00:18:44,460 –&gt; 00:18:45,819<br>it’s a little bit fishy.</p>
<p>271<br>00:18:45,819 –&gt; 00:18:49,299<br>So this leader has to just erase a value</p>
<p>272<br>00:18:49,299 –&gt; 00:18:54,299<br>out of the log off S3 and somebody put that in</p>
<p>273<br>00:18:55,299 –&gt; 00:19:00,299<br>and you’re, you know, erasing it seems a little bit dangerous.</p>
<p>274<br>00:19:00,819 –&gt; 00:19:05,500<br>And so it turns out there is a coordinate case</p>
<p>275<br>00:19:06,379 –&gt; 00:19:09,700<br>where you have to be a little bit careful</p>
<p>276<br>00:19:09,700 –&gt; 00:19:12,940<br>by when you deliver, when you declare a message</p>
<p>277<br>00:19:12,940 –&gt; 00:19:13,779<br>actually committed.</p>
<p>278<br>00:19:14,940 –&gt; 00:19:16,500<br>And it turns out that basically,</p>
<p>279<br>00:19:18,899 –&gt; 00:19:21,339<br>so figure eight illustrates that.</p>
<p>280<br>00:19:22,339 –&gt; 00:19:24,179<br>So let me talk a little bit about this,</p>
<p>281<br>00:19:24,179 –&gt; 00:19:27,699<br>erasing log entries.</p>
<p>282<br>00:19:31,539 –&gt; 00:19:33,939<br>And what we will see is that the rule for actually</p>
<p>283<br>00:19:33,939 –&gt; 00:19:35,699<br>when the message can be delivered, you know,</p>
<p>284<br>00:19:35,699 –&gt; 00:19:40,779<br>to the application is slightly more subtle</p>
<p>285<br>00:19:40,779 –&gt; 00:19:44,220<br>than just counting the replicas.</p>
<p>286<br>00:19:47,139 –&gt; 00:19:49,899<br>Let’s see if they get to figure eight, load it in.</p>
<p>287<br>00:19:50,900 –&gt; 00:19:52,140<br>Okay, so here’s figure eight.</p>
<p>288<br>00:19:53,820 –&gt; 00:19:55,820<br>And so this is usual structure.</p>
<p>289<br>00:19:58,980 –&gt; 00:20:00,940<br>Okay, let me get back to the questioning the,</p>
<p>290<br>00:20:02,980 –&gt; 00:20:04,700<br>in the chat in a second.</p>
<p>291<br>00:20:05,980 –&gt; 00:20:07,420<br>So here’s figure eight.</p>
<p>292<br>00:20:07,420 –&gt; 00:20:08,900<br>And so once it was walked through</p>
<p>293<br>00:20:08,900 –&gt; 00:20:10,620<br>what the scenario here is,</p>
<p>294<br>00:20:10,620 –&gt; 00:20:14,019<br>correct in figure A, you know, log in through one</p>
<p>295<br>00:20:14,019 –&gt; 00:20:16,180<br>has been committed by everybody.</p>
<p>296<br>00:20:17,180 –&gt; 00:20:22,180<br>You know, the S1 or S2 became leader in entry in term two.</p>
<p>297<br>00:20:25,539 –&gt; 00:20:27,420<br>They committed or they started</p>
<p>298<br>00:20:27,420 –&gt; 00:20:31,140<br>depending on entry two hasn’t been committed yet</p>
<p>299<br>00:20:31,140 –&gt; 00:20:33,580<br>because it’s not on the majority for sure.</p>
<p>300<br>00:20:33,580 –&gt; 00:20:35,060<br>Then in B, what actually happens,</p>
<p>301<br>00:20:35,060 –&gt; 00:20:37,060<br>you know, S5 must be disconnected,</p>
<p>302<br>00:20:37,060 –&gt; 00:20:39,299<br>has learned of this term two,</p>
<p>303<br>00:20:39,299 –&gt; 00:20:40,980<br>became a leader in term three,</p>
<p>304<br>00:20:40,980 –&gt; 00:20:44,460<br>appended an entry to its log.</p>
<p>305<br>00:20:44,460 –&gt; 00:20:45,500<br>That certainly is not committed</p>
<p>306<br>00:20:45,619 –&gt; 00:20:46,900<br>because there’s no majority.</p>
<p>307<br>00:20:46,900 –&gt; 00:20:51,900<br>Then we end up in C, maybe the S5 actually got disconnected again,</p>
<p>308<br>00:20:53,500 –&gt; 00:20:57,099<br>S1 becomes a leader in term four</p>
<p>309<br>00:20:57,099 –&gt; 00:20:59,380<br>and then starts replicating entry,</p>
<p>310<br>00:20:59,380 –&gt; 00:21:01,779<br>this log entry two to other nodes.</p>
<p>311<br>00:21:02,779 –&gt; 00:21:04,940<br>And in fact, you know,</p>
<p>312<br>00:21:04,940 –&gt; 00:21:07,259<br>it delivers it, you know, it gets back,</p>
<p>313<br>00:21:07,259 –&gt; 00:21:09,380<br>you know, it’s like it’s up to show on the previous slide.</p>
<p>314<br>00:21:10,420 –&gt; 00:21:11,859<br>It knows it’s actually on S2</p>
<p>315<br>00:21:11,859 –&gt; 00:21:13,380<br>and it knows it actually is on S3.</p>
<p>316<br>00:21:14,380 –&gt; 00:21:18,380<br>And in terms of, you know, that actually,</p>
<p>317<br>00:21:18,380 –&gt; 00:21:20,260<br>you might think, okay, well, you know,</p>
<p>318<br>00:21:20,260 –&gt; 00:21:23,460<br>as one knows, you know, that actually,</p>
<p>319<br>00:21:23,460 –&gt; 00:21:26,540<br>the free nodes that actually have a copy</p>
<p>320<br>00:21:26,540 –&gt; 00:21:29,380<br>of this particular entry and so I might be able to deliver it.</p>
<p>321<br>00:21:29,380 –&gt; 00:21:30,940<br>And it turns out that’s not true.</p>
<p>322<br>00:21:32,100 –&gt; 00:21:37,100<br>And there’s a more subtle reasoning</p>
<p>323<br>00:21:37,500 –&gt; 00:21:40,420<br>that needs to happen to actually commit.</p>
<p>324<br>00:21:40,420 –&gt; 00:21:42,540<br>And namely, you can only commit,</p>
<p>325<br>00:21:42,539 –&gt; 00:21:43,379<br>oops, sorry.</p>
<p>326<br>00:21:46,940 –&gt; 00:21:50,940<br>You can commit after the leader has committed</p>
<p>327<br>00:22:00,379 –&gt; 00:22:04,019<br>one entry in its own term.</p>
<p>328<br>00:22:04,299 –&gt; 00:22:05,299<br>And if we think about this,</p>
<p>329<br>00:22:05,299 –&gt; 00:22:06,819<br>it’s going to number two,</p>
<p>330<br>00:22:06,819 –&gt; 00:22:10,139<br>it actually is in term, the leaders in term four.</p>
<p>331<br>00:22:10,139 –&gt; 00:22:14,539<br>And so the commit rule wouldn’t allow actually committing two</p>
<p>332<br>00:22:14,539 –&gt; 00:22:26,500<br>immediately to the surface because that actually is one</p>
<p>333<br>00:22:26,500 –&gt; 00:22:28,700<br>from a previous term and not from the current term.</p>
<p>334<br>00:22:28,700 –&gt; 00:22:31,460<br>And so, for example, your code to decide</p>
<p>335<br>00:22:31,460 –&gt; 00:22:33,980<br>whether actually something can be delivered on the applied channel,</p>
<p>336<br>00:22:34,099 –&gt; 00:22:36,099<br>we need to take that as an account.</p>
<p>337<br>00:22:36,099 –&gt; 00:22:38,180<br>And the reason you need to take the account is illustrated</p>
<p>338<br>00:22:38,180 –&gt; 00:22:39,019<br>by DNA.</p>
<p>339<br>00:22:40,460 –&gt; 00:22:43,740<br>Where basically what can happen is that, you know,</p>
<p>340<br>00:22:43,740 –&gt; 00:22:47,180<br>four, you know, as one actually, you might,</p>
<p>341<br>00:22:48,220 –&gt; 00:22:50,740<br>we might actually end up in a different situation</p>
<p>342<br>00:22:50,740 –&gt; 00:22:55,220<br>where D actually becomes the,</p>
<p>343<br>00:22:56,579 –&gt; 00:22:57,380<br>after,</p>
<p>344<br>00:22:57,620 –&gt; 00:22:58,620<br>you know,</p>
<p>345<br>00:23:00,620 –&gt; 00:23:03,060<br>D actually becomes the leader,</p>
<p>346<br>00:23:03,060 –&gt; 00:23:06,580<br>after, for example, as one of which has been disconnected</p>
<p>347<br>00:23:06,580 –&gt; 00:23:09,780<br>and it might actually start connecting,</p>
<p>348<br>00:23:09,780 –&gt; 00:23:11,220<br>it can form a majority.</p>
<p>349<br>00:23:11,220 –&gt; 00:23:14,820<br>And actually it starts copying its particular,</p>
<p>350<br>00:23:14,820 –&gt; 00:23:16,180<br>its entries to actually,</p>
<p>351<br>00:23:18,700 –&gt; 00:23:22,180<br>it raises the two’s and actually copies it’s free</p>
<p>352<br>00:23:22,180 –&gt; 00:23:24,660<br>in like the entry for its term three</p>
<p>353<br>00:23:24,660 –&gt; 00:23:27,220<br>into whatever it used to be to.</p>
<p>354<br>00:23:27,339 –&gt; 00:23:29,460<br>And this is the raising that we talked about</p>
<p>355<br>00:23:29,460 –&gt; 00:23:30,460<br>on the previous slide.</p>
<p>356<br>00:23:31,819 –&gt; 00:23:36,339<br>And so we’ll see actually that even though T</p>
<p>357<br>00:23:36,339 –&gt; 00:23:38,259<br>was on the majority of the notes,</p>
<p>358<br>00:23:38,259 –&gt; 00:23:40,539<br>what on the majority of notes had got erased.</p>
<p>359<br>00:23:41,500 –&gt; 00:23:45,900<br>And so the rule, and therefore the rule is as stated here</p>
<p>360<br>00:23:45,900 –&gt; 00:23:50,500<br>because once, this is illustrated by E,</p>
<p>361<br>00:23:50,500 –&gt; 00:23:55,299<br>once actually S3, S1, commits an entry in its own term.</p>
<p>362<br>00:23:56,139 –&gt; 00:23:58,180<br>And so it knows that every,</p>
<p>363<br>00:23:58,180 –&gt; 00:24:00,539<br>no, there’s a majority in its own term.</p>
<p>364<br>00:24:00,539 –&gt; 00:24:03,059<br>So at this point, it can actually deliver four,</p>
<p>365<br>00:24:03,059 –&gt; 00:24:04,740<br>you know, through the application.</p>
<p>366<br>00:24:04,740 –&gt; 00:24:06,259<br>And as a result of that,</p>
<p>367<br>00:24:06,259 –&gt; 00:24:09,059<br>you know, any notes that were committed in previous terms</p>
<p>368<br>00:24:09,059 –&gt; 00:24:12,180<br>can also be delivered, you know, to the application.</p>
<p>369<br>00:24:13,180 –&gt; 00:24:15,980<br>And so you see here that there’s a raising with log entries,</p>
<p>370<br>00:24:15,980 –&gt; 00:24:17,180<br>and it basically commits the,</p>
<p>371<br>00:24:17,180 –&gt; 00:24:20,619<br>makes the commit rule quite slightly more complicated.</p>
<p>372<br>00:24:20,619 –&gt; 00:24:22,139<br>And that’s just the design decisions,</p>
<p>373<br>00:24:22,139 –&gt; 00:24:23,779<br>the design of a raft,</p>
<p>374<br>00:24:25,460 –&gt; 00:24:27,940<br>made, and they could have done it differently.</p>
<p>375<br>00:24:27,940 –&gt; 00:24:31,419<br>They could have counted and made basically two survived</p>
<p>376<br>00:24:31,419 –&gt; 00:24:32,419<br>if they wanted to,</p>
<p>377<br>00:24:32,419 –&gt; 00:24:34,379<br>but they decided to go for this particular approach,</p>
<p>378<br>00:24:34,379 –&gt; 00:24:36,779<br>you know, on the grounds that they think it’s simpler.</p>
<p>379<br>00:24:39,740 –&gt; 00:24:43,220<br>Okay, so this is a subtly that will show up,</p>
<p>380<br>00:24:43,220 –&gt; 00:24:46,019<br>you know, in the test cases for the last.</p>
<p>381<br>00:24:46,019 –&gt; 00:24:48,579<br>And so you have to be a little bit careful</p>
<p>382<br>00:24:48,579 –&gt; 00:24:49,659<br>with your commit rule.</p>
<p>383<br>00:24:52,019 –&gt; 00:24:53,740<br>And the given point is correct.</p>
<p>384<br>00:24:56,099 –&gt; 00:25:03,099<br>Okay, so far, you know, if you go back to this particular picture,</p>
<p>385<br>00:25:03,099 –&gt; 00:25:06,379<br>the unoptimized version of this protocol</p>
<p>386<br>00:25:08,059 –&gt; 00:25:11,220<br>is a little bit of a bummer, right?</p>
<p>387<br>00:25:11,220 –&gt; 00:25:14,259<br>Like if you think a little bit about this,</p>
<p>388<br>00:25:14,259 –&gt; 00:25:18,659<br>let’s look at actually what happens with S1.</p>
<p>389<br>00:25:20,180 –&gt; 00:25:22,980<br>So let’s say, let me switch things.</p>
<p>390<br>00:25:23,140 –&gt; 00:25:25,500<br>Let’s say S2 tries to bring S1 up today,</p>
<p>391<br>00:25:25,500 –&gt; 00:25:27,299<br>you can all do the same thing,</p>
<p>392<br>00:25:27,299 –&gt; 00:25:29,059<br>you know, send in a pen entries, you know,</p>
<p>393<br>00:25:29,059 –&gt; 00:25:32,299<br>with Nail entries, pass term, you know,</p>
<p>394<br>00:25:32,299 –&gt; 00:25:34,140<br>previous term to be five.</p>
<p>395<br>00:25:36,539 –&gt; 00:25:41,539<br>And previous index to be 12, it will say no, right?</p>
<p>396<br>00:25:43,460 –&gt; 00:25:44,620<br>I’ll actually use that index,</p>
<p>397<br>00:25:44,620 –&gt; 00:25:48,500<br>you know, previous index is actually a 10 with term free.</p>
<p>398<br>00:25:48,500 –&gt; 00:25:49,339<br>So it will,</p>
<p>399<br>00:25:50,339 –&gt; 00:25:54,339<br>this guy will decrease its next index going from 13 to 12.</p>
<p>400<br>00:25:56,819 –&gt; 00:25:59,459<br>Then we’ll do the same thing again, you know,</p>
<p>401<br>00:25:59,459 –&gt; 00:26:03,259<br>we’ll send, I guess it’s going to send five,</p>
<p>402<br>00:26:03,259 –&gt; 00:26:07,299<br>the lock entry five, it will send the previous term to be free.</p>
<p>403<br>00:26:07,299 –&gt; 00:26:10,779<br>And index, previous index to be 11.</p>
<p>404<br>00:26:10,779 –&gt; 00:26:13,139<br>It’s going to get a no back.</p>
<p>405<br>00:26:13,139 –&gt; 00:26:15,939<br>You know, then the index goes to 12 to 11.</p>
<p>406<br>00:26:16,939 –&gt; 00:26:19,139<br>And now basically it’s going to work.</p>
<p>407<br>00:26:19,259 –&gt; 00:26:20,780<br>And so what we see here that basically</p>
<p>408<br>00:26:20,780 –&gt; 00:26:23,820<br>for every lock entry, we’re going to have a round trip,</p>
<p>409<br>00:26:23,820 –&gt; 00:26:26,140<br>you know, sort of one of these append entries.</p>
<p>410<br>00:26:26,140 –&gt; 00:26:29,220<br>And turns out, you know, that can be expensive.</p>
<p>411<br>00:26:29,220 –&gt; 00:26:30,540<br>Like left through,</p>
<p>412<br>00:26:30,540 –&gt; 00:26:31,860<br>and the real question is like, you know,</p>
<p>413<br>00:26:31,860 –&gt; 00:26:34,420<br>can the follower be far, far behind?</p>
<p>414<br>00:26:35,500 –&gt; 00:26:36,940<br>Yeah, and let me ask that,</p>
<p>415<br>00:26:36,940 –&gt; 00:26:38,020<br>we’re positive for a second,</p>
<p>416<br>00:26:38,020 –&gt; 00:26:41,220<br>and so you can reflect and think about that case.</p>
<p>417<br>00:26:41,220 –&gt; 00:26:44,540<br>Is this possible that the follower can be far, far behind</p>
<p>418<br>00:26:44,540 –&gt; 00:26:45,900<br>for a given leader?</p>
<p>419<br>00:26:49,540 –&gt; 00:26:52,140<br>If a new machine joins the cluster.</p>
<p>420<br>00:26:52,140 –&gt; 00:26:54,580<br>Yeah, if a new machine joins the cluster,</p>
<p>421<br>00:26:54,580 –&gt; 00:26:56,140<br>there’s a good example, any other cases?</p>
<p>422<br>00:26:57,940 –&gt; 00:27:00,340<br>A machine crashed and is only coming back online</p>
<p>423<br>00:27:00,340 –&gt; 00:27:01,780<br>after several terms?</p>
<p>424<br>00:27:01,780 –&gt; 00:27:03,060<br>Yeah, exactly.</p>
<p>425<br>00:27:03,060 –&gt; 00:27:04,860<br>It comes back after a day, right?</p>
<p>426<br>00:27:04,860 –&gt; 00:27:07,060<br>So it might be far, far behind.</p>
<p>427<br>00:27:07,060 –&gt; 00:27:09,300<br>And so that would mean like in the vertical,</p>
<p>428<br>00:27:09,300 –&gt; 00:27:11,259<br>and I’m an optimized version that you’re going to go back</p>
<p>429<br>00:27:11,259 –&gt; 00:27:13,380<br>one by one from the lock entry.</p>
<p>430<br>00:27:13,380 –&gt; 00:27:15,020<br>And so that’s a little bit expensive.</p>
<p>431<br>00:27:15,020 –&gt; 00:27:18,420<br>And so the paper actually discusses an optimization.</p>
<p>432<br>00:27:18,420 –&gt; 00:27:19,779<br>So to catch up quickly.</p>
<p>433<br>00:27:30,900 –&gt; 00:27:35,900<br>And the idea basically is instead of like backing off,</p>
<p>434<br>00:27:38,980 –&gt; 00:27:41,740<br>so suddenly the next index is basically optimistic.</p>
<p>435<br>00:27:41,740 –&gt; 00:27:42,740<br>It just gets, right?</p>
<p>436<br>00:27:42,740 –&gt; 00:27:45,580<br>And it doesn’t really have to be that accurate.</p>
<p>437<br>00:27:46,419 –&gt; 00:27:49,419<br>And so the optimization is that we don’t really</p>
<p>438<br>00:27:49,419 –&gt; 00:27:51,179<br>have to go one by one back.</p>
<p>439<br>00:27:51,179 –&gt; 00:27:53,899<br>It’s perfectly fine, for example, to go a whole turn back.</p>
<p>440<br>00:27:53,899 –&gt; 00:27:58,220<br>And in fact, the logical maybe that is the node.</p>
<p>441<br>00:27:58,220 –&gt; 00:27:59,819<br>It’s a couple of terms back.</p>
<p>442<br>00:27:59,819 –&gt; 00:28:01,299<br>And so we back off a couple of terms,</p>
<p>443<br>00:28:01,299 –&gt; 00:28:04,379<br>and then we’ll skin from there.</p>
<p>444<br>00:28:04,379 –&gt; 00:28:07,579<br>So to illustrate a little bit how that works,</p>
<p>445<br>00:28:07,579 –&gt; 00:28:09,980<br>when you use the following sample.</p>
<p>446<br>00:28:09,980 –&gt; 00:28:12,859<br>And I’m just going to two servers, even though there might</p>
<p>447<br>00:28:12,859 –&gt; 00:28:15,019<br>be a meat free, two or a half majority,</p>
<p>448<br>00:28:15,019 –&gt; 00:28:17,019<br>but let’s assume there’s a third one.</p>
<p>449<br>00:28:17,019 –&gt; 00:28:19,740<br>And it just plays happily along.</p>
<p>450<br>00:28:19,740 –&gt; 00:28:23,460<br>So here’s S1, here’s S2.</p>
<p>451<br>00:28:23,460 –&gt; 00:28:33,779<br>And let’s see, this guy has 5, 5, 5, 4, 5.</p>
<p>452<br>00:28:33,779 –&gt; 00:28:39,660<br>And this is 1, 2, 3, 4, 5, indexes.</p>
<p>453<br>00:28:40,540 –&gt; 00:28:47,460<br>Let’s say this S2 has four, basically, all sixes.</p>
<p>454<br>00:28:47,460 –&gt; 00:28:50,820<br>So basically, S1 is quite wide, correct?</p>
<p>455<br>00:28:50,820 –&gt; 00:28:52,580<br>Because I’ve been only placed where</p>
<p>456<br>00:28:52,580 –&gt; 00:28:55,220<br>the action line up is in the first entry,</p>
<p>457<br>00:28:55,220 –&gt; 00:28:58,540<br>in the first four, which has turned four.</p>
<p>458<br>00:28:58,540 –&gt; 00:29:01,340<br>And so in the unoptimized scheme, we would back off</p>
<p>459<br>00:29:01,340 –&gt; 00:29:06,060<br>like one by one, one by one, until we finally got there.</p>
<p>460<br>00:29:06,059 –&gt; 00:29:10,619<br>To optimize this, the paper describes an optimization.</p>
<p>461<br>00:29:10,619 –&gt; 00:29:12,299<br>Unfortunately, the optimization is not</p>
<p>462<br>00:29:12,299 –&gt; 00:29:15,139<br>as described in the same amount of detail as a figure 2.</p>
<p>463<br>00:29:15,139 –&gt; 00:29:18,259<br>And so in fact, if you get a URL for 2C,</p>
<p>464<br>00:29:18,259 –&gt; 00:29:20,179<br>it actually passed 2C, you do actually have</p>
<p>465<br>00:29:20,179 –&gt; 00:29:24,419<br>to have this optimisation of volume of this optimization</p>
<p>466<br>00:29:24,419 –&gt; 00:29:25,179<br>implemented.</p>
<p>467<br>00:29:25,179 –&gt; 00:29:27,059<br>But you’re reasonable free, actually, how to implement it.</p>
<p>468<br>00:29:27,059 –&gt; 00:29:29,460<br>Because the paper action doesn’t describe very precisely</p>
<p>469<br>00:29:29,460 –&gt; 00:29:30,659<br>which, how you should do it, then you</p>
<p>470<br>00:29:30,659 –&gt; 00:29:32,460<br>will have to do a little bit of work.</p>
<p>471<br>00:29:32,460 –&gt; 00:29:35,139<br>But the basic idea is just follows.</p>
<p>472<br>00:29:35,140 –&gt; 00:29:38,660<br>And just instead of just voting, or just saying no, or yes,</p>
<p>473<br>00:29:38,660 –&gt; 00:29:43,420<br>as we on the previous slide, the rejection,</p>
<p>474<br>00:29:43,420 –&gt; 00:29:46,220<br>so you say no, the rejection includes</p>
<p>475<br>00:29:46,220 –&gt; 00:29:47,660<br>a little bit of more information.</p>
<p>476<br>00:29:47,660 –&gt; 00:29:50,620<br>And that information is going to help the leader</p>
<p>477<br>00:29:50,620 –&gt; 00:29:53,220<br>to basically back off quicker.</p>
<p>478<br>00:29:53,220 –&gt; 00:29:56,259<br>And so it includes something about the call,</p>
<p>479<br>00:29:56,259 –&gt; 00:29:59,820<br>the conflicting term, in the response,</p>
<p>480<br>00:29:59,820 –&gt; 00:30:01,020<br>and the conflicting index.</p>
<p>481<br>00:30:01,299 –&gt; 00:30:10,940<br>And the conflicting term is basically the if,</p>
<p>482<br>00:30:10,940 –&gt; 00:30:13,220<br>let me actually make this a little bit more clear.</p>
<p>483<br>00:30:13,220 –&gt; 00:30:18,259<br>Let’s say we’re S1, the timeline, here’s S2.</p>
<p>484<br>00:30:18,259 –&gt; 00:30:21,420<br>So S2 sense of, you know, is elected leader in 7,</p>
<p>485<br>00:30:21,420 –&gt; 00:30:21,940<br>correct?</p>
<p>486<br>00:30:21,940 –&gt; 00:30:24,779<br>Because it has the most up-to-date log.</p>
<p>487<br>00:30:24,779 –&gt; 00:30:28,339<br>It sends a message to S1, a heartbeat.</p>
<p>488<br>00:30:28,339 –&gt; 00:30:31,179<br>And in the heartbeat, it will say, you know,</p>
<p>489<br>00:30:31,179 –&gt; 00:30:36,179<br>the previous term was 6.</p>
<p>490<br>00:30:36,179 –&gt; 00:30:42,740<br>And the previous index was 5.</p>
<p>491<br>00:30:42,740 –&gt; 00:30:45,740<br>And now when S1 gets this, you know, it looks at this log,</p>
<p>492<br>00:30:45,740 –&gt; 00:30:49,019<br>and it sees that actually the previous term was 5.</p>
<p>493<br>00:30:49,019 –&gt; 00:30:52,659<br>And so instead of actually, and so it will include in response,</p>
<p>494<br>00:30:52,659 –&gt; 00:30:55,579<br>you know, the conflicting term, the term where it</p>
<p>495<br>00:30:55,579 –&gt; 00:30:58,740<br>conflicts on in that index, and that was 5.</p>
<p>496<br>00:30:58,740 –&gt; 00:31:00,299<br>We’re going to find a entry.</p>
<p>497<br>00:31:00,299 –&gt; 00:31:04,659<br>And then it also includes what the first index of that term</p>
<p>498<br>00:31:04,659 –&gt; 00:31:05,539<br>is in this log.</p>
<p>499<br>00:31:05,539 –&gt; 00:31:08,419<br>So we look at this term, like a 555.</p>
<p>500<br>00:31:08,419 –&gt; 00:31:10,579<br>And the first time, like the index 5 showed up,</p>
<p>501<br>00:31:10,579 –&gt; 00:31:12,179<br>it’s a log is at the index 2.</p>
<p>502<br>00:31:12,179 –&gt; 00:31:14,179<br>And so it will include that 2.</p>
<p>503<br>00:31:14,179 –&gt; 00:31:17,019<br>And we’ll send that back to the leader.</p>
<p>504<br>00:31:17,019 –&gt; 00:31:19,220<br>So here’s S2, which is our leader.</p>
<p>505<br>00:31:19,220 –&gt; 00:31:22,859<br>And so we’re going to send back, you know, 5,</p>
<p>506<br>00:31:22,859 –&gt; 00:31:26,179<br>comma 2, that’s the conflicting information.</p>
<p>507<br>00:31:26,179 –&gt; 00:31:30,740<br>And the leader uses that information to basically skip</p>
<p>508<br>00:31:30,740 –&gt; 00:31:32,459<br>back or trigger, in fact, you know, it</p>
<p>509<br>00:31:32,459 –&gt; 00:31:33,699<br>skips back, you know, from.</p>
<p>510<br>00:31:33,699 –&gt; 00:31:42,699<br>So initially, its guess was next index for S1 was 6.</p>
<p>511<br>00:31:42,699 –&gt; 00:31:44,219<br>And based on this information,</p>
<p>512<br>00:31:44,219 –&gt; 00:31:46,379<br>that extra scales it back to 2.</p>
<p>513<br>00:31:46,379 –&gt; 00:31:48,059<br>So it turns it into 2.</p>
<p>514<br>00:31:48,059 –&gt; 00:31:50,819<br>And then the next appendentries is going</p>
<p>515<br>00:31:50,819 –&gt; 00:31:54,019<br>to include everything from 2.</p>
<p>516<br>00:31:54,019 –&gt; 00:31:58,259<br>So it’s going to include 5, 5, 5.</p>
<p>517<br>00:31:58,259 –&gt; 00:32:01,059<br>And previous term is 4.</p>
<p>518<br>00:32:01,059 –&gt; 00:32:04,779<br>And previous index is 1.</p>
<p>519<br>00:32:04,779 –&gt; 00:32:08,460<br>And now S1, one swap, all swap, basically copy,</p>
<p>520<br>00:32:08,460 –&gt; 00:32:10,500<br>you know, the new log entries over, you know,</p>
<p>521<br>00:32:10,500 –&gt; 00:32:14,379<br>the entries 2, 3, 4, 5, and that’s in the back of the date.</p>
<p>522<br>00:32:14,379 –&gt; 00:32:16,859<br>And so this basically, you know, reduces the number of sort</p>
<p>523<br>00:32:16,859 –&gt; 00:32:19,619<br>of hard beats, you know, to catch up,</p>
<p>524<br>00:32:19,619 –&gt; 00:32:23,059<br>a follower by one per term instead of one per entry.</p>
<p>525<br>00:32:31,019 –&gt; 00:32:33,619<br>Any questions?</p>
<p>526<br>00:32:33,619 –&gt; 00:32:36,379<br>How do we make sure that we don’t, you know,</p>
<p>527<br>00:32:36,379 –&gt; 00:32:37,500<br>overload the bandwidth?</p>
<p>528<br>00:32:37,500 –&gt; 00:32:40,059<br>Is it imagine if you have like a, if you’re</p>
<p>529<br>00:32:40,059 –&gt; 00:32:42,459<br>trying to send back like all of these log entries,</p>
<p>530<br>00:32:42,459 –&gt; 00:32:44,579<br>could that cause problems in terms of like packets</p>
<p>531<br>00:32:44,579 –&gt; 00:32:46,179<br>that are too large?</p>
<p>532<br>00:32:46,179 –&gt; 00:32:48,179<br>Yeah, sort of a great question.</p>
<p>533<br>00:32:48,460 –&gt; 00:32:51,700<br>And because it sort of indicates an alternative scheme,</p>
<p>534<br>00:32:51,700 –&gt; 00:32:56,900<br>that you know, back here is that instead of actually making</p>
<p>535<br>00:32:56,900 –&gt; 00:32:59,779<br>this optimistic guess, you know, why make a guess at all?</p>
<p>536<br>00:32:59,779 –&gt; 00:33:01,220<br>Just send everything.</p>
<p>537<br>00:33:01,220 –&gt; 00:33:03,820<br>The leader could have sent like, though, it’s whole log</p>
<p>538<br>00:33:03,820 –&gt; 00:33:04,860<br>and it would be perfectly fine.</p>
<p>539<br>00:33:04,860 –&gt; 00:33:06,779<br>And then basically, you know, any of the followers</p>
<p>540<br>00:33:06,779 –&gt; 00:33:09,019<br>can sort of fish out the ones they need, right?</p>
<p>541<br>00:33:11,700 –&gt; 00:33:14,220<br>And then we’d be in an alternative implementation.</p>
<p>542<br>00:33:14,220 –&gt; 00:33:17,180<br>And presumably we don’t like that implementation,</p>
<p>543<br>00:33:17,180 –&gt; 00:33:21,539<br>because the log might be large and that would be problematic.</p>
<p>544<br>00:33:22,700 –&gt; 00:33:25,700<br>So I think, you know, the basic guess here that’s going on</p>
<p>545<br>00:33:25,700 –&gt; 00:33:30,700<br>is that in the normal, in the typical situations,</p>
<p>546<br>00:33:30,700 –&gt; 00:33:33,779<br>the followers are, you know, hopefully reasonable close</p>
<p>547<br>00:33:33,779 –&gt; 00:33:34,620<br>together.</p>
<p>548<br>00:33:34,620 –&gt; 00:33:37,820<br>And so backing off a couple of entries is extra sufficient.</p>
<p>549<br>00:33:37,820 –&gt; 00:33:39,940<br>And if not, then, you know, we might as well back</p>
<p>550<br>00:33:39,940 –&gt; 00:33:43,460<br>of one term, but not all terms.</p>
<p>551<br>00:33:43,460 –&gt; 00:33:46,620<br>And so we’ll send the log entries for one term.</p>
<p>552<br>00:33:46,859 –&gt; 00:33:47,819<br>That might be a log.</p>
<p>553<br>00:33:47,819 –&gt; 00:33:48,939<br>Right. That might be a lot.</p>
<p>554<br>00:33:48,939 –&gt; 00:33:51,139<br>And we’ll see in a second, like, how we get around that, right?</p>
<p>555<br>00:33:51,139 –&gt; 00:33:54,699<br>Like, snapshotting is going to help reducing the number</p>
<p>556<br>00:33:54,699 –&gt; 00:33:56,379<br>of log entries that we have to send.</p>
<p>557<br>00:33:59,619 –&gt; 00:34:01,419<br>So there was question of do you need to implement this sort</p>
<p>558<br>00:34:01,419 –&gt; 00:34:05,139<br>of a version of this optimization scheme in lab 2C?</p>
<p>559<br>00:34:05,139 –&gt; 00:34:05,939<br>And yes, yes.</p>
<p>560<br>00:34:07,099 –&gt; 00:34:09,940<br>At least I believe I haven’t been able to pass the test</p>
<p>561<br>00:34:09,940 –&gt; 00:34:11,940<br>without implementing some optimization.</p>
<p>562<br>00:34:12,940 –&gt; 00:34:14,940<br>So I have a question.</p>
<p>563<br>00:34:14,940 –&gt; 00:34:19,940<br>So I, in my code, I did the optimization by backing off</p>
<p>564<br>00:34:19,940 –&gt; 00:34:20,940<br>to, like, to the commit.</p>
<p>565<br>00:34:20,940 –&gt; 00:34:25,940<br>So I made the reply, include the last commit index.</p>
<p>566<br>00:34:25,940 –&gt; 00:34:27,940<br>And then I started from there.</p>
<p>567<br>00:34:27,940 –&gt; 00:34:29,940<br>Is that much worse?</p>
<p>568<br>00:34:29,940 –&gt; 00:34:34,940<br>I do mind running trouble in the, so that the tests keep track</p>
<p>569<br>00:34:34,940 –&gt; 00:34:37,940<br>of how many bytes you sent and gives you a budget.</p>
<p>570<br>00:34:37,940 –&gt; 00:34:40,940<br>And if you’re like, I go across the board,</p>
<p>571<br>00:34:40,940 –&gt; 00:34:43,940<br>I go across the budget, you know, by too much.</p>
<p>572<br>00:34:43,940 –&gt; 00:34:48,940<br>Then the test will say, like, well, you’re just sending too much data.</p>
<p>573<br>00:34:48,940 –&gt; 00:34:50,940<br>Yes.</p>
<p>574<br>00:34:50,940 –&gt; 00:34:53,940<br>Because in your scheme, it might be the case that I think you will send</p>
<p>575<br>00:34:53,940 –&gt; 00:34:55,940<br>more data than really necessary.</p>
<p>576<br>00:34:55,940 –&gt; 00:34:57,940<br>Whatever necessary means.</p>
<p>577<br>00:34:57,940 –&gt; 00:35:00,940<br>But.</p>
<p>578<br>00:35:00,940 –&gt; 00:35:02,940<br>There is a question in chat.</p>
<p>579<br>00:35:02,940 –&gt; 00:35:03,940<br>Yeah.</p>
<p>580<br>00:35:03,940 –&gt; 00:35:05,940<br>Did I say draw the wrong thing?</p>
<p>581<br>00:35:05,940 –&gt; 00:35:06,940<br>Yeah, 6666.</p>
<p>582<br>00:35:06,940 –&gt; 00:35:07,940<br>Sorry.</p>
<p>583<br>00:35:07,940 –&gt; 00:35:09,940<br>Thank you.</p>
<p>584<br>00:35:09,940 –&gt; 00:35:16,940<br>I don’t want to follow or rain the leaders.</p>
<p>585<br>00:35:16,940 –&gt; 00:35:18,940<br>Mark Andrews.</p>
<p>586<br>00:35:18,940 –&gt; 00:35:19,940<br>Sorry about that.</p>
<p>587<br>00:35:19,940 –&gt; 00:35:23,940<br>Good catch.</p>
<p>588<br>00:35:23,940 –&gt; 00:35:32,940<br>Any questions?</p>
<p>589<br>00:35:32,940 –&gt; 00:35:33,940<br>Okay.</p>
<p>590<br>00:35:33,940 –&gt; 00:35:39,940<br>Okay.</p>
<p>591<br>00:35:39,940 –&gt; 00:35:40,940<br>Okay.</p>
<p>592<br>00:35:40,940 –&gt; 00:35:44,940<br>So the, when you talk a little bit about the persistence.</p>
<p>593<br>00:35:44,940 –&gt; 00:35:47,940<br>We have one question in the chat first.</p>
<p>594<br>00:35:47,940 –&gt; 00:35:48,940<br>Okay.</p>
<p>595<br>00:35:48,940 –&gt; 00:35:52,940<br>They’re wondering why the rejection has send back the rejected term</p>
<p>596<br>00:35:52,940 –&gt; 00:35:56,940<br>number as well as the index.</p>
<p>597<br>00:35:56,940 –&gt; 00:36:01,940<br>Well, that depends very much how you actually implement the,</p>
<p>598<br>00:36:01,940 –&gt; 00:36:07,940<br>how what kind of state you maintain on the leader and how the leader decides to back off.</p>
<p>599<br>00:36:07,940 –&gt; 00:36:13,940<br>You need to know, send some terms back because you need to explore.</p>
<p>600<br>00:36:13,940 –&gt; 00:36:16,940<br>If you’re in response to get delayed for a long period of time,</p>
<p>601<br>00:36:16,940 –&gt; 00:36:22,940<br>you certainly should reject, you know, information from terms that are completely not relevant anymore.</p>
<p>602<br>00:36:22,940 –&gt; 00:36:24,940<br>So.</p>
<p>603<br>00:36:24,940 –&gt; 00:36:30,940<br>I know this is slightly vague answer, but it really very much dependent on the jacket, how you implement it.</p>
<p>604<br>00:36:30,940 –&gt; 00:36:38,940<br>Okay.</p>
<p>605<br>00:36:38,940 –&gt; 00:36:45,940<br>Persistence.</p>
<p>606<br>00:36:45,940 –&gt; 00:36:49,940<br>We talked about persistence a little bit.</p>
<p>607<br>00:36:49,940 –&gt; 00:36:55,940<br>In the last draft of the first draft lecture, we’re, you know, we noted that, you know, the,</p>
<p>608<br>00:36:55,940 –&gt; 00:37:00,940<br>but the state that we all are can only vote for one candidate in a per term.</p>
<p>609<br>00:37:00,940 –&gt; 00:37:02,940<br>And therefore, it needs to remember.</p>
<p>610<br>00:37:02,940 –&gt; 00:37:06,940<br>It’s, you would vote for in what actually recurrent term is.</p>
<p>611<br>00:37:06,940 –&gt; 00:37:11,940<br>But there is a sort of a larger issue around persistence.</p>
<p>612<br>00:37:12,940 –&gt; 00:37:17,940<br>And that came up in one of the questions you’re one of you just asked, which is.</p>
<p>613<br>00:37:17,940 –&gt; 00:37:21,940<br>You know, what happens on reboot.</p>
<p>614<br>00:37:21,940 –&gt; 00:37:25,019<br>There’s two possible strategy you could think of.</p>
<p>615<br>00:37:25,019 –&gt; 00:37:36,139<br>One strategy is strategy one is basically the node joins</p>
<p>616<br>00:37:36,139 –&gt; 00:37:37,980<br>sort of freshly.</p>
<p>617<br>00:37:37,980 –&gt; 00:37:40,059<br>So, of joins.</p>
<p>618<br>00:37:40,059 –&gt; 00:37:44,780<br>Basically, when a node crashes and comes back up,</p>
<p>619<br>00:37:44,780 –&gt; 00:37:46,220<br>it’s just doesn’t participate anymore.</p>
<p>620<br>00:37:46,220 –&gt; 00:37:51,700<br>It has to rejoin the raft cluster.</p>
<p>621<br>00:37:52,500 –&gt; 00:37:59,380<br>And that means, you know, when a rejoin should have to replay the log,</p>
<p>622<br>00:37:59,380 –&gt; 00:38:02,380<br>where it basically has to receive every entry in the log,</p>
<p>623<br>00:38:02,380 –&gt; 00:38:05,780<br>and then, you know, replay that.</p>
<p>624<br>00:38:05,780 –&gt; 00:38:10,220<br>And of course, you know, like if a node has been down,</p>
<p>625<br>00:38:10,220 –&gt; 00:38:13,300<br>or you know, a node crashes and is down for a day or two days,</p>
<p>626<br>00:38:13,300 –&gt; 00:38:16,340<br>or even if it just goes down for a second,</p>
<p>627<br>00:38:16,340 –&gt; 00:38:19,099<br>but, you know, the system has been up for a year,</p>
<p>628<br>00:38:19,139 –&gt; 00:38:22,420<br>that number mean, like, you have to replay a lot of log entries.</p>
<p>629<br>00:38:22,420 –&gt; 00:38:23,779<br>And so, that’s a little bit annoying.</p>
<p>630<br>00:38:23,779 –&gt; 00:38:28,059<br>And so, people prefer that strategy two, which is,</p>
<p>631<br>00:38:29,059 –&gt; 00:38:30,259<br>you know, you come back up,</p>
<p>632<br>00:38:31,940 –&gt; 00:38:34,179<br>and you just basically participate again.</p>
<p>633<br>00:38:35,500 –&gt; 00:38:37,940<br>So, you catch up from, you know, you basically,</p>
<p>634<br>00:38:37,940 –&gt; 00:38:40,059<br>you start from your persistent state.</p>
<p>635<br>00:38:50,099 –&gt; 00:38:52,179<br>And the idea being that, you know,</p>
<p>636<br>00:38:52,179 –&gt; 00:38:54,059<br>it’s just a quick reboot, you crash,</p>
<p>637<br>00:38:54,059 –&gt; 00:38:54,980<br>you come back up on the way,</p>
<p>638<br>00:38:54,980 –&gt; 00:38:57,219<br>or it was a quick network failure.</p>
<p>639<br>00:38:57,219 –&gt; 00:38:59,099<br>And so, maybe, you know, the rest, you know,</p>
<p>640<br>00:38:59,099 –&gt; 00:39:03,139<br>moved one term along, you basically have all the state,</p>
<p>641<br>00:39:03,139 –&gt; 00:39:06,179<br>and you know, should be reasonable quick to catch up.</p>
<p>642<br>00:39:06,179 –&gt; 00:39:08,699<br>So, then the real question is, like, what needs to be,</p>
<p>643<br>00:39:08,699 –&gt; 00:39:12,099<br>what state needs to be persistent across reboots?</p>
<p>644<br>00:39:12,980 –&gt; 00:39:15,900<br>On, you know, where did he talk about voted for?</p>
<p>645<br>00:39:15,900 –&gt; 00:39:17,460<br>That needs to be persistent.</p>
<p>646<br>00:39:19,819 –&gt; 00:39:21,339<br>Because you are not allowed, you know,</p>
<p>647<br>00:39:21,339 –&gt; 00:39:25,699<br>to vote for another candidate in the same term.</p>
<p>648<br>00:39:27,259 –&gt; 00:39:28,860<br>And, but the, the rafting obtains</p>
<p>649<br>00:39:28,860 –&gt; 00:39:30,339<br>a little bit more information.</p>
<p>650<br>00:39:30,339 –&gt; 00:39:35,339<br>It also maintains the log on disk or inconsistent state</p>
<p>651<br>00:39:35,699 –&gt; 00:39:37,579<br>and the current term.</p>
<p>652<br>00:39:42,980 –&gt; 00:39:45,659<br>And for each one, we should ask ourselves the question,</p>
<p>653<br>00:39:46,659 –&gt; 00:39:49,819<br>you know, why you maintain a persistent state?</p>
<p>654<br>00:39:49,819 –&gt; 00:39:53,179<br>Because like, it means that whenever we update that state,</p>
<p>655<br>00:39:53,179 –&gt; 00:39:56,099<br>you know, whenever we append an entry to the log,</p>
<p>656<br>00:39:56,099 –&gt; 00:39:58,420<br>or whenever we increment the term,</p>
<p>657<br>00:39:58,420 –&gt; 00:40:00,819<br>or you know, whenever we change forward of work,</p>
<p>658<br>00:40:00,819 –&gt; 00:40:02,819<br>we actually have to write the disk and,</p>
<p>659<br>00:40:02,819 –&gt; 00:40:03,899<br>or through stable storage.</p>
<p>660<br>00:40:03,899 –&gt; 00:40:05,619<br>And the stable storage is expensive.</p>
<p>661<br>00:40:05,619 –&gt; 00:40:08,099<br>And so, it’s very likely that, like,</p>
<p>662<br>00:40:08,099 –&gt; 00:40:13,099<br>for example, the writing to stable storage could be,</p>
<p>663<br>00:40:13,099 –&gt; 00:40:14,339<br>it could be become a bottleneck.</p>
<p>664<br>00:40:15,940 –&gt; 00:40:17,339<br>So, we’re already talking about voting for,</p>
<p>665<br>00:40:17,339 –&gt; 00:40:18,339<br>so I’m not going to cover again,</p>
<p>666<br>00:40:18,339 –&gt; 00:40:19,859<br>but let’s talk about the log.</p>
<p>667<br>00:40:19,859 –&gt; 00:40:21,579<br>You know, why does the log have to be written</p>
<p>668<br>00:40:21,579 –&gt; 00:40:22,899<br>through persistent storage?</p>
<p>669<br>00:40:24,819 –&gt; 00:40:26,059<br>And we re-integrate.</p>
<p>670<br>00:40:38,940 –&gt; 00:40:41,019<br>Another way of asking, let’s say we don’t write</p>
<p>671<br>00:40:41,019 –&gt; 00:40:42,980<br>if you’re stable storage, what would break?</p>
<p>672<br>00:40:45,659 –&gt; 00:40:46,659<br>Okay.</p>
<p>673<br>00:40:55,460 –&gt; 00:40:56,299<br>Yeah.</p>
<p>674<br>00:40:56,299 –&gt; 00:40:57,299<br>And someone need to chat,</p>
<p>675<br>00:40:57,299 –&gt; 00:40:59,420<br>to just answer this question in which</p>
<p>676<br>00:40:59,420 –&gt; 00:41:01,500<br>you could lose the majority on the commit at right entries.</p>
<p>677<br>00:41:01,500 –&gt; 00:41:02,579<br>Right?</p>
<p>678<br>00:41:02,579 –&gt; 00:41:04,420<br>So, like, here’s the scenario.</p>
<p>679<br>00:41:05,500 –&gt; 00:41:10,339<br>The graph replicated the operation</p>
<p>680<br>00:41:10,339 –&gt; 00:41:12,379<br>on a majority of the nodes.</p>
<p>681<br>00:41:12,380 –&gt; 00:41:14,660<br>So somebody, you know,</p>
<p>682<br>00:41:14,660 –&gt; 00:41:17,180<br>what George of the know is actually committed</p>
<p>683<br>00:41:17,180 –&gt; 00:41:19,220<br>to actually delivering,</p>
<p>684<br>00:41:19,220 –&gt; 00:41:20,619<br>and we haven’t delivered,</p>
<p>685<br>00:41:20,619 –&gt; 00:41:23,720<br>having accepted that log entry.</p>
<p>686<br>00:41:23,720 –&gt; 00:41:26,980<br>So the leader sees the commitments,</p>
<p>687<br>00:41:26,980 –&gt; 00:41:29,300<br>he delivers the message with their operation</p>
<p>688<br>00:41:29,300 –&gt; 00:41:31,180<br>on the applied channel to the surface,</p>
<p>689<br>00:41:31,180 –&gt; 00:41:33,660<br>the service after the activity operation,</p>
<p>690<br>00:41:33,660 –&gt; 00:41:36,220<br>and lets the client know the operation has succeeded.</p>
<p>691<br>00:41:37,740 –&gt; 00:41:40,380<br>So now, you know, basically we exposed the fact</p>
<p>692<br>00:41:40,380 –&gt; 00:41:42,900<br>that this action operation was actually</p>
<p>693<br>00:41:42,900 –&gt; 00:41:45,539<br>replicated in the majority of the know, it’s to the client.</p>
<p>694<br>00:41:45,539 –&gt; 00:41:48,380<br>And so it will not, if the followers</p>
<p>695<br>00:41:48,380 –&gt; 00:41:50,940<br>that actually received that entry did not put it on,</p>
<p>696<br>00:41:50,940 –&gt; 00:41:51,940<br>first on disk,</p>
<p>697<br>00:41:52,820 –&gt; 00:41:56,780<br>and so that when they reboot, they still have it,</p>
<p>698<br>00:41:56,780 –&gt; 00:41:57,980<br>we could run into the case,</p>
<p>699<br>00:41:57,980 –&gt; 00:42:00,019<br>and that in exactly as the entry in the chat,</p>
<p>700<br>00:42:00,019 –&gt; 00:42:02,019<br>that, you know, we lose the majority</p>
<p>701<br>00:42:02,019 –&gt; 00:42:02,940<br>on a committed entry,</p>
<p>702<br>00:42:02,940 –&gt; 00:42:04,619<br>and that entry will not be delivered</p>
<p>703<br>00:42:04,619 –&gt; 00:42:08,539<br>on the remaining replicas to the surface,</p>
<p>704<br>00:42:08,539 –&gt; 00:42:10,500<br>and so the client will see something strange,</p>
<p>705<br>00:42:10,500 –&gt; 00:42:13,539<br>where it sees that an operation that it did actually happened,</p>
<p>706<br>00:42:13,539 –&gt; 00:42:14,579<br>we’ll a little bit later,</p>
<p>707<br>00:42:14,579 –&gt; 00:42:17,860<br>actually that operation hasn’t happened.</p>
<p>708<br>00:42:17,860 –&gt; 00:42:19,019<br>And so it actually is important</p>
<p>709<br>00:42:19,019 –&gt; 00:42:20,659<br>that this actually is unstable storage,</p>
<p>710<br>00:42:20,659 –&gt; 00:42:23,500<br>and we basically promised the leader to commit it.</p>
<p>711<br>00:42:28,699 –&gt; 00:42:30,619<br>And we cannot back out of that promise.</p>
<p>712<br>00:42:33,579 –&gt; 00:42:36,300<br>Okay, any questions about this?</p>
<p>713<br>00:42:38,539 –&gt; 00:42:39,380<br>Okay.</p>
<p>714<br>00:42:43,860 –&gt; 00:42:47,500<br>Why do we need to remember the current term for disk,</p>
<p>715<br>00:42:47,500 –&gt; 00:42:49,619<br>and why don’t we, does that need to be stored stable?</p>
<p>716<br>00:42:53,659 –&gt; 00:42:54,980<br>Well, the term,</p>
<p>717<br>00:42:57,460 –&gt; 00:42:59,420<br>you vote for a different person in every term,</p>
<p>718<br>00:42:59,420 –&gt; 00:43:01,300<br>so if you don’t keep track of what term it is,</p>
<p>719<br>00:43:01,300 –&gt; 00:43:02,699<br>then you don’t really,</p>
<p>720<br>00:43:02,699 –&gt; 00:43:04,900<br>you don’t actually know who you voted for, right?</p>
<p>721<br>00:43:04,900 –&gt; 00:43:06,380<br>Yeah, exactly, you know, you know,</p>
<p>722<br>00:43:06,380 –&gt; 00:43:07,219<br>when you voted for it,</p>
<p>723<br>00:43:07,219 –&gt; 00:43:09,939<br>one problem also, current terms always have to go up,</p>
<p>724<br>00:43:09,939 –&gt; 00:43:12,500<br>right, you cannot go down in term,</p>
<p>725<br>00:43:12,500 –&gt; 00:43:14,980<br>because you’re gonna use that to detect RPCs</p>
<p>726<br>00:43:14,980 –&gt; 00:43:18,579<br>from a state of leaders and state candidates.</p>
<p>727<br>00:43:20,019 –&gt; 00:43:21,299<br>But this always has to go up.</p>
<p>728<br>00:43:30,939 –&gt; 00:43:31,779<br>Okay.</p>
<p>729<br>00:43:34,739 –&gt; 00:43:36,379<br>Any questions about persistence?</p>
<p>730<br>00:43:38,059 –&gt; 00:43:38,899<br>Okay.</p>
<p>731<br>00:43:47,139 –&gt; 00:43:51,980<br>I guess I’m a number one, which is more about the way</p>
<p>732<br>00:43:51,980 –&gt; 00:43:55,619<br>you laid out stuff, but you say it’s too strategy, right?</p>
<p>733<br>00:43:55,619 –&gt; 00:44:00,619<br>Yeah, we play the log and starting from persistence state.</p>
<p>734<br>00:44:01,819 –&gt; 00:44:03,339<br>Yeah.</p>
<p>735<br>00:44:03,339 –&gt; 00:44:04,619<br>And so, I mean,</p>
<p>736<br>00:44:05,539 –&gt; 00:44:08,460<br>the way you describe starting from a persistent state,</p>
<p>737<br>00:44:11,179 –&gt; 00:44:14,259<br>do you, like, do you,</p>
<p>738<br>00:44:15,900 –&gt; 00:44:20,900<br>replay, like, I guess it doesn’t say in the slide,</p>
<p>739<br>00:44:21,339 –&gt; 00:44:24,420<br>like if you have, does that assume you also have</p>
<p>740<br>00:44:24,420 –&gt; 00:44:29,339<br>like the snapshot of your state?</p>
<p>741<br>00:44:29,339 –&gt; 00:44:31,460<br>I have not talked about snapshot at all yet,</p>
<p>742<br>00:44:31,460 –&gt; 00:44:32,859<br>which we’ll talk about in a second.</p>
<p>743<br>00:44:32,860 –&gt; 00:44:35,220<br>That’s actually the next topic.</p>
<p>744<br>00:44:35,220 –&gt; 00:44:37,340<br>Okay, but the point is, okay,</p>
<p>745<br>00:44:37,340 –&gt; 00:44:39,980<br>there’s two strategies after a node crashes.</p>
<p>746<br>00:44:39,980 –&gt; 00:44:42,059<br>There’s two ways to treat that node.</p>
<p>747<br>00:44:42,059 –&gt; 00:44:44,380<br>One has a complete new node that never existed</p>
<p>748<br>00:44:44,380 –&gt; 00:44:46,220<br>in a system ever.</p>
<p>749<br>00:44:46,220 –&gt; 00:44:49,539<br>And so when it comes up, you add it to the cluster</p>
<p>750<br>00:44:49,539 –&gt; 00:44:50,660<br>as as if it’s a new node.</p>
<p>751<br>00:44:50,660 –&gt; 00:44:53,940<br>So basically the cluster goes from, you know,</p>
<p>752<br>00:44:53,940 –&gt; 00:44:55,500<br>let’s say you started with seven nodes,</p>
<p>753<br>00:44:55,500 –&gt; 00:44:57,980<br>one guy crashes, the cluster has six nodes,</p>
<p>754<br>00:44:57,980 –&gt; 00:44:59,460<br>it just can happily proceed, you know,</p>
<p>755<br>00:44:59,460 –&gt; 00:45:01,460<br>whatever the other nodes do their application</p>
<p>756<br>00:45:01,460 –&gt; 00:45:02,740<br>and all that kind of stuff.</p>
<p>757<br>00:45:02,779 –&gt; 00:45:06,539<br>And then the seven node actually comes back up.</p>
<p>758<br>00:45:06,539 –&gt; 00:45:08,539<br>And so there’s two ways of, you know,</p>
<p>759<br>00:45:08,539 –&gt; 00:45:10,979<br>then join one way to say like, well,</p>
<p>760<br>00:45:10,979 –&gt; 00:45:12,779<br>I just forget everything I did ever,</p>
<p>761<br>00:45:12,779 –&gt; 00:45:15,179<br>I’ll join the cluster again.</p>
<p>762<br>00:45:15,179 –&gt; 00:45:17,419<br>And the other six nodes will bring me up to date.</p>
<p>763<br>00:45:17,419 –&gt; 00:45:18,699<br>That will send the log to me</p>
<p>764<br>00:45:18,699 –&gt; 00:45:20,500<br>and all we redo do operations.</p>
<p>765<br>00:45:21,859 –&gt; 00:45:25,219<br>And that can be costly, even with snapshots.</p>
<p>766<br>00:45:25,219 –&gt; 00:45:27,659<br>So the second strategy is to say, well,</p>
<p>767<br>00:45:27,659 –&gt; 00:45:30,659<br>you know, if the same node seven comes back up again,</p>
<p>768<br>00:45:30,659 –&gt; 00:45:34,259<br>it tries to reintegrate with its persistent state</p>
<p>769<br>00:45:34,259 –&gt; 00:45:35,099<br>that it has.</p>
<p>770<br>00:45:36,819 –&gt; 00:45:38,619<br>And basically the hope that, you know,</p>
<p>771<br>00:45:38,619 –&gt; 00:45:40,420<br>if, for example, I did you went down for like,</p>
<p>772<br>00:45:40,420 –&gt; 00:45:42,179<br>you know, a couple nanoseconds, a microsecond,</p>
<p>773<br>00:45:42,179 –&gt; 00:45:43,179<br>or a millisecond,</p>
<p>774<br>00:45:43,179 –&gt; 00:45:44,980<br>and it’s basically not much catching up to do it all</p>
<p>775<br>00:45:44,980 –&gt; 00:45:46,940<br>because it has all the state.</p>
<p>776<br>00:45:49,619 –&gt; 00:45:51,659<br>But it would like,</p>
<p>777<br>00:45:53,699 –&gt; 00:45:56,259<br>aside from the log, there’s also like a state machine, right?</p>
<p>778<br>00:45:56,259 –&gt; 00:45:58,699<br>That you’ve been like applying changes to.</p>
<p>779<br>00:45:58,699 –&gt; 00:45:59,699<br>Yeah, I know.</p>
<p>780<br>00:45:59,699 –&gt; 00:46:01,460<br>So yeah, let’s talk about that.</p>
<p>781<br>00:46:01,460 –&gt; 00:46:03,179<br>So there’s nothing that’s the next topic.</p>
<p>782<br>00:46:03,179 –&gt; 00:46:04,019<br>Okay.</p>
<p>783<br>00:46:05,859 –&gt; 00:46:06,859<br>I think you’re here.</p>
<p>784<br>00:46:06,859 –&gt; 00:46:09,460<br>So, you know, what about service recovery?</p>
<p>785<br>00:46:16,299 –&gt; 00:46:19,379<br>Sorry, I actually have another question on persistence.</p>
<p>786<br>00:46:19,379 –&gt; 00:46:20,699<br>Yep.</p>
<p>787<br>00:46:20,699 –&gt; 00:46:23,619<br>When does the server decide to persist?</p>
<p>788<br>00:46:24,539 –&gt; 00:46:26,179<br>Ah, good, great question.</p>
<p>789<br>00:46:26,179 –&gt; 00:46:27,619<br>You know, what do you think?</p>
<p>790<br>00:46:28,980 –&gt; 00:46:30,299<br>I’m sure you thought about this.</p>
<p>791<br>00:46:33,339 –&gt; 00:46:37,579<br>I mean, I think a simple answer would be every time</p>
<p>792<br>00:46:37,579 –&gt; 00:46:39,699<br>one of these variables changes,</p>
<p>793<br>00:46:39,699 –&gt; 00:46:44,219<br>but that seems like a very costly thing to do.</p>
<p>794<br>00:46:44,219 –&gt; 00:46:46,179<br>I think that this is the correct answer.</p>
<p>795<br>00:46:47,219 –&gt; 00:46:48,699<br>Whenever one of these variable changes,</p>
<p>796<br>00:46:48,699 –&gt; 00:46:51,819<br>you actually flush it to disk or you write it to the,</p>
<p>797<br>00:46:51,819 –&gt; 00:46:53,659<br>in our case, correct it in the labs,</p>
<p>798<br>00:46:53,659 –&gt; 00:46:56,500<br>you know, you write to the persistent module.</p>
<p>799<br>00:46:57,500 –&gt; 00:46:58,500<br>Okay, and it does.</p>
<p>800<br>00:46:58,500 –&gt; 00:47:00,500<br>So for example, when the leader, you know,</p>
<p>801<br>00:47:00,500 –&gt; 00:47:03,500<br>accepts an entry, you know, for start and a pen,</p>
<p>802<br>00:47:03,500 –&gt; 00:47:05,500<br>it’s to reach local, it’s log,</p>
<p>803<br>00:47:05,500 –&gt; 00:47:08,500<br>it actually has to persist that entry.</p>
<p>804<br>00:47:13,500 –&gt; 00:47:16,500<br>All right, and so does the persisting work incrementally?</p>
<p>805<br>00:47:16,500 –&gt; 00:47:19,500<br>So it like once you get a new log entry,</p>
<p>806<br>00:47:19,500 –&gt; 00:47:22,500<br>you append or just like take the entire state</p>
<p>807<br>00:47:22,500 –&gt; 00:47:24,500<br>and like rewrite it into the file.</p>
<p>808<br>00:47:25,500 –&gt; 00:47:27,500<br>Okay, in real life, you know, we repent, right?</p>
<p>809<br>00:47:27,500 –&gt; 00:47:29,380<br>And you would not rewrite the whole log,</p>
<p>810<br>00:47:29,380 –&gt; 00:47:31,219<br>you would just repent at one entry to the log.</p>
<p>811<br>00:47:31,219 –&gt; 00:47:34,179<br>And that’s actually one of the reasons that logs are cool,</p>
<p>812<br>00:47:34,179 –&gt; 00:47:37,380<br>because you know, you can just sort of append at the end,</p>
<p>813<br>00:47:37,380 –&gt; 00:47:38,219<br>incrementally.</p>
<p>814<br>00:47:39,380 –&gt; 00:47:42,659<br>In our lab, you know, the whole thing is fake.</p>
<p>815<br>00:47:42,659 –&gt; 00:47:44,980<br>The persisting actually doesn’t really persist.</p>
<p>816<br>00:47:47,059 –&gt; 00:47:50,940<br>It keeps the object around between crashes,</p>
<p>817<br>00:47:50,940 –&gt; 00:47:52,739<br>because crashes are also sort of fake.</p>
<p>818<br>00:47:52,739 –&gt; 00:47:54,299<br>You know, the test they’re basically, you know,</p>
<p>819<br>00:47:54,299 –&gt; 00:47:56,139<br>stops nodes, you know, re-starts them,</p>
<p>820<br>00:47:56,139 –&gt; 00:47:57,739<br>and basically gives them the new state.</p>
<p>821<br>00:48:00,019 –&gt; 00:48:03,139<br>But in real system, you would depend.</p>
<p>822<br>00:48:03,139 –&gt; 00:48:04,619<br>So the log would be a file,</p>
<p>823<br>00:48:04,619 –&gt; 00:48:06,619<br>and you would append an entry to the file.</p>
<p>824<br>00:48:07,619 –&gt; 00:48:08,459<br>Thank you.</p>
<p>825<br>00:48:14,379 –&gt; 00:48:17,019<br>And yes, you know, we actually, you all have to,</p>
<p>826<br>00:48:17,019 –&gt; 00:48:19,459<br>in real system, you know, if you append a log entry,</p>
<p>827<br>00:48:19,459 –&gt; 00:48:20,819<br>you’re your first append log entering,</p>
<p>828<br>00:48:20,820 –&gt; 00:48:21,820<br>then you respond.</p>
<p>829<br>00:48:21,820 –&gt; 00:48:24,900<br>Like so in the append entries, if you update the log,</p>
<p>830<br>00:48:24,900 –&gt; 00:48:28,940<br>and you add append, sorry, append entries on the follower,</p>
<p>831<br>00:48:28,940 –&gt; 00:48:30,700<br>it receives a new set of log entries,</p>
<p>832<br>00:48:30,700 –&gt; 00:48:33,860<br>it depends them to its, you know, local persistent log,</p>
<p>833<br>00:48:33,860 –&gt; 00:48:36,059<br>and then it can respond, because you, you,</p>
<p>834<br>00:48:36,059 –&gt; 00:48:38,620<br>it would be bad to respond before appending,</p>
<p>835<br>00:48:38,620 –&gt; 00:48:42,059<br>because then you might lose, you know,</p>
<p>836<br>00:48:42,059 –&gt; 00:48:43,260<br>if you responded before appending,</p>
<p>837<br>00:48:43,260 –&gt; 00:48:46,660<br>you might run in a situation where, just before actually,</p>
<p>838<br>00:48:46,660 –&gt; 00:48:48,420<br>the actual pen happens to your crashes,</p>
<p>839<br>00:48:48,420 –&gt; 00:48:51,340<br>and so you actually did not persist the log entries,</p>
<p>840<br>00:48:51,340 –&gt; 00:48:55,539<br>and so you would, you know, you could lose committed entries.</p>
<p>841<br>00:49:00,420 –&gt; 00:49:01,260<br>Okay.</p>
<p>842<br>00:49:02,740 –&gt; 00:49:05,099<br>Okay, so how about service recovery?</p>
<p>843<br>00:49:05,099 –&gt; 00:49:07,420<br>So the service keeps its own state,</p>
<p>844<br>00:49:08,420 –&gt; 00:49:09,860<br>for example, a lot of pre-earrampalmenting</p>
<p>845<br>00:49:09,860 –&gt; 00:49:12,900<br>and key value store, and so the key value store</p>
<p>846<br>00:49:12,900 –&gt; 00:49:17,900<br>maintains basically a hash map from a key to value,</p>
<p>847<br>00:49:18,099 –&gt; 00:49:21,380<br>and you need to replay that state.</p>
<p>848<br>00:49:21,380 –&gt; 00:49:26,380<br>And again, there are two possible ways of going about it.</p>
<p>849<br>00:49:26,380 –&gt; 00:49:29,460<br>One strategy one is to replay the log</p>
<p>850<br>00:49:29,460 –&gt; 00:49:31,180<br>to actually reconstruct that state.</p>
<p>851<br>00:49:34,300 –&gt; 00:49:36,500<br>So basically if you’re,</p>
<p>852<br>00:49:37,740 –&gt; 00:49:39,420<br>this is sort of similar to the strategy one,</p>
<p>853<br>00:49:39,420 –&gt; 00:49:40,860<br>on the previous slide, you know,</p>
<p>854<br>00:49:40,860 –&gt; 00:49:44,139<br>you just take the log, you just replay all the entries</p>
<p>855<br>00:49:44,139 –&gt; 00:49:46,180<br>in the log, and that should, you know,</p>
<p>856<br>00:49:46,179 –&gt; 00:49:48,339<br>basically create exactly the same state,</p>
<p>857<br>00:49:49,819 –&gt; 00:49:52,819<br>as if, as before, right?</p>
<p>858<br>00:49:52,819 –&gt; 00:49:54,980<br>Because, you know, the whole point</p>
<p>859<br>00:49:54,980 –&gt; 00:49:56,980<br>of this replicated state machine approach</p>
<p>860<br>00:49:56,980 –&gt; 00:50:01,699<br>is that all the operations are actually being in total order.</p>
<p>861<br>00:50:01,699 –&gt; 00:50:03,299<br>The operations have no side effect,</p>
<p>862<br>00:50:03,299 –&gt; 00:50:04,739<br>so if you start in the same state,</p>
<p>863<br>00:50:04,739 –&gt; 00:50:07,619<br>like nothing, and you’re gonna replay all the operations,</p>
<p>864<br>00:50:07,619 –&gt; 00:50:10,059<br>you should end up exactly in the same state,</p>
<p>865<br>00:50:10,059 –&gt; 00:50:11,139<br>as any other node.</p>
<p>866<br>00:50:12,659 –&gt; 00:50:14,699<br>And so that’s one possible,</p>
<p>867<br>00:50:14,699 –&gt; 00:50:17,179<br>and so that was a one way to recreate the state.</p>
<p>868<br>00:50:24,579 –&gt; 00:50:26,819<br>And you know, obviously that’s just expensive, you know,</p>
<p>869<br>00:50:26,819 –&gt; 00:50:29,259<br>if the search actually has been running, you know,</p>
<p>870<br>00:50:29,259 –&gt; 00:50:31,460<br>for a couple of years, and you know,</p>
<p>871<br>00:50:31,460 –&gt; 00:50:33,379<br>who have to replay the logs, you know,</p>
<p>872<br>00:50:33,379 –&gt; 00:50:35,579<br>from the beginning of time, you know, that is not,</p>
<p>873<br>00:50:35,579 –&gt; 00:50:37,739<br>you know, so desirable.</p>
<p>874<br>00:50:37,739 –&gt; 00:50:38,619<br>And so, you know, like,</p>
<p>875<br>00:50:38,619 –&gt; 00:50:42,579<br>like people don’t really follow strategy one,</p>
<p>876<br>00:50:42,579 –&gt; 00:50:43,980<br>but they follow another strategy,</p>
<p>877<br>00:50:43,980 –&gt; 00:50:46,659<br>and we’re just like basically making periodic snapshots.</p>
<p>878<br>00:50:47,659 –&gt; 00:50:49,940<br>And there are two reasons to do that.</p>
<p>879<br>00:50:49,940 –&gt; 00:50:51,980<br>One, you basically reconstruct, you know,</p>
<p>880<br>00:50:51,980 –&gt; 00:50:53,820<br>the server state in the fast manner.</p>
<p>881<br>00:50:53,820 –&gt; 00:50:55,099<br>And the second reason to do that</p>
<p>882<br>00:50:55,099 –&gt; 00:50:58,860<br>is to be able to compact the log, you know,</p>
<p>883<br>00:50:58,860 –&gt; 00:51:03,860<br>even the raft state itself can be cut off</p>
<p>884<br>00:51:05,460 –&gt; 00:51:08,099<br>from it that the prefix can be cut off.</p>
<p>885<br>00:51:08,099 –&gt; 00:51:09,780<br>And the basic observation is that,</p>
<p>886<br>00:51:11,139 –&gt; 00:51:12,740<br>if the application is running for a while,</p>
<p>887<br>00:51:12,739 –&gt; 00:51:15,139<br>and it just has to apply to the first thousand operations,</p>
<p>888<br>00:51:15,139 –&gt; 00:51:16,819<br>or the first million operations,</p>
<p>889<br>00:51:17,779 –&gt; 00:51:20,419<br>then the state that is constructed at that point,</p>
<p>890<br>00:51:22,579 –&gt; 00:51:27,579<br>the states will contain all ox, you know,</p>
<p>891<br>00:51:28,619 –&gt; 00:51:32,339<br>say through I, where I may be a thousand,</p>
<p>892<br>00:51:32,339 –&gt; 00:51:34,539<br>or a million, whatever, whatever you,</p>
<p>893<br>00:51:34,539 –&gt; 00:51:38,739<br>so one way to think about is that,</p>
<p>894<br>00:51:38,739 –&gt; 00:51:42,259<br>there’s sort of a duality between state replication</p>
<p>895<br>00:51:42,260 –&gt; 00:51:45,540<br>and log replication or replay.</p>
<p>896<br>00:51:47,540 –&gt; 00:51:49,860<br>You can save the state after a thousand operations,</p>
<p>897<br>00:51:49,860 –&gt; 00:51:52,180<br>and then you’ve got exactly the same thing as actually</p>
<p>898<br>00:51:52,180 –&gt; 00:51:56,740<br>reapplying or redoing every operation from zero to the fast.</p>
<p>899<br>00:51:57,820 –&gt; 00:52:01,140<br>And so this means that once you have a snapshot,</p>
<p>900<br>00:52:01,140 –&gt; 00:52:03,820<br>and you store the snapshot stably in disk,</p>
<p>901<br>00:52:03,820 –&gt; 00:52:06,660<br>in persistent state, you can cut off,</p>
<p>902<br>00:52:07,820 –&gt; 00:52:09,660<br>you can cut the log,</p>
<p>903<br>00:52:12,420 –&gt; 00:52:13,260<br>you know, through I.</p>
<p>904<br>00:52:16,940 –&gt; 00:52:19,900<br>And so this allows you to control the size of the log,</p>
<p>905<br>00:52:19,900 –&gt; 00:52:24,340<br>you know, basically by periodically asking the surface</p>
<p>906<br>00:52:24,340 –&gt; 00:52:25,540<br>to actually take snapshots,</p>
<p>907<br>00:52:25,540 –&gt; 00:52:27,660<br>and then you know, the service telling the raft library,</p>
<p>908<br>00:52:27,660 –&gt; 00:52:29,900<br>yes, I’ve taken a snapshot through I,</p>
<p>909<br>00:52:29,900 –&gt; 00:52:31,460<br>then the raft can say, okay, good.</p>
<p>910<br>00:52:31,460 –&gt; 00:52:34,220<br>I just don’t have to remember anything from I,</p>
<p>911<br>00:52:34,220 –&gt; 00:52:37,220<br>or until I, that means of course that the snapshot</p>
<p>912<br>00:52:37,220 –&gt; 00:52:39,260<br>has to be stored, I’ll save the storage.</p>
<p>913<br>00:52:43,220 –&gt; 00:52:46,820<br>And this is also good for recovery, correct?</p>
<p>914<br>00:52:46,820 –&gt; 00:52:49,100<br>And so it makes our recovery scheme slightly more complicated</p>
<p>915<br>00:52:49,100 –&gt; 00:52:50,900<br>than I just described in the previous slide,</p>
<p>916<br>00:52:50,900 –&gt; 00:52:54,980<br>and what it has to happen is that when a follower,</p>
<p>917<br>00:52:54,980 –&gt; 00:52:57,180<br>you know, comes back up after a quick, you know, say,</p>
<p>918<br>00:52:57,180 –&gt; 00:53:00,540<br>reboot, it loads its persistent state,</p>
<p>919<br>00:53:00,540 –&gt; 00:53:01,580<br>you know, that includes, you know,</p>
<p>920<br>00:53:01,580 –&gt; 00:53:03,980<br>the persistent state that we talked about on the previous slide,</p>
<p>921<br>00:53:03,980 –&gt; 00:53:05,260<br>that’s disinformation.</p>
<p>922<br>00:53:06,540 –&gt; 00:53:10,180<br>But also it’s last, you know, snapshot,</p>
<p>923<br>00:53:10,179 –&gt; 00:53:12,299<br>installs that last, you know, basically loads</p>
<p>924<br>00:53:12,299 –&gt; 00:53:14,819<br>that snapshot into memory, the surface does.</p>
<p>925<br>00:53:14,819 –&gt; 00:53:17,659<br>And then, you know, we can sort of replay any log entries</p>
<p>926<br>00:53:17,659 –&gt; 00:53:19,659<br>to basically bring the follower up to date.</p>
<p>927<br>00:53:20,940 –&gt; 00:53:21,779<br>Okay.</p>
<p>928<br>00:53:29,539 –&gt; 00:53:30,659<br>Any questions about this?</p>
<p>929<br>00:53:32,259 –&gt; 00:53:34,619<br>I have one question.</p>
<p>930<br>00:53:34,619 –&gt; 00:53:37,619<br>I’m not sure if I’m gonna be able to phrase it super clearly.</p>
<p>931<br>00:53:38,619 –&gt; 00:53:41,619<br>But I guess, like, I was under impression.</p>
<p>932<br>00:53:41,619 –&gt; 00:53:46,619<br>So I guess like, does this not break some layer of abstraction</p>
<p>933<br>00:53:46,619 –&gt; 00:53:50,619<br>that truly existed between the application on top of raft</p>
<p>934<br>00:53:50,619 –&gt; 00:53:53,380<br>and raft itself, where it now needs to understand</p>
<p>935<br>00:53:53,380 –&gt; 00:53:56,099<br>how to state machine, like how to apply commands</p>
<p>936<br>00:53:56,099 –&gt; 00:53:58,900<br>to the state machine instead of just like giving commands</p>
<p>937<br>00:53:58,900 –&gt; 00:54:01,619<br>to some external state machine?</p>
<p>938<br>00:54:01,619 –&gt; 00:54:04,139<br>Yeah, great after that.</p>
<p>939<br>00:54:04,139 –&gt; 00:54:05,139<br>I’m gonna take it.</p>
<p>940<br>00:54:05,139 –&gt; 00:54:09,139<br>Clearly, you know, there is some, you have to play together,</p>
<p>941<br>00:54:11,139 –&gt; 00:54:13,139<br>right, the raft library and the surface.</p>
<p>942<br>00:54:14,420 –&gt; 00:54:16,539<br>Because first of all, the surface lies about, like,</p>
<p>943<br>00:54:16,539 –&gt; 00:54:18,059<br>you know, gives the wrong information about, like,</p>
<p>944<br>00:54:18,059 –&gt; 00:54:20,019<br>how far as natural applied, then, you know,</p>
<p>945<br>00:54:20,019 –&gt; 00:54:21,500<br>we get inconsistent results.</p>
<p>946<br>00:54:21,500 –&gt; 00:54:23,980<br>But anyway, so we don’t assume wires anyway,</p>
<p>947<br>00:54:23,980 –&gt; 00:54:27,299<br>but it’s clearly the case that the surface</p>
<p>948<br>00:54:27,299 –&gt; 00:54:30,420<br>and the raft library have to cooperate.</p>
<p>949<br>00:54:30,420 –&gt; 00:54:34,059<br>And you can call that an abstraction violation.</p>
<p>950<br>00:54:35,420 –&gt; 00:54:39,220<br>I think the reason they need to do it is to limit</p>
<p>951<br>00:54:39,220 –&gt; 00:54:41,980<br>the amount of state that the raft library has to maintain.</p>
<p>952<br>00:54:41,980 –&gt; 00:54:43,579<br>Otherwise, the raft library wouldn’t know</p>
<p>953<br>00:54:43,579 –&gt; 00:54:45,740<br>when it can cut the log.</p>
<p>954<br>00:54:45,740 –&gt; 00:54:47,780<br>And so there’s basically no way around it</p>
<p>955<br>00:54:47,780 –&gt; 00:54:49,700<br>that the surface actually tells it, like,</p>
<p>956<br>00:54:49,700 –&gt; 00:54:51,820<br>well, I got a snapshot through I.</p>
<p>957<br>00:54:51,820 –&gt; 00:54:55,019<br>And so it’s okay for you to remove log entries</p>
<p>958<br>00:54:55,019 –&gt; 00:54:56,019<br>from zero for I.</p>
<p>959<br>00:54:57,980 –&gt; 00:54:59,019<br>And you’ll see that.</p>
<p>960<br>00:54:59,019 –&gt; 00:55:01,940<br>And so this is going to be a good point.</p>
<p>961<br>00:55:01,940 –&gt; 00:55:03,820<br>This is going to come up in 2D, right?</p>
<p>962<br>00:55:03,820 –&gt; 00:55:06,980<br>But log 2D is going to is all about snapshots</p>
<p>963<br>00:55:06,980 –&gt; 00:55:11,579<br>and log compaction, as it’s also called in the paper.</p>
<p>964<br>00:55:13,980 –&gt; 00:55:17,420<br>There has to be some API between the servers</p>
<p>965<br>00:55:17,420 –&gt; 00:55:19,340<br>and raft to be able to collaborate.</p>
<p>966<br>00:55:19,340 –&gt; 00:55:23,259<br>And basically in 2A and 2B, that API, in fact,</p>
<p>967<br>00:55:23,259 –&gt; 00:55:26,460<br>even in 2C, that API is extremely simple.</p>
<p>968<br>00:55:26,460 –&gt; 00:55:28,619<br>The only API that exists is basically</p>
<p>969<br>00:55:28,619 –&gt; 00:55:31,659<br>delivering log message on the apply channel, right?</p>
<p>970<br>00:55:31,659 –&gt; 00:55:34,539<br>And almost nothing flows down from the servers</p>
<p>971<br>00:55:34,539 –&gt; 00:55:35,300<br>to the raft library.</p>
<p>972<br>00:55:35,300 –&gt; 00:55:39,380<br>Other than that, the servers may start a raft,</p>
<p>973<br>00:55:40,500 –&gt; 00:55:42,940<br>try to append an entry to the log using a start.</p>
<p>974<br>00:55:44,740 –&gt; 00:55:49,340<br>And so in 2D, there has to be a little bit more of an API</p>
<p>975<br>00:55:49,340 –&gt; 00:55:53,220<br>between the servers and raft library.</p>
<p>976<br>00:55:53,220 –&gt; 00:55:55,940<br>And the third time, like, you can design that API</p>
<p>977<br>00:55:55,940 –&gt; 00:55:57,179<br>in many possible ways.</p>
<p>978<br>00:55:57,179 –&gt; 00:55:58,980<br>There are quite a number of ways of doing it.</p>
<p>979<br>00:55:58,980 –&gt; 00:55:59,940<br>There’s not particularly one.</p>
<p>980<br>00:55:59,940 –&gt; 00:56:02,940<br>And the paper doesn’t lay out what API you should use.</p>
<p>981<br>00:56:04,380 –&gt; 00:56:06,420<br>The paper’s actually just nothing about this.</p>
<p>982<br>00:56:06,420 –&gt; 00:56:10,019<br>And so it’s up to you, it’s up to us,</p>
<p>983<br>00:56:10,019 –&gt; 00:56:11,059<br>to figure out what the API is.</p>
<p>984<br>00:56:11,059 –&gt; 00:56:16,059<br>And to be able to do 2D, we have to declare an API</p>
<p>985<br>00:56:16,300 –&gt; 00:56:18,820<br>between the servers and raft.</p>
<p>986<br>00:56:18,820 –&gt; 00:56:23,820<br>And you’ll see what you do to the API has some funny,</p>
<p>987<br>00:56:26,820 –&gt; 00:56:29,380<br>might be a little bit more different than you might expect.</p>
<p>988<br>00:56:29,380 –&gt; 00:56:33,420<br>And we have to pick one particular API.</p>
<p>989<br>00:56:33,420 –&gt; 00:56:38,420<br>And in that API, there’s an operation called</p>
<p>990<br>00:56:38,460 –&gt; 00:56:43,460<br>through a conditional install that has a semantics</p>
<p>991<br>00:56:43,460 –&gt; 00:56:47,099<br>that allows you to change the raft state</p>
<p>992<br>00:56:47,099 –&gt; 00:56:48,780<br>and the server state automatically</p>
<p>993<br>00:56:48,780 –&gt; 00:56:50,260<br>in one single operation.</p>
<p>994<br>00:56:51,260 –&gt; 00:56:55,260<br>And that partly, that operation exists</p>
<p>995<br>00:56:55,260 –&gt; 00:57:00,260<br>to try to limit the abstraction boundaries.</p>
<p>996<br>00:57:03,260 –&gt; 00:57:06,100<br>And it turns out you can do it in different ways.</p>
<p>997<br>00:57:06,100 –&gt; 00:57:07,580<br>You don’t really need to go.</p>
<p>998<br>00:57:07,580 –&gt; 00:57:09,060<br>You could have written it in different ways,</p>
<p>999<br>00:57:09,060 –&gt; 00:57:11,780<br>but our personal thing is actually one of the more</p>
<p>1000<br>00:57:11,780 –&gt; 00:57:12,780<br>simple ways of doing it.</p>
<p>1001<br>00:57:13,780 –&gt; 00:57:15,420<br>But that will become more clear in 2D.</p>
<p>1002<br>00:57:15,420 –&gt; 00:57:17,860<br>And you’ll see indeed that there’s sort of an interaction</p>
<p>1003<br>00:57:17,860 –&gt; 00:57:21,460<br>between the servers and raft in a way</p>
<p>1004<br>00:57:21,460 –&gt; 00:57:22,780<br>that they have to play along.</p>
<p>1005<br>00:57:28,860 –&gt; 00:57:30,579<br>I could repeat when raft communicates</p>
<p>1006<br>00:57:30,579 –&gt; 00:57:32,620<br>with the servers in the snapshot process.</p>
<p>1007<br>00:57:32,620 –&gt; 00:57:37,140<br>So the snapshots are driven by the service.</p>
<p>1008<br>00:57:37,140 –&gt; 00:57:40,420<br>So the service just says once in a while to raft,</p>
<p>1009<br>00:57:40,420 –&gt; 00:57:43,340<br>I’ve made a snapshot, here’s my snapshot.</p>
<p>1010<br>00:57:43,340 –&gt; 00:57:44,340<br>And this is a snapshot,</p>
<p>1011<br>00:57:44,340 –&gt; 00:57:46,900<br>includes all the operations through I.</p>
<p>1012<br>00:57:46,900 –&gt; 00:57:51,900<br>And then raft writes the snapshot and truncates a blog</p>
<p>1013<br>00:57:51,980 –&gt; 00:57:55,660<br>to I and writes all that information to the disk.</p>
<p>1014<br>00:57:57,619 –&gt; 00:57:59,700<br>And that’s basically all what happens</p>
<p>1015<br>00:57:59,700 –&gt; 00:58:01,340<br>in sort of regular operation.</p>
<p>1016<br>00:58:01,340 –&gt; 00:58:04,260<br>Periodically, snapshots happen, snapshots happens.</p>
<p>1017<br>00:58:04,260 –&gt; 00:58:07,059<br>Then the other case, you’ll have to consider</p>
<p>1018<br>00:58:07,059 –&gt; 00:58:09,740<br>is like when reboot happens.</p>
<p>1019<br>00:58:09,740 –&gt; 00:58:11,460<br>And so when the follower reboots,</p>
<p>1020<br>00:58:11,460 –&gt; 00:58:15,740<br>it actually reboots from its persistent state.</p>
<p>1021<br>00:58:15,739 –&gt; 00:58:18,219<br>And so including its snapshot.</p>
<p>1022<br>00:58:18,219 –&gt; 00:58:20,579<br>And so when the follower reboots,</p>
<p>1023<br>00:58:20,579 –&gt; 00:58:23,819<br>it basically loads the snapshot from a memory</p>
<p>1024<br>00:58:23,819 –&gt; 00:58:26,339<br>from the persistent disk and actually reconstructs</p>
<p>1025<br>00:58:26,339 –&gt; 00:58:28,659<br>the application state, the key value store.</p>
<p>1026<br>00:58:28,659 –&gt; 00:58:29,939<br>And you will do this in lot free.</p>
<p>1027<br>00:58:29,939 –&gt; 00:58:32,299<br>So this is not going to be an issue in lot two.</p>
<p>1028<br>00:58:32,299 –&gt; 00:58:34,059<br>The only thing that is going to be an issue in lot two</p>
<p>1029<br>00:58:34,059 –&gt; 00:58:37,779<br>is that because the followers,</p>
<p>1030<br>00:58:37,779 –&gt; 00:58:38,779<br>or because the,</p>
<p>1031<br>00:58:42,419 –&gt; 00:58:44,500<br>because the log has been cut,</p>
<p>1032<br>00:58:45,460 –&gt; 00:58:48,179<br>instead of like having all the entries from zero to I</p>
<p>1033<br>00:58:48,179 –&gt; 00:58:50,539<br>in the log plus more.</p>
<p>1034<br>00:58:50,539 –&gt; 00:58:51,659<br>So I,</p>
<p>1035<br>00:58:51,659 –&gt; 00:58:55,780<br>and the log is cut from I to N.</p>
<p>1036<br>00:58:57,940 –&gt; 00:59:01,500<br>And that’s part of the log compaction.</p>
<p>1037<br>00:59:01,500 –&gt; 00:59:05,059<br>That also means that if a follower is far behind,</p>
<p>1038<br>00:59:05,059 –&gt; 00:59:07,539<br>like for example, a new node joins the system</p>
<p>1039<br>00:59:07,539 –&gt; 00:59:11,340<br>and doesn’t actually have the beginning of the log</p>
<p>1040<br>00:59:11,340 –&gt; 00:59:13,860<br>or the snapshot,</p>
<p>1041<br>00:59:13,860 –&gt; 00:59:18,860<br>then the raft has to communicate the snapshot to that follower.</p>
<p>1042<br>00:59:19,620 –&gt; 00:59:22,780<br>So in the case that the follower is before I,</p>
<p>1043<br>00:59:22,780 –&gt; 00:59:27,180<br>because it rejoined the raft,</p>
<p>1044<br>00:59:27,180 –&gt; 00:59:28,180<br>posture,</p>
<p>1045<br>00:59:29,780 –&gt; 00:59:33,780<br>leader actually has to set the snapshot to the follower</p>
<p>1046<br>00:59:33,780 –&gt; 00:59:36,420<br>and the follower basically starts from there.</p>
<p>1047<br>00:59:36,420 –&gt; 00:59:37,900<br>And that will show up in 2D.</p>
<p>1048<br>00:59:37,900 –&gt; 00:59:40,940<br>And so there’s an additional RPC called</p>
<p>1049<br>00:59:40,940 –&gt; 00:59:45,380<br>the snapshot RPC or install snapshot RPC.</p>
<p>1050<br>00:59:45,380 –&gt; 00:59:46,900<br>That’s described in the paper,</p>
<p>1051<br>00:59:46,900 –&gt; 00:59:48,980<br>and that you will have to implement in 2D.</p>
<p>1052<br>00:59:50,059 –&gt; 00:59:54,220<br>In fact, this brings me to a good point.</p>
<p>1053<br>00:59:54,220 –&gt; 00:59:55,740<br>Actually, let me first go to,</p>
<p>1054<br>00:59:56,980 –&gt; 00:59:58,980<br>can you basically bring me to the homework question,</p>
<p>1055<br>00:59:58,980 –&gt; 01:00:00,300<br>which is,</p>
<p>1056<br>01:00:03,019 –&gt; 01:00:03,860<br>years the,</p>
<p>1057<br>01:00:05,659 –&gt; 01:00:10,340<br>install snapshot RPCs or equivalent to figure two,</p>
<p>1058<br>01:00:10,340 –&gt; 01:00:12,620<br>but then just for the snapshot RPC</p>
<p>1059<br>01:00:12,620 –&gt; 01:00:14,780<br>and you actually have to implement that.</p>
<p>1060<br>01:00:16,460 –&gt; 01:00:17,740<br>And in 2D.</p>
<p>1061<br>01:00:17,740 –&gt; 01:00:20,980<br>And one issue that came up in the,</p>
<p>1062<br>01:00:20,980 –&gt; 01:00:22,940<br>which was the homework question for today</p>
<p>1063<br>01:00:22,940 –&gt; 01:00:23,940<br>is,</p>
<p>1064<br>01:00:23,940 –&gt; 01:00:28,620<br>isn’t every possible in raft or what avoids it,</p>
<p>1065<br>01:00:28,620 –&gt; 01:00:29,900<br>if it’s not possible,</p>
<p>1066<br>01:00:29,900 –&gt; 01:00:32,460<br>that the state machine rolls back.</p>
<p>1067<br>01:00:32,460 –&gt; 01:00:35,740<br>So example, a leader sends maybe,</p>
<p>1068<br>01:00:35,740 –&gt; 01:00:39,460<br>maybe an old snapshot shows up at a follower.</p>
<p>1069<br>01:00:39,460 –&gt; 01:00:41,900<br>Is it possible that,</p>
<p>1070<br>01:00:43,139 –&gt; 01:00:43,980<br>if it’s possible,</p>
<p>1071<br>01:00:43,980 –&gt; 01:00:46,820<br>if not the follower would install that snapshot</p>
<p>1072<br>01:00:46,820 –&gt; 01:00:49,900<br>and then implicitly basically roll back to state machine,</p>
<p>1073<br>01:00:49,900 –&gt; 01:00:52,900<br>right, maybe it already has seen more information.</p>
<p>1074<br>01:00:52,900 –&gt; 01:00:54,699<br>You know, clearly that seems not right.</p>
<p>1075<br>01:00:54,699 –&gt; 01:00:56,460<br>And so the question is,</p>
<p>1076<br>01:00:56,460 –&gt; 01:00:58,780<br>you know, how does Ravgett around it?</p>
<p>1077<br>01:00:58,780 –&gt; 01:01:01,300<br>And so maybe this is a great place</p>
<p>1078<br>01:01:01,300 –&gt; 01:01:03,539<br>to actually do a quick breakout</p>
<p>1079<br>01:01:03,539 –&gt; 01:01:05,059<br>and you can debate, you know,</p>
<p>1080<br>01:01:05,059 –&gt; 01:01:06,179<br>that, you know,</p>
<p>1081<br>01:01:06,179 –&gt; 01:01:08,619<br>that the homework question for a couple of minutes,</p>
<p>1082<br>01:01:08,739 –&gt; 01:01:09,699<br>five minutes,</p>
<p>1083<br>01:01:09,699 –&gt; 01:01:13,539<br>and then we’ll come back and talk about,</p>
<p>1084<br>01:01:13,539 –&gt; 01:01:14,900<br>a little bit more about snapshots.</p>
<p>1085<br>01:01:16,940 –&gt; 01:01:19,619<br>Really would it be like on the one hand?</p>
<p>1086<br>01:01:19,619 –&gt; 01:01:22,059<br>No, Lily, how about I try?</p>
<p>1087<br>01:01:22,059 –&gt; 01:01:22,900<br>You can make it.</p>
<p>1088<br>01:01:22,900 –&gt; 01:01:24,500<br>Yeah, I’ll go for it.</p>
<p>1089<br>01:01:24,500 –&gt; 01:01:26,500<br>Yeah, hold on, I’ll probably have to make you,</p>
<p>1090<br>01:01:32,099 –&gt; 01:01:33,739<br>host and then you can do it.</p>
<p>1091<br>01:01:35,420 –&gt; 01:01:37,219<br>Okay, you should be host now.</p>
<p>1092<br>01:01:37,219 –&gt; 01:01:38,059<br>Awesome.</p>
<p>1093<br>01:02:08,659 –&gt; 01:02:09,460<br>Okay, good.</p>
<p>1094<br>01:02:09,460 –&gt; 01:02:10,299<br>Nothing gets too much.</p>
<p>1095<br>01:02:10,299 –&gt; 01:02:11,299<br>Thank you, you’re welcome.</p>
<p>1096<br>01:08:08,980 –&gt; 01:08:09,940<br>Make you host again.</p>
<p>1097<br>01:08:09,940 –&gt; 01:08:10,779<br>Yeah, that’d be great.</p>
<p>1098<br>01:08:10,779 –&gt; 01:08:11,619<br>Thank you.</p>
<p>1099<br>01:08:11,619 –&gt; 01:08:12,460<br>Okay.</p>
<p>1100<br>01:08:35,619 –&gt; 01:08:36,619<br>Let me see that guy.</p>
<p>1101<br>01:08:36,619 –&gt; 01:08:37,619<br>Let me share my screen.</p>
<p>1102<br>01:08:41,739 –&gt; 01:08:42,739<br>Yeah, let me see.</p>
<p>1103<br>01:08:55,180 –&gt; 01:08:56,579<br>Okay, everybody back online.</p>
<p>1104<br>01:09:00,180 –&gt; 01:09:01,739<br>We’re good to go.</p>
<p>1105<br>01:09:01,739 –&gt; 01:09:03,539<br>If somebody can respond, that’d be great.</p>
<p>1106<br>01:09:05,539 –&gt; 01:09:06,539<br>I’m already here.</p>
<p>1107<br>01:09:06,539 –&gt; 01:09:07,819<br>Okay, good, good, good.</p>
<p>1108<br>01:09:07,819 –&gt; 01:09:08,659<br>Okay, great.</p>
<p>1109<br>01:09:08,659 –&gt; 01:09:11,220<br>I hear it at, like, sometimes people,</p>
<p>1110<br>01:09:11,220 –&gt; 01:09:12,460<br>because of the breakout rooms,</p>
<p>1111<br>01:09:12,460 –&gt; 01:09:14,460<br>I think that when you drop that of soon,</p>
<p>1112<br>01:09:14,460 –&gt; 01:09:16,100<br>I think it would be important.</p>
<p>1113<br>01:09:16,100 –&gt; 01:09:18,500<br>The key is that somebody’s going to do it.</p>
<p>1114<br>01:09:18,500 –&gt; 01:09:21,940<br>Past rooms, breakout, but hopefully,</p>
<p>1115<br>01:09:23,539 –&gt; 01:09:25,780<br>and I know exactly what to do about that.</p>
<p>1116<br>01:09:25,780 –&gt; 01:09:28,140<br>I guess we’re class and fault tolerance.</p>
<p>1117<br>01:09:28,140 –&gt; 01:09:30,740<br>It’s a little bit unfortunate that people could just drop.</p>
<p>1118<br>01:09:32,860 –&gt; 01:09:37,579<br>Okay, so any, I think the homework question this time</p>
<p>1119<br>01:09:37,579 –&gt; 01:09:39,860<br>around was going to be the most sort of straightforward.</p>
<p>1120<br>01:09:39,859 –&gt; 01:09:44,859<br>It has to be the case that you cannot install an old snapshot</p>
<p>1121<br>01:09:44,899 –&gt; 01:09:49,059<br>because a server that might have had a more recent snapshot</p>
<p>1122<br>01:09:49,059 –&gt; 01:09:50,699<br>might have responded to the client saying,</p>
<p>1123<br>01:09:50,699 –&gt; 01:09:53,179<br>like, yeah, the operation succeeded.</p>
<p>1124<br>01:09:53,179 –&gt; 01:09:55,460<br>And then if you would install an old snapshot,</p>
<p>1125<br>01:09:55,460 –&gt; 01:09:57,699<br>then you basically back out to the state</p>
<p>1126<br>01:09:57,699 –&gt; 01:09:59,659<br>and the client would see the certainly an old version</p>
<p>1127<br>01:09:59,659 –&gt; 01:10:00,500<br>of the server.</p>
<p>1128<br>01:10:00,500 –&gt; 01:10:02,299<br>So that’s certainly not legit.</p>
<p>1129<br>01:10:03,339 –&gt; 01:10:05,659<br>And so this little bit, you should definitely reject</p>
<p>1130<br>01:10:05,659 –&gt; 01:10:08,179<br>old snapshots, but you have to be a little bit careful.</p>
<p>1131<br>01:10:09,060 –&gt; 01:10:13,060<br>If the follower has a log that goes beyond the snapshot,</p>
<p>1132<br>01:10:13,060 –&gt; 01:10:18,060<br>you have to keep that remainder part of the log</p>
<p>1133<br>01:10:18,060 –&gt; 01:10:20,659<br>because basically you have promised to a leader</p>
<p>1134<br>01:10:20,659 –&gt; 01:10:22,340<br>that you have accepted a message.</p>
<p>1135<br>01:10:22,340 –&gt; 01:10:26,500<br>And so you can’t delete the rest of the log</p>
<p>1136<br>01:10:26,500 –&gt; 01:10:30,140<br>that was not covered by the snapshot.</p>
<p>1137<br>01:10:30,140 –&gt; 01:10:31,300<br>Okay?</p>
<p>1138<br>01:10:31,420 –&gt; 01:10:33,460<br>Okay, so then, let me return.</p>
<p>1139<br>01:10:36,420 –&gt; 01:10:39,420<br>We had a question actually.</p>
<p>1140<br>01:10:40,940 –&gt; 01:10:41,940<br>Okay, go ahead.</p>
<p>1141<br>01:10:41,940 –&gt; 01:10:45,100<br>So it says, it says in the paper, right?</p>
<p>1142<br>01:10:45,100 –&gt; 01:10:47,420<br>If the follower receives a snapshot,</p>
<p>1143<br>01:10:47,420 –&gt; 01:10:49,940<br>that’s a prefix of its log, right?</p>
<p>1144<br>01:10:49,940 –&gt; 01:10:50,779<br>Yep.</p>
<p>1145<br>01:10:50,779 –&gt; 01:10:55,579<br>The log entry is covered by the snapshot.</p>
<p>1146<br>01:10:55,579 –&gt; 01:10:57,420<br>I deleted, but the rest are kept.</p>
<p>1147<br>01:10:57,420 –&gt; 01:10:58,260<br>Yep.</p>
<p>1148<br>01:10:58,260 –&gt; 01:11:03,260<br>And that case is the state machine wouldn’t be overwritten,</p>
<p>1149<br>01:11:03,260 –&gt; 01:11:05,260<br>right? In this case.</p>
<p>1150<br>01:11:05,260 –&gt; 01:11:07,260<br>Okay, so the interesting question is like,</p>
<p>1151<br>01:11:07,260 –&gt; 01:11:12,260<br>how does the snapshot get communicated to the state machine?</p>
<p>1152<br>01:11:12,260 –&gt; 01:11:15,260<br>And as you will see in lab 3,</p>
<p>1153<br>01:11:15,260 –&gt; 01:11:17,260<br>that goes over the applied channel.</p>
<p>1154<br>01:11:17,260 –&gt; 01:11:21,260<br>And so the state machine will get the snapshot</p>
<p>1155<br>01:11:21,260 –&gt; 01:11:22,260<br>over the applied channel.</p>
<p>1156<br>01:11:22,260 –&gt; 01:11:27,260<br>And then again, the state machine will get the snapshot</p>
<p>1157<br>01:11:27,260 –&gt; 01:11:30,260<br>and then it’s up to you to do the right thing.</p>
<p>1158<br>01:11:32,260 –&gt; 01:11:33,260<br>Okay.</p>
<p>1159<br>01:11:33,260 –&gt; 01:11:34,260<br>Okay.</p>
<p>1160<br>01:11:36,260 –&gt; 01:11:37,260<br>Okay, good.</p>
<p>1161<br>01:11:37,260 –&gt; 01:11:39,260<br>Just a follow up on that.</p>
<p>1162<br>01:11:39,260 –&gt; 01:11:40,260<br>Sorry.</p>
<p>1163<br>01:11:40,260 –&gt; 01:11:41,260<br>Yeah.</p>
<p>1164<br>01:11:41,260 –&gt; 01:11:43,260<br>I was a little bit, so that makes sense to me.</p>
<p>1165<br>01:11:43,260 –&gt; 01:11:48,260<br>The part that I was confused by is in the, in the figure 13,</p>
<p>1166<br>01:11:48,260 –&gt; 01:11:51,260<br>like the box that describes the snapshot RPC.</p>
<p>1167<br>01:11:51,260 –&gt; 01:11:53,260<br>Yep.</p>
<p>1168<br>01:11:53,260 –&gt; 01:11:55,260<br>On six, it says,</p>
<p>1169<br>01:11:55,260 –&gt; 01:11:58,260<br>the existing log entry has the same index as the term snapshot,</p>
<p>1170<br>01:11:58,260 –&gt; 01:12:00,260<br>class include entry.</p>
<p>1171<br>01:12:00,260 –&gt; 01:12:04,260<br>Um,</p>
<p>1172<br>01:12:04,260 –&gt; 01:12:06,260<br>well, I’m,</p>
<p>1173<br>01:12:06,260 –&gt; 01:12:08,260<br>I might have just mixed reddit.</p>
<p>1174<br>01:12:08,260 –&gt; 01:12:09,260<br>Okay.</p>
<p>1175<br>01:12:09,260 –&gt; 01:12:11,260<br>Why do you keep thinking about it and look in?</p>
<p>1176<br>01:12:11,260 –&gt; 01:12:12,260<br>Yeah.</p>
<p>1177<br>01:12:12,260 –&gt; 01:12:13,260<br>If I have a question.</p>
<p>1178<br>01:12:13,260 –&gt; 01:12:14,260<br>I’ll ask you.</p>
<p>1179<br>01:12:14,260 –&gt; 01:12:17,260<br>Yeah, take it offline and we’ll do it right after lecture if you want to.</p>
<p>1180<br>01:12:17,260 –&gt; 01:12:18,260<br>Okay.</p>
<p>1181<br>01:12:18,260 –&gt; 01:12:20,260<br>I want to go back actually for a couple minutes, you know,</p>
<p>1182<br>01:12:20,260 –&gt; 01:12:22,260<br>that we have remaining and talk about actually using raft.</p>
<p>1183<br>01:12:22,260 –&gt; 01:12:27,260<br>And we should sort of a discussion that we’re already basically having here.</p>
<p>1184<br>01:12:27,260 –&gt; 01:12:29,260<br>Now for a service.</p>
<p>1185<br>01:12:29,260 –&gt; 01:12:34,260<br>Okay. So again, I’m going to focus on the replicated key value service that’s going to be the top of the plot free.</p>
<p>1186<br>01:12:34,260 –&gt; 01:12:38,260<br>And so just to go back to almost like one of the first, you know,</p>
<p>1187<br>01:12:38,260 –&gt; 01:12:41,260<br>boards that I drew at the beginning of the ref lectures.</p>
<p>1188<br>01:12:41,260 –&gt; 01:12:49,260<br>Here’s like our boxes, you know, that correspond to the free replica.</p>
<p>1189<br>01:12:49,260 –&gt; 01:12:53,260<br>And each replica correct, you know, has a sort of split.</p>
<p>1190<br>01:12:53,260 –&gt; 01:12:54,260<br>Two pieces.</p>
<p>1191<br>01:12:54,260 –&gt; 01:13:01,260<br>One is the service part.</p>
<p>1192<br>01:13:01,260 –&gt; 01:13:04,260<br>And one is the raft library.</p>
<p>1193<br>01:13:04,260 –&gt; 01:13:15,260<br>We know that basically they screen the case to approve the applied channel unless the way to information flow from raft to the service.</p>
<p>1194<br>01:13:15,260 –&gt; 01:13:19,260<br>And so clients, you know, interact.</p>
<p>1195<br>01:13:19,260 –&gt; 01:13:22,260<br>You know, with the service, you know, not directly with raft.</p>
<p>1196<br>01:13:22,260 –&gt; 01:13:24,260<br>So we have a client here.</p>
<p>1197<br>01:13:24,260 –&gt; 01:13:28,260<br>You know, that sends an operation like a food operator or get operation for the service.</p>
<p>1198<br>01:13:28,260 –&gt; 01:13:31,260<br>The service receives, you know, this operation.</p>
<p>1199<br>01:13:31,260 –&gt; 01:13:35,260<br>And it basically calls start.</p>
<p>1200<br>01:13:35,260 –&gt; 01:13:40,260<br>You know, for that operation, then raft does it’s a chit chat, you know, with, you know, the other.</p>
<p>1201<br>01:13:40,260 –&gt; 01:13:44,260<br>Graph libraries, you know, messages can flow back.</p>
<p>1202<br>01:13:44,260 –&gt; 01:13:46,260<br>And at some point the operation is committed.</p>
<p>1203<br>01:13:46,260 –&gt; 01:13:51,260<br>And then it actually is, you know, raft will say, look at this operation is ready to be committed.</p>
<p>1204<br>01:13:51,260 –&gt; 01:13:53,260<br>Senses on the applied channel.</p>
<p>1205<br>01:13:53,260 –&gt; 01:13:58,260<br>And the service then basically execute the operation and send the response back, you know, after it executed the operation.</p>
<p>1206<br>01:13:58,260 –&gt; 01:14:05,260<br>The response back to the client saying like, well, the value or the get, you know, key 20, you know, is this.</p>
<p>1207<br>01:14:05,260 –&gt; 01:14:07,260<br>Right. So this is a get operation.</p>
<p>1208<br>01:14:07,260 –&gt; 01:14:10,260<br>Or put.</p>
<p>1209<br>01:14:10,260 –&gt; 01:14:16,260<br>And this is basically the value for the get or, you know, okay, which exceed it.</p>
<p>1210<br>01:14:16,260 –&gt; 01:14:19,260<br>And we also discovered in the last lecture that.</p>
<p>1211<br>01:14:19,260 –&gt; 01:14:26,260<br>It might be the case that the client, you know, sends an RPC to the service and the, you know, the RPC disappears.</p>
<p>1212<br>01:14:26,260 –&gt; 01:14:29,260<br>And so the client must be more recent.</p>
<p>1213<br>01:14:29,260 –&gt; 01:14:33,260<br>And by the time the recent is actually, you know, the leader might not need the leader anymore.</p>
<p>1214<br>01:14:33,260 –&gt; 01:14:37,260<br>And so in that case, it has to redirect itself to another year.</p>
<p>1215<br>01:14:37,260 –&gt; 01:14:39,260<br>And so basically what are a little bit of code.</p>
<p>1216<br>01:14:39,260 –&gt; 01:14:41,260<br>What I want you to think about this.</p>
<p>1217<br>01:14:41,260 –&gt; 01:14:46,260<br>There’s a little bit of code at the client site that sort of understands replicated state machines a little bit.</p>
<p>1218<br>01:14:46,260 –&gt; 01:14:48,260<br>And it maintains some information.</p>
<p>1219<br>01:14:48,260 –&gt; 01:14:50,260<br>It maintains like who’s the leader.</p>
<p>1220<br>01:14:50,260 –&gt; 01:14:52,260<br>And who are the other followers.</p>
<p>1221<br>01:14:52,260 –&gt; 01:14:55,260<br>And so that can switch, you know, between them.</p>
<p>1222<br>01:14:55,260 –&gt; 01:14:57,260<br>If necessary.</p>
<p>1223<br>01:14:57,260 –&gt; 01:15:05,260<br>We also last time talked a little bit about that it’s possible that, you know, operation can be duplicated right because you know the.</p>
<p>1224<br>01:15:05,260 –&gt; 01:15:10,260<br>The client may send an operation put operation to the servers.</p>
<p>1225<br>01:15:10,260 –&gt; 01:15:14,260<br>And the, but you know, the client doesn’t get a response.</p>
<p>1226<br>01:15:14,260 –&gt; 01:15:16,260<br>But the service actually received it.</p>
<p>1227<br>01:15:16,260 –&gt; 01:15:20,260<br>So it went through and I went through the whole operation sequence.</p>
<p>1228<br>01:15:20,260 –&gt; 01:15:29,260<br>You know, starting the draft a pants can go through the graph motion and then basically sending it out to the client channel.</p>
<p>1229<br>01:15:29,260 –&gt; 01:15:33,260<br>And so basically the client actually might send the second one.</p>
<p>1230<br>01:15:33,260 –&gt; 01:15:37,260<br>And, you know, the, and basically for the repetition.</p>
<p>1231<br>01:15:37,260 –&gt; 01:15:42,260<br>You know, that might actually go through, you know, the graph library to comes out on the applied channel.</p>
<p>1232<br>01:15:42,260 –&gt; 01:15:45,260<br>And so, you know, you have to do some duplicate detection detection.</p>
<p>1233<br>01:15:45,260 –&gt; 01:15:46,260<br>And then multiple ways of doing it.</p>
<p>1234<br>01:15:46,260 –&gt; 01:15:48,260<br>But either way, you have to do duplicate detection.</p>
<p>1235<br>01:15:48,260 –&gt; 01:15:55,260<br>And so in addition to sort of maintaining some state about like what the leader and the followers are.</p>
<p>1236<br>01:15:55,260 –&gt; 01:15:58,260<br>The Putin get also actually have an idea.</p>
<p>1237<br>01:15:58,260 –&gt; 01:16:00,260<br>An idea associated with it.</p>
<p>1238<br>01:16:00,260 –&gt; 01:16:05,260<br>And the client needs to maintain what is the last ID that it actually is trying to get through.</p>
<p>1239<br>01:16:05,260 –&gt; 01:16:08,260<br>And that is used to actually do duplicate detection.</p>
<p>1240<br>01:16:08,260 –&gt; 01:16:12,260<br>And this little piece of code is often called a clerk.</p>
<p>1241<br>01:16:12,260 –&gt; 01:16:18,260<br>And the clerk that interacts, you know, with the service and that does a little bit of work to collaborate with the service to actually get the right thing done.</p>
<p>1242<br>01:16:18,260 –&gt; 01:16:27,260<br>And so we have multiple clients all have a clerical library, if you’re real, which is a go package.</p>
<p>1243<br>01:16:27,260 –&gt; 01:16:36,260<br>And you know, the clients basically talk Putin gets, you know, over that interface and inside of the clerk actually maintains these IDs.</p>
<p>1244<br>01:16:36,260 –&gt; 01:16:43,260<br>Or maintains one idea for the outstanding, you know, Putin get operation as well as some information about like who’s part of the cluster.</p>
<p>1245<br>01:16:43,260 –&gt; 01:16:44,260<br>Okay.</p>
<p>1246<br>01:16:44,260 –&gt; 01:16:46,260<br>Does that all make sense?</p>
<p>1247<br>01:16:46,260 –&gt; 01:16:51,260<br>So that’s sort of the basic structure, correct? And like how raft fits into a larger picture.</p>
<p>1248<br>01:16:51,260 –&gt; 01:17:05,260<br>And one question that comes all the way up is like what, you know, what is the guarantees, you know, the servers and the clerk together make to declines about this Putin get operations.</p>
<p>1249<br>01:17:05,260 –&gt; 01:17:12,260<br>And this really means, you know, what is the correctness criteria?</p>
<p>1250<br>01:17:12,260 –&gt; 01:17:19,260<br>And the way we always have described this so far, we’ve been reasonable sloppy about it, where I’ve been sloppy about it.</p>
<p>1251<br>01:17:19,260 –&gt; 01:17:33,260<br>And the thing that I’ve said is like, well, it should behave like a single machine.</p>
<p>1252<br>01:17:33,260 –&gt; 01:17:43,260<br>And that is a little bit of an imprecise definition because what happens is two clients basically at the same time, you know, actually could have put her get operation and what actually is the correct outcome.</p>
<p>1253<br>01:17:43,260 –&gt; 01:17:53,260<br>These operations. So we need really need to sort of a little bit more precisely, you know, I think like behaving like a single machine is the right intuition, but we need to a little bit of precisely definition.</p>
<p>1254<br>01:17:53,260 –&gt; 01:18:05,260<br>You saw the term used in the paper in this definition is called linearizability.</p>
<p>1255<br>01:18:05,260 –&gt; 01:18:12,260<br>And linearizability is basically spec, you know, specification of what values a put and get operation can return.</p>
<p>1256<br>01:18:12,260 –&gt; 01:18:17,260<br>And basically, there’s in since put there’s really up and return operations really what get can actually return.</p>
<p>1257<br>01:18:17,260 –&gt; 01:18:28,260<br>And basically says like what are allowed things to be returned and what are things that are not allowed to be returned independent of right to how you implement it, but just like a purely specification.</p>
<p>1258<br>01:18:28,260 –&gt; 01:18:32,260<br>And it basically has three components to linearizability.</p>
<p>1259<br>01:18:32,260 –&gt; 01:18:52,260<br>linearizability says like if you have to look at some sequence of operations and some of them executed concurrently, it has to be the case that there’s a total order. So you can arrange all the operation in some total order.</p>
<p>1260<br>01:18:52,260 –&gt; 01:18:58,260<br>So you can decide operations to.</p>
<p>1261<br>01:18:58,260 –&gt; 01:19:06,260<br>It has to match real time.</p>
<p>1262<br>01:19:06,260 –&gt; 01:19:24,260<br>With that, I mean that if an operation completed before a second operation started, even if those operations are different machines, it has to be the case that in this total order, the first operation shows up before the second operation.</p>
<p>1263<br>01:19:24,260 –&gt; 01:19:34,260<br>And that sort of makes sense, right, like if it behaves like a single machine and you start an operation last after another operation, then the single machine would always return the results of the first operation.</p>
<p>1264<br>01:19:34,260 –&gt; 01:19:37,260<br>So, and then finally a read operation.</p>
<p>1265<br>01:19:37,260 –&gt; 01:19:46,260<br>So this is like in our case in the key value server, it only has one read operation they will get. But the read operation should always return.</p>
<p>1266<br>01:19:46,260 –&gt; 01:19:49,260<br>So the results.</p>
<p>1267<br>01:19:49,260 –&gt; 01:19:56,260<br>Of the last right.</p>
<p>1268<br>01:19:56,260 –&gt; 01:20:10,260<br>So in our case, you know, we do a get operation and the put operation happened well before it and complete well before then that get operation suit of zero of the last.</p>
<p>1269<br>01:20:10,260 –&gt; 01:20:22,260<br>So this sort of a sort of a free conditions, you know, that what to determine whether system actually has linear is ability.</p>
<p>1270<br>01:20:22,260 –&gt; 01:20:27,260<br>And you can think about the interisability as well, well, you just behave like a single machine.</p>
<p>1271<br>01:20:27,260 –&gt; 01:20:31,260<br>So let me make a little bit more concrete because there’s a little bit abstract.</p>
<p>1272<br>01:20:31,260 –&gt; 01:20:44,260<br>The way basically people think about linear is ability or like our unit of system is realized a little bit is looking at particular history or executions and then see.</p>
<p>1273<br>01:20:44,260 –&gt; 01:20:53,260<br>Let’s see if you can use histories if you can turn that into a total order, even though the operations actually might have actually executed concurrently.</p>
<p>1274<br>01:20:53,260 –&gt; 01:21:04,260<br>Let me give you one example of a trivial example. So let’s say we have three clients, you won C two, see three and they do a bunch of puts against.</p>
<p>1275<br>01:21:04,260 –&gt; 01:21:10,260<br>So in a typically the way, you know, basically say there has to be some start point where the operation started.</p>
<p>1276<br>01:21:10,260 –&gt; 01:21:13,260<br>And there’s some end points where the operation ends.</p>
<p>1277<br>01:21:13,260 –&gt; 01:21:19,260<br>So example, we’re next to the client actually gets the return from the surface.</p>
<p>1278<br>01:21:19,260 –&gt; 01:21:26,260<br>And so let’s say this is right operation, you know, to the value to the variable X and we write one to it.</p>
<p>1279<br>01:21:26,260 –&gt; 01:21:33,260<br>So the client one started at some point in operation to the very next to the right one and then it’s going to at some point here.</p>
<p>1280<br>01:21:33,260 –&gt; 01:21:39,260<br>Now maybe you did a second one.</p>
<p>1281<br>01:21:39,260 –&gt; 01:21:41,260<br>And right to to it.</p>
<p>1282<br>01:21:41,260 –&gt; 01:21:46,260<br>So we have all the action and we’ve linearized ability is when operation happened to curve.</p>
<p>1283<br>01:21:46,260 –&gt; 01:21:56,260<br>So some operations start before another one actually finishes. So example, we might have the following operation client to does a read operation in our case would be again.</p>
<p>1284<br>01:21:56,260 –&gt; 01:22:01,260<br>And there’s a read of X and the value returned by this operations to.</p>
<p>1285<br>01:22:01,260 –&gt; 01:22:08,260<br>And then we have a similar sort of situation where I’m client free it actually starts an operation, a read operation.</p>
<p>1286<br>01:22:08,260 –&gt; 01:22:12,260<br>And at least X and returns one.</p>
<p>1287<br>01:22:12,260 –&gt; 01:22:16,260<br>Let me make this a little bit more clean.</p>
<p>1288<br>01:22:16,260 –&gt; 01:22:30,260<br>The read operation actually returns before you know the right to operation starts for ends and same same from our actual and then the question of the always comes up is this a linear or a visible case is this linear or a visible execution.</p>
<p>1289<br>01:22:30,260 –&gt; 01:22:36,260<br>And if it’s going to rise well, then basically it means like this could happen on a single machine to.</p>
<p>1290<br>01:22:36,260 –&gt; 01:22:40,260<br>And so could just happen on a single machine.</p>
<p>1291<br>01:22:40,260 –&gt; 01:22:45,260<br>You just like abstract and think about it without actually having.</p>
<p>1292<br>01:22:45,260 –&gt; 01:22:51,260<br>Is this a legit outcome for basically where we need to look at is the outcomes of R2 and from C2 and RSC free.</p>
<p>1293<br>01:22:51,260 –&gt; 01:22:55,260<br>You know, is this a legit execution.</p>
<p>1294<br>01:22:55,260 –&gt; 01:23:03,260<br>I’m not sure I don’t really know what it means for a right to take like a long time.</p>
<p>1295<br>01:23:03,260 –&gt; 01:23:05,260<br>Well, I think about.</p>
<p>1296<br>01:23:05,260 –&gt; 01:23:07,260<br>Take a long time for that matter.</p>
<p>1297<br>01:23:07,260 –&gt; 01:23:09,260<br>Yeah, if you think about the.</p>
<p>1298<br>01:23:09,260 –&gt; 01:23:13,260<br>From the client perspective, right, it’s sent a request to the service.</p>
<p>1299<br>01:23:13,260 –&gt; 01:23:15,260<br>So that’s the starting of the right.</p>
<p>1300<br>01:23:15,260 –&gt; 01:23:21,260<br>And I’ve got to return value at some point from the service and that’s the end of the right.</p>
<p>1301<br>01:23:21,260 –&gt; 01:23:29,260<br>So in between all kinds of stuff happens, when that’s mean to the servers, the servers, you know, put it into draft, wrap, when you apply channel, blah, blah, lots of stuff happen.</p>
<p>1302<br>01:23:29,260 –&gt; 01:23:34,260<br>We really care about exactly what the information does at some point in government response.</p>
<p>1303<br>01:23:34,260 –&gt; 01:23:45,260<br>And so you can think about this, you know, there’s basically free concurrent clients, you know, they issued concurrent operations and we are wondering if this is actually legit outcome.</p>
<p>1304<br>01:23:45,260 –&gt; 01:23:58,260<br>I don’t think this could happen on a single machine because the right for two, it finishes after the read starts.</p>
<p>1305<br>01:23:58,260 –&gt; 01:24:00,260<br>Oh, sorry. Yeah, yeah, that’s right.</p>
<p>1306<br>01:24:00,260 –&gt; 01:24:04,260<br>But it seems like the right should happen before the read.</p>
<p>1307<br>01:24:04,260 –&gt; 01:24:09,260<br>And in this situation, it.</p>
<p>1308<br>01:24:09,260 –&gt; 01:24:12,260<br>It couldn’t happen if the right started after.</p>
<p>1309<br>01:24:12,260 –&gt; 01:24:17,260<br>If the right thing, if the right finishing after the rights restarted. Yeah.</p>
<p>1310<br>01:24:17,260 –&gt; 01:24:25,260<br>Yeah, okay, so one point we need to think of one idea of thinking about is that we can move, you know, and we have to construct a total order, right?</p>
<p>1311<br>01:24:25,260 –&gt; 01:24:31,260<br>And we can construct a total order where all the, you know, the operations line up, then, you know, it’s a valid, linearizable history.</p>
<p>1312<br>01:24:31,260 –&gt; 01:24:36,260<br>And so, so let’s construct a total order and then go back to this question that you just asked.</p>
<p>1313<br>01:24:36,260 –&gt; 01:24:41,260<br>So a total order, here’s a total order that I’m going to.</p>
<p>1314<br>01:24:41,260 –&gt; 01:24:48,260<br>So the first the right operation, then the read X one, then the right X to you.</p>
<p>1315<br>01:24:48,260 –&gt; 01:24:52,260<br>And then our X, you know, the read of X to, right?</p>
<p>1316<br>01:24:52,260 –&gt; 01:24:56,260<br>There’s a total order, all the operations are now happening sequentially.</p>
<p>1317<br>01:24:56,260 –&gt; 01:25:01,260<br>And, you know, we need to check whether this is our, this total order is correct.</p>
<p>1318<br>01:25:01,260 –&gt; 01:25:07,260<br>We’re responding to the linearizability definitions. Well, it has to be the case that operations that start.</p>
<p>1319<br>01:25:07,260 –&gt; 01:25:12,260<br>If an operation starts after some of their operations ends and needs to be after in the total order.</p>
<p>1320<br>01:25:12,260 –&gt; 01:25:19,260<br>And so we’re going to look at this. Let’s look at this. This one must start after WX one.</p>
<p>1321<br>01:25:19,260 –&gt; 01:25:23,260<br>And that is true correct in this total order.</p>
<p>1322<br>01:25:23,260 –&gt; 01:25:32,260<br>RX one must, you know, start after WX one because it actually returns, you know, the value, right?</p>
<p>1323<br>01:25:32,260 –&gt; 01:25:35,260<br>And that’s exactly in our total order that is also the case.</p>
<p>1324<br>01:25:35,260 –&gt; 01:25:42,260<br>RX to, you know, must start at WX to because it’s observed the result of this right.</p>
<p>1325<br>01:25:42,260 –&gt; 01:25:45,260<br>And, you know, that’s perfectly fine too.</p>
<p>1326<br>01:25:45,260 –&gt; 01:25:49,260<br>And basically, we want a way to think about it is that, you know, even though they executed this way,</p>
<p>1327<br>01:25:49,260 –&gt; 01:25:54,260<br>we’ve got some rearranged things now to sort of fit the total order.</p>
<p>1328<br>01:25:54,260 –&gt; 01:26:03,260<br>And so if we think about this, then this is a total legit execution where, you know, the operation format over the order.</p>
<p>1329<br>01:26:03,260 –&gt; 01:26:10,260<br>And so this is like what, what a single machine would do. So single machine could execute it the right double X on read X one, right X to read X to.</p>
<p>1330<br>01:26:10,260 –&gt; 01:26:14,260<br>And real perfectly fine.</p>
<p>1331<br>01:26:14,260 –&gt; 01:26:15,260<br>Okay.</p>
<p>1332<br>01:26:15,260 –&gt; 01:26:20,260<br>So let me make me to help hold this. I think about the history that is not linearizable.</p>
<p>1333<br>01:26:20,260 –&gt; 01:26:29,260<br>So let me look at the second one.</p>
<p>1334<br>01:26:29,260 –&gt; 01:26:36,260<br>And I’m going to come back on this on the first day anyway. So don’t worry if this, not make sense yet.</p>
<p>1335<br>01:26:36,260 –&gt; 01:26:40,260<br>But here’s another one. I got C one.</p>
<p>1336<br>01:26:40,260 –&gt; 01:26:44,260<br>Same thing, right X one.</p>
<p>1337<br>01:26:44,260 –&gt; 01:26:48,260<br>I got a sheet and a here right.</p>
<p>1338<br>01:26:48,260 –&gt; 01:26:50,260<br>X to.</p>
<p>1339<br>01:26:50,260 –&gt; 01:26:58,260<br>And there’s going to be a read that actually goes in the X one.</p>
<p>1340<br>01:26:58,260 –&gt; 01:27:01,260<br>And, what’s our reaction to.</p>
<p>1341<br>01:27:01,260 –&gt; 01:27:05,260<br>And then I got a C two, see free.</p>
<p>1342<br>01:27:05,260 –&gt; 01:27:07,260<br>See free.</p>
<p>1343<br>01:27:07,260 –&gt; 01:27:11,260<br>Start after the other read.</p>
<p>1344<br>01:27:11,260 –&gt; 01:27:15,260<br>And returns one.</p>
<p>1345<br>01:27:15,260 –&gt; 01:27:24,260<br>And the claim here is that it’s not possible to construct the total order that you know, I’m met you some innerizability.</p>
<p>1346<br>01:27:24,260 –&gt; 01:27:34,260<br>And one way, you know, one indication of this is that this read right that returned actual on started after the read that return to.</p>
<p>1347<br>01:27:34,260 –&gt; 01:27:41,260<br>And I will make this a little bit more precise later, but in a real, you know, single machine system that could have never happened.</p>
<p>1348<br>01:27:41,260 –&gt; 01:27:47,260<br>Right. Because that would have meant that the value change between R to an R is one.</p>
<p>1349<br>01:27:47,260 –&gt; 01:27:58,260<br>And you know, 50’s few operations that we have on the board that has to be the case that this R is one happened after that right.</p>
<p>1350<br>01:27:58,260 –&gt; 01:28:08,260<br>And this right must have happened after that right because they’re in total there, we have to respect, you know, the ordering of the single of C one.</p>
<p>1351<br>01:28:08,260 –&gt; 01:28:14,260<br>And so there’s no way to basically slot, you know, average one in the total order.</p>
<p>1352<br>01:28:14,260 –&gt; 01:28:21,260<br>And according to this picture, it should go after our edge one.</p>
<p>1353<br>01:28:21,260 –&gt; 01:28:34,260<br>And, but I can really not be true, because even the guy got our after our one that man is also after WX to so that must have read to, and not one.</p>
<p>1354<br>01:28:34,260 –&gt; 01:28:38,260<br>And that is not a linearized bill, not a linearizable.</p>
<p>1355<br>01:28:38,260 –&gt; 01:28:46,260<br>This is in execution.</p>
<p>1356<br>01:28:46,260 –&gt; 01:28:53,260<br>And another way of saying that is that this is what what what what is arts in returning here is really returning this tail value.</p>
<p>1357<br>01:28:53,260 –&gt; 01:28:58,260<br>Right. And that is not allowed.</p>
<p>1358<br>01:28:58,260 –&gt; 01:29:03,260<br>If machine behaves as like a single machine or replicate a server behaves like a single machine.</p>
<p>1359<br>01:29:03,260 –&gt; 01:29:08,260<br>And so I’m going to come back, you know, this to the lecture when next week when we talk about zookeeper.</p>
<p>1360<br>01:29:08,260 –&gt; 01:29:15,260<br>Because this is going to be a very important like notion of later as ability sort of a thing that shows up probably into paper.</p>
<p>1361<br>01:29:15,260 –&gt; 01:29:20,260<br>And there’s notion of stay value is also shows up probably.</p>
<p>1362<br>01:29:20,260 –&gt; 01:29:25,260<br>And so I’m running out of time and there’s going to resume that next week.</p>
<p>1363<br>01:29:25,260 –&gt; 01:29:30,260<br>Okay.</p>
<p>1364<br>01:29:30,260 –&gt; 01:29:34,260<br>Any further questions and people that need to leave please, you know, feel free to leave.</p>
<p>1365<br>01:29:34,260 –&gt; 01:29:37,260<br>And in fact, I hope you did.</p>
<p>1366<br>01:29:37,260 –&gt; 01:29:41,260<br>You want to make it responsible that you miss other classes.</p>
<p>1367<br>01:29:41,260 –&gt; 01:29:48,260<br>Is this considered like what type of consistency is this considered to be a strong consistency.</p>
<p>1368<br>01:29:48,260 –&gt; 01:29:53,260<br>And what really is sort of a precise definition of what’s strong consistency is.</p>
<p>1369<br>01:29:53,260 –&gt; 01:30:12,260<br>So like our intuition about what’s strong consistency is namely behaving like a single machine that the precise definition of people in using the technical literature is linearizability.</p>
<p>1370<br>01:30:12,260 –&gt; 01:30:20,260<br>How did they decide to have that property like why did they decide to have that property.</p>
<p>1371<br>01:30:20,260 –&gt; 01:30:24,260<br>There’s a couple of things one reason, you know, the reason.</p>
<p>1372<br>01:30:24,260 –&gt; 01:30:26,260<br>Okay, so it makes sort of sense.</p>
<p>1373<br>01:30:26,260 –&gt; 01:30:29,260<br>So if you think from this point of view.</p>
<p>1374<br>01:30:29,260 –&gt; 01:30:34,260<br>Like you want to behave, you want to make a replicated system behave like a single machine.</p>
<p>1375<br>01:30:34,260 –&gt; 01:30:45,260<br>And you want to only allow outcomes that are actually correspond to executions that the single machine could have done the next linearizability is a very intuitive definition for that.</p>
<p>1376<br>01:30:45,260 –&gt; 01:30:53,260<br>The database world has also some other terminology like serializability. This is also term that will show up in the term later.</p>
<p>1377<br>01:30:53,260 –&gt; 01:31:03,260<br>And basically the only difference between sort of linearizability and serializability is that serializability doesn’t require that matches real time.</p>
<p>1378<br>01:31:03,260 –&gt; 01:31:07,260<br>And so people have sort of different definitions of strong consistency, if you will.</p>
<p>1379<br>01:31:07,260 –&gt; 01:31:21,260<br>And the one that we’ll see most probably is linearizability which corresponds closest to like the machine behaves that replicate serves behave like a single machine.</p>
<p>1380<br>01:31:21,260 –&gt; 01:31:22,260<br>Thank you.</p>
<p>1381<br>01:31:22,260 –&gt; 01:31:25,260<br>You’re welcome.</p>
<p>1382<br>01:31:25,260 –&gt; 01:31:33,260<br>So I’m going to ask you a question about what happens during like a network partition.</p>
<p>1383<br>01:31:33,260 –&gt; 01:31:38,260<br>So I know it like so if a leader gets partition completely on their own, they’ll eventually time out.</p>
<p>1384<br>01:31:38,260 –&gt; 01:31:45,260<br>But if they have sort of like a few followers with them, they’ll stay the leader.</p>
<p>1385<br>01:31:45,260 –&gt; 01:31:48,260<br>And they won’t be able to commit anything because they’ll be in a minority.</p>
<p>1386<br>01:31:48,260 –&gt; 01:31:51,260<br>And they’ll be a new leader and they’ll be so.</p>
<p>1387<br>01:31:51,260 –&gt; 01:32:02,260<br>And they’ll be able to do whatever sort of recognize that maybe it’s a sale leader or do we just assume that eventually if the partition goes away.</p>
<p>1388<br>01:32:02,260 –&gt; 01:32:07,260<br>It’ll figure out because like I’m worried if there’s a client that’s talking to the sale leader.</p>
<p>1389<br>01:32:07,260 –&gt; 01:32:10,260<br>What is that client do?</p>
<p>1390<br>01:32:11,260 –&gt; 01:32:16,260<br>Okay, so this is a great question with this picture here hopefully will help.</p>
<p>1391<br>01:32:16,260 –&gt; 01:32:20,260<br>So the client will talk to the talks of this guy, right? Like who’s the leader?</p>
<p>1392<br>01:32:20,260 –&gt; 01:32:23,260<br>You see the picture.</p>
<p>1393<br>01:32:23,260 –&gt; 01:32:28,260<br>So let’s say you know this first box is the leader client talks about leader.</p>
<p>1394<br>01:32:28,260 –&gt; 01:32:32,260<br>The leader can’t commit any operations, correct?</p>
<p>1395<br>01:32:32,260 –&gt; 01:32:35,260<br>And so it won’t communicate anything on the apply channel.</p>
<p>1396<br>01:32:35,260 –&gt; 01:32:37,260<br>And so it will never respond to the client.</p>
<p>1397<br>01:32:37,260 –&gt; 01:32:41,260<br>Because there’s like no operation actually be it’s operations are not being executed.</p>
<p>1398<br>01:32:41,260 –&gt; 01:32:46,260<br>And so the client will just retry and just keep retry forever.</p>
<p>1399<br>01:32:46,260 –&gt; 01:32:52,260<br>Until you know until the client actually maybe tries another.</p>
<p>1400<br>01:32:52,260 –&gt; 01:32:59,260<br>You know one of the other followers correct that maintains you know who else is actually in the group.</p>
<p>1401<br>01:32:59,260 –&gt; 01:33:05,260<br>Or until the network heals.</p>
<p>1402<br>01:33:05,260 –&gt; 01:33:07,260<br>And the leader actually commit an operation.</p>
<p>1403<br>01:33:07,260 –&gt; 01:33:13,260<br>Gotcha. Wait, so doesn’t doesn’t the leader immediately reply those saying I got your request?</p>
<p>1404<br>01:33:13,260 –&gt; 01:33:15,260<br>Or doesn’t wait until it’s committed.</p>
<p>1405<br>01:33:15,260 –&gt; 01:33:16,260<br>He like free.</p>
<p>1406<br>01:33:16,260 –&gt; 01:33:21,260<br>It doesn’t communicate with the client until it actually has processed the request.</p>
<p>1407<br>01:33:21,260 –&gt; 01:33:28,260<br>And which means that the operation actually has run through graphed and come out of the apply channel and ask me executed by the service.</p>
<p>1408<br>01:33:28,260 –&gt; 01:33:33,260<br>Okay.</p>
<p>1409<br>01:33:33,260 –&gt; 01:33:40,260<br>Does that make sense? Yeah. So then so then the client could just implement a timeout where they’re like if it’s a certain amount of time and they haven’t received the commit.</p>
<p>1410<br>01:33:40,260 –&gt; 01:33:43,260<br>Assume that maybe I should try a different node.</p>
<p>1411<br>01:33:43,260 –&gt; 01:33:46,260<br>And then if it gets the new leader or a follower of the new leader.</p>
<p>1412<br>01:33:46,260 –&gt; 01:33:48,260<br>It’ll it’ll be back.</p>
<p>1413<br>01:33:48,260 –&gt; 01:33:49,260<br>No, no.</p>
<p>1414<br>01:33:49,260 –&gt; 01:33:53,260<br>So this clerk does exactly what this clerk should have does.</p>
<p>1415<br>01:33:53,260 –&gt; 01:33:57,260<br>So replace along with the service to actually do what you’re just said.</p>
<p>1416<br>01:33:57,260 –&gt; 01:33:59,260<br>Got it.</p>
<p>1417<br>01:33:59,260 –&gt; 01:34:01,260<br>Okay. Thank you.</p>
<p>1418<br>01:34:01,260 –&gt; 01:34:02,260<br>You’re welcome.</p>
<p>1419<br>01:34:02,260 –&gt; 01:34:05,260<br>Sorry, can you repeat again what the clerk does?</p>
<p>1420<br>01:34:05,260 –&gt; 01:34:11,260<br>The clerk is a little bit of like a stub or like a light little wide read the client links me.</p>
<p>1421<br>01:34:11,260 –&gt; 01:34:13,260<br>And so the client calls puts and gets.</p>
<p>1422<br>01:34:13,260 –&gt; 01:34:18,260<br>And the clerk actually is the interface that it talks to and the clerk can keep some information.</p>
<p>1423<br>01:34:18,260 –&gt; 01:34:21,260<br>Like who’s part of the.</p>
<p>1424<br>01:34:21,260 –&gt; 01:34:31,260<br>And then the clerk is the one who’s the leader and who are the followers at least what eight things is the leader in the followers.</p>
<p>1425<br>01:34:31,260 –&gt; 01:34:37,260<br>And when it’s in our PC, you know, to the service is a sensitive to the leader, but eight things is the current leader.</p>
<p>1426<br>01:34:37,260 –&gt; 01:34:42,260<br>And the servers into the whatever things is the current leader, the leader might actually be sponsoring like hey, I’m not the leader.</p>
<p>1427<br>01:34:42,260 –&gt; 01:34:47,260<br>And then it will try one of the others and updates information.</p>
<p>1428<br>01:34:47,260 –&gt; 01:34:50,260<br>It also will tag every.</p>
<p>1429<br>01:34:50,260 –&gt; 01:34:56,260<br>Put and get operation that the decision to client and that sense to the service, the unique ID.</p>
<p>1430<br>01:34:56,260 –&gt; 01:35:00,260<br>So the service can do duplicate detection.</p>
<p>1431<br>01:35:00,260 –&gt; 01:35:03,260<br>And this all comes up in lap three.</p>
<p>1432<br>01:35:03,260 –&gt; 01:35:05,260<br>So you will see there.</p>
<p>1433<br>01:35:05,260 –&gt; 01:35:13,260<br>And there’s no real clerk because the tester basically sort of sits on top of the directly on the raft interface and that’s a really interact through the clerk.</p>
<p>1434<br>01:35:13,260 –&gt; 01:35:16,260<br>But in lap three will interact through a clerk.</p>
<p>1435<br>01:35:16,260 –&gt; 01:35:20,260<br>So how did the clients generate unique IDs?</p>
<p>1436<br>01:35:20,260 –&gt; 01:35:23,260<br>I don’t know what to each other.</p>
<p>1437<br>01:35:23,260 –&gt; 01:35:26,260<br>Random big random numbers.</p>
<p>1438<br>01:35:26,260 –&gt; 01:35:31,260<br>So we’re just guessing and hoping rather than actually guaranteeing some sort of like incremental.</p>
<p>1439<br>01:35:31,260 –&gt; 01:35:41,260<br>One way to make it more guaranteedies were to take your IP address and append and random number.</p>
<p>1440<br>01:35:41,260 –&gt; 01:35:44,260<br>A question about the homework question.</p>
<p>1441<br>01:35:44,260 –&gt; 01:35:47,260<br>So I thought that it could go backwards in time.</p>
<p>1442<br>01:35:47,260 –&gt; 01:35:51,260<br>Like I read the paper and it says on page 12,</p>
<p>1443<br>01:35:51,260 –&gt; 01:36:00,260<br>it said that the if there’s a conflict right then the follower just describes this entire log and it’s also proceeded by the snapshot.</p>
<p>1444<br>01:36:00,260 –&gt; 01:36:05,260<br>So I wonder why.</p>
<p>1445<br>01:36:05,260 –&gt; 01:36:06,260<br>Let me guess.</p>
<p>1446<br>01:36:06,260 –&gt; 01:36:09,260<br>I don’t really know exactly the sentence where you’re referring to.</p>
<p>1447<br>01:36:09,260 –&gt; 01:36:10,260<br>To look it up again.</p>
<p>1448<br>01:36:10,260 –&gt; 01:36:12,260<br>It’s on page 12.</p>
<p>1449<br>01:36:12,260 –&gt; 01:36:14,260<br>It’s at the it’s towards the end of page 12.</p>
<p>1450<br>01:36:14,260 –&gt; 01:36:16,260<br>The second column here.</p>
<p>1451<br>01:36:16,260 –&gt; 01:36:18,260<br>So the second to last paragraph.</p>
<p>1452<br>01:36:18,260 –&gt; 01:36:21,260<br>So the log can go back right but not the state machine.</p>
<p>1453<br>01:36:21,260 –&gt; 01:36:25,260<br>Not oh, the log can the log can go back but not the state machine.</p>
<p>1454<br>01:36:25,260 –&gt; 01:36:30,260<br>What was the state machine like what you the committed entries, right?</p>
<p>1455<br>01:36:30,260 –&gt; 01:36:34,260<br>Yeah, the the the the log can go back because of income.</p>
<p>1456<br>01:36:34,260 –&gt; 01:36:36,260<br>Uncommitted entries can go back.</p>
<p>1457<br>01:36:36,260 –&gt; 01:36:41,260<br>This is like this whole ratio stuff that we talked about earlier.</p>
<p>1458<br>01:36:41,260 –&gt; 01:36:44,260<br>So actually the log can go back.</p>
<p>1459<br>01:36:44,260 –&gt; 01:36:49,260<br>Yeah, not the state machine, which is basically what you committed already.</p>
<p>1460<br>01:36:49,260 –&gt; 01:36:52,260<br>Yeah, the log can never go will never go back.</p>
<p>1461<br>01:36:52,260 –&gt; 01:36:54,260<br>We never bail out of committed operations.</p>
<p>1462<br>01:36:54,260 –&gt; 01:36:57,260<br>It can only bail out of race and committed operations.</p>
<p>1463<br>01:36:57,260 –&gt; 01:36:59,260<br>Yes, that is right.</p>
<p>1464<br>01:36:59,260 –&gt; 01:37:00,260<br>Okay, got it.</p>
<p>1465<br>01:37:00,260 –&gt; 01:37:02,260<br>That’s what I asked you.</p>
<p>1466<br>01:37:02,260 –&gt; 01:37:04,260<br>Can I ask a question about the third slide?</p>
<p>1467<br>01:37:04,260 –&gt; 01:37:08,260<br>Yeah, that’s the one right before this one.</p>
<p>1468<br>01:37:08,260 –&gt; 01:37:15,260<br>So could you just walk me through real quick what match index is doing on the right.</p>
<p>1469<br>01:37:15,260 –&gt; 01:37:18,260<br>Like when S2 is communicating with S3.</p>
<p>1470<br>01:37:18,260 –&gt; 01:37:21,260<br>Okay, let me start out as zero.</p>
<p>1471<br>01:37:21,260 –&gt; 01:37:22,260<br>Yep.</p>
<p>1472<br>01:37:22,260 –&gt; 01:37:26,260<br>So the whole mess to is communicating with who S3.</p>
<p>1473<br>01:37:26,260 –&gt; 01:37:28,260<br>Yeah, so basically, okay, so here.</p>
<p>1474<br>01:37:28,260 –&gt; 01:37:31,260<br>Match index is zero. Right, like so.</p>
<p>1475<br>01:37:31,260 –&gt; 01:37:33,260<br>And let me write it down as zero.</p>
<p>1476<br>01:37:33,260 –&gt; 01:37:34,260<br>Yeah.</p>
<p>1477<br>01:37:34,260 –&gt; 01:37:39,260<br>Okay, then it gets a no back so match index stay zero.</p>
<p>1478<br>01:37:39,260 –&gt; 01:37:40,260<br>Okay.</p>
<p>1479<br>01:37:40,260 –&gt; 01:37:46,260<br>Nothing there, but now it gets an okay back. So what does that imply?</p>
<p>1480<br>01:37:46,260 –&gt; 01:37:55,260<br>That implies that, you know, what did it send that send an heartbeat correct with four index for team.</p>
<p>1481<br>01:37:55,260 –&gt; 01:38:00,260<br>And including and the.</p>
<p>1482<br>01:38:00,260 –&gt; 01:38:03,260<br>So that means that S3.</p>
<p>1483<br>01:38:03,260 –&gt; 01:38:06,260<br>S3 is up to date through until 13.</p>
<p>1484<br>01:38:06,260 –&gt; 01:38:07,260<br>Great.</p>
<p>1485<br>01:38:07,260 –&gt; 01:38:11,260<br>That is next index that it actually has expects 13.</p>
<p>1486<br>01:38:11,260 –&gt; 01:38:15,260<br>And so the S2 knows now that it’s log.</p>
<p>1487<br>01:38:15,260 –&gt; 01:38:20,260<br>Matches until 13 after this message.</p>
<p>1488<br>01:38:20,260 –&gt; 01:38:22,260<br>Is it until 13 or until 12?</p>
<p>1489<br>01:38:22,260 –&gt; 01:38:24,260<br>It matches till 13.</p>
<p>1490<br>01:38:24,260 –&gt; 01:38:29,260<br>So the next thing that will be sent will be going index 13.</p>
<p>1491<br>01:38:29,260 –&gt; 01:38:33,260<br>So the next and the next and match index are going to be 13.</p>
<p>1492<br>01:38:33,260 –&gt; 01:38:38,260<br>Yeah, the next index is not used yet correct means empty.</p>
<p>1493<br>01:38:38,260 –&gt; 01:38:43,260<br>So basically the way, you know, they, you can do either way, right?</p>
<p>1494<br>01:38:43,260 –&gt; 01:38:49,260<br>You can either say the last one or their in a first that’s going to be the first next, you know, one.</p>
<p>1495<br>01:38:49,260 –&gt; 01:38:53,260<br>And in this case, they go by the first next one.</p>
<p>1496<br>01:38:53,260 –&gt; 01:38:57,260<br>So in this case, both of them are 13 for the next one.</p>
<p>1497<br>01:38:57,260 –&gt; 01:39:03,260<br>Yeah, so basically if you could think about this, this stage, right before like all the green stuff has happened.</p>
<p>1498<br>01:39:03,260 –&gt; 01:39:09,260<br>The match index.</p>
<p>1499<br>01:39:09,260 –&gt; 01:39:20,260<br>For three is 13 and the match index for itself.</p>
<p>1500<br>01:39:20,260 –&gt; 01:39:24,260<br>Two is also 13.</p>
<p>1501<br>01:39:24,260 –&gt; 01:39:27,260<br>Got it.</p>
<p>1502<br>01:39:27,260 –&gt; 01:39:29,260<br>Awesome. Thank you.</p>
<p>1503<br>01:39:29,260 –&gt; 01:39:32,260<br>You’re welcome.</p>
<p>1504<br>01:39:32,260 –&gt; 01:39:35,260<br>Actually, can I ask a full off on that?</p>
<p>1505<br>01:39:35,260 –&gt; 01:39:39,260<br>So when it sees as something matches.</p>
<p>1506<br>01:39:39,260 –&gt; 01:39:45,260<br>So for example, here on position 11, it’s all that matches.</p>
<p>1507<br>01:39:45,260 –&gt; 01:39:49,260<br>So if you can’t see it, then.</p>
<p>1508<br>01:39:49,260 –&gt; 01:39:54,260<br>It is a guarantee that everything before that matches to.</p>
<p>1509<br>01:39:54,260 –&gt; 01:39:56,260<br>Yes, right? Because hold on.</p>
<p>1510<br>01:39:56,260 –&gt; 01:39:59,260<br>I mean double double check. You’re talking about this message.</p>
<p>1511<br>01:39:59,260 –&gt; 01:40:01,260<br>Yeah, yeah.</p>
<p>1512<br>01:40:01,260 –&gt; 01:40:04,260<br>About like when it says okay, it checks.</p>
<p>1513<br>01:40:04,260 –&gt; 01:40:05,260<br>The next one.</p>
<p>1514<br>01:40:05,260 –&gt; 01:40:06,260<br>Yeah, yeah.</p>
<p>1515<br>01:40:06,260 –&gt; 01:40:11,260<br>Because that is the whole reason that this previous term and previous index are communicated correct to the faller.</p>
<p>1516<br>01:40:11,260 –&gt; 01:40:18,260<br>Okay, even need is the case that in the previous index 11 actually turn free.</p>
<p>1517<br>01:40:18,260 –&gt; 01:40:21,260<br>And if that’s true, that means that basically everything before that much match.</p>
<p>1518<br>01:40:21,260 –&gt; 01:40:24,260<br>And this is like this, whatever area there.</p>
<p>1519<br>01:40:24,260 –&gt; 01:40:28,260<br>Whatever the statement they call.</p>
<p>1520<br>01:40:28,260 –&gt; 01:40:36,260<br>This invariant that it is maintaining that like if something matches that like one index then everything before that much match to.</p>
<p>1521<br>01:40:36,260 –&gt; 01:40:37,260<br>Oh, okay.</p>
<p>1522<br>01:40:37,260 –&gt; 01:40:38,260<br>This is the ingredients.</p>
<p>1523<br>01:40:38,260 –&gt; 01:40:41,260<br>I think that’s the first thing that I see.</p>
<p>1524<br>01:40:41,260 –&gt; 01:40:44,260<br>Oh, and I had another follow up question.</p>
<p>1525<br>01:40:44,260 –&gt; 01:40:47,260<br>It was related to the question.</p>
<p>1526<br>01:40:47,260 –&gt; 01:40:50,260<br>On the lecture question that I wrote.</p>
<p>1527<br>01:40:50,260 –&gt; 01:40:52,260<br>I asked about the copy on right.</p>
<p>1528<br>01:40:52,260 –&gt; 01:40:54,260<br>For these options.</p>
<p>1529<br>01:40:54,260 –&gt; 01:40:55,260<br>No.</p>
<p>1530<br>01:40:55,260 –&gt; 01:40:58,260<br>And I think I don’t really understand what is being copied.</p>
<p>1531<br>01:40:58,260 –&gt; 01:41:01,260<br>Is it is it the page table or is it something?</p>
<p>1532<br>01:41:01,260 –&gt; 01:41:04,260<br>I think I think I responded.</p>
<p>1533<br>01:41:04,260 –&gt; 01:41:07,260<br>Yeah, I think email, but I just.</p>
<p>1534<br>01:41:07,260 –&gt; 01:41:09,260<br>Okay.</p>
<p>1535<br>01:41:09,260 –&gt; 01:41:10,260<br>Okay.</p>
<p>1536<br>01:41:10,260 –&gt; 01:41:11,260<br>Okay.</p>
<p>1537<br>01:41:11,260 –&gt; 01:41:12,260<br>Hold on a second.</p>
<p>1538<br>01:41:12,260 –&gt; 01:41:14,260<br>We’ll catch my breath.</p>
<p>1539<br>01:41:14,260 –&gt; 01:41:15,260<br>The.</p>
<p>1540<br>01:41:15,260 –&gt; 01:41:17,260<br>So, okay.</p>
<p>1541<br>01:41:17,260 –&gt; 01:41:20,260<br>The scenario is.</p>
<p>1542<br>01:41:20,260 –&gt; 01:41:24,260<br>Snap trust can be expensive because the snapshot might be large.</p>
<p>1543<br>01:41:24,260 –&gt; 01:41:25,260<br>It’s a gigabyte.</p>
<p>1544<br>01:41:25,260 –&gt; 01:41:29,260<br>You know, key values page table.</p>
<p>1545<br>01:41:29,260 –&gt; 01:41:31,260<br>It’s a gigabyte.</p>
<p>1546<br>01:41:31,260 –&gt; 01:41:33,260<br>You know, key value store.</p>
<p>1547<br>01:41:33,260 –&gt; 01:41:37,260<br>Then, you know, you need to write that gigabyte into disk.</p>
<p>1548<br>01:41:37,260 –&gt; 01:41:38,260<br>Right.</p>
<p>1549<br>01:41:38,260 –&gt; 01:41:40,260<br>And while you’re writing it to disk.</p>
<p>1550<br>01:41:40,260 –&gt; 01:41:44,260<br>If you don’t do anything clever, you cannot process any other food and get operations.</p>
<p>1551<br>01:41:44,260 –&gt; 01:41:47,260<br>That come in through the.</p>
<p>1552<br>01:41:47,260 –&gt; 01:41:48,260<br>The channels.</p>
<p>1553<br>01:41:48,260 –&gt; 01:41:52,260<br>Let me actually pop up this picture.</p>
<p>1554<br>01:41:52,260 –&gt; 01:41:53,260<br>Correct.</p>
<p>1555<br>01:41:53,260 –&gt; 01:41:55,260<br>So this deserves to decide to some point to take a checkpoint.</p>
<p>1556<br>01:41:55,260 –&gt; 01:41:56,260<br>You know, it’s a gigabyte.</p>
<p>1557<br>01:41:56,260 –&gt; 01:41:57,260<br>You have to write a gigabyte to this.</p>
<p>1558<br>01:41:57,260 –&gt; 01:42:00,260<br>And then you have to write it.</p>
<p>1559<br>01:42:00,260 –&gt; 01:42:01,260<br>You know, that’s expensive.</p>
<p>1560<br>01:42:01,260 –&gt; 01:42:05,260<br>So the plan, you know, the, I think the plan that the paper is hinting at.</p>
<p>1561<br>01:42:05,260 –&gt; 01:42:08,260<br>Is that what the service does.</p>
<p>1562<br>01:42:08,260 –&gt; 01:42:11,260<br>It’s, you know, calls fork.</p>
<p>1563<br>01:42:11,260 –&gt; 01:42:15,260<br>So when it makes, what’s the make of the checkpoints, it calls fork.</p>
<p>1564<br>01:42:15,260 –&gt; 01:42:18,260<br>And for it’s case of copy of that process, right?</p>
<p>1565<br>01:42:18,260 –&gt; 01:42:21,260<br>So now we have the operating system running.</p>
<p>1566<br>01:42:21,260 –&gt; 01:42:26,260<br>And we have now basically two processes that correspond to the server,</p>
<p>1567<br>01:42:26,260 –&gt; 01:42:29,260<br>the server, the server’s raft, server’s raft.</p>
<p>1568<br>01:42:29,260 –&gt; 01:42:32,260<br>And this is the copy.</p>
<p>1569<br>01:42:32,260 –&gt; 01:42:34,260<br>The child.</p>
<p>1570<br>01:42:34,260 –&gt; 01:42:37,260<br>The operating system uses copy and write.</p>
<p>1571<br>01:42:37,260 –&gt; 01:42:40,260<br>So when it made a copy of that second process.</p>
<p>1572<br>01:42:40,260 –&gt; 01:42:44,260<br>And just copy to page table, but didn’t copy physical memory.</p>
<p>1573<br>01:42:44,260 –&gt; 01:42:52,260<br>So basically, these two processes shared the same physical memory.</p>
<p>1574<br>01:42:52,260 –&gt; 01:42:55,260<br>And then we have the key value.</p>
<p>1575<br>01:42:55,260 –&gt; 01:42:58,260<br>Which holds, you know, the, our key value store.</p>
<p>1576<br>01:42:58,260 –&gt; 01:43:00,260<br>Right.</p>
<p>1577<br>01:43:00,260 –&gt; 01:43:03,260<br>And so now the idea is that the child, when it starts running,</p>
<p>1578<br>01:43:03,260 –&gt; 01:43:05,260<br>it starts making a checkpoint.</p>
<p>1579<br>01:43:05,260 –&gt; 01:43:06,260<br>Or snapshot.</p>
<p>1580<br>01:43:06,260 –&gt; 01:43:10,260<br>I can just write out, you know, the key value sort of.</p>
<p>1581<br>01:43:10,260 –&gt; 01:43:13,260<br>The key value store to disk.</p>
<p>1582<br>01:43:13,260 –&gt; 01:43:18,260<br>And in parallel, you know, the parent can just start processing new.</p>
<p>1583<br>01:43:18,260 –&gt; 01:43:21,260<br>You know, get input operations.</p>
<p>1584<br>01:43:21,260 –&gt; 01:43:24,260<br>Because if it does a put operation.</p>
<p>1585<br>01:43:24,260 –&gt; 01:43:28,260<br>And it wants to modify the, it will write, you know, to.</p>
<p>1586<br>01:43:28,260 –&gt; 01:43:33,260<br>The pages that correspond to the key value store that will result in a page fault.</p>
<p>1587<br>01:43:33,260 –&gt; 01:43:34,260<br>Right.</p>
<p>1588<br>01:43:34,260 –&gt; 01:43:35,260<br>And so the OS will get a page fault.</p>
<p>1589<br>01:43:35,260 –&gt; 01:43:38,260<br>And so the OS will copy that page.</p>
<p>1590<br>01:43:38,260 –&gt; 01:43:39,260<br>At that point.</p>
<p>1591<br>01:43:39,260 –&gt; 01:43:43,260<br>And then, you know, the first parent process can just update it.</p>
<p>1592<br>01:43:43,260 –&gt; 01:43:45,260<br>And this is all transparent to the child. Right.</p>
<p>1593<br>01:43:45,260 –&gt; 01:43:50,260<br>Which the child, you know, had a consistent snapshot of the whole dress space at the point of the fork.</p>
<p>1594<br>01:43:50,260 –&gt; 01:43:53,260<br>And so this allows basically the parent and child to run concurrently,</p>
<p>1595<br>01:43:53,260 –&gt; 01:43:56,260<br>still make a consistent snapshot.</p>
<p>1596<br>01:43:56,260 –&gt; 01:44:02,260<br>And the parent to actually make process new food and get operations.</p>
<p>1597<br>01:44:02,260 –&gt; 01:44:03,260<br>Is that more clear?</p>
<p>1598<br>01:44:03,260 –&gt; 01:44:04,260<br>Oh, yeah, yeah.</p>
<p>1599<br>01:44:04,260 –&gt; 01:44:05,260<br>Okay. I see.</p>
<p>1600<br>01:44:05,260 –&gt; 01:44:07,260<br>So the, we copy on right.</p>
<p>1601<br>01:44:07,260 –&gt; 01:44:11,260<br>The memory that holds the key value store.</p>
<p>1602<br>01:44:11,260 –&gt; 01:44:13,260<br>Okay. Okay. Okay.</p>
<p>1603<br>01:44:13,260 –&gt; 01:44:15,260<br>I see. Yeah. This makes it very clear.</p>
<p>1604<br>01:44:15,260 –&gt; 01:44:16,260<br>Thank you so much.</p>
<p>1605<br>01:44:16,260 –&gt; 01:44:18,260<br>Thank you.</p>
<p>1606<br>01:44:18,260 –&gt; 01:44:24,260<br>Any more questions?</p>
<p>1607<br>01:44:24,260 –&gt; 01:44:25,260<br>Yeah, I have.</p>
<p>1608<br>01:44:25,260 –&gt; 01:44:29,260<br>I guess this is sort of a weird scenario.</p>
<p>1609<br>01:44:29,260 –&gt; 01:44:31,260<br>And I’m not sure if this could actually.</p>
<p>1610<br>01:44:31,260 –&gt; 01:44:35,260<br>But what if so imagine that we’re always in the same term.</p>
<p>1611<br>01:44:35,260 –&gt; 01:44:37,260<br>And then.</p>
<p>1612<br>01:44:37,260 –&gt; 01:44:42,260<br>You get to a point where some nodes have disconnected, but they’re still the same term.</p>
<p>1613<br>01:44:42,260 –&gt; 01:44:44,260<br>The leader is still in the same term.</p>
<p>1614<br>01:44:44,260 –&gt; 01:44:48,260<br>And then at, at, at some point, they will.</p>
<p>1615<br>01:44:48,260 –&gt; 01:44:50,260<br>They will do a snapshot.</p>
<p>1616<br>01:44:50,260 –&gt; 01:44:52,260<br>And then all the logs will be compressed.</p>
<p>1617<br>01:44:52,260 –&gt; 01:44:54,260<br>And then they keep going forward.</p>
<p>1618<br>01:44:54,260 –&gt; 01:44:57,260<br>And now the logs are being popular again.</p>
<p>1619<br>01:44:57,260 –&gt; 01:44:58,260<br>And then.</p>
<p>1620<br>01:44:58,260 –&gt; 01:45:00,260<br>Let’s just say.</p>
<p>1621<br>01:45:00,260 –&gt; 01:45:02,260<br>15 logs have been added.</p>
<p>1622<br>01:45:02,260 –&gt; 01:45:03,260<br>And then after 10.</p>
<p>1623<br>01:45:03,260 –&gt; 01:45:04,260<br>They.</p>
<p>1624<br>01:45:04,260 –&gt; 01:45:05,260<br>Compressed them.</p>
<p>1625<br>01:45:05,260 –&gt; 01:45:07,260<br>And then they’re at index.</p>
<p>1626<br>01:45:07,260 –&gt; 01:45:08,260<br>They’re at X five again.</p>
<p>1627<br>01:45:08,260 –&gt; 01:45:10,260<br>And then the other nodes joined back in.</p>
<p>1628<br>01:45:10,260 –&gt; 01:45:12,260<br>And they’re also at index five of the same term.</p>
<p>1629<br>01:45:12,260 –&gt; 01:45:13,260<br>Is that a problem?</p>
<p>1630<br>01:45:13,260 –&gt; 01:45:15,260<br>Like how does.</p>
<p>1631<br>01:45:15,260 –&gt; 01:45:18,260<br>It’s almost like they’re on a, on a snapshot.</p>
<p>1632<br>01:45:18,260 –&gt; 01:45:20,260<br>E-poc of some sort.</p>
<p>1633<br>01:45:20,260 –&gt; 01:45:22,260<br>Okay, so it’s a little snapshot.</p>
<p>1634<br>01:45:22,260 –&gt; 01:45:23,260<br>Of course, found to an index.</p>
<p>1635<br>01:45:23,260 –&gt; 01:45:24,260<br>Right.</p>
<p>1636<br>01:45:24,260 –&gt; 01:45:25,260<br>Yeah.</p>
<p>1637<br>01:45:25,260 –&gt; 01:45:26,260<br>So, okay, let’s.</p>
<p>1638<br>01:45:26,260 –&gt; 01:45:27,260<br>Drive the drive.</p>
<p>1639<br>01:45:27,260 –&gt; 01:45:28,260<br>Like maybe.</p>
<p>1640<br>01:45:28,260 –&gt; 01:45:29,260<br>Drive your scenario.</p>
<p>1641<br>01:45:29,260 –&gt; 01:45:33,260<br>So we got a server that has some log.</p>
<p>1642<br>01:45:33,260 –&gt; 01:45:36,260<br>And you know, maybe I think you know, you’re talking about 10.</p>
<p>1643<br>01:45:36,260 –&gt; 01:45:37,260<br>And it took a snapshot at 10.</p>
<p>1644<br>01:45:37,260 –&gt; 01:45:38,260<br>Yeah.</p>
<p>1645<br>01:45:38,260 –&gt; 01:45:39,260<br>So let’s say that.</p>
<p>1646<br>01:45:39,260 –&gt; 01:45:40,260<br>Basically, yeah.</p>
<p>1647<br>01:45:40,260 –&gt; 01:45:42,260<br>So basically the first nine operations or maybe you,</p>
<p>1648<br>01:45:42,260 –&gt; 01:45:45,260<br>including 10 are in a snapshot.</p>
<p>1649<br>01:45:45,260 –&gt; 01:45:49,260<br>And then, okay, so there’s another note.</p>
<p>1650<br>01:45:49,260 –&gt; 01:45:51,260<br>That is.</p>
<p>1651<br>01:45:51,260 –&gt; 01:45:53,260<br>Same term.</p>
<p>1652<br>01:45:53,260 –&gt; 01:45:55,260<br>So all these entries have the same term, right?</p>
<p>1653<br>01:45:55,260 –&gt; 01:45:56,260<br>Like whatever.</p>
<p>1654<br>01:45:56,260 –&gt; 01:45:58,260<br>You know, one, one, one, one, one, one, one, one, one.</p>
<p>1655<br>01:45:58,260 –&gt; 01:45:59,260<br>Right.</p>
<p>1656<br>01:45:59,260 –&gt; 01:46:00,260<br>Yep.</p>
<p>1657<br>01:46:00,260 –&gt; 01:46:01,260<br>Yep.</p>
<p>1658<br>01:46:01,260 –&gt; 01:46:02,260<br>Yep.</p>
<p>1659<br>01:46:02,260 –&gt; 01:46:03,260<br>Yep.</p>
<p>1660<br>01:46:03,260 –&gt; 01:46:06,260<br>And so this note actually, but this note has only through 10.</p>
<p>1661<br>01:46:06,260 –&gt; 01:46:08,260<br>Greg and this guy has through 15.</p>
<p>1662<br>01:46:08,260 –&gt; 01:46:09,260<br>Let’s say.</p>
<p>1663<br>01:46:09,260 –&gt; 01:46:11,260<br>I think that’s what you’re sending Greg out.</p>
<p>1664<br>01:46:11,260 –&gt; 01:46:13,260<br>So you were no once.</p>
<p>1665<br>01:46:13,260 –&gt; 01:46:23,260<br>Here’s a one.</p>
<p>1666<br>01:46:23,260 –&gt; 01:46:26,260<br>Well, I think my.</p>
<p>1667<br>01:46:26,260 –&gt; 01:46:30,260<br>My thought is, well, here’s here’s a question I can answer.</p>
<p>1668<br>01:46:30,260 –&gt; 01:46:33,260<br>You know, when you take a snapshot, do you reset your index?</p>
<p>1669<br>01:46:33,260 –&gt; 01:46:34,260<br>Or do you keep counting?</p>
<p>1670<br>01:46:34,260 –&gt; 01:46:35,260<br>You keep that.</p>
<p>1671<br>01:46:35,260 –&gt; 01:46:36,260<br>Oh, okay.</p>
<p>1672<br>01:46:36,260 –&gt; 01:46:39,260<br>I was imagining it was like an array.</p>
<p>1673<br>01:46:39,260 –&gt; 01:46:42,260<br>And you saw your index goes backwards.</p>
<p>1674<br>01:46:42,260 –&gt; 01:46:47,260<br>So that if so that would be possible for you to have two different entries in the same term.</p>
<p>1675<br>01:46:47,260 –&gt; 01:46:48,260<br>With the same index.</p>
<p>1676<br>01:46:48,260 –&gt; 01:46:49,260<br>Yeah.</p>
<p>1677<br>01:46:49,260 –&gt; 01:46:50,260<br>That’s not a lot.</p>
<p>1678<br>01:46:50,260 –&gt; 01:46:51,260<br>Absolutely.</p>
<p>1679<br>01:46:51,260 –&gt; 01:46:52,260<br>Right.</p>
<p>1680<br>01:46:52,260 –&gt; 01:46:53,260<br>Yeah.</p>
<p>1681<br>01:46:53,260 –&gt; 01:46:54,260<br>Okay.</p>
<p>1682<br>01:46:54,260 –&gt; 01:46:55,260<br>I see.</p>
<p>1683<br>01:46:55,260 –&gt; 01:46:56,260<br>So.</p>
<p>1684<br>01:46:56,260 –&gt; 01:46:57,260<br>Okay.</p>
<p>1685<br>01:46:57,260 –&gt; 01:46:58,260<br>Okay.</p>
<p>1686<br>01:46:58,260 –&gt; 01:47:04,260<br>Okay.</p>
<p>1687<br>01:47:04,260 –&gt; 01:47:05,260<br>Yeah.</p>
<p>1688<br>01:47:05,260 –&gt; 01:47:06,260<br>Yeah.</p>
<p>1689<br>01:47:06,260 –&gt; 01:47:07,260<br>Yeah.</p>
<p>1690<br>01:47:07,260 –&gt; 01:47:11,260<br>When you cut, you know, like this part of the walk in index stays at 10.</p>
<p>1691<br>01:47:11,260 –&gt; 01:47:12,260<br>Got it.</p>
<p>1692<br>01:47:12,260 –&gt; 01:47:13,260<br>Got it.</p>
<p>1693<br>01:47:13,260 –&gt; 01:47:17,260<br>And so in fact, you know, when you do this in 2D, this is going to be slightly knowing.</p>
<p>1694<br>01:47:17,260 –&gt; 01:47:21,260<br>That because you presumably take advantage of the fact that those started the waters at 0.</p>
<p>1695<br>01:47:21,260 –&gt; 01:47:24,260<br>And what you’re now going to get is that the start of the later of zero walk might be 10.</p>
<p>1696<br>01:47:24,260 –&gt; 01:47:25,260<br>Mm hmm.</p>
<p>1697<br>01:47:25,260 –&gt; 01:47:26,260<br>So that’s what I was saying.</p>
<p>1698<br>01:47:26,260 –&gt; 01:47:27,260<br>I was saying that everywhere.</p>
<p>1699<br>01:47:27,260 –&gt; 01:47:28,260<br>Yeah.</p>
<p>1700<br>01:47:28,260 –&gt; 01:47:37,260<br>Oh, and then last thing really quickly, there, I think the reason I was confused earlier was in the, in the code for lab 2.</p>
<p>1701<br>01:47:37,260 –&gt; 01:47:38,260<br>Yeah.</p>
<p>1702<br>01:47:38,260 –&gt; 01:47:41,260<br>There’s a comment that says we’re supposed to return immediately.</p>
<p>1703<br>01:47:41,260 –&gt; 01:47:42,260<br>From start.</p>
<p>1704<br>01:47:42,260 –&gt; 01:47:43,260<br>Yeah.</p>
<p>1705<br>01:47:43,260 –&gt; 01:47:44,260<br>Yeah.</p>
<p>1706<br>01:47:44,260 –&gt; 01:47:46,260<br>Well, you, oh, yes.</p>
<p>1707<br>01:47:46,260 –&gt; 01:47:47,260<br>Meaning you.</p>
<p>1708<br>01:47:47,260 –&gt; 01:47:48,260<br>Okay.</p>
<p>1709<br>01:47:48,260 –&gt; 01:47:50,260<br>So let me go back to this picture here.</p>
<p>1710<br>01:47:50,260 –&gt; 01:47:51,260<br>Yeah.</p>
<p>1711<br>01:47:51,260 –&gt; 01:47:52,260<br>Hopefully.</p>
<p>1712<br>01:47:52,260 –&gt; 01:47:53,260<br>It’s getting really crowded.</p>
<p>1713<br>01:47:53,260 –&gt; 01:47:57,260<br>So we get an operation correct and we do the start operation.</p>
<p>1714<br>01:47:57,260 –&gt; 01:47:59,260<br>We call start.</p>
<p>1715<br>01:47:59,260 –&gt; 01:48:02,260<br>Oh, return immediately doesn’t necessarily mean reply.</p>
<p>1716<br>01:48:02,260 –&gt; 01:48:04,260<br>Is that exactly.</p>
<p>1717<br>01:48:04,260 –&gt; 01:48:05,260<br>Yeah, exactly.</p>
<p>1718<br>01:48:05,260 –&gt; 01:48:06,260<br>It just means reply back.</p>
<p>1719<br>01:48:06,260 –&gt; 01:48:07,260<br>Return to the service.</p>
<p>1720<br>01:48:07,260 –&gt; 01:48:10,260<br>Not to decline.</p>
<p>1721<br>01:48:10,260 –&gt; 01:48:11,260<br>I see.</p>
<p>1722<br>01:48:11,260 –&gt; 01:48:12,260<br>I see.</p>
<p>1723<br>01:48:12,260 –&gt; 01:48:13,260<br>Okay.</p>
<p>1724<br>01:48:13,260 –&gt; 01:48:14,260<br>Gotcha.</p>
<p>1725<br>01:48:14,260 –&gt; 01:48:19,260<br>I, yeah, I guess operating under the assumption that a return always is necessarily a reply.</p>
<p>1726<br>01:48:19,260 –&gt; 01:48:22,260<br>But that’s not, that’s not always the case.</p>
<p>1727<br>01:48:22,260 –&gt; 01:48:23,260<br>No, it’s not the case.</p>
<p>1728<br>01:48:23,260 –&gt; 01:48:26,260<br>I think there’s a way we call more clearing and lab free than they, you know, in lab 2.</p>
<p>1729<br>01:48:26,260 –&gt; 01:48:27,260<br>There’s a lot.</p>
<p>1730<br>01:48:27,260 –&gt; 01:48:28,260<br>There’s a little bit of weird.</p>
<p>1731<br>01:48:28,260 –&gt; 01:48:29,260<br>Correct.</p>
<p>1732<br>01:48:29,260 –&gt; 01:48:30,260<br>There’s no really.</p>
<p>1733<br>01:48:30,260 –&gt; 01:48:31,260<br>There’s no application bill.</p>
<p>1734<br>01:48:31,260 –&gt; 01:48:32,260<br>Yeah.</p>
<p>1735<br>01:48:32,260 –&gt; 01:48:33,260<br>Yeah.</p>
<p>1736<br>01:48:33,260 –&gt; 01:48:34,260<br>Okay. Well, thank you.</p>
<p>1737<br>01:48:34,260 –&gt; 01:48:35,260<br>This was really helpful.</p>
<p>1738<br>01:48:35,260 –&gt; 01:48:36,260<br>You’re welcome.</p>
<p>1739<br>01:48:36,260 –&gt; 01:48:37,260<br>Happy.</p>
<p>1740<br>01:48:37,260 –&gt; 01:48:38,260<br>Appreciate it.</p>
<p>1741<br>01:48:38,260 –&gt; 01:48:39,260<br>Yeah.</p>
<p>1742<br>01:48:39,260 –&gt; 01:48:41,260<br>Have a good one.</p>
<p>1743<br>01:48:41,260 –&gt; 01:48:42,260<br>Yeah, you too.</p>
<p>1744<br>01:48:42,260 –&gt; 01:48:43,260<br>Bye.</p>
<p>1745<br>01:48:43,260 –&gt; 01:48:45,260<br>Good luck with the last.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MIT6824 P7Lecture7 FaultTolerance Raft2</div>
      <div>http://example.com/2025/10/24/MIT6824 P7Lecture7-FaultTolerance-Raft2/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/24/MIT6824%20P8Lecture8-Lab2A_2BQA/" title="MIT6824 P8Lecture8 Lab2A_2BQA">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MIT6824 P8Lecture8 Lab2A_2BQA</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/24/MIT6824%20P4Lecture4Primary-BackupReplication/" title="MIT6824 P4Lecture4Primary BackupReplication">
                        <span class="hidden-mobile">MIT6824 P4Lecture4Primary BackupReplication</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
