

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:05,240Good afternoon, good morning, good evening, good night, wherever you are. 200:00:05,240 –&gt; 00:00:14,320So today I want to talk about the zookeeper and the background">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6824 P9Lecture9 Zookeeper">
<meta property="og:url" content="http://example.com/2025/10/24/MIT6824%20P9Lecture9-Zookeeper/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:05,240Good afternoon, good morning, good evening, good night, wherever you are. 200:00:05,240 –&gt; 00:00:14,320So today I want to talk about the zookeeper and the background">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-24T12:02:19.374Z">
<meta property="article:modified_time" content="2025-10-24T12:06:28.576Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MIT6824 P9Lecture9 Zookeeper - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MIT6824 P9Lecture9 Zookeeper"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-24 20:02" pubdate>
          2025年10月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          82 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MIT6824 P9Lecture9 Zookeeper</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:05,240<br>Good afternoon, good morning, good evening, good night, wherever you are.</p>
<p>2<br>00:00:05,240 –&gt; 00:00:14,320<br>So today I want to talk about the zookeeper and the background, the paper that we, you know,</p>
<p>3<br>00:00:14,320 –&gt; 00:00:19,359<br>was assigned for today, which is from 2010.</p>
<p>4<br>00:00:19,359 –&gt; 00:00:23,760<br>And so this is going to be, we’re going back in the last couple lectures.</p>
<p>5<br>00:00:23,760 –&gt; 00:00:29,719<br>I think we dove in quite a bit of detail into draft, including sort of looking at code.</p>
<p>6<br>00:00:29,719 –&gt; 00:00:36,439<br>So lectures from now on are going to be more conceptual and exploring ideas,</p>
<p>7<br>00:00:36,439 –&gt; 00:00:39,560<br>the interested systems through papers.</p>
<p>8<br>00:00:39,560 –&gt; 00:00:46,439<br>And the zookeeper one is particularly relevant to us because it has a little bit of a relationship</p>
<p>9<br>00:00:46,439 –&gt; 00:00:49,079<br>as we’ll see with lap three.</p>
<p>10<br>00:00:49,079 –&gt; 00:00:53,480<br>So we’ll allow us to talk about a little bit of some properties of lap three and particularly</p>
<p>11<br>00:00:53,480 –&gt; 00:00:55,280<br>linearizability.</p>
<p>12<br>00:00:55,280 –&gt; 00:00:59,519<br>But the zookeeper system, more importantly, is interesting because one, it’s a white</p>
<p>13<br>00:00:59,520 –&gt; 00:01:00,520<br>zoo system.</p>
<p>14<br>00:01:00,520 –&gt; 00:01:16,000<br>And practice well beyond Apache, well beyond Yahoo, there’s an open source Apache project</p>
<p>15<br>00:01:16,000 –&gt; 00:01:19,120<br>that is still active.</p>
<p>16<br>00:01:19,120 –&gt; 00:01:23,520<br>And what particularly was interesting about it for us in this lecture today is actually</p>
<p>17<br>00:01:23,520 –&gt; 00:01:25,480<br>high performance.</p>
<p>18<br>00:01:25,480 –&gt; 00:01:32,480<br>I mean, what’s higher performance than what actually a lap three is going to be.</p>
<p>19<br>00:01:32,480 –&gt; 00:01:36,760<br>And we’ll talk a little bit of detail about this.</p>
<p>20<br>00:01:36,760 –&gt; 00:01:39,800<br>And there’s sort of two reasons why is high performance.</p>
<p>21<br>00:01:39,800 –&gt; 00:01:47,680<br>One, the client operations are asynchronous.</p>
<p>22<br>00:01:47,680 –&gt; 00:01:51,800<br>And really what high performance here means is that we can, the system can process many</p>
<p>23<br>00:01:51,800 –&gt; 00:01:54,200<br>more operations per second.</p>
<p>24<br>00:01:54,200 –&gt; 00:01:57,120<br>So it’s really a throughput metric.</p>
<p>25<br>00:01:57,120 –&gt; 00:02:01,879<br>And the second reason, you know, it’s high performance is because it doesn’t provide strong</p>
<p>26<br>00:02:01,879 –&gt; 00:02:03,280<br>consistency.</p>
<p>27<br>00:02:03,280 –&gt; 00:02:05,280<br>So it doesn’t.</p>
<p>28<br>00:02:05,280 –&gt; 00:02:10,920<br>It has an interesting consistency definition.</p>
<p>29<br>00:02:10,920 –&gt; 00:02:16,719<br>And it gives us some freedom to execute this way, read operations on any replica and</p>
<p>30<br>00:02:16,719 –&gt; 00:02:20,080<br>therefore reconforms can scale.</p>
<p>31<br>00:02:20,080 –&gt; 00:02:23,879<br>Then the second aspect, you know, that is interesting from zookeeper is in addition to being</p>
<p>32<br>00:02:23,879 –&gt; 00:02:35,879<br>high performance in sort of a generic what they call a coordination service.</p>
<p>33<br>00:02:35,879 –&gt; 00:02:42,199<br>And the point being here is that there are many applications where you need to sort of</p>
<p>34<br>00:02:42,199 –&gt; 00:02:47,039<br>keep track of like who’s part of this cluster and who is the master.</p>
<p>35<br>00:02:47,039 –&gt; 00:02:53,439<br>So think about the map reduce or think about the GFS, the master in GFS needs to keep track</p>
<p>36<br>00:02:53,439 –&gt; 00:02:57,560<br>of like every chunk, you know, who are the servers that actually serve the brand that</p>
<p>37<br>00:02:57,560 –&gt; 00:03:01,359<br>served the chunk of moon servers actually is the master.</p>
<p>38<br>00:03:01,359 –&gt; 00:03:05,159<br>And so tracking that sort of configuration information, you know, comes up in lots of</p>
<p>39<br>00:03:05,159 –&gt; 00:03:06,159<br>distributed applications.</p>
<p>40<br>00:03:06,159 –&gt; 00:03:10,039<br>And zookeepers really designed, you know, to support that kind of thing.</p>
<p>41<br>00:03:10,039 –&gt; 00:03:16,039<br>So you can sort of outsource all the configuration management to zookeeper and then, you know,</p>
<p>42<br>00:03:16,039 –&gt; 00:03:22,120<br>focus the rest of your application development on other aspects of your distributed system.</p>
<p>43<br>00:03:22,120 –&gt; 00:03:23,120<br>Not okay.</p>
<p>44<br>00:03:23,120 –&gt; 00:03:27,719<br>So that’s sort of a brief introduction, you know, the topics that we’re going to be talking</p>
<p>45<br>00:03:27,719 –&gt; 00:03:28,719<br>about.</p>
<p>46<br>00:03:28,719 –&gt; 00:03:36,560<br>And as a usual, you know, feel free to interrupt at any time or something in the chat</p>
<p>47<br>00:03:36,560 –&gt; 00:03:37,560<br>message.</p>
<p>48<br>00:03:37,560 –&gt; 00:03:39,960<br>Let me actually pull up the chat.</p>
<p>49<br>00:03:39,960 –&gt; 00:03:40,960<br>Okay.</p>
<p>50<br>00:03:40,960 –&gt; 00:03:41,960<br>Good.</p>
<p>51<br>00:03:41,960 –&gt; 00:03:50,759<br>So just to start from the basics, zookeeper is a replicated state change.</p>
<p>52<br>00:03:50,759 –&gt; 00:04:03,639<br>In the same way, you know, the replicate state issues that we’ve been seeing.</p>
<p>53<br>00:04:03,639 –&gt; 00:04:06,639<br>And so let’s draw the usual picture.</p>
<p>54<br>00:04:06,639 –&gt; 00:04:07,639<br>We have some service.</p>
<p>55<br>00:04:07,639 –&gt; 00:04:11,840<br>In this case, it’s going to be a zookeeper and a ZK.</p>
<p>56<br>00:04:11,840 –&gt; 00:04:19,120<br>Now, it receives requests from clients that create the creators, you know, and basically</p>
<p>57<br>00:04:19,120 –&gt; 00:04:27,480<br>the way it interacts to distribute these operations, it has sort of a separate library.</p>
<p>58<br>00:04:27,480 –&gt; 00:04:31,920<br>You know, think about this as the graph library, the, you know, in our case, it’s called</p>
<p>59<br>00:04:31,920 –&gt; 00:04:32,920<br>ZAP.</p>
<p>60<br>00:04:32,920 –&gt; 00:04:41,680<br>And basically, you know, the leader sticks the operation into, you know, the equivalent</p>
<p>61<br>00:04:41,680 –&gt; 00:04:49,079<br>of the graph library that talks, you know, to, you know, other libraries on other peers.</p>
<p>62<br>00:04:49,079 –&gt; 00:04:54,240<br>And then basically creates, you know, a log, you know, that’s convinced with all these</p>
<p>63<br>00:04:54,240 –&gt; 00:04:57,000<br>operations and all these machines.</p>
<p>64<br>00:04:57,000 –&gt; 00:05:00,639<br>And then the operations are out of the log of feedback, you know, to the, through an,</p>
<p>65<br>00:05:00,639 –&gt; 00:05:06,360<br>so in our case, the, the apply channel to the service, the service applies the operation</p>
<p>66<br>00:05:06,360 –&gt; 00:05:07,360<br>in response to the client.</p>
<p>67<br>00:05:07,360 –&gt; 00:05:11,519<br>And so we have basically different versions of this running.</p>
<p>68<br>00:05:11,519 –&gt; 00:05:17,240<br>And so far, you know, in the labs, you know, we’ve been focusing mostly, you know, a lot</p>
<p>69<br>00:05:17,240 –&gt; 00:05:24,000<br>of food is all about, you know, this part, implementing, in our case, raft, so instead</p>
<p>70<br>00:05:24,000 –&gt; 00:05:25,000<br>of ZAP.</p>
<p>71<br>00:05:25,000 –&gt; 00:05:30,280<br>And for the first order, at a very high level, you know, you can think about ZAP just being</p>
<p>72<br>00:05:30,280 –&gt; 00:05:35,600<br>another raft, you know, providing sort of similar guarantees, although, you know, implemented</p>
<p>73<br>00:05:35,600 –&gt; 00:05:36,600<br>quite differently.</p>
<p>74<br>00:05:36,600 –&gt; 00:05:43,360<br>But, you know, it provides an order of all the operations, that it’s spiked failures,</p>
<p>75<br>00:05:43,360 –&gt; 00:05:47,600<br>network pickations, et cetera, et cetera, doesn’t shop for first-blit drain, brain, all</p>
<p>76<br>00:05:47,600 –&gt; 00:05:53,400<br>various sort of things that we sort of associate with the raft library.</p>
<p>77<br>00:05:53,400 –&gt; 00:05:58,120<br>And you know, what we’re going to be focusing in live free on is actually implementing a service</p>
<p>78<br>00:05:58,120 –&gt; 00:05:59,120<br>in public.</p>
<p>79<br>00:05:59,120 –&gt; 00:06:04,319<br>And so this paper talks about the Discordination service we keep going, we’re going to</p>
<p>80<br>00:06:04,319 –&gt; 00:06:12,560<br>actually implement in live free, a key value store.</p>
<p>81<br>00:06:12,560 –&gt; 00:06:17,120<br>And the data structure is just a map, you know, from keys to values.</p>
<p>82<br>00:06:17,120 –&gt; 00:06:22,879<br>And so the operations that we’re going to be supporting are, you know, putting it, so</p>
<p>83<br>00:06:22,879 –&gt; 00:06:27,160<br>the clients may put in get operations, you know, through the service, the service runs</p>
<p>84<br>00:06:27,160 –&gt; 00:06:33,920<br>them through the raft, and then applies them one by one to the key value store.</p>
<p>85<br>00:06:33,920 –&gt; 00:06:36,840<br>And in Zookyper, you know, the structures are slightly different, there’s just a tree</p>
<p>86<br>00:06:36,840 –&gt; 00:06:38,639<br>of Z nodes.</p>
<p>87<br>00:06:38,639 –&gt; 00:06:44,759<br>But the base operation is the plan is the same, you know, the lower layer, the lab, the</p>
<p>88<br>00:06:44,759 –&gt; 00:06:48,479<br>ZAP library or the raft library, or does all the operations, they’re applied in the same</p>
<p>89<br>00:06:48,479 –&gt; 00:06:54,360<br>order on all the replicas, because they’re applied all in the same order, there’s no non-determinism,</p>
<p>90<br>00:06:54,360 –&gt; 00:06:58,439<br>the resulting state on each of the replicas is going to be identical.</p>
<p>91<br>00:06:58,439 –&gt; 00:06:59,439<br>Okay.</p>
<p>92<br>00:06:59,439 –&gt; 00:07:06,599<br>That’s sort of the basic setting of this paper.</p>
<p>93<br>00:07:06,720 –&gt; 00:07:14,520<br>And sort of also the part of the relationship between lab 3 and the Zookyper search itself.</p>
<p>94<br>00:07:14,520 –&gt; 00:07:18,560<br>And mostly going to be talking in this lecture on focus on the Zookyper part itself, and</p>
<p>95<br>00:07:18,560 –&gt; 00:07:22,720<br>not talk about ZAP, because there’s going to assume, you know, that’s sort of similar</p>
<p>96<br>00:07:22,720 –&gt; 00:07:25,640<br>to what we’re doing in lab 2.</p>
<p>97<br>00:07:25,640 –&gt; 00:07:26,640<br>Okay.</p>
<p>98<br>00:07:26,640 –&gt; 00:07:35,920<br>I want to talk a little bit about what kind of performance would you observe if you want</p>
<p>99<br>00:07:35,920 –&gt; 00:07:41,960<br>to finish lab 3 and measure, you know, how many put in gets you operation, you can get</p>
<p>100<br>00:07:41,960 –&gt; 00:07:47,319<br>through percept, because like one of the achievements of this paper is this high performance.</p>
<p>101<br>00:07:47,319 –&gt; 00:07:50,080<br>So let’s think a little bit about that.</p>
<p>102<br>00:07:50,080 –&gt; 00:07:54,879<br>So let’s assume, you know, there’s a put operation coming in.</p>
<p>103<br>00:07:54,879 –&gt; 00:07:56,560<br>And you know, put a variation comes in by the leader.</p>
<p>104<br>00:07:56,560 –&gt; 00:07:59,560<br>And so we’re just going to go for the normal case, like the standard case where everything</p>
<p>105<br>00:07:59,560 –&gt; 00:08:03,160<br>is working, no network failure, no petition, nothing, everything works out perfectly.</p>
<p>106<br>00:08:03,720 –&gt; 00:08:06,840<br>Here’s the leader, you know, we got two followers.</p>
<p>107<br>00:08:09,480 –&gt; 00:08:13,960<br>And you know, just by now, you know, that protocol, you know, probably insight out, you know,</p>
<p>108<br>00:08:13,960 –&gt; 00:08:18,720<br>the first thing of course, it happens, like you would call the leadical start, the start</p>
<p>109<br>00:08:18,720 –&gt; 00:08:26,560<br>actually writes the put operation to its to the log in the leader.</p>
<p>110<br>00:08:26,560 –&gt; 00:08:31,600<br>And then the leader, you know, propagates its log to the other followers.</p>
<p>111<br>00:08:31,600 –&gt; 00:08:37,519<br>And so before that actually happens in parallel, let me draw this slightly differently.</p>
<p>112<br>00:08:40,000 –&gt; 00:08:46,720<br>Basically it launches a bunch of RPCs almost instantaneously to the different followers.</p>
<p>113<br>00:08:46,720 –&gt; 00:08:51,040<br>It’s fallen, of course, you know, well, a penalty entry to its log, so that it requires</p>
<p>114<br>00:08:51,040 –&gt; 00:08:56,000<br>a right, you know, to just install it, same thing here, and then they respond back.</p>
<p>115<br>00:08:56,960 –&gt; 00:08:59,039<br>And so here’s the response back.</p>
<p>116<br>00:08:59,039 –&gt; 00:09:04,720<br>And in this case, you know, if a majority has responded, the leader can actually apply the operation.</p>
<p>117<br>00:09:04,720 –&gt; 00:09:08,799<br>So the leader will actually apply the operation here for not indicated.</p>
<p>118<br>00:09:09,840 –&gt; 00:09:14,480<br>So do the put and send the response back to the client.</p>
<p>119<br>00:09:15,200 –&gt; 00:09:21,279<br>And so what we’re curious about is like how many puts, puts per second can we actually get, you know,</p>
<p>120<br>00:09:21,439 –&gt; 00:09:25,279<br>in this, in this setting.</p>
<p>121<br>00:09:26,240 –&gt; 00:09:31,120<br>And I know we’ll think about it in the, in when you’re just going to cross groups,</p>
<p>122<br>00:09:31,120 –&gt; 00:09:32,720<br>you know, back at the envelope calculation.</p>
<p>123<br>00:09:32,720 –&gt; 00:09:37,839<br>We don’t really care exactly about the exact numbers, but, you know, one round trip,</p>
<p>124<br>00:09:39,279 –&gt; 00:09:41,679<br>we need one of these one round trip to actually get the majority.</p>
<p>125<br>00:09:41,679 –&gt; 00:09:45,120<br>Right, the leader needs to talk to one, these one followers actually maintain the majority.</p>
<p>126<br>00:09:45,120 –&gt; 00:09:47,759<br>So we’re going to have at least one round trip messaging.</p>
<p>127<br>00:09:51,679 –&gt; 00:09:59,600<br>And then you sort of need to look at the rights to stable storage, because those tend to be expensive.</p>
<p>128<br>00:09:59,600 –&gt; 00:10:02,240<br>And we’ll see, you know, in this case, we’re going to have two rights.</p>
<p>129<br>00:10:02,240 –&gt; 00:10:05,199<br>But there’s going to be one right at the leader is one right at the follower.</p>
<p>130<br>00:10:05,199 –&gt; 00:10:08,480<br>At that point, we have at least two nodes that have a copy.</p>
<p>131<br>00:10:08,480 –&gt; 00:10:10,000<br>So one of the things will be committed.</p>
<p>132<br>00:10:11,839 –&gt; 00:10:13,120<br>If no, for failures.</p>
<p>133<br>00:10:14,000 –&gt; 00:10:18,480<br>And so, basically, you know, to a minimum, we’re going to need two rights.</p>
<p>134<br>00:10:18,480 –&gt; 00:10:24,080<br>So that sort of debates and the best you could do, right, at least in this sort of the simple scheme</p>
<p>135<br>00:10:24,080 –&gt; 00:10:25,920<br>that we discussed here.</p>
<p>136<br>00:10:25,920 –&gt; 00:10:28,800<br>And sort of know what we can think about like the cost is.</p>
<p>137<br>00:10:28,800 –&gt; 00:10:34,320<br>And in a round trip, you know, maybe you’re just running into data center networks or not across the internet.</p>
<p>138<br>00:10:34,320 –&gt; 00:10:37,279<br>You know, maybe you get all that actually comes down to one millisecond.</p>
<p>139<br>00:10:37,279 –&gt; 00:10:43,120<br>We’re roughly in the neighborhood of a millisecond, maybe a little bit faster,</p>
<p>140<br>00:10:43,120 –&gt; 00:10:44,240<br>but we’re going to care about it.</p>
<p>141<br>00:10:44,240 –&gt; 00:10:45,200<br>We’ll see in a second.</p>
<p>142<br>00:10:45,200 –&gt; 00:10:47,759<br>So we’re going to do two rights to stable storage.</p>
<p>143<br>00:10:48,720 –&gt; 00:10:51,439<br>And rights actually, two stable storage, tend to be expensive.</p>
<p>144<br>00:10:51,439 –&gt; 00:10:56,000<br>And you know, it depends on what medium or what technology you’re using for stable storage.</p>
<p>145<br>00:10:56,000 –&gt; 00:10:59,439<br>But let’s assume that we’re using SSDs, sort of pretty typical.</p>
<p>146<br>00:10:59,439 –&gt; 00:11:03,200<br>And then, you know, presumably one right is in the order of maybe two milliseconds.</p>
<p>147<br>00:11:03,200 –&gt; 00:11:07,200<br>You know, we’ve got to really make sure actually the right ends up on the in the SSD.</p>
<p>148<br>00:11:07,200 –&gt; 00:11:09,919<br>So we’ve got to probably have to be a synchronous right.</p>
<p>149<br>00:11:10,879 –&gt; 00:11:13,759<br>So a minute means like two milliseconds for one right.</p>
<p>150<br>00:11:13,759 –&gt; 00:11:16,960<br>You know, so two right would be roughly, you know, four milliseconds.</p>
<p>151<br>00:11:18,240 –&gt; 00:11:20,080<br>So we add it up.</p>
<p>152<br>00:11:20,080 –&gt; 00:11:21,759<br>You know, that’s going to be five milliseconds.</p>
<p>153<br>00:11:24,240 –&gt; 00:11:25,919<br>And so how many operations per second?</p>
<p>154<br>00:11:28,080 –&gt; 00:11:29,439<br>Just to see if anybody’s still awake.</p>
<p>155<br>00:11:33,759 –&gt; 00:11:34,799<br>So 100.</p>
<p>156<br>00:11:34,799 –&gt; 00:11:37,439<br>Yeah, so there’s going to be 200 puts per second.</p>
<p>157<br>00:11:40,960 –&gt; 00:11:41,919<br>Any questions about this?</p>
<p>158<br>00:11:41,919 –&gt; 00:11:42,639<br>Does this make sense?</p>
<p>159<br>00:11:43,120 –&gt; 00:11:48,639<br>Okay. So now let’s look at the shoe keeper.</p>
<p>160<br>00:11:48,639 –&gt; 00:11:51,039<br>What’s the round trip or in the rights?</p>
<p>161<br>00:11:51,039 –&gt; 00:11:52,159<br>I’m sorry, I missed it.</p>
<p>162<br>00:11:53,919 –&gt; 00:11:56,879<br>We have the four main the rights and the rights is no round trip.</p>
<p>163<br>00:11:56,879 –&gt; 00:11:59,519<br>There’s one round trip correct to talk from the leader to the follower.</p>
<p>164<br>00:11:59,519 –&gt; 00:12:02,480<br>And the two rights, one at the stable storage for the leader.</p>
<p>165<br>00:12:02,480 –&gt; 00:12:05,519<br>And one at the stable storage, stable storage of the follower.</p>
<p>166<br>00:12:07,279 –&gt; 00:12:09,120<br>And the two rights add up to four.</p>
<p>167<br>00:12:09,120 –&gt; 00:12:11,840<br>The round trip to roughly one milliseconds or the total five.</p>
<p>168<br>00:12:12,720 –&gt; 00:12:13,759<br>milliseconds for one put.</p>
<p>169<br>00:12:17,199 –&gt; 00:12:19,120<br>Okay, let’s look at the shoe keeper.</p>
<p>170<br>00:12:27,919 –&gt; 00:12:31,600<br>And again, the metric that the paper is interested in is the fruit,</p>
<p>171<br>00:12:31,600 –&gt; 00:12:34,799<br>the fruit metric where basically declines, you know, many, many, many,</p>
<p>172<br>00:12:34,799 –&gt; 00:12:39,679<br>clients and the pump, you know, many requests</p>
<p>173<br>00:12:40,479 –&gt; 00:12:46,399<br>to two shoe keeper as much as possible and</p>
<p>174<br>00:12:47,359 –&gt; 00:12:49,199<br>piped line democraciously.</p>
<p>175<br>00:12:49,919 –&gt; 00:12:54,239<br>And so, so let’s see what the results of that is.</p>
<p>176<br>00:12:54,879 –&gt; 00:13:00,239<br>And so let me pull up the graph of the paper.</p>
<p>177<br>00:13:04,240 –&gt; 00:13:07,759<br>And you know, let’s look at that paper a little, let the graph a little bit.</p>
<p>178<br>00:13:10,239 –&gt; 00:13:15,120<br>So a couple things that presumably to observe, you know, on the x-axis is the percentage of</p>
<p>179<br>00:13:15,120 –&gt; 00:13:20,079<br>read requests that we’ll see in a second period of this is going to be important to distinguish</p>
<p>180<br>00:13:20,079 –&gt; 00:13:23,759<br>read from right operations. And so right operations are really operations that modify</p>
<p>181<br>00:13:23,759 –&gt; 00:13:26,079<br>any right operation that modify to state.</p>
<p>182<br>00:13:26,079 –&gt; 00:13:29,199<br>And read operations are operations that don’t modify to state at all.</p>
<p>183<br>00:13:29,199 –&gt; 00:13:34,879<br>So in our, in the three terms, you know, put would be in a right operation and get the read</p>
<p>184<br>00:13:35,360 –&gt; 00:13:39,840<br>operation. And on the y-axis is the number operations per second.</p>
<p>185<br>00:13:39,840 –&gt; 00:13:42,159<br>And let’s look at the case of free servers.</p>
<p>186<br>00:13:42,159 –&gt; 00:13:48,480<br>And so the first thing you’re going to notice is that at zero reach, so only right operations.</p>
<p>187<br>00:13:48,480 –&gt; 00:13:56,320<br>So the ones that modify to state, you know, we get, you know, roughly 21,000 operations per</p>
<p>188<br>00:13:56,320 –&gt; 00:14:03,600<br>second as fruit put. All right. And, you know, we look at, you know, if the system only has reads,</p>
<p>189<br>00:14:04,159 –&gt; 00:14:10,159<br>I’d actually get a lot more, you know, it gets up in the, you know, whatever, the 67-year region.</p>
<p>190<br>00:14:10,960 –&gt; 00:14:13,680<br>And in fact, what really was going on is that the number reads,</p>
<p>191<br>00:14:14,800 –&gt; 00:14:17,519<br>what it proof puts into read just scales with the number of search.</p>
<p>192<br>00:14:25,519 –&gt; 00:14:31,600<br>So if you’re a free server, you know, you get three times, you know, the read</p>
<p>193<br>00:14:31,600 –&gt; 00:14:36,720<br>performance of one server. If you have five server, you get near the five times the read</p>
<p>194<br>00:14:36,720 –&gt; 00:14:40,720<br>performance of one server. There’s of course not truly right, great. Like in fact, if you look at</p>
<p>195<br>00:14:40,720 –&gt; 00:14:47,440<br>this graph, you see that if with more servers, the right performance actually goes down. And,</p>
<p>196<br>00:14:47,440 –&gt; 00:14:53,120<br>you know, the reason for that is, usually, the leader has to do chat with more servers to actually</p>
<p>197<br>00:14:53,120 –&gt; 00:14:59,360<br>get some operation through. And so when we’re purely doing right operations, we’re actually</p>
<p>198<br>00:14:59,360 –&gt; 00:15:03,519<br>limited. And we cannot get to expect more performance than the single server. In fact, the adsor</p>
<p>199<br>00:15:03,519 –&gt; 00:15:10,720<br>are going to go down for us. And so just 21,000 per second, even for a single,</p>
<p>200<br>00:15:12,960 –&gt; 00:15:18,639<br>for, you know, right operations, we have a configuration of free server, it’s an impressive number.</p>
<p>201<br>00:15:18,639 –&gt; 00:15:23,920<br>It’s quite a bit higher than actually the simple calculation of calculus that we did for a lot of</p>
<p>202<br>00:15:23,919 –&gt; 00:15:27,679<br>free. You know, a lot of free will never get in that, will now get close in the neighborhood at all.</p>
<p>203<br>00:15:29,120 –&gt; 00:15:34,479<br>And so, you know, we want to understand, you want to see in this design, what the design</p>
<p>204<br>00:15:34,479 –&gt; 00:15:44,799<br>does do to actually get that kind of performance. And so two, as I mentioned earlier, there’s two PIDs,</p>
<p>205<br>00:15:45,919 –&gt; 00:15:53,679<br>one, everything is asynchronous or declines, can submit many operations to raft or</p>
<p>206<br>00:15:54,240 –&gt; 00:16:01,039<br>zookeepers in a single shot. So they’re all pipelines. So basically, when doing the way to think about</p>
<p>207<br>00:16:01,039 –&gt; 00:16:06,639<br>the zookeeper client, basically says, please start executing this foot and doesn’t wait in the response</p>
<p>208<br>00:16:07,759 –&gt; 00:16:12,639<br>of the foot. I just, you know, nearly issues the second foot and then the third and the fourth and the fifth.</p>
<p>209<br>00:16:12,639 –&gt; 00:16:16,639<br>And so, for example, a lot of these foot run will be batched all together. Maybe even in a single</p>
<p>210<br>00:16:16,639 –&gt; 00:16:22,079<br>messes, I’ll be transferred to the leader and the leader will apply them all at the same time.</p>
<p>211<br>00:16:23,040 –&gt; 00:16:27,200<br>And in fact, it will leader will write to the persistent storage only once, you know, for just</p>
<p>212<br>00:16:27,200 –&gt; 00:16:32,720<br>whole batch of operations. So instead of having one write per operation, you’re going to have one</p>
<p>213<br>00:16:32,720 –&gt; 00:16:37,200<br>disk write through many, many, many operations. And this is one reason, you know, they get this,</p>
<p>214<br>00:16:38,160 –&gt; 00:16:45,200<br>you know, very good performance on write operations. And then the second thing is, they do something</p>
<p>215<br>00:16:45,200 –&gt; 00:16:52,320<br>special for read operations. They allow read operations to be processed by any server.</p>
<p>216<br>00:16:57,120 –&gt; 00:17:03,120<br>So instead of running all the operations through the leader, they allow operations to actually be</p>
<p>217<br>00:17:03,120 –&gt; 00:17:10,319<br>processed by any server. So, and then the letter, when I want to talk a little bit more about it.</p>
<p>218<br>00:17:10,799 –&gt; 00:17:15,839<br>And I think I wanted to just think about, you know, could we do something similar? Like, let’s say we</p>
<p>219<br>00:17:15,839 –&gt; 00:17:24,000<br>want to do a lot for you. And we’re going to do the same trick. And we want to look at the lab,</p>
<p>220<br>00:17:24,639 –&gt; 00:17:33,519<br>basically reads from any machine or any peer mechanism.</p>
<p>221<br>00:17:36,720 –&gt; 00:17:39,519<br>So the picture would be in his follows. We have a leader.</p>
<p>222<br>00:17:40,799 –&gt; 00:17:44,639<br>We have the two followers. We just stick to the case of three.</p>
<p>223<br>00:17:47,039 –&gt; 00:17:54,240<br>And we have a client. And we’re going to consider what actually could happen.</p>
<p>224<br>00:17:55,439 –&gt; 00:17:59,359<br>If, you know, we sort of leave, we follow this strategy where we’re going to read from anything.</p>
<p>225<br>00:17:59,359 –&gt; 00:18:04,159<br>So here’s our client. The leaders actually, you know, when we do boots, you know, they all go through</p>
<p>226<br>00:18:04,159 –&gt; 00:18:09,839<br>this leader. And so the client, you know, basically does a read. And let’s say, you know,</p>
<p>227<br>00:18:09,839 –&gt; 00:18:15,599<br>this was a read put was done. And at the same time, we’re roughly after the after the put was done,</p>
<p>228<br>00:18:15,599 –&gt; 00:18:21,599<br>the client issues a get. And it talks to one of the followers, you know, arbitrary one. Let’s say</p>
<p>229<br>00:18:21,599 –&gt; 00:18:28,559<br>use for this case. It does not talk to the leader. And then, you know, we’re the follower response.</p>
<p>230<br>00:18:29,119 –&gt; 00:18:32,639<br>And the question is like, what value does the get observed?</p>
<p>231<br>00:18:35,199 –&gt; 00:18:38,959<br>So what is the possible values, you know, that the get can observe. Now, let’s say that, you know,</p>
<p>232<br>00:18:38,960 –&gt; 00:18:46,640<br>we’re reading whatever the key X and the initial value of X is zero. And this put actually put X to one.</p>
<p>233<br>00:18:48,240 –&gt; 00:18:53,039<br>And what are the values that get can actually return in if we don’t do anything, particularly special.</p>
<p>234<br>00:18:56,480 –&gt; 00:19:01,279<br>I’m so just a question here about this setup. So if we’re assuming that draft is the infrastructure</p>
<p>235<br>00:19:01,279 –&gt; 00:19:06,400<br>here and guess it’s just another command, then wouldn’t there a follower just redirect the client to</p>
<p>236<br>00:19:06,400 –&gt; 00:19:12,160<br>the leader with the get request for the leader? No, no, so the goal is correct. We can do that.</p>
<p>237<br>00:19:12,160 –&gt; 00:19:17,519<br>There’s a lot of things we could do, but like we want to get this perfect scalability. So to get</p>
<p>238<br>00:19:17,519 –&gt; 00:19:22,960<br>perfect scalability, the follower cannot talk to the leader for read operation. So basically read</p>
<p>239<br>00:19:22,960 –&gt; 00:19:28,880<br>operations are executed by the individual followers immediately without no communication.</p>
<p>240<br>00:19:28,880 –&gt; 00:19:32,320<br>Because that’s the way we’re going to get perfect scalability. Well, I say so they’re not even</p>
<p>241<br>00:19:32,319 –&gt; 00:19:37,839<br>communicating with. Yep, I’m just doing the needs plan. Like I said, like our goals to get perfect</p>
<p>242<br>00:19:37,839 –&gt; 00:19:42,799<br>scalability like no zookeeper does. And we want to understand like, you know, it’s that difficult or</p>
<p>243<br>00:19:42,799 –&gt; 00:19:47,279<br>easy or what does that really mean. And so the first thing in a five experiment is like we do</p>
<p>244<br>00:19:47,279 –&gt; 00:19:52,639<br>absolutely nothing at the leaders at the followers, the followers get the read operation to execute it</p>
<p>245<br>00:19:52,639 –&gt; 00:19:57,839<br>and return the value. And what can you know, and then the question is what values can be returned by</p>
<p>246<br>00:19:58,319 –&gt; 00:20:04,879<br>again, the client of germ in this picture? Can be either because maybe they put</p>
<p>247<br>00:20:04,879 –&gt; 00:20:10,879<br>then they make it through the desk of the leader yet. Yeah, so it could be either going to return</p>
<p>248<br>00:20:10,879 –&gt; 00:20:18,000<br>zero or it could return a month. So it can return stale data. It’s a possibility.</p>
<p>249<br>00:20:18,319 –&gt; 00:20:27,680<br>Let’s say, you know, we do the let’s say it returns one. So this gets returns one years for</p>
<p>250<br>00:20:27,680 –&gt; 00:20:35,200<br>a five experiment. And then the client does another yet. I’m not going to really say to where that</p>
<p>251<br>00:20:35,200 –&gt; 00:20:45,840<br>gap is going. But you know, and what values could we see from response and that gap?</p>
<p>252<br>00:20:46,880 –&gt; 00:20:51,680<br>Assuming there are no other rights, it should be a one, right? Yeah, unfortunately,</p>
<p>253<br>00:20:52,400 –&gt; 00:20:54,960<br>because I have free servers. If I had five servers,</p>
<p>254<br>00:20:55,680 –&gt; 00:21:09,600<br>why is it different? Okay, let’s make it different. So certainly, can return one, right?</p>
<p>255<br>00:21:09,600 –&gt; 00:21:14,960<br>That’s where we’re agreeing that because if the follower talks to the second get request, you know,</p>
<p>256<br>00:21:15,680 –&gt; 00:21:22,160<br>talks to a follower that actually has seen the boot operation, which the majority of them</p>
<p>257<br>00:21:22,160 –&gt; 00:21:26,960<br>have seen the boot operation, we’re going to get a one back, correct? And the real question is,</p>
<p>258<br>00:21:26,960 –&gt; 00:21:36,800<br>could it see a zero? Even though the juror of the one earlier. I mean, could see a zero, even in the</p>
<p>259<br>00:21:36,800 –&gt; 00:21:41,440<br>case of three servers, right? Because let’s say that you have the majority of servers. Okay,</p>
<p>260<br>00:21:41,440 –&gt; 00:21:49,360<br>let me do a first to five case because it’s simpler to see. Are we assuming that the client always</p>
<p>261<br>00:21:49,359 –&gt; 00:21:55,119<br>asks the same peer? Or no, or there might be a little network petition or a disconnection for</p>
<p>262<br>00:21:55,119 –&gt; 00:21:59,359<br>a brief period of time. So, you know, now we have to talk to the same peer as the last time, right?</p>
<p>263<br>00:22:00,079 –&gt; 00:22:06,799<br>Yeah, so in that case, it can talk to a different peer and that peer may respond with zero.</p>
<p>264<br>00:22:06,799 –&gt; 00:22:12,079<br>And that’s exactly so this is possible. So, you know, we’re going to have to sort of strange</p>
<p>265<br>00:22:12,079 –&gt; 00:22:17,359<br>behavior, correct? And discrimination where you might see a recent, you know, in the first case,</p>
<p>266<br>00:22:17,359 –&gt; 00:22:21,279<br>you might see actually a recent value. And then we read actually something from back, you know,</p>
<p>267<br>00:22:21,279 –&gt; 00:22:35,119<br>back in time. Yeah. So, we’re doing nothing special. And you just like naively read from any</p>
<p>268<br>00:22:35,119 –&gt; 00:22:38,639<br>peer, then, you know, we’re have sort of two set of types of problems. The get can return</p>
<p>269<br>00:22:38,640 –&gt; 00:22:48,240<br>scale data and the get can return a data you from back in time. And so, sorry, wasn’t this possible</p>
<p>270<br>00:22:48,240 –&gt; 00:22:53,200<br>also with three followers because the majority was the leader and one follower and you could ask the</p>
<p>271<br>00:22:53,200 –&gt; 00:23:01,280<br>other one. If you’ve seen the one in, yes, it could be possible. Absolutely. The three would be</p>
<p>272<br>00:23:01,279 –&gt; 00:23:04,399<br>possible too. I think we five is just much more clear that this is possible.</p>
<p>273<br>00:23:09,519 –&gt; 00:23:16,000<br>Okay, so, so then we’re going to go back and sort of think about literally the disbehavior,</p>
<p>274<br>00:23:16,000 –&gt; 00:23:22,240<br>correct? You know, returning those values is that okay? And this is a very interesting question.</p>
<p>275<br>00:23:22,240 –&gt; 00:23:27,599<br>And it depends of course, like what you mean with correctness. And what, you know,</p>
<p>276<br>00:23:27,679 –&gt; 00:23:32,079<br>something is okay, it depends on like what our correctness definition is. And the correctness</p>
<p>277<br>00:23:32,079 –&gt; 00:23:35,439<br>definition that we should have been pedaling, you know, for the last couple lectures or</p>
<p>278<br>00:23:35,439 –&gt; 00:23:39,119<br>like since the beginning of the term is this notion of linearizability.</p>
<p>279<br>00:23:45,839 –&gt; 00:23:51,919<br>And it roughly, but that means we talked a little bit about it in the, you know,</p>
<p>280<br>00:23:51,920 –&gt; 00:23:54,720<br>a week ago, you know, behaves like a sort of a single machine.</p>
<p>281<br>00:23:57,440 –&gt; 00:24:01,519<br>And that’s the intuition that we’ve been using since the beginning of the semester.</p>
<p>282<br>00:24:03,279 –&gt; 00:24:06,480<br>But, you know, the definition of linearizability is a little bit more precise.</p>
<p>283<br>00:24:07,600 –&gt; 00:24:11,680<br>In terms of tries to nail down what it means to behave like a single machine. And so,</p>
<p>284<br>00:24:11,680 –&gt; 00:24:15,120<br>when something behaves like a single machine, in a first of all, we’re going to have to be the case</p>
<p>285<br>00:24:15,120 –&gt; 00:24:19,360<br>that even if the operation actually could concurrently, you can sort of order them in a total order.</p>
<p>286<br>00:24:20,319 –&gt; 00:24:26,000<br>So, it’s possible to construct the total order of all the operations because in the end,</p>
<p>287<br>00:24:26,000 –&gt; 00:24:30,240<br>it’s a single machine. So, it behaves as a single machine. There’s only one machine, sort of</p>
<p>288<br>00:24:30,240 –&gt; 00:24:36,159<br>virtual machine that can actually perform the operation. So, the total order order, well, ops.</p>
<p>289<br>00:24:37,439 –&gt; 00:24:43,839<br>And there has to be some properties true about that total order. And so, one property that has to be</p>
<p>290<br>00:24:43,839 –&gt; 00:24:54,799<br>true is that the order matches real time. And real time, really, what I mean is that even operation</p>
<p>291<br>00:24:54,799 –&gt; 00:25:03,199<br>completed before another one started, then that first operation has to go before the second operation</p>
<p>292<br>00:25:03,199 –&gt; 00:25:12,559<br>in the total order. And then there’s a third property that the read operation, read ops returns,</p>
<p>293<br>00:25:14,159 –&gt; 00:25:16,159<br>value of last write.</p>
<p>294<br>00:25:23,519 –&gt; 00:25:27,359<br>And that’s sort of the official definition of linearized ability. And you can just think about this as</p>
<p>295<br>00:25:27,359 –&gt; 00:25:34,240<br>sort of a more precise statement of this kind of first thing, this intuition, namely the whole thing</p>
<p>296<br>00:25:34,240 –&gt; 00:25:42,079<br>behaves like a single machine. Now, we want to go back and think a little bit about the scenarios</p>
<p>297<br>00:25:42,079 –&gt; 00:25:48,000<br>that we have just on this whiteboard, namely these two cases of stale data and back in time,</p>
<p>298<br>00:25:48,000 –&gt; 00:25:51,679<br>I think about that thinking whether linearized ability allows that.</p>
<p>299<br>00:25:53,599 –&gt; 00:25:58,879<br>And so, let’s first focus on the first one. So, we have a client one, quickly for you, the way you</p>
<p>300<br>00:25:58,879 –&gt; 00:26:04,240<br>would draw this out and reason about linearized ability is you draw a diagram from this form,</p>
<p>301<br>00:26:04,240 –&gt; 00:26:09,279<br>where the left bar is to start up the operation, the right bar is the acknowledgement through the</p>
<p>302<br>00:26:09,279 –&gt; 00:26:14,000<br>client that the operation X being executed. And in this case, we’re sort of saying where’s a</p>
<p>303<br>00:26:14,000 –&gt; 00:26:21,440<br>put to X and that put the value one. And then we had another client, or in the same client,</p>
<p>304<br>00:26:22,000 –&gt; 00:26:27,759<br>let’s do it draw another client, that basically did the read and the read started well past</p>
<p>305<br>00:26:28,399 –&gt; 00:26:35,119<br>the put operations where there’s a get of X. And we have one case where the get of X actually</p>
<p>306<br>00:26:35,119 –&gt; 00:26:42,159<br>returned to zero, right? That was the first process possible. And so that’s what actually happened</p>
<p>307<br>00:26:42,159 –&gt; 00:26:46,799<br>on the previous board. And now we want to sort of think about this, is this execution allowed by</p>
<p>308<br>00:26:46,799 –&gt; 00:26:51,359<br>linearized ability? This is the correctness definition that we’re looking for. And we want to see</p>
<p>309<br>00:26:51,359 –&gt; 00:26:57,279<br>this execution, this order of operations that happened in practice, you know, at least we have</p>
<p>310<br>00:26:57,279 –&gt; 00:27:01,199<br>seen that as possible in practice, is this allowed by linearized ability? And that’s our correctness</p>
<p>311<br>00:27:01,360 –&gt; 00:27:06,480<br>criteria. In, this is allowed by linearized ability.</p>
<p>312<br>00:27:12,000 –&gt; 00:27:20,559<br>No. No, why not? Well, because the C2 client operation started after the C1 completed. So in the</p>
<p>313<br>00:27:20,559 –&gt; 00:27:26,559<br>total order, you have to have put X1 and get X and H1 because it should read the last way.</p>
<p>314<br>00:27:27,039 –&gt; 00:27:31,039<br>Yep. So basically in the total order that you construct, you know, this guy, you know,</p>
<p>315<br>00:27:31,039 –&gt; 00:27:37,599<br>this operation must be after that operation because it started later. But then you look, you know,</p>
<p>316<br>00:27:37,599 –&gt; 00:27:42,240<br>that violates rule number three, correct? That the operation returns the value of the last</p>
<p>317<br>00:27:42,240 –&gt; 00:27:46,720<br>right. That’s actually not the case. So that’s the return to the earlier value. So this is not linearized</p>
<p>318<br>00:27:46,720 –&gt; 00:27:55,440<br>ability. Does that make sense? And of course, this totally matches our intuition, right? Because</p>
<p>319<br>00:27:55,840 –&gt; 00:27:59,440<br>an single machine just could not have happened, you know, your road of value to, you know,</p>
<p>320<br>00:27:59,440 –&gt; 00:28:03,039<br>the single machine and then you’re headed back. And it’s certainly another value, it’s actually</p>
<p>321<br>00:28:03,039 –&gt; 00:28:08,960<br>previous value. So this is not a lot. Okay, let’s do a second one like our other example. So we had</p>
<p>322<br>00:28:08,960 –&gt; 00:28:15,200<br>a client one again, just put and I’m going to draw a little bit more compact because I don’t have</p>
<p>323<br>00:28:15,200 –&gt; 00:28:24,000<br>much space. And you know, we do a put then we do there’s the read where to get, get the room to</p>
<p>324<br>00:28:24,000 –&gt; 00:28:29,279<br>room’s one. So we’re not in the first case, but in the second and we’re in another case. And then</p>
<p>325<br>00:28:30,480 –&gt; 00:28:39,519<br>we have to get the returns zero. And so that’s the second sort of case that we looked at, correct,</p>
<p>326<br>00:28:39,519 –&gt; 00:28:44,960<br>that this and this picture, you know, the back and tie case. And again, we can ask ourselves the same</p>
<p>327<br>00:28:44,960 –&gt; 00:28:49,039<br>question. Is this allowed by linearizability?</p>
<p>328<br>00:28:53,519 –&gt; 00:28:58,799<br>No, because the read wouldn’t be returning the audio the last break.</p>
<p>329<br>00:28:58,799 –&gt; 00:29:02,960<br>Yeah, yeah, it’s a pretty straightforward documentation, correct? This is absolutely not the case.</p>
<p>330<br>00:29:02,960 –&gt; 00:29:06,720<br>In fact, it’s almost simpler in the first case because like even these operations have to be in</p>
<p>331<br>00:29:06,720 –&gt; 00:29:11,759<br>this order, but you know, the, you know, the, you know, could not have happened, but it violates</p>
<p>332<br>00:29:12,480 –&gt; 00:29:19,359<br>rule free, correct? Okay, good. So you know, this is a good fusion of intuition of like a</p>
<p>333<br>00:29:19,359 –&gt; 00:29:24,240<br>now with linearizability means, you know, how you reason about it. And basically, if we don’t do</p>
<p>334<br>00:29:24,240 –&gt; 00:29:30,559<br>anything special and we do this naive scheme, if you were implementing the lab free and you follow</p>
<p>335<br>00:29:30,559 –&gt; 00:29:36,960<br>this naive scheme, then you would not pass the test because you know, the test assume or our goal</p>
<p>336<br>00:29:36,960 –&gt; 00:29:41,440<br>in lab free is actually to provide linearizability for putting gets. And so the scenarios like these</p>
<p>337<br>00:29:41,519 –&gt; 00:29:48,559<br>ones are just not a lot of, you know, your implementation has to be in a way that these results cannot appear.</p>
<p>338<br>00:29:50,320 –&gt; 00:29:57,519<br>So that makes sense. So we’re going to name lab free, we’re going to shoot for linearizability.</p>
<p>339<br>00:29:58,160 –&gt; 00:30:04,480<br>And what is one easy way of getting linearizability? How are we going to shoot or to put in gets</p>
<p>340<br>00:30:04,720 –&gt; 00:30:11,200<br>operation or linearizable? Well, I mean, if you do actually use one machine,</p>
<p>341<br>00:30:11,920 –&gt; 00:30:17,519<br>then it will be linearizable, right? Yeah, so what’s the easy solution? We run all the reads</p>
<p>342<br>00:30:17,519 –&gt; 00:30:23,440<br>through the leader, correct? So basically, the easy solution to get linearizability and the fact that’s</p>
<p>343<br>00:30:23,440 –&gt; 00:30:31,759<br>what we’re going to be doing in lab free, in lab free, what we’re going to be doing is, you know,</p>
<p>344<br>00:30:31,759 –&gt; 00:30:38,480<br>reads or get operations, get ops, go through the log. So they go through a raft.</p>
<p>345<br>00:30:42,480 –&gt; 00:30:46,559<br>And as you observe, you know, it seems, you know, they really go all through one machine.</p>
<p>346<br>00:30:46,559 –&gt; 00:30:50,799<br>Well, there’s not, they might not go through all one machine, because the leader may change over time.</p>
<p>347<br>00:30:50,799 –&gt; 00:30:55,519<br>But we know that the leader is always total order, correct? And the log is total order. And so we’re</p>
<p>348<br>00:30:55,519 –&gt; 00:31:00,400<br>going to be able to construct, you know, a total order that actually has, you know, the order matches</p>
<p>349<br>00:31:00,400 –&gt; 00:31:05,440<br>real time and all the reads return to values of the last, last right? Because basically, the raft</p>
<p>350<br>00:31:05,440 –&gt; 00:31:13,519<br>protocol will guarantee that all the entries in the log are in the total order, right? And of</p>
<p>351<br>00:31:13,519 –&gt; 00:31:17,600<br>course, the raft protocol has been quite a bit of work, to actually make that all happen. And</p>
<p>352<br>00:31:17,600 –&gt; 00:31:26,480<br>despite, you know, network failures, despite network splits, you know, the raft protocol will</p>
<p>353<br>00:31:26,480 –&gt; 00:31:31,920<br>guarantee us that basically all the operations happen in the total order. In fact, you know,</p>
<p>354<br>00:31:31,920 –&gt; 00:31:35,599<br>the whole replicated state machine approaches are based on this idea, correct? That like all the</p>
<p>355<br>00:31:35,599 –&gt; 00:31:40,240<br>oxen in the total order and applied in the same order on all peers, and as a result, everything</p>
<p>356<br>00:31:40,240 –&gt; 00:31:46,480<br>looks, looks like a single machine. And so the easy way to do self-dispirations is to run all the</p>
<p>357<br>00:31:46,480 –&gt; 00:31:51,680<br>reads, you know, through the leader, wherever the leaders are at that particular point of time,</p>
<p>358<br>00:31:51,680 –&gt; 00:31:59,840<br>and that will give us linear rights ability. Let me pause for a second. Any questions about this?</p>
<p>359<br>00:32:02,320 –&gt; 00:32:07,840<br>Sorry, matches real time. It just means that if operation 1 ends before operation 2 starts,</p>
<p>360<br>00:32:08,720 –&gt; 00:32:14,400<br>then one is before 2. Yeah, that is raft, you know, what you will see now, there’s what happened</p>
<p>361<br>00:32:14,400 –&gt; 00:32:20,960<br>automatically, correct? Because the if an operation action completely finished, then must have</p>
<p>362<br>00:32:20,960 –&gt; 00:32:24,960<br>been the case that the leader responded to, you know, back to the client, and then if the client</p>
<p>363<br>00:32:24,960 –&gt; 00:32:31,600<br>started operation later, and must end up later in the log at the leader. So this is going to be a</p>
<p>364<br>00:32:31,600 –&gt; 00:32:38,240<br>practice, true. And also, so just to double check and maybe reiterate so the, so in lab 3, all of the</p>
<p>365<br>00:32:38,240 –&gt; 00:32:47,759<br>client requests are going to be synchronous. Yes, absolutely. Okay, good. So, you know, one downside of</p>
<p>366<br>00:32:47,759 –&gt; 00:32:51,920<br>this scheme, you know, we would go back, actually, if you read the draft paper very carefully,</p>
<p>367<br>00:32:51,920 –&gt; 00:32:57,519<br>there’s an optimization for read-only operations, but even that optimization requires some,</p>
<p>368<br>00:32:58,960 –&gt; 00:33:04,000<br>some communication. And so, like if we just follow this naive, you know, so this straightforward</p>
<p>369<br>00:33:04,000 –&gt; 00:33:10,480<br>plan to actually get linearizability, you know, does this, what does that mean for performance?</p>
<p>370<br>00:33:10,480 –&gt; 00:33:13,920<br>You know, we go back to sort of thinking about, you know, contrasting it to a zookeeper.</p>
<p>371<br>00:33:17,759 –&gt; 00:33:24,319<br>Yeah, is, for example, the number read operations is going to scale with the number of service.</p>
<p>372<br>00:33:26,720 –&gt; 00:33:31,920<br>Not because now everything has to pass through the list. Yeah, everything has to go for the leader</p>
<p>373<br>00:33:31,920 –&gt; 00:33:36,559<br>again. So, you know, when I went over, it’s a little bit undesirable, correct? And so, it gives</p>
<p>374<br>00:33:36,559 –&gt; 00:33:40,079<br>you an interesting question, it’s like, you know, how is it possible that like the, uh,</p>
<p>375<br>00:33:41,519 –&gt; 00:33:45,359<br>zookeeper gets these great performance? And like, will you see that the simple scheme,</p>
<p>376<br>00:33:45,359 –&gt; 00:33:49,279<br>your reference doesn’t really work, or at least violates linearizability.</p>
<p>377<br>00:33:50,399 –&gt; 00:33:54,799<br>And so, one, uh, so we want to talk a little bit about, to understand, like, what does it really,</p>
<p>378<br>00:33:54,799 –&gt; 00:34:00,240<br>how does you give a get this? Um, and so the first thing to really realize, and this is probably</p>
<p>379<br>00:34:00,240 –&gt; 00:34:06,799<br>the most important part, is that a zookeeper does not provide linearizability.</p>
<p>380<br>00:34:08,319 –&gt; 00:34:10,719<br>It basically changes the correctness definition.</p>
<p>381<br>00:34:15,360 –&gt; 00:34:27,519<br>And so, the zookeeper service is not going to behave like a single machine.</p>
<p>382<br>00:34:28,320 –&gt; 00:34:32,480<br>You know, it’s going to have results that we could never happen on a single machine.</p>
<p>383<br>00:34:33,440 –&gt; 00:34:37,599<br>Um, and so the particular, so what is it, what does it provide? Well,</p>
<p>384<br>00:34:38,240 –&gt; 00:34:40,880<br>uh, it does provide linearizable rights.</p>
<p>385<br>00:34:45,920 –&gt; 00:34:56,640<br>So, all the, uh, operations, all the right operations, actually, you know, go through the leader,</p>
<p>386<br>00:34:56,640 –&gt; 00:35:02,480<br>and you know, go through the log, and are pended to the log every peer in the same order.</p>
<p>387<br>00:35:02,480 –&gt; 00:35:06,079<br>And so they’re, they’re going to also be applied in the same order. So we still have this replicated</p>
<p>388<br>00:35:06,079 –&gt; 00:35:11,519<br>state machine, uh, approach, or where, reply, all the right operation, all the operation,</p>
<p>389<br>00:35:11,519 –&gt; 00:35:21,199<br>the change data into, uh, uh, uh, in the total order. But, uh, there’s a couple more properties.</p>
<p>390<br>00:35:23,039 –&gt; 00:35:27,280<br>So, but it doesn’t not provide linearizability for reach. Instead, it sort of provides two,</p>
<p>391<br>00:35:27,280 –&gt; 00:35:33,759<br>sort of a different property, which is that all the operations appear in five-co-order,</p>
<p>392<br>00:35:33,760 –&gt; 00:35:38,400<br>uh, in five-co-client order.</p>
<p>393<br>00:35:40,400 –&gt; 00:35:44,960<br>And as far as I have to do with the asynchronous, you know, a client may submit multiple requests,</p>
<p>394<br>00:35:45,520 –&gt; 00:35:52,960<br>uh, one by one, uh, without waiting for response. And, you know, juker, but we’ll guarantee that</p>
<p>395<br>00:35:52,960 –&gt; 00:35:58,240<br>if you submit, you know, if client one submitted a request, and then client one submitted another</p>
<p>396<br>00:35:58,239 –&gt; 00:36:05,519<br>request, then that second request will appear, uh, later in, uh, the result will occur if the result</p>
<p>397<br>00:36:05,519 –&gt; 00:36:13,199<br>of the first operation. And so in particular, you know, rights going to client order.</p>
<p>398<br>00:36:22,079 –&gt; 00:36:27,759<br>Um, and then the reads have, where all the action is, where the existing properties are,</p>
<p>399<br>00:36:28,559 –&gt; 00:36:37,599<br>um, the, uh, reach observed last right, okay, so reach, uh, okay, reach observed</p>
<p>400<br>00:36:40,079 –&gt; 00:36:41,759<br>last right from same client.</p>
<p>401<br>00:36:50,959 –&gt; 00:36:55,519<br>And so this order makes sense, you know, basically this sort of says like, uh, you read your own rights.</p>
<p>402<br>00:36:55,519 –&gt; 00:36:59,199<br>And so if you did the right operation, you immediately followed the read operation, you see at</p>
<p>403<br>00:36:59,199 –&gt; 00:37:05,519<br>least the, the results of your own rights. Uh, but, uh, for rights from other operation, from other</p>
<p>404<br>00:37:05,519 –&gt; 00:37:11,599<br>clients, uh, the juker does not guarantee that property. Instead, what it guarantees is that</p>
<p>405<br>00:37:11,599 –&gt; 00:37:17,119<br>the read we observe some prefix of the log.</p>
<p>406<br>00:37:17,119 –&gt; 00:37:25,519<br>Uh, and, uh, so this means that you can actually see stale data.</p>
<p>407<br>00:37:29,519 –&gt; 00:37:35,279<br>You may, you know, read for other follower, and that follower has a prefix of the log, but not</p>
<p>408<br>00:37:35,279 –&gt; 00:37:39,679<br>like the last entries in the log, because maybe you just got to lag the, lags behind a little bit,</p>
<p>409<br>00:37:40,319 –&gt; 00:37:46,639<br>uh, and nevertheless, that, uh, followers allow to, uh, return, uh, a value, uh, because you know,</p>
<p>410<br>00:37:46,639 –&gt; 00:37:51,920<br>the only thing that, uh, uh, juker is going to guarantee that actually, you know, read, observe, uh,</p>
<p>411<br>00:37:51,920 –&gt; 00:37:58,239<br>a prefix of the log. So the operations cannot go out of order, you know, once they in the log,</p>
<p>412<br>00:37:58,239 –&gt; 00:38:03,599<br>and you can’t sort of, uh, reach, can’t like, read, uh, operation out of the log in out of order,</p>
<p>413<br>00:38:03,599 –&gt; 00:38:10,159<br>it really has to be a prefix of the log. And then there’s a second requirement that you cannot do</p>
<p>414<br>00:38:10,159 –&gt; 00:38:20,960<br>no reads from the past. And that really means like, if you saw some prefix one,</p>
<p>415<br>00:38:22,879 –&gt; 00:38:27,199<br>and then you issue like a read style prefix one, and then you read a second read,</p>
<p>416<br>00:38:27,839 –&gt; 00:38:31,440<br>then that second read has to see at least prefix one plus more.</p>
<p>417<br>00:38:34,719 –&gt; 00:38:39,359<br>And it might be no, you know, it might be just prefix one, but it cannot go back in time. So it cannot</p>
<p>418<br>00:38:39,360 –&gt; 00:38:46,880<br>see a shorter prefix than prefix one. And so this basically, uh, so, so what if we look back at this</p>
<p>419<br>00:38:46,880 –&gt; 00:38:55,280<br>picture, uh, the juker will allow this in certain cases, namely if the two clients are different,</p>
<p>420<br>00:38:56,160 –&gt; 00:39:02,160<br>but it won’t allow this up, this, and you can never have back in time. Okay?</p>
<p>421<br>00:39:02,639 –&gt; 00:39:09,759<br>So I have a question, a conceptual one. So we have these two consistency guarantees the</p>
<p>422<br>00:39:09,759 –&gt; 00:39:15,119<br>linearizable rights and the fee-fo client order. So if we ignore the second constraint for a second,</p>
<p>423<br>00:39:15,119 –&gt; 00:39:20,319<br>and if we only focus on the first one, does it, does the definition of linearizable rights actually</p>
<p>424<br>00:39:20,319 –&gt; 00:39:25,759<br>make sense? Since the definition of linearizability depends on having a read operation and a write-off</p>
<p>425<br>00:39:25,760 –&gt; 00:39:33,520<br>operation. I, I, I, I, I hold that thought for a second, uh, because the, the, the, the, the,</p>
<p>426<br>00:39:33,520 –&gt; 00:39:37,360<br>the way they define linearizable rights is not based on the rights of a total order, uh,</p>
<p>427<br>00:39:37,360 –&gt; 00:39:40,880<br>and, but there is a relationship between the reads and the rights. So I’ll hold the thought for a second,</p>
<p>428<br>00:39:40,880 –&gt; 00:39:47,520<br>okay? Uh, we’ll come back, we’ll get to that in a, in a minute, like in one board. I want to make</p>
<p>429<br>00:39:47,520 –&gt; 00:39:55,680<br>one board in between, okay? That’s good. Okay, so it’s like a, let’s look a little bit</p>
<p>430<br>00:39:56,480 –&gt; 00:40:03,279<br>at how C group, Zupyp are actually provides these guarantees. Um, and, you know, so we get the</p>
<p>431<br>00:40:03,279 –&gt; 00:40:09,919<br>intuition, you know, uh, how you could implement this. Uh, the paper section is not very explicit</p>
<p>432<br>00:40:09,919 –&gt; 00:40:13,679<br>about how they implement this. And sort of like I’m going to give you sort of a roughly best guess.</p>
<p>433<br>00:40:14,719 –&gt; 00:40:18,319<br>Um, so there’s a, Zupyp are client.</p>
<p>434<br>00:40:18,320 –&gt; 00:40:25,920<br>It runs in the client machine, uh, in Latvian, we call this a clerk. And so this is a piece of</p>
<p>435<br>00:40:25,920 –&gt; 00:40:31,680<br>software library sort of that works, collaborate, you know, with the service. And, uh, and, and,</p>
<p>436<br>00:40:31,680 –&gt; 00:40:36,880<br>and Zupyp are in the paper terminology, basically it is the thing that has to session. So, uh,</p>
<p>437<br>00:40:36,880 –&gt; 00:40:40,960<br>when you join when a client wants to connect with the Zupyp the server, you know, it creates a session,</p>
<p>438<br>00:40:40,960 –&gt; 00:40:46,160<br>it connects, you know, using the session information to the leader and maintains, you know, state</p>
<p>439<br>00:40:46,159 –&gt; 00:40:52,960<br>across the session. So we have a leader, uh, in, uh, Zupyp, as we’ll see, we have, you know,</p>
<p>440<br>00:40:52,960 –&gt; 00:40:58,480<br>followers, you know, basically dissolve sort of similar, uh, to what we’re used to from lab, you know,</p>
<p>441<br>00:40:58,480 –&gt; 00:41:04,159<br>to, and, you know, to do the client get issues right, you know, to the leader, you know, because</p>
<p>442<br>00:41:04,159 –&gt; 00:41:08,079<br>the rights are going to be linearizable. In fact, the right to basically follow exactly sort of</p>
<p>443<br>00:41:08,079 –&gt; 00:41:14,719<br>roughly the same strategy as in the raft library. So there’s going to be a log and in the log</p>
<p>444<br>00:41:14,719 –&gt; 00:41:18,000<br>our own the rights are entered, you know, so whatever, you know, there’s some slots,</p>
<p>445<br>00:41:18,000 –&gt; 00:41:24,159<br>let’s say the leader, you know, pence this right, you know, in this particular, uh, index. So this</p>
<p>446<br>00:41:24,159 –&gt; 00:41:29,839<br>see, you know, has an index, uh, and then the paper they refer to this index as the ZXID.</p>
<p>447<br>00:41:31,519 –&gt; 00:41:35,119<br>Uh, so I think you can think about the ZXID, basically ask the index in the log.</p>
<p>448<br>00:41:36,799 –&gt; 00:41:44,079<br>And, uh, when the leader, you know, basically commits, uh, an entry, uh, right, you know, to the log,</p>
<p>449<br>00:41:44,079 –&gt; 00:41:49,119<br>you know, it returns the ZXID back, you know, to the clients. And so the client maintains that state.</p>
<p>450<br>00:41:50,559 –&gt; 00:41:56,400<br>So associated with the session is basically, you know, with CXIDs, you know, the ZXID at the last right.</p>
<p>451<br>00:41:59,759 –&gt; 00:42:07,599<br>Okay. And so when the client will, later on, does a read, and the read, you know, doesn’t have to go</p>
<p>452<br>00:42:07,599 –&gt; 00:42:11,840<br>through the leader, because of the whole goal to get a more, uh, performance. So maybe the read</p>
<p>453<br>00:42:11,840 –&gt; 00:42:20,400<br>actually will go, you know, to one of the followers. And but the read will be tagged with the CXID</p>
<p>454<br>00:42:20,400 –&gt; 00:42:27,039<br>that, of the last right that that particular client has done. And so what does that mean? Well,</p>
<p>455<br>00:42:27,039 –&gt; 00:42:32,800<br>let’s say this follower is behind, correct? And it has to entry, but it hasn’t actually observed,</p>
<p>456<br>00:42:32,800 –&gt; 00:42:36,400<br>you know, the right yet, because whatever the leader may be committed through these other followers.</p>
<p>457<br>00:42:37,360 –&gt; 00:42:43,360<br>And what happens in this case is that this read, uh, the follower won’t really respond immediately.</p>
<p>458<br>00:42:43,360 –&gt; 00:42:50,639<br>Instead, you know, it will wait until it’s seen, you know, the ZXID. And as soon as it’s seen,</p>
<p>459<br>00:42:50,639 –&gt; 00:42:58,160<br>the ZXID, it actually will respond. Now, of course, there’s going to be another client.</p>
<p>460<br>00:42:59,039 –&gt; 00:43:02,160<br>Uh, and so maybe at some point, you know, this right will come through.</p>
<p>461<br>00:43:02,960 –&gt; 00:43:09,119<br>Um, and um, it may be now the read, you know, the client does another read. And so it hasn’t seen no</p>
<p>462<br>00:43:09,119 –&gt; 00:43:16,000<br>any other ZXIDs. Uh, and maybe, like, let me make one more follower. Let’s say there’s an</p>
<p>463<br>00:43:16,000 –&gt; 00:43:20,719<br>again, another follower that actually has not observed, you know, that that that’s final right yet.</p>
<p>464<br>00:43:20,719 –&gt; 00:43:26,639<br>We’re actually, let me. So there’s going to be another, let’s say there’s a other client that sticks</p>
<p>465<br>00:43:26,639 –&gt; 00:43:30,719<br>in some other right. So that’s the scenario I want to talk about. So there was another client that</p>
<p>466<br>00:43:30,719 –&gt; 00:43:37,359<br>actually appended a W after the ZXID, you know, it is right here. Uh, but if it’s not observed,</p>
<p>467<br>00:43:37,359 –&gt; 00:43:46,959<br>that particular right, you know, what we have here is we got the, uh, we got the two slots,</p>
<p>468<br>00:43:46,959 –&gt; 00:43:51,199<br>we got the right, but the green right hasn’t really shown up in that particular, that particular</p>
<p>469<br>00:43:51,199 –&gt; 00:43:55,919<br>follower. And so if the client now issues a second, you know, read and maybe that goes to the</p>
<p>470<br>00:43:55,920 –&gt; 00:44:01,440<br>other follower, you know, that’s the same ZXID because it hasn’t seen any new, you know, that</p>
<p>471<br>00:44:01,440 –&gt; 00:44:07,920<br>client has not issued any new, more new rights. It will arrive there. And that, that, that, that guy</p>
<p>472<br>00:44:07,920 –&gt; 00:44:14,480<br>is allowed to respond immediately because it has, you know, seen the ZXID of, you know, the,</p>
<p>473<br>00:44:15,119 –&gt; 00:44:19,840<br>what, and has seen the last ZXID of that particular client. Uh, of course it misses, you know,</p>
<p>474<br>00:44:19,840 –&gt; 00:44:23,840<br>some rights, you know, that might, from other clients that are already being processed by, uh,</p>
<p>475<br>00:44:23,840 –&gt; 00:44:28,720<br>some majority of the sooner, but it does not require to return that data. And so it can just return.</p>
<p>476<br>00:44:29,760 –&gt; 00:44:35,039<br>And so this might have to be returned and instale values, but, you know, there’s a lot out by the</p>
<p>477<br>00:44:35,039 –&gt; 00:44:40,480<br>definition of, you know, the suit keeper correct, correctness guarantees. Um, I, Professor, I have</p>
<p>478<br>00:44:40,480 –&gt; 00:44:49,600<br>a question. Yep. First, I, I thought, um, I’m, I’m not sure, but, uh, I understood, um, um, client reads,</p>
<p>479<br>00:44:49,599 –&gt; 00:44:56,719<br>like, the session of each were sticky. So they would like, in general, go to the same, um, to the same.</p>
<p>480<br>00:44:58,159 –&gt; 00:45:01,199<br>Yeah, but, you know, of course, you know, there might be a little bit of, you know, it might be a</p>
<p>481<br>00:45:01,199 –&gt; 00:45:06,960<br>quick network petition or, uh, anything like it. And so in between time, you know, the, the,</p>
<p>482<br>00:45:06,960 –&gt; 00:45:12,799<br>the, it might have switched to another server. Okay. And then, um, the, the, the, the, the, the,</p>
<p>483<br>00:45:12,799 –&gt; 00:45:17,440<br>the invitation turns out to suit paper does actually do some load balancing. Uh, so, but, but,</p>
<p>484<br>00:45:18,400 –&gt; 00:45:26,240<br>never actually can happen, right? Right. Um, the other thing was, you said, right, um, always,</p>
<p>485<br>00:45:26,240 –&gt; 00:45:34,480<br>always go to the leader. Um, and, and then the leader, um, responded with the ZXID.</p>
<p>486<br>00:45:35,760 –&gt; 00:45:40,159<br>Doesn’t the leader have to like first, like reach consensus before responding air?</p>
<p>487<br>00:45:41,119 –&gt; 00:45:49,440<br>And this, uh, yes, I guess so, uh, you know, you just asked the committee to get out of</p>
<p>488<br>00:45:49,440 –&gt; 00:45:55,199<br>why she’s in the committee, right? Uh, and so I think the, the exact protocol, okay, I’m, I’m</p>
<p>489<br>00:45:55,199 –&gt; 00:45:59,679<br>abstracting a way a little bit from the details of the protocol. I’m just going to sketch how it</p>
<p>490<br>00:45:59,679 –&gt; 00:46:05,359<br>works. Uh, I believe you’re right, you know, that, uh, it must return presumably after, you know,</p>
<p>491<br>00:46:05,440 –&gt; 00:46:12,480<br>the entry action is really committed. That, um, sorry, last thing, um, you said it, it always</p>
<p>492<br>00:46:12,480 –&gt; 00:46:16,640<br>goes to the leader, but I think the paper described, like, it could go to like followers or right,</p>
<p>493<br>00:46:16,640 –&gt; 00:46:20,240<br>could go to a follower and then be, yeah, but it then ends up at the leader, correct?</p>
<p>494<br>00:46:21,599 –&gt; 00:46:30,000<br>So, it ends and goes for the leader. Thanks. Yep. Uh, just to clarify, when you say, wait for ZXID,</p>
<p>495<br>00:46:30,000 –&gt; 00:46:34,640<br>unlike, for example, the second follower, or, so second, when we wait for ZXID, we’re actually</p>
<p>496<br>00:46:34,639 –&gt; 00:46:40,719<br>waiting for it to be committed, right? It’s not sufficient to just get it. I’ve got it.</p>
<p>497<br>00:46:42,960 –&gt; 00:46:49,440<br>Wait, but, um, what, it like, it would have been committed by the time it was, like, like a client,</p>
<p>498<br>00:46:49,440 –&gt; 00:46:56,559<br>what would it get an uncommitted ZXID, correct? Like ever? No, yeah, but just, uh, that’s correct. Uh,</p>
<p>499<br>00:46:56,559 –&gt; 00:47:04,400<br>so if, you know, the, this point, again, at this point, when the follower sees this, uh, ZXID,</p>
<p>500<br>00:47:04,400 –&gt; 00:47:09,039<br>and the, the right is in that particular ZXID, you know, it must have been committed because,</p>
<p>501<br>00:47:09,039 –&gt; 00:47:12,639<br>you know, the client could have not gotten that ZXID unless, you know, that option,</p>
<p>502<br>00:47:12,639 –&gt; 00:47:24,240<br>of that ZXID wash commit. Thanks. Um, also, so when you say that, uh, from the read, you, you get</p>
<p>503<br>00:47:24,240 –&gt; 00:47:30,240<br>stale data. So, like, the last basically, uh, but the client here in the read request,</p>
<p>504<br>00:47:30,239 –&gt; 00:47:37,519<br>it supplied the ZXID within it. So, it’s as if the client knowingly exactly wanted that location</p>
<p>505<br>00:47:37,519 –&gt; 00:47:45,919<br>in the log that had ZXID as its index. So, didn’t it knowingly just request that prefix, that specific</p>
<p>506<br>00:47:45,919 –&gt; 00:47:50,639<br>prefix of the log? No, but the really says, you know, what this basically ZXD says, like,</p>
<p>507<br>00:47:51,839 –&gt; 00:47:58,319<br>basically counter, you know, going back in time. And, uh, so the ZXD says, like, you know, you have,</p>
<p>508<br>00:47:58,320 –&gt; 00:48:03,920<br>as a follower, you have to return me a result that at least concludes the prefix of the log</p>
<p>509<br>00:48:03,920 –&gt; 00:48:09,760<br>through ZXID. Uh, you might have more that be fine too, but at least through ZXID. And this just</p>
<p>510<br>00:48:09,760 –&gt; 00:48:13,600<br>stops that one case where you read back in time. Okay, awesome. Thanks.</p>
<p>511<br>00:48:16,160 –&gt; 00:48:22,400<br>Okay, so now you might wonder, uh, you know, so, just clearly does not provide linearizability,</p>
<p>512<br>00:48:22,400 –&gt; 00:48:26,320<br>and one reason people are excited about linearizability is because of the like, a single machine,</p>
<p>513<br>00:48:26,320 –&gt; 00:48:29,680<br>so it’s easier to program, right? Like, you know, you do a good, you get a good, you know,</p>
<p>514<br>00:48:29,680 –&gt; 00:48:35,120<br>you have roughly no what you’re going to get. Uh, and then no pun intended. Uh, but the</p>
<p>515<br>00:48:35,120 –&gt; 00:48:39,440<br>here you’re going to know you certainly have a model, programming model that’s different from a single</p>
<p>516<br>00:48:39,440 –&gt; 00:48:46,400<br>machine. And so, uh, you know, how do you program with this thing? And, you know, it turns out that</p>
<p>517<br>00:48:46,400 –&gt; 00:48:50,640<br>that basically these rules, you know, this correctness definition that, you know, ZXID people has,</p>
<p>518<br>00:48:50,639 –&gt; 00:48:56,799<br>are basically, you can think of it as like good enough to actually do, you know, for the</p>
<p>519<br>00:48:56,799 –&gt; 00:49:00,879<br>purpose, just kind of through, through, through the help programming. And so I want to talk a little</p>
<p>520<br>00:49:00,879 –&gt; 00:49:16,159<br>bit about that. So the real point is that, you know, the, we’ve linearizability, you know,</p>
<p>521<br>00:49:16,159 –&gt; 00:49:21,039<br>it’s pretty clear that, you know, that helps programming and writes, you know, into the programs.</p>
<p>522<br>00:49:21,039 –&gt; 00:49:24,559<br>You think they’re going to be slightly different. And we want to understand actually, you know,</p>
<p>523<br>00:49:24,559 –&gt; 00:49:29,440<br>things that work out well. Uh, and, uh, or whether they select it, just painting an act of</p>
<p>524<br>00:49:29,440 –&gt; 00:49:35,839<br>programming is basically completely unusual. Um, so, uh, so let’s look at one of the key examples,</p>
<p>525<br>00:49:36,480 –&gt; 00:49:42,399<br>they talk about in the paper. Um, and, uh, the first thing I want to do is like basically ignore</p>
<p>526<br>00:49:42,400 –&gt; 00:49:47,519<br>the sync operation because like you can make, uh, every operation actually linearizable by just</p>
<p>527<br>00:49:47,519 –&gt; 00:49:52,880<br>issuing a sync, uh, like before you do the read. Uh, but that, of course, you know, makes everything</p>
<p>528<br>00:49:52,880 –&gt; 00:49:57,039<br>real slow again and we’re not going to get our performance at that. So, uh, basically, we want to</p>
<p>529<br>00:49:57,039 –&gt; 00:50:02,000<br>avoid, uh, doing syncs. And so I’m just going to ignore syncs and like program as if, you know, we don’t</p>
<p>530<br>00:50:02,000 –&gt; 00:50:08,079<br>have syncs. So let’s look at the following operations. So, uh, here’s the right order.</p>
<p>531<br>00:50:13,039 –&gt; 00:50:18,400<br>We’re going to do a couple operations and this is the case of the ready file. So, uh, we issue a delete</p>
<p>532<br>00:50:20,320 –&gt; 00:50:29,200<br>of the ready file. So for example, this is a, uh, a new, uh, master that becomes, uh,</p>
<p>533<br>00:50:30,720 –&gt; 00:50:37,680<br>uh, uh, it becomes the new leader. Um, and so it needs to write a sort of configuration and</p>
<p>534<br>00:50:38,159 –&gt; 00:50:43,519<br>uh, information in it like, you know, who’s, uh, who are part of the, uh, the, the, the replicate state</p>
<p>535<br>00:50:43,519 –&gt; 00:50:47,919<br>machine and who is the leader. And so it writes, you know, some configuration files, you know, write</p>
<p>536<br>00:50:49,679 –&gt; 00:50:58,319<br>at one, write f2, and then does it create off, ready.</p>
<p>537<br>00:50:58,480 –&gt; 00:51:06,880<br>And then other followers might in your other, you know, this is the red order.</p>
<p>538<br>00:51:11,600 –&gt; 00:51:18,559<br>They can, you know, for example, uh, call, you know, if, you know, exists, ready.</p>
<p>539<br>00:51:18,639 –&gt; 00:51:29,679<br>And so, you can actually see how operation exists and, uh, uh, if, uh, ready exists, then it will</p>
<p>540<br>00:51:29,679 –&gt; 00:51:36,639<br>immediately or true, uh, and otherwise, uh, not. And so you’re gonna have to wait. Uh, so let’s ignore</p>
<p>541<br>00:51:36,639 –&gt; 00:51:41,360<br>that case for a second. Let’s assume that, you know, the second client, so here’s the one per,</p>
<p>542<br>00:51:41,360 –&gt; 00:51:46,559<br>one client did the right operation, second client does the read operations, and then, uh, if it exists,</p>
<p>543<br>00:51:46,559 –&gt; 00:51:51,279<br>then the client reads f1, so then we have to.</p>
<p>544<br>00:51:55,199 –&gt; 00:52:01,039<br>And so the thing that we, you know, we want to understand, like, you know, what values could</p>
<p>545<br>00:52:01,039 –&gt; 00:52:03,199<br>f1, dis-read actually return?</p>
<p>546<br>00:52:11,840 –&gt; 00:52:14,960<br>And I think the thing that we worry about, correct, is a pretty return,</p>
<p>547<br>00:52:16,559 –&gt; 00:52:20,079<br>could have returned some, you know, result of a right that was done much earlier here.</p>
<p>548<br>00:52:25,759 –&gt; 00:52:27,279<br>And we’re must have observed this right.</p>
<p>549<br>00:52:33,199 –&gt; 00:52:39,759<br>I think the paper mentions that, um, there either can watch certain things and be notified of</p>
<p>550<br>00:52:40,559 –&gt; 00:52:44,480<br>changes. Yeah, so let’s assume that actually defile exists, so create actually</p>
<p>551<br>00:52:44,559 –&gt; 00:52:47,360<br>succeeds immediately. So let’s talk about the notifications in a second.</p>
<p>552<br>00:52:49,199 –&gt; 00:52:55,920<br>So this exists returns immediately. No watches involved, just exists. And then we do,</p>
<p>553<br>00:52:55,920 –&gt; 00:52:57,599<br>that second client does a read of f1.</p>
<p>554<br>00:52:59,599 –&gt; 00:53:04,400<br>Um, I think it shouldn’t read whatever word was written by the first client because the operations</p>
<p>555<br>00:53:04,400 –&gt; 00:53:11,280<br>are in five-bow. Yeah, yeah, correct. So the, uh, I think the real thing that actually, uh,</p>
<p>556<br>00:53:11,280 –&gt; 00:53:17,280<br>the, so if we saw this option of what value, correct, like for some right earlier,</p>
<p>557<br>00:53:17,280 –&gt; 00:53:22,640<br>that would mean that we’re reading back in time, correct. And that is just not a lot, you know,</p>
<p>558<br>00:53:22,640 –&gt; 00:53:30,000<br>the rules actually forbid that. Um, this read, you know, must observe, you know, this, uh,</p>
<p>559<br>00:53:30,000 –&gt; 00:53:35,360<br>that value of that right because this read, the previous read, he exists, observe this right,</p>
<p>560<br>00:53:35,440 –&gt; 00:53:42,160<br>correct. So we know that, you know, this exists, I.D. must have seen the ZXID corresponding by that</p>
<p>561<br>00:53:42,160 –&gt; 00:53:51,920<br>create. And so that means that this read will, uh, uh, must, you know, uh, must sort of see the last</p>
<p>562<br>00:53:51,920 –&gt; 00:53:55,599<br>right, you know, that was before them, the total order that preceded, you know, that particular</p>
<p>563<br>00:53:55,599 –&gt; 00:54:01,680<br>create. And so the, the last right in that critical order before that is this particular right,</p>
<p>564<br>00:54:02,399 –&gt; 00:54:07,359<br>because all the rights are actually linearizable. And so it must be the case that this read F1</p>
<p>565<br>00:54:07,359 –&gt; 00:54:12,719<br>of jurists, you know, there’s all the right F1. And so this is nice, correct, because they’ve like,</p>
<p>566<br>00:54:12,719 –&gt; 00:54:17,759<br>you know, some new leader, you know, became the primary, the race, the configuration file, you know,</p>
<p>567<br>00:54:17,759 –&gt; 00:54:22,159<br>we know for sure that actually we’re going to see that last configuration trial that was created by</p>
<p>568<br>00:54:22,159 –&gt; 00:54:29,199<br>that, by that new leader. So we see here an example that these rules are sort of carefully chosen,</p>
<p>569<br>00:54:30,000 –&gt; 00:54:33,919<br>that, you know, things that you might care about, if you’re writing a configuration service,</p>
<p>570<br>00:54:33,919 –&gt; 00:54:41,679<br>that actually certainly work out. Sorry, I might have not understood what you were saying before,</p>
<p>571<br>00:54:41,679 –&gt; 00:54:48,559<br>but in this case, if it exists, like checking exists, ready, couldn’t it read like stuff before</p>
<p>572<br>00:54:48,559 –&gt; 00:54:54,960<br>ready was deleted? Okay, all the rights in your total order. So this right is in total order,</p>
<p>573<br>00:54:54,960 –&gt; 00:54:59,599<br>that right is in total order, the creates in total order, right? So this read here on the other</p>
<p>574<br>00:54:59,599 –&gt; 00:55:04,880<br>site has observed that create. So whatever read is going to do is going to go back in total order,</p>
<p>575<br>00:55:04,880 –&gt; 00:55:09,679<br>correct? And like it would, and observe the last right in that total order. And the last right F1</p>
<p>576<br>00:55:09,679 –&gt; 00:55:15,360<br>is this one. But is exists, right? No, since this is a read, but the existence of jurist is</p>
<p>577<br>00:55:15,360 –&gt; 00:55:21,360<br>particularly right. Oh, you’re saying it, you cannot read back in time, correct? Like this is the whole</p>
<p>578<br>00:55:21,360 –&gt; 00:55:28,240<br>goal. Right. But how did we know that it observed that exact? I told you that I said like the file</p>
<p>579<br>00:55:28,240 –&gt; 00:55:34,559<br>existed. So it must be the case that it observed it. It just endured true. But it existed before</p>
<p>580<br>00:55:34,559 –&gt; 00:55:41,280<br>you deleted it, right? Yeah, yeah, yeah, yeah, but you know, okay, well, go back in a second,</p>
<p>581<br>00:55:41,280 –&gt; 00:55:45,760<br>let me, okay, so this is the second case. This is a good point. Let me talk about that. So like,</p>
<p>582<br>00:55:45,760 –&gt; 00:55:50,079<br>there’s another scenario, and I think this is the one you’re worrying about that could have happened.</p>
<p>583<br>00:55:50,079 –&gt; 00:55:56,880<br>And this is where notifications come in. So the Lizard agreed that this is right, correct? So the second</p>
<p>584<br>00:55:56,880 –&gt; 00:56:06,239<br>case, more rules. And this is indeed interesting. I think the case where you’re worried about is,</p>
<p>585<br>00:56:07,920 –&gt; 00:56:16,079<br>here’s our reader again, here’s our writer again. And the reader calls exists on ready.</p>
<p>586<br>00:56:16,079 –&gt; 00:56:24,799<br>And let’s assume the file, you know, is there and does a read of F1.</p>
<p>587<br>00:56:26,400 –&gt; 00:56:32,159<br>Right. Almost same as in the previous scenario. And now like, there’s some changing leadership,</p>
<p>588<br>00:56:32,159 –&gt; 00:56:39,119<br>you know, there’s the crash, recovery and all the kind of stuff is happening. And so there’s a new</p>
<p>589<br>00:56:39,759 –&gt; 00:56:42,639<br>primary. It deletes ready.</p>
<p>590<br>00:56:46,880 –&gt; 00:56:48,239<br>Get it right. F1.</p>
<p>591<br>00:56:51,039 –&gt; 00:57:02,000<br>It writes F2. And it creates ready. Like I said before.</p>
<p>592<br>00:57:02,480 –&gt; 00:57:08,559<br>And let’s assume that this like this reader a little bit delayed. I don’t know,</p>
<p>593<br>00:57:08,559 –&gt; 00:57:12,960<br>something else happened on the machine. And you know, now does the read of F2.</p>
<p>594<br>00:57:15,440 –&gt; 00:57:18,960<br>I think this is the very question you’re so asking about because this is worrisome,</p>
<p>595<br>00:57:18,960 –&gt; 00:57:24,800<br>correct? Because now there’s a configuration change. And if this configuration change gets</p>
<p>596<br>00:57:24,800 –&gt; 00:57:32,000<br>slotted in the middle here, correct. This read of F2 is going to return the new configuration as</p>
<p>597<br>00:57:32,000 –&gt; 00:57:36,560<br>opposed to the read of F1 that is going to return the old configuration. And clearly things are</p>
<p>598<br>00:57:36,560 –&gt; 00:57:41,760<br>going to be messed up. That is not a scenario where we want to be in. So the terrible outcome.</p>
<p>599<br>00:57:42,880 –&gt; 00:57:47,760<br>And so, and how does that actually, you know, get rectified or how does this actually</p>
<p>600<br>00:57:48,160 –&gt; 00:57:54,080<br>zooki deal with this? Well, this is where the watchers come in. You know, the pictures I drew in</p>
<p>601<br>00:57:54,080 –&gt; 00:57:59,760<br>the foreign proof slide board is not completely correct. In addition to calling exist with this</p>
<p>602<br>00:57:59,760 –&gt; 00:58:01,520<br>read is going to say watch to true.</p>
<p>603<br>00:58:09,600 –&gt; 00:58:12,960<br>And what that means is that this delete</p>
<p>604<br>00:58:13,199 –&gt; 00:58:20,639<br>will change the read file. And we have now set a watch on the read file. And so when the</p>
<p>605<br>00:58:21,599 –&gt; 00:58:27,519<br>read file gets deleted by this new primary, that actually results in the notification.</p>
<p>606<br>00:58:34,720 –&gt; 00:58:39,199<br>And there’s a rule for this notification. Another rule for the notification is that every</p>
<p>607<br>00:58:39,199 –&gt; 00:58:47,679<br>notification will be delivered for, you know, rights that go after it. And so what it has to be the</p>
<p>608<br>00:58:47,679 –&gt; 00:58:57,199<br>case that, you know, this notification will be delivered before the right to F1. So when,</p>
<p>609<br>00:58:57,199 –&gt; 00:59:00,319<br>so there’s two possible scenarios, correct. The notification gets delivered here.</p>
<p>610<br>00:59:02,159 –&gt; 00:59:05,359<br>Or the notification gets delivered like after the read of F2.</p>
<p>611<br>00:59:06,320 –&gt; 00:59:08,640<br>Now let me move that read of F2 slightly up.</p>
<p>612<br>00:59:12,240 –&gt; 00:59:17,840<br>Or yeah. So it’s still happening sort of in time behind, you know, the right operation.</p>
<p>613<br>00:59:18,480 –&gt; 00:59:22,800<br>But the notification gets easier delivered here depending on the delays. Or it’s going to deliver</p>
<p>614<br>00:59:22,800 –&gt; 00:59:28,079<br>to here. So what’s the exact wording of that rule that allows us to happen?</p>
<p>615<br>00:59:31,200 –&gt; 00:59:34,480<br>Basically, I think one way to think about it is the notification is just like it was almost like a</p>
<p>616<br>00:59:34,480 –&gt; 00:59:42,639<br>right operation. And the followers, you know, implement it. So that the, if your change happens</p>
<p>617<br>00:59:42,639 –&gt; 00:59:47,760<br>through the lead to notification goes off, that notification is delivered to the client with that ZXID.</p>
<p>618<br>00:59:51,599 –&gt; 00:59:52,480<br>Again, the data is not-</p>
<p>619<br>00:59:52,480 –&gt; 00:59:59,519<br>I still don’t understand why this guarantees that it can go like before,</p>
<p>620<br>00:59:59,519 –&gt; 01:00:08,320<br>wait, so the valid places for it to be are before the right of F1. And also like after the right of</p>
<p>621<br>01:00:09,280 –&gt; 01:00:17,599<br>F2, right? The notification is delivered after the lead of ready. Before the rights,</p>
<p>622<br>01:00:17,599 –&gt; 01:00:22,159<br>and before the rights of F1 and F2 are visible, or end the create, without matter.</p>
<p>623<br>01:00:22,480 –&gt; 01:00:24,000<br>Oh, I see.</p>
<p>624<br>01:00:30,239 –&gt; 01:00:32,719<br>That’s just a rule. You know, Zooky could have to guarantee that.</p>
<p>625<br>01:00:33,519 –&gt; 01:00:39,039<br>Okay. Okay, so that means there’s two cases, correct? Like the notification gets delivered before</p>
<p>626<br>01:00:39,039 –&gt; 01:00:44,960<br>the read of F1 or after the read of F1. If it’s delivered, if it’s gets delivered after the read</p>
<p>627<br>01:00:45,039 –&gt; 01:00:54,320<br>of F1 or for F2, is there a problem? No. No. Because then the read just happened before the rights.</p>
<p>628<br>01:00:54,320 –&gt; 01:00:59,440<br>Yep, so everything is good. So this is a whole block is happening after the read of F2 is perfectly fine.</p>
<p>629<br>01:00:59,440 –&gt; 01:01:00,159<br>And how about here?</p>
<p>630<br>01:01:03,360 –&gt; 01:01:08,400<br>Um, wait, Professor Didi Say, the watch is like a right, like, right something?</p>
<p>631<br>01:01:09,519 –&gt; 01:01:13,920<br>Well, you can think about it. The watch is not a right operation. Yeah, I didn’t mean to</p>
<p>632<br>01:01:13,920 –&gt; 01:01:19,599<br>imply that, but the right, the watch is executed with the appropriate sort of ZXID that’s associated</p>
<p>633<br>01:01:19,599 –&gt; 01:01:24,559<br>with that right, with that modification. Those are local, right? The watches are. Yeah, the watchers</p>
<p>634<br>01:01:24,559 –&gt; 01:01:32,000<br>are local. And so when they’re executed, it’s guaranteed, you know, that they happen at the right.</p>
<p>635<br>01:01:32,720 –&gt; 01:01:37,760<br>When the right is observed, or the client sees that the watch is propagated with the CXID to</p>
<p>636<br>01:01:37,760 –&gt; 01:01:45,440<br>the client and make sure that they’re executed. Thanks. Again, the papers will slightly</p>
<p>637<br>01:01:45,440 –&gt; 01:01:48,640<br>evade them exactly how it’s implemented, but you can imagine different scenarios.</p>
<p>638<br>01:01:50,080 –&gt; 01:01:53,600<br>But the more important point is like this rule is guaranteed. Okay, so what happens if the</p>
<p>639<br>01:01:53,600 –&gt; 01:02:00,000<br>notification is delivered here? So if the client is running correct, you know, there’s an</p>
<p>640<br>01:02:00,000 –&gt; 01:02:02,639<br>exists to read F1 and now there’s notification comes in.</p>
<p>641<br>01:02:06,000 –&gt; 01:02:08,559<br>Then you have to restart, probably. Yeah, you have to restart.</p>
<p>642<br>01:02:14,960 –&gt; 01:02:21,119<br>Okay, so what we see here basically is that, you know, the rules, you know, make programming definitely</p>
<p>643<br>01:02:21,119 –&gt; 01:02:28,239<br>a little bit more difficult, but not impossible. You know, we have a little bit of careful sort of</p>
<p>644<br>01:02:28,239 –&gt; 01:02:33,839<br>programming, you know, you understand rules, you can actually get the desirable results that</p>
<p>645<br>01:02:33,839 –&gt; 01:02:41,279<br>that’s probably the application wants. What happens to the read F1 though? What happens to read F1?</p>
<p>646<br>01:02:41,279 –&gt; 01:02:48,079<br>Well, you can start all over. Oh, including that. Okay.</p>
<p>647<br>01:02:50,079 –&gt; 01:02:53,759<br>As you’ll see, this is a trick that shows up in those recipes quite a bit, right? Like this</p>
<p>648<br>01:02:54,080 –&gt; 01:03:01,760<br>idea of actually, you know, bailing out and starting over again. Okay, good. So hopefully that</p>
<p>649<br>01:03:01,760 –&gt; 01:03:08,000<br>gives you a sense that for two things, there’s sort of even though, you know, one reason why people</p>
<p>650<br>01:03:08,000 –&gt; 01:03:11,760<br>like people like linearizability is because it’s very intuitive, you know, very easy to program with</p>
<p>651<br>01:03:11,760 –&gt; 01:03:15,680<br>because everything behaves like a single machine. But, you know, if you want fault tolerance,</p>
<p>652<br>01:03:15,680 –&gt; 01:03:20,480<br>scalability, it’s hard to get actually good performance. And so one way to get good performance</p>
<p>653<br>01:03:20,480 –&gt; 01:03:26,240<br>is to compromise on the consistency guarantee. And in this case, you know, compromising linearizability</p>
<p>654<br>01:03:26,240 –&gt; 01:03:29,599<br>and provides some other consistent guarantee. And as we can see, you know, that’s it.</p>
<p>655<br>01:03:30,400 –&gt; 01:03:35,920<br>Complicates, you know, the user experience or the programmer experience. But you know, these rules</p>
<p>656<br>01:03:35,920 –&gt; 01:03:39,599<br>and suitkeepers are carefully chosen. So to still, you know, things are going to actually work out.</p>
<p>657<br>01:03:42,159 –&gt; 01:03:46,719<br>It’s doable. So it is possible to get the right sort of guarantees.</p>
<p>658<br>01:03:46,719 –&gt; 01:03:52,480<br>So now there’s another aspect to this programming model. I don’t know what I want to talk a little bit</p>
<p>659<br>01:03:52,480 –&gt; 01:03:55,279<br>about now that is really related to the coordination service part.</p>
<p>660<br>01:04:06,159 –&gt; 01:04:12,319<br>And so the examples, you know, you need to, you know, what does it mean to be coordination</p>
<p>661<br>01:04:12,320 –&gt; 01:04:19,039<br>service? One good example is probably the VM virtual machine fault tolerance paper from a little</p>
<p>662<br>01:04:19,039 –&gt; 01:04:28,480<br>while ago that we read and that have this test and set operation. The goal of the, you know,</p>
<p>663<br>01:04:28,480 –&gt; 01:04:31,519<br>the test and set operation was basically to make sure that there’s no split brain,</p>
<p>664<br>01:04:31,519 –&gt; 01:04:36,320<br>which is basically two clients would run. And one would win the test and set and get it one wooden.</p>
<p>665<br>01:04:36,320 –&gt; 01:04:41,200<br>And as a result, you know, the one that won the test and set could conclude, you know, that I’m</p>
<p>666<br>01:04:41,279 –&gt; 01:04:48,879<br>going to be the primary. And so that is sort of an example of a feature that a coordination service</p>
<p>667<br>01:04:48,879 –&gt; 01:04:55,039<br>should be able to provide. And I want to, you know, just to make that a little bit more concrete.</p>
<p>668<br>01:04:57,119 –&gt; 01:05:02,960<br>Let’s think about like one wild free, could you get that with wild free? You know, basically sort of</p>
<p>669<br>01:05:02,960 –&gt; 01:05:11,199<br>you kept this in a test and set type thing. Well, so let’s do a very simple case, you know, let’s say</p>
<p>670<br>01:05:11,199 –&gt; 01:05:19,760<br>we have, here’s our simple implementation of test and set. And in lot three, we only have put</p>
<p>671<br>01:05:19,760 –&gt; 01:05:24,000<br>and get operations, right? There’s no other operations. So those are the two operations. So like how</p>
<p>672<br>01:05:24,000 –&gt; 01:05:31,760<br>why you write this, you know, maybe you know, we’ll do a put to the key, let’s say master.</p>
<p>673<br>01:05:34,800 –&gt; 01:05:38,559<br>And we put my IP address in it. We get the address of the caller.</p>
<p>674<br>01:05:40,559 –&gt; 01:05:50,559<br>And then you know, do get, you know, and we say if the get on master is equal to my IP address.</p>
<p>675<br>01:05:54,000 –&gt; 01:05:59,119<br>Then, you know, act as master or act as leader.</p>
<p>676<br>01:06:02,559 –&gt; 01:06:07,119<br>Actually, this is our, you know, in the implementation, you know, we don’t have many other choices</p>
<p>677<br>01:06:07,119 –&gt; 01:06:11,039<br>because we only have to put, we only have to put it in again. And this is how we can implement this.</p>
<p>678<br>01:06:13,119 –&gt; 01:06:15,039<br>Will this do the desirable thing?</p>
<p>679<br>01:06:15,279 –&gt; 01:06:28,960<br>Oh, there’s no atomicity between the put in the gap. So maybe some change them.</p>
<p>680<br>01:06:29,519 –&gt; 01:06:34,000<br>Correct. So basically, there could be two clients, correct? They’re both good at the same time.</p>
<p>681<br>01:06:34,719 –&gt; 01:06:46,559<br>And then observe, you know, the roughly that we do that at the same time, and then interleaf,</p>
<p>682<br>01:06:46,559 –&gt; 01:06:50,400<br>you know, correctly, involve election return, get, you know, with their particular IP address,</p>
<p>683<br>01:06:50,400 –&gt; 01:06:53,039<br>correct? And so we can get two leaders.</p>
<p>684<br>01:06:57,199 –&gt; 01:07:02,639<br>And that’s of course not what we want. So the main point of this, for example, is there’s basically,</p>
<p>685<br>01:07:02,719 –&gt; 01:07:06,559<br>you just have put it in again. It’s going to be very hard to implement a test and set.</p>
<p>686<br>01:07:07,839 –&gt; 01:07:12,000<br>It turns out it’s possible, but it’s very complex. You use Baker’s algorithm, you know,</p>
<p>687<br>01:07:12,000 –&gt; 01:07:15,920<br>you can basically probably do it, but they’re not going to be ridiculous to do that in a distributed system.</p>
<p>688<br>01:07:17,119 –&gt; 01:07:26,319<br>And so what Suzuki does, it just provides some additional help to build these sort of type of</p>
<p>689<br>01:07:26,320 –&gt; 01:07:33,280<br>primitives. And then see in a second. The other thing that, you know, presumably what you want to know,</p>
<p>690<br>01:07:33,280 –&gt; 01:07:38,240<br>and that like, three, does not provide any support for it, if you’re sort of a configuration service,</p>
<p>691<br>01:07:38,240 –&gt; 01:07:42,720<br>or a coordination service, is that you want to know when somebody goes down. And for example,</p>
<p>692<br>01:07:42,720 –&gt; 01:07:47,600<br>you want to observe that like if the leader goes down, like some other parties would like to know,</p>
<p>693<br>01:07:47,600 –&gt; 01:07:53,519<br>like, is the leader down so that we can choose a new one if you needed to. And so at least on the</p>
<p>694<br>01:07:53,519 –&gt; 01:08:00,400<br>applications that building using that service. Okay, so, so there’s two things that we really want.</p>
<p>695<br>01:08:00,400 –&gt; 01:08:03,599<br>You know, one is, you know, we’re not sort of way of trying to get this on a missity.</p>
<p>696<br>01:08:05,679 –&gt; 01:08:09,039<br>That’s what we’re looking for in the ZUKIEPER design. And then in ZUKIEPER design, second,</p>
<p>697<br>01:08:09,039 –&gt; 01:08:14,960<br>we were looking for in the ZUKIEPER design is for an application to learn whether some node goes down.</p>
<p>698<br>01:08:16,640 –&gt; 01:08:22,560<br>And so let’s look at the ZUKIEPER API. And really, you know, what we want to look at is the ZNOT API.</p>
<p>699<br>01:08:24,480 –&gt; 01:08:32,320<br>And we’ll see again that it’s actually carefully designed to actually make it possible to do the</p>
<p>700<br>01:08:32,320 –&gt; 01:08:38,400<br>things that we’re looking for. Okay, so the way the system is organized is, you know, there are</p>
<p>701<br>01:08:38,400 –&gt; 01:08:46,640<br>three of ZNOTes. Typically, you know, there’s like one, you know, sort of app one as a ZNOTE that might</p>
<p>702<br>01:08:46,640 –&gt; 01:08:52,880<br>have some children that correspond to the machines that are part, you know, of app one. So maybe like</p>
<p>703<br>01:08:52,880 –&gt; 01:09:01,920<br>peer or machine one, machine two, maybe the RPI addresses or DNS names, machine three. And they</p>
<p>704<br>01:09:01,920 –&gt; 01:09:07,520<br>might actually have version numbers associated with sequence numbers with them. And basically,</p>
<p>705<br>01:09:07,520 –&gt; 01:09:15,119<br>ZNOTes can be of three types. One, they can be regular. So then they’re fault tolerance replicated</p>
<p>706<br>01:09:15,119 –&gt; 01:09:23,199<br>and all that kind of stuff. And then they can be infemoral. And infemoral basically means that</p>
<p>707<br>01:09:23,199 –&gt; 01:09:31,599<br>the node will disappear automatically when the session with the machine three goes away.</p>
<p>708<br>01:09:32,319 –&gt; 01:09:36,479<br>So either because there’s a network petition, there’s no hard beats more coming in from</p>
<p>709<br>01:09:36,479 –&gt; 01:09:42,159<br>machine three. But at some point ZUKIEPER decides, you know, that session is gone. And so then it will</p>
<p>710<br>01:09:42,159 –&gt; 01:09:49,760<br>delete, you know, that node automatically. And so that’s where infemoral nodes. And then there’s</p>
<p>711<br>01:09:49,760 –&gt; 01:09:57,519<br>a third one, which is the sequential. Let’s go back to the third one. Type of nodes are sequential</p>
<p>712<br>01:09:58,960 –&gt; 01:10:03,039<br>nodes. And that really means that, you know, they have version of version numbers associated with them</p>
<p>713<br>01:10:03,039 –&gt; 01:10:10,399<br>in their name. And they’re created, you get a one by one in under the particular ZNOTE,</p>
<p>714<br>01:10:10,399 –&gt; 01:10:16,639<br>all the children will have a sequence number in their name. And the nodes are no ordered by that</p>
<p>715<br>01:10:16,639 –&gt; 01:10:21,679<br>sequence number. And so again, with this, my desk, sequence number one, this is my desk,</p>
<p>716<br>01:10:21,679 –&gt; 01:10:25,119<br>sequence number two, this is my desk, sequence number three. And if the new one gets created,</p>
<p>717<br>01:10:25,119 –&gt; 01:10:33,119<br>it will have a sequence number higher than three. Okay. And then there’s a API associated with that.</p>
<p>718<br>01:10:33,119 –&gt; 01:10:37,599<br>That’s where I want to talk a little bit about. It’s going to, there’s create. If we already mentioned</p>
<p>719<br>01:10:37,600 –&gt; 01:10:45,200<br>a little bit, you know, takes a path, takes some data and flags. And the flags for response,</p>
<p>720<br>01:10:45,200 –&gt; 01:10:51,600<br>you know, to the free cases. And then there’s delete. And in the previous slide,</p>
<p>721<br>01:10:51,600 –&gt; 01:10:55,440<br>after it’s moved, this leading, you know, delete takes a path as before, but it also takes a version</p>
<p>722<br>01:10:55,439 –&gt; 01:11:09,519<br>number. And exists takes a path in a watch. And then there’s a get data, primitive, that takes</p>
<p>723<br>01:11:09,519 –&gt; 01:11:16,559<br>a path in the version number. And we’ll see that these version numbers are the trick, you know,</p>
<p>724<br>01:11:16,559 –&gt; 01:11:23,759<br>or the key to actually get our other database. And then there’s said data, path, data, and a version</p>
<p>725<br>01:11:23,760 –&gt; 01:11:32,560<br>number. And there’s also call for get children to get actual the children of a particular Z note,</p>
<p>726<br>01:11:32,560 –&gt; 01:11:40,480<br>which takes a path. And I think it watch. And there’s sync, you know, basically I sort of a</p>
<p>727<br>01:11:40,480 –&gt; 01:11:44,960<br>cop out operation direction, ensure that after being, you know, sort of if you really need strong</p>
<p>728<br>01:11:44,960 –&gt; 01:11:51,199<br>linear activity. Okay. So I want to sort of talk a little bit about like, you know, why, you know,</p>
<p>729<br>01:11:51,199 –&gt; 01:11:58,559<br>this version number is handy. And so let’s look at a particular example, the simple example. I can</p>
<p>730<br>01:11:58,559 –&gt; 01:12:10,399<br>come up with a basically implementing a counter. And so the way, you know, you would write the,</p>
<p>731<br>01:12:12,399 –&gt; 01:12:17,199<br>if you write, you know, okay, so let me actually first give the right solution. So while I’ll get</p>
<p>732<br>01:12:17,439 –&gt; 01:12:24,479<br>true. In the way, the implement increment. So there’s the pseudocode for increment of this counter.</p>
<p>733<br>01:12:24,479 –&gt; 01:12:32,159<br>And it’s going to you do get XV, you know, get data of the counter.</p>
<p>734<br>01:12:32,159 –&gt; 01:12:48,319<br>Get data, you know, count. And then if you know, set data. Count.</p>
<p>735<br>01:12:48,319 –&gt; 01:13:01,519<br>So it’s X plus one. And the version number. And get that as the case, then break.</p>
<p>736<br>01:13:03,840 –&gt; 01:13:10,159<br>Okay, so let me quickly go over this. So to get data, returns the current version number and the</p>
<p>737<br>01:13:10,159 –&gt; 01:13:17,359<br>value of the key. So the key or the path, you know, so for the file count, it returns the value</p>
<p>738<br>01:13:17,359 –&gt; 01:13:21,359<br>and its version number at that particular point when they differentiate. And then you call,</p>
<p>739<br>01:13:22,079 –&gt; 01:13:26,639<br>and said data to three arguments, you know, the path, you know, updates, the new value. In this case,</p>
<p>740<br>01:13:26,639 –&gt; 01:13:30,799<br>it’s going to be X plus one because we want increment, you know, the value by one. And it actually</p>
<p>741<br>01:13:30,799 –&gt; 01:13:36,880<br>passes in all of the vertical number. And the, uh, semantics of said data is that either, you know,</p>
<p>742<br>01:13:36,880 –&gt; 01:13:43,279<br>the version numbers are still the same. Then the said data actually happens and otherwise not.</p>
<p>743<br>01:13:43,279 –&gt; 01:13:46,319<br>And so what does this protect against?</p>
<p>744<br>01:13:49,359 –&gt; 01:13:51,439<br>Um, this prevents you from</p>
<p>745<br>01:13:52,559 –&gt; 01:13:58,079<br>interleaving the get and set basically. Yeah, right. So if like two, uh,</p>
<p>746<br>01:13:58,079 –&gt; 01:14:01,920<br>operators, two clients did get at the same time, it would read, uh,</p>
<p>747<br>01:14:01,920 –&gt; 01:14:10,079<br>they do get at the same time. They get both back, say, you know, whatever, X is zero.</p>
<p>748<br>01:14:10,960 –&gt; 01:14:15,119<br>And version number zero, X is zero, version number zero.</p>
<p>749<br>01:14:16,239 –&gt; 01:14:20,319<br>Uh, then they do both of put where, like in this case, it’s set data.</p>
<p>750<br>01:14:22,399 –&gt; 01:14:28,319<br>So the set data with, you know, whatever, uh, X is one, you know, version number zero.</p>
<p>751<br>01:14:29,279 –&gt; 01:14:33,840<br>Also, this guy does the same thing, set, you know, one zero.</p>
<p>752<br>01:14:33,840 –&gt; 01:14:41,520<br>Uh, and you know, why, and so both, both clients issue those two set operations or both set operations</p>
<p>753<br>01:14:41,520 –&gt; 01:14:42,239<br>you can cheat.</p>
<p>754<br>01:14:48,239 –&gt; 01:14:52,640<br>Um, well, no. And yeah, why not?</p>
<p>755<br>01:14:53,760 –&gt; 01:14:56,159<br>Uh, because one of the version numbers will be wrong.</p>
<p>756<br>01:14:56,960 –&gt; 01:15:01,279<br>Yeah, right. Like, what do you want? So one of the two goes first. Why, why does one of the two go first?</p>
<p>757<br>01:15:01,439 –&gt; 01:15:03,439<br>Because all rights are linearized.</p>
<p>758<br>01:15:03,439 –&gt; 01:15:06,159<br>Yeah, all rights are linearized, so they’re going some total order.</p>
<p>759<br>01:15:06,159 –&gt; 01:15:11,519<br>So, you know, we can pick one. So let’s say this guy goes first or this operation goes first.</p>
<p>760<br>01:15:11,519 –&gt; 01:15:18,880<br>So that will increase the, uh, that will increase the, uh, uh, the value, correct,</p>
<p>761<br>01:15:18,880 –&gt; 01:15:24,559<br>the one from zero to one is correctly. And, but that will also, and, and we’ll execute</p>
<p>762<br>01:15:24,559 –&gt; 01:15:27,920<br>because the version number is match, right? Like the version number zero is actually</p>
<p>763<br>01:15:27,920 –&gt; 01:15:32,480<br>actually what the version number is. And so the version number’s match, the increment happens</p>
<p>764<br>01:15:32,480 –&gt; 01:15:37,199<br>and set data returns, uh, true. And what will happen if it’s a second one, while the second one,</p>
<p>765<br>01:15:37,199 –&gt; 01:15:40,640<br>the version number won’t match because the version number will be increased because of,</p>
<p>766<br>01:15:40,640 –&gt; 01:15:44,800<br>because this previous you said data operation. And therefore the second set operation will fail.</p>
<p>767<br>01:15:45,359 –&gt; 01:15:52,560<br>And so then the client will loop back and try again and, uh, try to, and, uh, and try to take another</p>
<p>768<br>01:15:52,560 –&gt; 01:15:57,520<br>shot and do the increment. And correct. So what, what happens in this case is correct,</p>
<p>769<br>01:15:57,520 –&gt; 01:16:02,160<br>even though the two clients executed the operation, you know, concurrently, uh,</p>
<p>770<br>01:16:02,160 –&gt; 01:16:06,320<br>if the interleasing is bad, you know, the, this piece of code will actually do the right thing,</p>
<p>771<br>01:16:06,320 –&gt; 01:16:11,920<br>the second client will try again. And as a result, you know, the, what, what, the end value will be,</p>
<p>772<br>01:16:11,920 –&gt; 01:16:20,000<br>you know, two is supposed to one. Okay? Does that make sense?</p>
<p>773<br>01:16:23,520 –&gt; 01:16:29,360<br>If you’ve done any sort of lock-free programming in the past, uh, then this might all look very familiar to you.</p>
<p>774<br>01:16:29,360 –&gt; 01:16:33,360<br>And so this sort of a style of lock-free, uh, you know, is usually zookeeper to recur,</p>
<p>775<br>01:16:33,360 –&gt; 01:16:35,360<br>just this sort of style of lock-free program.</p>
<p>776<br>01:16:44,800 –&gt; 01:16:45,600<br>Okay, um,</p>
<p>777<br>01:16:47,520 –&gt; 01:16:51,760<br>what I’d like to do, uh, since I’m almost running out of time, last time I ran overtime,</p>
<p>778<br>01:16:51,760 –&gt; 01:16:58,880<br>is I’ll want to talk to some points about locks, uh, but I will do that, uh, next time,</p>
<p>779<br>01:16:59,680 –&gt; 01:17:04,960<br>uh, that I, uh, the next lecture. Now, let me just sort of summarize that we’ve learned so far,</p>
<p>780<br>01:17:04,960 –&gt; 01:17:08,640<br>and then, uh, I’ll talk a little bit more about zookeeper in the, the next lecture.</p>
<p>781<br>01:17:10,720 –&gt; 01:17:12,960<br>So, uh, sorry.</p>
<p>782<br>01:17:15,520 –&gt; 01:17:18,720<br>Uh, so basically, you know, just a very successful design.</p>
<p>783<br>01:17:22,400 –&gt; 01:17:23,199<br>Oops.</p>
<p>784<br>01:17:25,360 –&gt; 01:17:29,840<br>Quite the use. Uh, you can, you know, download it, you know, the time get up, you can uh,</p>
<p>785<br>01:17:29,840 –&gt; 01:17:34,079<br>play around with it if you wanted to. Uh, and one of the things that is interesting about it,</p>
<p>786<br>01:17:34,079 –&gt; 01:17:38,720<br>you know, compared to all the systems that we look so far, it has weaker consistency,</p>
<p>787<br>01:17:38,720 –&gt; 01:17:42,079<br>which with weaker consistency, I mean, it doesn’t provide linearizability.</p>
<p>788<br>01:17:44,560 –&gt; 01:17:48,159<br>Uh, and, you know, we’re seeing that basically as sort of careful,</p>
<p>789<br>01:17:48,720 –&gt; 01:17:54,399<br>design API, at least we have seen some aspects of the design API that, despite the fact that</p>
<p>790<br>01:17:54,399 –&gt; 01:17:58,960<br>actually as weaker consistency, you can still use it. And the fact, you know, you can use it</p>
<p>791<br>01:17:58,960 –&gt; 01:18:03,519<br>actually for pretty important applications, you can actually use, uh, zookeeper as a configuration</p>
<p>792<br>01:18:03,519 –&gt; 01:18:09,119<br>surface. It’s not like it’s just main purpose. So, keeping track of like who’s primary, who’s,</p>
<p>793<br>01:18:09,119 –&gt; 01:18:13,680<br>you know, who’s in the, uh, who wants to set up replicas, et cetera, et cetera. And so,</p>
<p>794<br>01:18:13,680 –&gt; 01:18:17,439<br>for the sort of crucial operation of being a configuration server that has to be correct,</p>
<p>795<br>01:18:17,439 –&gt; 01:18:22,239<br>because otherwise, you know, we get to split brain problem. Uh, the APIs carefully designed so</p>
<p>796<br>01:18:22,239 –&gt; 01:18:29,599<br>that if you use the API correctly, um, you still can implement a discrucial, uh, application on top</p>
<p>797<br>01:18:29,599 –&gt; 01:18:35,919<br>of it, despite the fact that actually provides weaker consistency. And the cool part of that is</p>
<p>798<br>01:18:35,919 –&gt; 01:18:40,159<br>that that’s this, this combination, you know, like sort of careful design API and the weaker</p>
<p>799<br>01:18:40,159 –&gt; 01:18:43,599<br>consistency allows us to get, you know, zookeeper really high performance.</p>
<p>800<br>01:18:49,439 –&gt; 01:18:55,760<br>And we’ll see later in later lectures, more of like this trick of trying to, uh, weaken the</p>
<p>801<br>01:18:55,760 –&gt; 01:19:02,399<br>consistency guarantees to actually, you know, get better, uh, to get better performance or, uh,</p>
<p>802<br>01:19:02,399 –&gt; 01:19:07,119<br>you know, able to, uh, continue despite network petitions.</p>
<p>803<br>01:19:07,119 –&gt; 01:19:14,960<br>Okay, let me stop here, uh, and then I’ll resume, uh, in a little while.</p>
<p>804<br>01:19:15,680 –&gt; 01:19:19,840<br>And the next time around for the rear lecture. Any questions?</p>
<p>805<br>01:19:21,199 –&gt; 01:19:25,199<br>Or, again, as usual, if you have to go, you know, please feel free to let out the go.</p>
<p>806<br>01:19:25,199 –&gt; 01:19:30,479<br>If you want to hang around, ask for more questions, you know, if you’ll be, please feel free to do so.</p>
<p>807<br>01:19:37,119 –&gt; 01:19:51,439<br>Um, sorry, can you go to this slide, which said the, um, set, um, the unsuccessful example for</p>
<p>808<br>01:19:51,439 –&gt; 01:20:03,039<br>the set and protest and set. I think it’s two slides back. This one. Yeah. Um, so you, the new design,</p>
<p>809<br>01:20:04,000 –&gt; 01:20:09,760<br>it’s, it is able to fix that, right? Yeah, it is. You mean, you’re like with the,</p>
<p>810<br>01:20:09,760 –&gt; 01:20:17,600<br>the API, it’s your future provides. Is the version right? Yeah, but if you have notes, I don’t like</p>
<p>811<br>01:20:17,600 –&gt; 01:20:22,640<br>it, it’s honest, so exactly. Uh, so I didn’t get to do that, but I was the point of the rest of the lecture,</p>
<p>812<br>01:20:22,640 –&gt; 01:20:25,920<br>you just need to talk about how you can implement test and set using the version numbers.</p>
<p>813<br>01:20:27,039 –&gt; 01:20:31,760<br>And clearly, the increments suggest you can’t correct, because this is basically the same sequence.</p>
<p>814<br>01:20:33,920 –&gt; 01:20:40,079<br>Right. Oh, and this is the same thing as the master API. Yeah, exactly.</p>
<p>815<br>01:20:41,039 –&gt; 01:20:47,840<br>Okay. Thank you so much. You’re welcome. I have a question about this version, uh,</p>
<p>816<br>01:20:47,840 –&gt; 01:20:53,920<br>versioning to prevent lock, uh, to implement lock free programming. Is this like much more</p>
<p>817<br>01:20:53,920 –&gt; 01:20:59,600<br>efficient, democracy programming? Because you still need to like re try the operation again and again</p>
<p>818<br>01:20:59,600 –&gt; 01:21:05,360<br>until it succeeds, right? Uh, yeah, I’m like, it might be if test and set has a similar property,</p>
<p>819<br>01:21:05,360 –&gt; 01:21:08,800<br>correct? If the test and set failed and you wanted to become, you know, actually increment,</p>
<p>820<br>01:21:08,800 –&gt; 01:21:13,200<br>you have to do that again. So it’s often the case in this lock free style programming that,</p>
<p>821<br>01:21:13,200 –&gt; 01:21:18,240<br>you know, you can have these loops where you re try. And so if there’s a lot of contention,</p>
<p>822<br>01:21:18,240 –&gt; 01:21:21,680<br>you’re going to get a lot to re try. Of course, if there’s no contention, there’s no re try.</p>
<p>823<br>01:21:23,039 –&gt; 01:21:26,640<br>And typically, you know, these lock free algorithms actually are pretty carefully in how they do the</p>
<p>824<br>01:21:26,640 –&gt; 01:21:30,320<br>back off. So they don’t really re try and nearly, you know, they have some backup plan.</p>
<p>825<br>01:21:32,160 –&gt; 01:21:38,160<br>Right. But what benefits does this give over a standard lock? Because either way, if you have</p>
<p>826<br>01:21:38,160 –&gt; 01:21:42,960<br>a lot of contention, you’re going to be like sitting there and re trying a lot. Yeah. So let’s,</p>
<p>827<br>01:21:42,960 –&gt; 01:21:50,480<br>let’s, uh, so you know, so, uh, the, the increment counter is an example where basically, uh, you</p>
<p>828<br>01:21:50,480 –&gt; 01:21:56,400<br>sort of implicitly do the walking, uh, because you will see if we’ve implement locks in Zookiever,</p>
<p>829<br>01:21:56,399 –&gt; 01:22:00,879<br>like it, uh, using the zoo key, okay, if you implement locks with the zoo key per API,</p>
<p>830<br>01:22:01,359 –&gt; 01:22:04,559<br>then if you do the stupid lock, you know, you can also have this contention issue.</p>
<p>831<br>01:22:05,439 –&gt; 01:22:09,119<br>Of course, there’s a way of implementing the smarter lock that they talked about, like we got</p>
<p>832<br>01:22:09,119 –&gt; 01:22:16,559<br>the herding, uh, and then you can do better. Uh, and so I’m hoping to talk about that, uh, next time.</p>
<p>833<br>01:22:18,799 –&gt; 01:22:22,719<br>Okay. Thank you. I think the real point here is, you know, that, you know, you can use these</p>
<p>834<br>01:22:22,800 –&gt; 01:22:28,400<br>primitives to actually do lock free programming. Like with the interface that the lock free provides,</p>
<p>835<br>01:22:28,400 –&gt; 01:22:32,800<br>it’s not possible. Makes sense. Thank you.</p>
<p>836<br>01:22:42,960 –&gt; 01:22:46,800<br>Any further questions?</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MIT6824 P9Lecture9 Zookeeper</div>
      <div>http://example.com/2025/10/24/MIT6824 P9Lecture9-Zookeeper/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/10/12/hello-world/" title="自学大纲">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">自学大纲</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/24/MIT6824%20P8Lecture8-Lab2A_2BQA/" title="MIT6824 P8Lecture8 Lab2A_2BQA">
                        <span class="hidden-mobile">MIT6824 P8Lecture8 Lab2A_2BQA</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
