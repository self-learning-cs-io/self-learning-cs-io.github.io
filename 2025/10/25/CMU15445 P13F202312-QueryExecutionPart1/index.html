

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:19,120This is P 200:00:19,120 –&gt; 00:00:30,080Alright, let’s give it up for DVN Shroom Bomb. 300:00:30,080 –&gt; 00:00:38,120E and I are both from Bombay and while the musi">
<meta property="og:type" content="article">
<meta property="og:title" content="CMU15445 P13F202312 QueryExecutionPart1">
<meta property="og:url" content="http://example.com/2025/10/25/CMU15445%20P13F202312-QueryExecutionPart1/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:19,120This is P 200:00:19,120 –&gt; 00:00:30,080Alright, let’s give it up for DVN Shroom Bomb. 300:00:30,080 –&gt; 00:00:38,120E and I are both from Bombay and while the musi">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-25T05:03:39.728Z">
<meta property="article:modified_time" content="2025-10-25T05:03:39.728Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>CMU15445 P13F202312 QueryExecutionPart1 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CMU15445 P13F202312 QueryExecutionPart1"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-25 13:03" pubdate>
          2025年10月25日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          67 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CMU15445 P13F202312 QueryExecutionPart1</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:19,120<br>This is P</p>
<p>2<br>00:00:19,120 –&gt; 00:00:30,080<br>Alright, let’s give it up for DVN Shroom Bomb.</p>
<p>3<br>00:00:30,080 –&gt; 00:00:38,120<br>E and I are both from Bombay and while the music was playing, how much of the population</p>
<p>4<br>00:00:38,120 –&gt; 00:00:40,120<br>of Bombay go up by in that two minutes?</p>
<p>5<br>00:00:40,120 –&gt; 00:00:42,120<br>I guess 100,000?</p>
<p>6<br>00:00:42,120 –&gt; 00:00:43,120<br>Yeah, something like that.</p>
<p>7<br>00:00:43,120 –&gt; 00:00:46,120<br>It’s like a city of 15, 20 million.</p>
<p>8<br>00:00:46,119 –&gt; 00:00:49,119<br>Every time I go back every few years, there’s like a million more.</p>
<p>9<br>00:00:49,119 –&gt; 00:00:53,119<br>I don’t know how they keep packing all of that stuff up, but that’s great.</p>
<p>10<br>00:00:53,119 –&gt; 00:00:54,119<br>Alright.</p>
<p>11<br>00:00:54,119 –&gt; 00:00:55,119<br>20 million.</p>
<p>12<br>00:00:55,119 –&gt; 00:00:56,119<br>20 million.</p>
<p>13<br>00:00:56,119 –&gt; 00:00:58,119<br>This stuff counting.</p>
<p>14<br>00:00:58,119 –&gt; 00:01:00,119<br>Yeah, yeah, that makes sense.</p>
<p>15<br>00:01:00,119 –&gt; 00:01:01,119<br>So great.</p>
<p>16<br>00:01:01,119 –&gt; 00:01:02,119<br>Alright.</p>
<p>17<br>00:01:02,119 –&gt; 00:01:06,120<br>Today, we are going to talk about very execution.</p>
<p>18<br>00:01:06,120 –&gt; 00:01:09,120<br>We’ll start with a couple announcements.</p>
<p>19<br>00:01:09,120 –&gt; 00:01:14,120<br>The first one is that you already know,</p>
<p>20<br>00:01:14,120 –&gt; 00:01:21,120<br>homework, please do on October 8th and project, please do an October 29th.</p>
<p>21<br>00:01:21,120 –&gt; 00:01:23,120<br>The big thing is the midterms.</p>
<p>22<br>00:01:23,120 –&gt; 00:01:28,120<br>Hopefully none of your surprised is the next lecture in class.</p>
<p>23<br>00:01:28,120 –&gt; 00:01:36,120<br>The material for that is everything that we covered till last week, including the two lectures from last week.</p>
<p>24<br>00:01:36,120 –&gt; 00:01:41,120<br>So today’s lecture is not material for the midterm, but it’s obviously material for the final exam.</p>
<p>25<br>00:01:41,120 –&gt; 00:01:47,120<br>So don’t stop paying attention today, but you don’t have to worry excessively about this lecture just yet.</p>
<p>26<br>00:01:47,120 –&gt; 00:01:50,120<br>You worry about it during your final exam.</p>
<p>27<br>00:01:50,120 –&gt; 00:01:54,120<br>Questions on the midterm?</p>
<p>28<br>00:01:54,120 –&gt; 00:01:55,120<br>Okay.</p>
<p>29<br>00:01:55,120 –&gt; 00:02:00,120<br>Alright, so we’ll get started and look at.</p>
<p>30<br>00:02:00,120 –&gt; 00:02:03,120<br>Yeah, for the midterm, do you get a cheat?</p>
<p>31<br>00:02:03,120 –&gt; 00:02:05,120<br>Yes, I was going to announce that all in the end.</p>
<p>32<br>00:02:05,120 –&gt; 00:02:10,120<br>The quick answer is yes, you get a cheat sheet that you can write on both sides, but handwritten.</p>
<p>33<br>00:02:10,120 –&gt; 00:02:14,120<br>So you don’t put in like six point font and come with binoculars and stuff like that.</p>
<p>34<br>00:02:14,120 –&gt; 00:02:25,120<br>So ultimately look, by philosophy is that if you need a cheat sheet just to have to get yourself from worrying about what formula’s I need to remember, that’s what a cheat sheet is for.</p>
<p>35<br>00:02:25,120 –&gt; 00:02:27,120<br>It should not stop you.</p>
<p>36<br>00:02:27,120 –&gt; 00:02:30,120<br>It should not be the way you say I’m going to pass the exam.</p>
<p>37<br>00:02:30,120 –&gt; 00:02:31,120<br>It will be a pretty bad idea.</p>
<p>38<br>00:02:31,120 –&gt; 00:02:39,120<br>We really want you to understand the material in this course so that if you’re an interviewer talking to someone who understands databases and they ask you question.</p>
<p>39<br>00:02:39,120 –&gt; 00:02:44,120<br>If you don’t say, wait a minute, I need to get my two page and written cheat sheet before I answer that question.</p>
<p>40<br>00:02:44,120 –&gt; 00:02:46,120<br>Okay, so that’s not the goal.</p>
<p>41<br>00:02:46,120 –&gt; 00:02:49,120<br>It’s it’s just a safety measure.</p>
<p>42<br>00:02:49,120 –&gt; 00:02:51,120<br>It’s not the way you pass the exam.</p>
<p>43<br>00:02:51,120 –&gt; 00:02:57,120<br>And I’ll talk about more about it when we get to that portion of the talk towards the after we finish today’s material.</p>
<p>44<br>00:02:57,120 –&gt; 00:02:58,120<br>Okay.</p>
<p>45<br>00:02:58,120 –&gt; 00:03:01,120<br>Alright, and some of you in the classroom, I know you like to talk with each other.</p>
<p>46<br>00:03:01,120 –&gt; 00:03:02,120<br>That’s great.</p>
<p>47<br>00:03:02,120 –&gt; 00:03:08,120<br>If you do, if you intend to talk to each other a lot, at least in the back room, being a student a long time ago.</p>
<p>48<br>00:03:08,120 –&gt; 00:03:12,120<br>I know if someone in front of you is talking a lot, the people behind you get disturbed.</p>
<p>49<br>00:03:12,120 –&gt; 00:03:15,120<br>So if you think you’re going to talk a lot, then just stay in the back seat.</p>
<p>50<br>00:03:15,120 –&gt; 00:03:16,120<br>It’s just easier.</p>
<p>51<br>00:03:16,120 –&gt; 00:03:20,120<br>And I’m okay with that as long as you don’t disturb everyone else.</p>
<p>52<br>00:03:20,120 –&gt; 00:03:21,120<br>Okay.</p>
<p>53<br>00:03:21,120 –&gt; 00:03:22,120<br>Great.</p>
<p>54<br>00:03:22,120 –&gt; 00:03:27,120<br>We’ll talk about processing models today, which is how does a query get processed?</p>
<p>55<br>00:03:27,120 –&gt; 00:03:31,120<br>We’ll dig into the details of the different methods and mechanisms.</p>
<p>56<br>00:03:31,120 –&gt; 00:03:44,120<br>Then talk about these things called access methods, which is the way in which the query operators will start touching the data, sitting in memory or in disks for the first time before it feeds into the rest of the query.</p>
<p>57<br>00:03:44,120 –&gt; 00:03:50,120<br>Then talk about things that you might have to make changes to when you worry about deletes and update types of queries.</p>
<p>58<br>00:03:50,120 –&gt; 00:03:56,120<br>We’ll look at expression evaluation, then do a very quick midterm review and hopefully we’ll have enough time for that.</p>
<p>59<br>00:03:56,120 –&gt; 00:03:57,120<br>Okay.</p>
<p>60<br>00:03:58,120 –&gt; 00:04:07,120<br>All right. So the processing model is what defines how a database system implement the execution of the different queries.</p>
<p>61<br>00:04:07,120 –&gt; 00:04:19,120<br>And the best way to think about the processing model is to say, if I were to write a database engine from scratch and you’re already working with bus stop so you know a whole bunch of how that works.</p>
<p>62<br>00:04:19,120 –&gt; 00:04:31,120<br>But imagine you have to start writing something from scratch and say how do I execute a query, which as we know from previous lectures comes in the form of a relational algebra operator, plant tree.</p>
<p>63<br>00:04:31,120 –&gt; 00:04:35,120<br>And data is going to flow from the bottle and the results come out at the top.</p>
<p>64<br>00:04:35,120 –&gt; 00:04:48,120<br>So how do I write that code? How would I write that code for that operator to make all of that happen because the shape of the tree can be arbitrary, but the code you’re going to write for each operator and code specific algorithms like a hash join for a joint operator.</p>
<p>65<br>00:04:48,120 –&gt; 00:04:53,120<br>Or a shortboard join or index nested loops or block nested loops.</p>
<p>66<br>00:04:53,120 –&gt; 00:05:02,120<br>And the inputs for that operator when it’s running either one of these algorithms is going to be some other portion of the query plan that’s doing its own thing.</p>
<p>67<br>00:05:02,120 –&gt; 00:05:07,120<br>You’re assembling this flow on the fly and what are the different ways in which you can bring it together.</p>
<p>68<br>00:05:07,120 –&gt; 00:05:15,120<br>So really the best way to understand these processing models is to say, how would I write the code for a database engine from scratch.</p>
<p>69<br>00:05:15,120 –&gt; 00:05:20,120<br>If I had to do that, that’s the best way to try and understand the operator model.</p>
<p>70<br>00:05:20,120 –&gt; 00:05:29,120<br>And hopefully you’ll get that appreciation in a bit. There are three different operator models will go through each one of those in turn.</p>
<p>71<br>00:05:29,120 –&gt; 00:05:35,120<br>The iterator model is the simplest and we look at an example next.</p>
<p>72<br>00:05:35,120 –&gt; 00:05:57,120<br>Three functions, imagine defining a canonical function definition for each of these operators, whether it’s a scan that reads a file or an index selection or a join or an aggregate or a projection, right, all the stuff that you know from what are nodes in an operator tree.</p>
<p>73<br>00:05:57,120 –&gt; 00:06:08,120<br>Each of those operators, we want them to have the same signature. The code is there is going to be dependent upon the algorithm that it implements, but you want the signature to be the same so you can mix and match.</p>
<p>74<br>00:06:08,120 –&gt; 00:06:19,120<br>What does that signature look like? The three key components of the signature are there’s an open and close start the operator close it like a constructor and destructor for a class.</p>
<p>75<br>00:06:19,120 –&gt; 00:06:34,120<br>And the key component of that, the main part that’s how it interacts with everything else is going to be this next this next call in the iterator model, which is the first of the three models we are looking at is simply going to say I’m doing whatever I’m doing.</p>
<p>76<br>00:06:34,120 –&gt; 00:06:55,120<br>If I’m a selection operation, I’m trying to look at the data, apply the predicate see if it passes that predicate and if so, I’m going to do something with it next is basically say what’s the next record that I send to someone else who needs that input who needs my output as a report.</p>
<p>77<br>00:06:55,120 –&gt; 00:07:16,120<br>So next you can cast all of this in very much like the iterators that you see in C++ and other languages, right. You are iterating over a range of values except in the operator model, you’re iterating over the records that are getting produced, you don’t know where the start and end is that’s going to be dependent on the semantics of that operator and what it does.</p>
<p>78<br>00:07:16,120 –&gt; 00:07:25,120<br>So it’s not a predefined you don’t know how many next functions are going to be called, but you know you’ll keep calling next if I’m talking to an operator and consuming from it.</p>
<p>79<br>00:07:25,120 –&gt; 00:07:34,120<br>You keep calling next till the operator returns an end of file saying I don’t have anything else and then processing everything I need and that’s your end of it, right, a marker.</p>
<p>80<br>00:07:34,120 –&gt; 00:07:38,120<br>Okay, the open and close adjust to tear up and tear down stuff as you need to.</p>
<p>81<br>00:07:38,120 –&gt; 00:07:43,120<br>So the next function is bringing in data or is it returning next function is bringing in data.</p>
<p>82<br>00:07:43,120 –&gt; 00:07:53,120<br>Okay, and then of course the person who’s implementing it has to output the data for the function to call so as an implementer, the next is to output the record as someone calling next is to consume that.</p>
<p>83<br>00:07:53,120 –&gt; 00:07:55,120<br>Okay.</p>
<p>84<br>00:07:56,120 –&gt; 00:08:07,120<br>And of course operators will take things from other operators and output stuff so they’ll call nest next and they will also go and have the nest function so it’ll all become clear in this light.</p>
<p>85<br>00:08:07,120 –&gt; 00:08:12,120<br>So imagine a very simple query which we’re going to use as a running example so let’s get to know it.</p>
<p>86<br>00:08:12,120 –&gt; 00:08:15,120<br>It’s got two tables are a nest that’s a sequel.</p>
<p>87<br>00:08:15,120 –&gt; 00:08:21,120<br>This is the relational algebra representation for that query now hopefully all these operators are very familiar to you.</p>
<p>88<br>00:08:21,120 –&gt; 00:08:26,120<br>If not you’ve got less than 48 hours to brush it up with some exam.</p>
<p>89<br>00:08:26,120 –&gt; 00:08:38,120<br>You’ll apply a selection here where the criteria is value is greater than 100 to a natural join between the R and S records produce the joint records and only key the two IDs.</p>
<p>90<br>00:08:38,120 –&gt; 00:08:47,120<br>Now of course an optimizer which we’ll see later on is going to try and do other types of things like it when most of the projection for the down this stuff like that ignore all of that.</p>
<p>91<br>00:08:47,120 –&gt; 00:08:52,120<br>Today we’re just going to try and run this query with these three different processing models.</p>
<p>92<br>00:08:52,120 –&gt; 00:08:54,120<br>Okay.</p>
<p>93<br>00:08:54,120 –&gt; 00:08:59,120<br>So start by opening up all these operators.</p>
<p>94<br>00:08:59,120 –&gt; 00:09:10,120<br>So what just happened is we just initiated each of the operators instances right so we just called new on the operator whose code implements each one of that.</p>
<p>95<br>00:09:10,120 –&gt; 00:09:13,120<br>Let’s see what each of the code looks like.</p>
<p>96<br>00:09:13,120 –&gt; 00:09:17,120<br>Let’s start with the simplest one here which is a simple scan.</p>
<p>97<br>00:09:17,120 –&gt; 00:09:38,120<br>What this is saying is for each record T tuple in the relation S so that’s the database file it will open up and it’s end to simply going to emit T right so it’s just reading from the five consuming from it and outputing that this operator is saying and we connect all up in in a second is say I’m going to read from here.</p>
<p>98<br>00:09:38,120 –&gt; 00:09:47,120<br>To this loop we’re going to call the next on the child so that’s the question that he just asked and I’m going to evaluate that predicate which is a selection.</p>
<p>99<br>00:09:47,120 –&gt; 00:09:54,120<br>And this is effective either next call it implement that next call calls the next forest child.</p>
<p>100<br>00:09:54,120 –&gt; 00:10:03,120<br>So imagine now we opened all of it and I’m not going to show how the connections are made we’ll talk about the scheduler towards end of the lecture and we’ll make that a little bit more explicit.</p>
<p>101<br>00:10:03,120 –&gt; 00:10:15,120<br>So all opens have been called and as part of the open calls it’s been set up that the root node has one child the child has two.</p>
<p>102<br>00:10:15,120 –&gt; 00:10:30,120<br>Operator instances it’s talking to the left and the right and the this over here has one more entry okay so the tree have been set up and effectively you can think about the talk mode having a function pointer to this when the open happened and in turn.</p>
<p>103<br>00:10:30,120 –&gt; 00:10:52,120<br>That open call this open that open call this open and that second open for call this okay so the open setup all that point so implicit in this diagram is that these things have been set up in the order in which we did that right so watch this again start with the top it opens opens another one open open open and all of those things are called up so now.</p>
<p>104<br>00:10:52,120 –&gt; 00:11:10,120<br>So at runtime in your system you’ve got the top corresponding to the root of this tree and as you’ll see in a little bit the database engine is just going to call next on that one is going to invoke the next function on that which in turn will.</p>
<p>105<br>00:11:10,120 –&gt; 00:11:26,120<br>We’ll apply the next call all the way down to go and start evaluating this girl okay this makes sense so far as to what we just did we just open the connections that set up the function connections has the same shape as the tree and now we get started we’re ready now.</p>
<p>106<br>00:11:26,120 –&gt; 00:11:39,120<br>So this is the open function of the next function the open function was implicit when this the boxes came up so this you can think about what shown over here as the implementation of the next function okay the main part the open happened as the boxes opened up.</p>
<p>107<br>00:11:39,120 –&gt; 00:12:08,120<br>And the pointers was set up okay and the close will be tell down I’m not even going to show the close anyone said allocated intermediate structure will remove it typically the operator themselves written as classes if you’ve written it in a language like C plus class so you’ll call the destructor of that class which implements usually the close function but often there’s a separate close function for cleanup but that’s details you talk about that in the advanced class if you want to keep some of these running especially if you’re in the streaming environment but that’s a.</p>
<p>108<br>00:12:08,120 –&gt; 00:12:21,120<br>But that’s a site note there’s sometimes in some database systems since streaming environments you might keep them around forever okay and just close it but keep the state around all right other questions.</p>
<p>109<br>00:12:21,120 –&gt; 00:12:37,120<br>What does child represents it’s children child right so for me and child basically say something called the next off my child which is this not that makes sense right and this has basically a left and a right which are the left and the right children.</p>
<p>110<br>00:12:37,120 –&gt; 00:13:06,120<br>So look at that pass code it says hash hash join implementation is what’s shown here it’s going to say get everything from this site on which I’m going to build a hash table so it has to first read everything from this site then once a half table is built it has to go and read from this site which in turn will call all of this up and then produce the pro okay and then it can send it stuff up so here’s the animation for it so we’ll start by calling the top most next.</p>
<p>111<br>00:13:06,120 –&gt; 00:13:35,120<br>The top most next function gets called at the very top that in turn calls the next function here okay that code starts to run for T1 building left next so it’s going to call the next year right and now when it calls that next year it goes and so that call that call calls this next year so we are here everyone with me as to what’s happened so far right all of this is set up in memory function state has been set up now for the first time we.</p>
<p>112<br>00:13:35,120 –&gt; 00:14:04,120<br>Now for the first time we start touching data this starts reading records from the table all right it starts to run and starts emitting the record as soon as it finds it it returns back the next as soon as it finds the record okay internally to keep track for where it is in that relation are so the next time it’s called it would fetch the next one haven’t shown all that state stuff but you can imagine that status get here so now one record has been fetched from the bottom and then it returns that.</p>
<p>113<br>00:14:05,120 –&gt; 00:14:26,120<br>So in this simple iterator model each next call returns one record okay now it comes back up over there and obviously the hash one code can’t do anything else to the first two lines are one which is building the hash table so guess what’s going to happen in someone helping what will happen next in this cold floor yeah.</p>
<p>114<br>00:14:26,120 –&gt; 00:14:55,120<br>Yeah yeah got me again so this will look and this will look till how long someone from this side of the room I’m noticing the class and most of the hands are raised here so I’m going to try and spread this load out and maybe next time you can shuffle around yeah read the entire table exactly all the our records will be read and eventually then end of file indicator will come to this new over here at which point the code is allowed to proceed to that second for loop okay so.</p>
<p>115<br>00:14:55,120 –&gt; 00:15:25,080<br>Okay so that will go on till you get to that but one record at a time and then this part gets involved now we stop touching data for the first time on the s side and same thing happens but this time that loop goes up to that next child the record gets selected if it passes that predicate and if it does it goes in there and the query runs till it’s done eventually now if something hits in the hash table it gets output it there so that next.</p>
<p>116<br>00:15:25,120 –&gt; 00:15:55,080<br>Call that was called from the root a long time ago now gets its first result after an entire hash table has been built and the pro side has been fed to it that selection of records that passes selection and hit in the hash table okay and what does it get as output at the root one record the first record from the output relation okay alright so this is a simplest model all databases started by implementing this you know.</p>
<p>117<br>00:15:55,120 –&gt; 00:16:05,560<br>Many of the database is that we see today at the older ones had the roots in the 1970s and 80s and as you can imagine as a programmer this was the easiest thing to do.</p>
<p>118<br>00:16:05,799 –&gt; 00:16:25,080<br>And the single record at the time interface was not a big deal because you’re pretty much at that time the memories won’t that large your book of rules was really small thousand pages 10,000 pages pretty tiny most of the time you are going out to this and so the cost for this was very reasonable and this was such an easy implementation right you can see as a.</p>
<p>119<br>00:16:25,120 –&gt; 00:16:28,679<br>Programmer it’s a very easy code to write.</p>
<p>120<br>00:16:28,679 –&gt; 00:16:35,159<br>Okay now what do you think of the downsides of this what do you think is inefficient about this.</p>
<p>121<br>00:16:35,159 –&gt; 00:16:40,440<br>It seems like because you have an iterator on everything you can’t really realize super easy.</p>
<p>122<br>00:16:40,440 –&gt; 00:16:53,480<br>You can’t capitalize super easy that’s true though the three were a bushy tree then you could start the left side right side you could do stuff like that really right so super easy to capitalize but hold on hold on yep I’m coming to you guys next stop thinking.</p>
<p>123<br>00:16:53,480 –&gt; 00:17:02,600<br>I have been done operations which are like at the base of the tree but yeah to keep running this for the you can’t do these kinds of optimization.</p>
<p>124<br>00:17:02,600 –&gt; 00:17:11,839<br>You mean like the S is being stand multiple times with different parts of the tree yes yeah for example like if you do like multiple ware causes or different.</p>
<p>125<br>00:17:11,839 –&gt; 00:17:12,240<br>Yeah.</p>
<p>126<br>00:17:12,240 –&gt; 00:17:25,200<br>Yeah that’s true that will happen in all the models but that’s a good thought hold on to that thought when you talk about expressions which you’re right there’s certain optimizations you could do.</p>
<p>127<br>00:17:25,200 –&gt; 00:17:33,079<br>When there are patterns spread across the different trees but that will be true for all the other models right there’s an even bigger problem here.</p>
<p>128<br>00:17:33,079 –&gt; 00:17:35,599<br>Okay.</p>
<p>129<br>00:17:35,599 –&gt; 00:17:52,279<br>Is it that you can use a static hash table but the bigger problem is that most operate you know the I’ll go to that part over here and then come back to the previous slide is that you are whoops.</p>
<p>130<br>00:17:52,279 –&gt; 00:18:03,719<br>You’re going to be calling a lot of these function calls over and over again and what’s the sequence that’s happening in the situator model I call a function do a work get one.</p>
<p>131<br>00:18:03,720 –&gt; 00:18:23,240<br>Record back so how many times do you think I’m switching context between these operators like take this slow here this code runs goes all the way down function switched over to a different function that needs to be run then that function ran it did it stop and then one record got.</p>
<p>132<br>00:18:23,240 –&gt; 00:18:31,079<br>So when this that there are billion records flying it will be billion times three loops to that one record at a time so that’s slow.</p>
<p>133<br>00:18:31,079 –&gt; 00:18:52,279<br>A lots of function calls they can be pretty expensive especially if your data fits in memory all of a sudden that’s a cost that adds up second is sometimes if you have lots of functions been called other queries running stuff like that you know your function code is not getting a chance to stay in the instruction cash it’s getting swapped out.</p>
<p>134<br>00:18:52,279 –&gt; 00:19:11,599<br>So instruction cash is where your code that is being run stays in the highest level of the process a cash human functions which is generally not good for it so that lots of reasons why this is inefficient is for every little thing you have to go back right it’s too low level every record involves going through a loop that you’re seeing in this call.</p>
<p>135<br>00:19:11,759 –&gt; 00:19:23,439<br>Okay so it starts to get really inefficient and as I said most database systems have that in fact you see a list of database systems over here some that are massive big database systems billion dollar companies are more.</p>
<p>136<br>00:19:23,879 –&gt; 00:19:30,439<br>And they still have this model because it’s super easy to implement and reason about okay also pretty easy to debug the code.</p>
<p>137<br>00:19:31,319 –&gt; 00:19:35,919<br>Because you can you know at any point as to what’s happening it’s a much more easier flow to reason about.</p>
<p>138<br>00:19:36,360 –&gt; 00:19:47,039<br>All right so all of this made sense in the 1980s or so but then memory started to get bigger and there are other models that were there.</p>
<p>139<br>00:19:47,720 –&gt; 00:20:05,880<br>This is a second model which is called the materialization model and what this says is that i’m going to when an operator is called imagine the next saying what i’m going to do in my next stuff is produce the entire output and then return it back up to my color.</p>
<p>140<br>00:20:06,880 –&gt; 00:20:18,759<br>Okay so that way each operator is getting called once at the root at the base of the tree of the operator tree returns its whole output and then it’s done.</p>
<p>141<br>00:20:20,200 –&gt; 00:20:28,240<br>Okay so here’s what it looks like same tree as before the code looks a little different now but the code component of it is still the same.</p>
<p>142<br>00:20:28,759 –&gt; 00:20:44,319<br>And the main part which you can see is now there’s this out so this scan on r is adding to an internal area think of it is getting in memory but sometimes it can be spilled to this too for the focus of the lecture we just say it’s kept in memory.</p>
<p>143<br>00:20:44,680 –&gt; 00:20:55,000<br>And then once it is done returns the whole array which is all the records in the table r so it’s a copy of the table are in an array that is sent to the parent right so the flow now looks like this.</p>
<p>144<br>00:20:55,599 –&gt; 00:21:04,680<br>Same way set things up this gets called a return which is all the records that’s it that looks going to be run that do three loop is run once.</p>
<p>145<br>00:21:05,759 –&gt; 00:21:10,559<br>Okay not once per record once per record in the art table is just run once for the query.</p>
<p>146<br>00:21:12,559 –&gt; 00:21:12,880<br>Okay.</p>
<p>147<br>00:21:13,880 –&gt; 00:21:34,880<br>All right now as you can imagine then the second piece of that hash join code hash join is a blocking operator it needs to see everything from one side before it can do anything else as you can see i’ve called the hash even in this scenario the next call call to it a long time ago it still has to get all of this stuff then start crossing the other side before it can do that right.</p>
<p>148<br>00:21:34,880 –&gt; 00:21:54,880<br>Unlike something like this which can start doing its work as soon as it’s called it’s not dependent on anything it can just stream through it it doesn’t have a blocking component hash join sorting aggregates and naturally blocking they have to see all or most of the input for the hash join it as to see all of the left side before it can start emitting anything else to its parent.</p>
<p>149<br>00:21:55,880 –&gt; 00:22:03,880<br>Okay same thing here no rocket science here all arrows flowing up ascending entire tables for the whole thing.</p>
<p>150<br>00:22:04,880 –&gt; 00:22:06,880<br>What the result of that operator.</p>
<p>151<br>00:22:08,880 –&gt; 00:22:28,880<br>Okay now where does it work well this works well when your queries don’t have large tables that need to be sent across which happens in OLTP environment that are transactional workloads i’m updating a record or you log into Amazon and you have a customer ID just need to look up your profile information to start populating the web page right stuff like that.</p>
<p>152<br>00:22:28,880 –&gt; 00:22:57,880<br>So very few records are passed along that entire query plan tree so the tables that are in between are relatively small in which case this is a pretty easy implementation and it requires the least number of calls that you need to make to these operators right because the operators get called once they do all the work and send stuff out it’s pretty efficient for the short queries that happens in these OLTP environment where the workload largely consists of small transactional stuff that touch on very small fraction of the data.</p>
<p>153<br>00:22:58,880 –&gt; 00:23:27,880<br>Either to read a few records from a gigantic table or to basically update a few records right and we’ll talk about updates in a little bit one of the databases that you see your whole DB and the ad worked on that before and from what I understand he wrote one of the first operator models based on the materialization approach it’s also pretty easy code based to reason about you could put a break point in any operator and look at what the input output is to say hey did the logic below work well.</p>
<p>154<br>00:23:27,880 –&gt; 00:23:56,880<br>So easier to implement this was a life till about two decades ago when processor started to get really fancy before this till the late 90s processes did it was in the 90s that processor started to have cashes and then you could start to do all kinds of interesting things with that where you have to worry about the cashes and the cost started to become different where the CPU cycle started to become more and more precious and memories were starting to grow right so now your data is starting to grow.</p>
<p>155<br>00:23:56,880 –&gt; 00:24:09,880<br>Right so now your data is coming from memory into the processor not this which is you know three orders of magnitude away at times from memory and so the CPU cost and other components and the switching costs started to become a big deal.</p>
<p>156<br>00:24:09,880 –&gt; 00:24:25,880<br>So one of the earliest examples of switching over to this is a vectorization model that came through was to basically recognize that there are two things we want to play on one is we don’t want we want to intermediate ground between fetching all the records between each of these operator called.</p>
<p>157<br>00:24:25,880 –&gt; 00:24:53,880<br>Or fetching just one topple to get something a little bit smaller and also if I can get a batch of records right not the entire result but not one batch being more than one I can also vectorize that so if I’m doing a selection so let’s just go through with an example here same thing is before slightly different code basically now start to see more the output which is the way database people say what’s the size of that output in terms of the data.</p>
<p>158<br>00:24:53,880 –&gt; 00:25:22,880<br>So it’s the size of that output in terms of number of records is greater than and then I am experiencing my batch sizes in so we’ll start doing this here start doing that now that return call will return a batch of records so this loop will get call as many times as there are batches to be provided so if we’ve got a thousand records and my batch is a hundred this will be 1000 divided by 100 this loop will be called 10 times.</p>
<p>159<br>00:25:22,880 –&gt; 00:25:51,880<br>Not once so it’s a little balanced in between and the other advantage of that especially when you’re doing things like that operator for is that if I get like a hundred records here I can get this inner part like the predicate eval potion and evaluate that using these instructions that are started to show up in a lot of machines where you could do multiple how many of you have heard of Cindy single instruction multiple data right so that type of hardware.</p>
<p>160<br>00:25:52,880 –&gt; 00:26:17,880<br>Where which says I’m going to add one to every number you could write a simple loop that says add one if I’ve got four numbers and that loop will run four times but there are instructions there architectures in which you can say if you can upload four numbers together you get that in an array in one instruction you can add four to each one independent single instruction on multiple data you can apply that apply that parallelism in in one cycle.</p>
<p>161<br>00:26:17,880 –&gt; 00:26:46,880<br>So all of that hardware does very well with the creation because if that operation is to do things like compare a predicate I can vectorize that if my vector size is eight then in one cycle I can evaluate eight values and decide whether the predicate applies or not and you’ll see techniques like that in subsequent classes when we go a little bit deeper into some of this but that plus finding that middle ground between how big the batches because with the full materialization model if one of this input for example in this algorithm.</p>
<p>162<br>00:26:47,880 –&gt; 00:27:13,880<br>The four was a billion rows now I need to allocate that billion rows and memory and that’s a lot of space right where’s that space going to come from it’s the same memory pool that’s competing for the buffer pool and stuff like that if I just start allocating that when buffer pool is going to get squeezed and I can start running into trouble okay I could put in the buffer pool but I’m taking space away from something else okay so the decoration model has a nice balance ground yep.</p>
<p>163<br>00:27:13,880 –&gt; 00:27:42,880<br>What is with the materialization model like I understand better for else but why is it like function call over there yeah the materialization model is better when you have very small so the question was when some materialization model better it’s when the records are the tables are relatively small and you just materializing the whole thing so you could argue why don’t I vectorize it even for that you could potentially and that’s a very relevant question to ask say if my bad size is big enough do I need the materialization model.</p>
<p>164<br>00:27:43,880 –&gt; 00:28:12,880<br>It can I just do the vectorization model the shot answer is vectorization gives you a nice middle ground between the best of both worlds and you can always control the vector size if the database implementer has given you that option and you can span that spectrum so we can good point that that could cover the case where materialization is better so I’m trying to ask is why is this ever faster than the iterative model why is this ever faster than the iterator model.</p>
<p>165<br>00:28:12,880 –&gt; 00:28:41,880<br>The materialization model it’s because if I have a hundred each of these arrows two three if you have to be run let’s say a thousand times versus to be run only once it’s probably better for me to just run that three function once past that the three thousand values to the join operator in that build site and I’m not making all these thousand function calls over and over again and not so much more than that.</p>
<p>166<br>00:28:42,880 –&gt; 00:29:11,880<br>So if you’re able to in line the lower function is for it. Yeah, we come to that not in this class a lot gets discussed in the other one pieces are done at runtime so inlining is difficult but there are methods that say so the question was can I inline all these functions and their methods that now say can I take the entire query and convert that into code at runtime with all types of inlining I’ll briefly talk about in 30 seconds in a little bit we’ll talk about but the advanced database class talks about that so that’s a good point.</p>
<p>167<br>00:29:12,880 –&gt; 00:29:17,880<br>I’m afraid to think about can I do something special for stuff like that and absolutely people are playing those games.</p>
<p>168<br>00:29:17,880 –&gt; 00:29:40,880<br>Yep on for the latter two models does that stop you from like let’s say we’re part of the way through a query and we discovered that we have enough does that does like materialization which reads the entire thing does that it sort of is an inefficiency with the model that you have to read everything even if we have like some filter and we have like some like only return of them that match this filter right does it like stop us from not reading the entire table if we find which model which model I’m going to do is that it’s not going to be a lot of things that I’m going to do.</p>
<p>169<br>00:29:40,880 –&gt; 00:30:02,880<br>So the question is if in materialization of the vectorized model if the vector is big enough should you stop and make that are you asking in the vectorization model let’s be more specific in the vectorization model would it benefit to make the vector size dynamic.</p>
<p>170<br>00:30:02,880 –&gt; 00:30:20,880<br>I guess I’m asking is like does it does it stop us from checking like if you had a really big vector size yeah let’s say we read a thousand people but we only use read 10 of them and then we would have been like we have a we have a thing in our period so the only way up to 10.</p>
<p>171<br>00:30:20,880 –&gt; 00:30:31,880<br>Oh I see I see so the question is if I had a limit clause at the top yes what can I do yes if there’s a limit clause at the top of the query in many cases you can push that down but if it’s limit 10 that doesn’t mean you could say.</p>
<p>172<br>00:30:31,880 –&gt; 00:30:43,880<br>Limit 10 at the bottom level you can do limit 10 in this case at the hash joined level but you may still have to read in even with the limit clause you still have to do the entire build site here.</p>
<p>173<br>00:30:43,880 –&gt; 00:31:00,880<br>Yeah but something like the iterator model it can if we have a limit clause and we have like a where clause that it can find 10 match absolutely so if there’s a limit clause that’s an optimization problem where the optimizer could make the code to three and four to be different so that doesn’t have to read the next can return and read.</p>
<p>174<br>00:31:00,880 –&gt; 00:31:10,880<br>The next can return end of file sooner when it is at the safe boundary absolutely yeah yeah there was a question here is that still on the table.</p>
<p>175<br>00:31:10,880 –&gt; 00:31:27,880<br>Okay so that’s great you guys are getting that there’s all kinds of optimization you can do the main thing I want to do get across is that the vectorization model has this nice balance down and if you were to do a new engine from scratch my recommendation would be to do this vectorization model that batch size okay.</p>
<p>176<br>00:31:27,880 –&gt; 00:31:56,880<br>Alright a little minor detail I mentioned the open call sets of the tree now that tree could be set up in a top down fashion or you could choose to set it up in a bottom up fashion it’s more natural if you’re writing the iterator model or any of these models to set it up in a top down fashion but you can also do it in the other way so nothing really dramatic over here but you have to set up the tree and that could be a top down versus.</p>
<p>177<br>00:31:56,880 –&gt; 00:32:25,880<br>Bottom up approach now one advantage of the bottom up approach is that as you’re setting things up there might be opportunities for some optimization putting in special optimization tricks that you could do but we’ll talk about that in the scheduler those things become more interesting and relevant if you do it at the scheduler level the main point over here is that you can set up the tree top down a bottom up there’s a setup cost which hopefully you got from that earlier discussion okay that setting up that function pointers across the tree.</p>
<p>178<br>00:32:25,880 –&gt; 00:32:54,880<br>When I call next what am I calling right because that hash joins next on one side was calling the file scan the other side was calling something that was looking at the predicate in evaluating that predicate right at you don’t know what your operator is till you start the silly query is run right and that same hash showing code sometimes is it’s children are different operators right so it depends on the context of the query.</p>
<p>179<br>00:32:54,880 –&gt; 00:33:23,880<br>Every tree at the bottom the root nodes of the operator tree are the places where you go access the actual data everything else is feeding stuff up from intermediate data that’s been produced so concerning that bottom part of that tree we have to decide how are we going to access the records in that underlying file and the technical term for that is called access method it comes from system R which was one of the earliest relational systems that was in the last time we got to the next one.</p>
<p>180<br>00:33:24,880 –&gt; 00:33:46,880<br>So it was built by IBM in the 1970s and the early days of the relational model after code imp proposed this model IBM started to work on the relational system called system R a lot of the optimization and things like that we’ll talk about come from system R and at the same time stone breaker in Berkeley you know IBM was in San Jose Berkeley.</p>
<p>181<br>00:33:46,880 –&gt; 00:34:15,880<br>So the other side and stone breaker and steam were implementing ingress and that ingress eventually became post stress right so the access method term comes from the system are days it’s a way of saying how we’re going to access that underlying file and the dominant methods are a sequential scan as you saw the left note in the tree that we saw or it could be an index scan which is to say I’ve got an index on this predicate that I need to apply let me use the index because it’s a more efficient way to do it.</p>
<p>182<br>00:34:16,880 –&gt; 00:34:33,880<br>So I’m going to fetch the records and hence the name access right the query has to access these records from this and hence the name access methods and we’ll talk about this multi index scan if I’ve got multiple predicates on the same table can I do something more interesting use two different indices and combine that.</p>
<p>183<br>00:34:33,880 –&gt; 00:34:41,880<br>Okay so it’s concerns how are we fetching data from that how are we accessing the base records in the base tables.</p>
<p>184<br>00:34:41,880 –&gt; 00:35:10,880<br>No rocket science here in this case we’ve already seen that the access method term applies to the RNS those two operators sequential scan pretty straightforward we already saw that with the our relation in the previous example just go and fetch one page from the table that you’re trying to scan and start reading all the records on that page once you’re done go fetch the next page that operator the sequential scan operator needs to keep some state around which is to say.</p>
<p>185<br>00:35:10,880 –&gt; 00:35:39,880<br>Which page have I read so that the next time it is called it knows do I still read in this page or do I go to that next page right so it has to keep track of something called the cursor which basically says which record on which page am I reading and that record ID is typically a combination of the page ID and some offset in that page ID you’ve seen that from the buffer pool right that record ID is what it has to keep track off and every time if it’s in the iterator model.</p>
<p>186<br>00:35:39,880 –&gt; 00:36:08,880<br>The state tells you which record are you at so the next time it’s called you’re fetching the next record right you don’t repeat and send back again to the consumer of that operator of the sequential scan operator a record that’s already in fetch the query result would be wrong right so for correctness that some state that is kept in that sequential scan operator and you’ll hear this term cursor which is a way to say I’ve got a marker on the record position in a file.</p>
<p>187<br>00:36:08,880 –&gt; 00:36:24,880<br>And I can advance the cursor this notion of a marker a cursor on a file also applies when you’re consuming the output of a SQL query as a database programmer right that was one of your projects.</p>
<p>188<br>00:36:25,880 –&gt; 00:36:47,880<br>And you’re writing code through your favorite or maybe SQL outcome or something you call a SQL query and you’re fetching records back what you’ll get back from the or M layer is a cursor object which allows you to fetch the next record the next record the next record so that next idea also applies all the way into the application space and the course is just a way of keeping track of which record you’re at.</p>
<p>189<br>00:36:47,880 –&gt; 00:37:03,880<br>Okay, so you just get the result and each record in the result only once and not multiple times for correct semantics so it’s here that word cursor also applied in that application space and in how people refer to code inside the database system same concept does that make sense.</p>
<p>190<br>00:37:03,880 –&gt; 00:37:32,880<br>Okay, so now sequential scan can be optimized and we’ve already seen some of this optimization so even if I’m scanning the rate the data sequentially you could pre fetch the next page right for your waiting and processing records on that page we’ve seen that before in lecture six you could do buffer pool bypass next class you talk about parallelism where you could do a fixed multiple records in parallel we’ve seen deep classroom in lecture.</p>
<p>191<br>00:37:33,880 –&gt; 00:38:02,880<br>It’s a great materialization which you just saw in the last class right don’t fetch the don’t particular record just keep the record IDs and fetch the values corresponding to the record IDs later so there are all kinds of optimization you could do with that right sequential scan to return the value or do a material as late just return the record IDs and there are interesting trade offs but the one that you haven’t seen or won’t see that you have to talk about today is the data skipping component and the data skipping component is the same as the data skipping component.</p>
<p>192<br>00:38:03,880 –&gt; 00:38:27,880<br>So this is basically a way to execute and you can do this in one of few different ways one is this approximate queries which is lost us and the other one is using zone maps and so the lossy approach gets using examples like vintage and redshift and stuff like that is to execute the queries on the subset of the entire table to produce an approximate result and that’s used in cases where approximate results are okay.</p>
<p>193<br>00:38:27,880 –&gt; 00:38:56,880<br>So typically not in the environments that you’ve seen so I’m going to find an average sales amount across all the products all I don’t run the whole query I’m okay if you give me some sort of an approximation and there are ways to go to that and talk about that in the advanced database class we’ll talk about where you’re trying to get the correct result but do that faster using these things called the zone map okay and I’ll just talk about it with the with an example and walk through that.</p>
<p>194<br>00:38:57,880 –&gt; 00:39:20,880<br>So imagine I’ve got a column with integer values here and on this imagine I’m going to be asking a lot of selection queries I’m looking for values let’s say between 100 and 200 another query might look for values that are less than 400 so I’ve got lots of scan predicates coming on this integer column.</p>
<p>195<br>00:39:20,880 –&gt; 00:39:49,880<br>Okay if I’m just doing a sequential scan I have to scan everything every time okay and now my data is broken up into pages right so now you can generalize that to say I’m going to organize my file into zones that zone could be a page often in many systems as this notion of a block which is typically much bigger many megabytes big and so in many systems you’ll have that much bigger concept but regardless of what you divide that data you’ll take that whole file break it up into part two.</p>
<p>196<br>00:39:50,880 –&gt; 00:40:11,880<br>So if you want to ask horizontally call them zones and now before scanning all the records in a zone you can create certain aggregates on it certain pieces of information on it that give you effectively an idea as to what is the value in that zone for the records in that zone.</p>
<p>197<br>00:40:11,880 –&gt; 00:40:22,880<br>Here we can create what we call as a zone map and say in this zone of five values the minimum is 100 max is 400 just the average is the sum and here’s the color.</p>
<p>198<br>00:40:22,880 –&gt; 00:40:31,880<br>Of course to make it fit on the slide there five values but you can imagine there may be 5000 or 50,000 values depending upon what you said about the zone size.</p>
<p>199<br>00:40:31,880 –&gt; 00:40:44,880<br>Now if someone says find me everything that is greater than 400 all you need to do is fetch the zone map and say I don’t even need to look at the actual values.</p>
<p>200<br>00:40:44,880 –&gt; 00:41:00,880<br>So by looking at the zone map you can decide whether it is worth looking at the actual values we finished this slide i’ll take your question in a second and this obviously is implemented in many systems and as you can see value greater than 600 I will only look at the zone map now the zone maps are much smaller right so in the end.</p>
<p>201<br>00:41:00,880 –&gt; 00:41:11,880<br>So in this case the zone map has just got quite integer values and as I said for this example the data also has five values but imagine it is 5000 values of 50,000 values.</p>
<p>202<br>00:41:11,880 –&gt; 00:41:25,880<br>So this is many orders of magnitude smaller in size and that allows you to go and filter stuff up now the zone maps can sometimes we kept with the zone page itself the zone data itself in which case you have to fetch the data to filter it.</p>
<p>203<br>00:41:25,880 –&gt; 00:41:35,880<br>So you don’t get the IO benefit but you get the CPU benefit but you could also keep the zone map outside and you have to make sure if updates happen here the zone map has also been updated.</p>
<p>204<br>00:41:35,880 –&gt; 00:41:50,880<br>Okay and then two different ways of doing that the external method is harder to keep track to keep synchronized but it’s obviously much more efficient because you don’t need to actually fetch the data you could just skip it you can get both IO and CPU optimization right question.</p>
<p>205<br>00:41:50,880 –&gt; 00:42:07,880<br>So this the user of the database set this up was no usually just set up by the DBMS you as a DBMS implementer will decide whether to implement zone maps or not and then sometimes the system may have certain options when you create the table or set up the database to say.</p>
<p>206<br>00:42:07,880 –&gt; 00:42:23,880<br>What type of zone maps to build should you only do min max which is the most common is it’s the smallest number of smallest zone map that you could create that as a maximum value average and other things have less utility but they do in some cases right.</p>
<p>207<br>00:42:23,880 –&gt; 00:42:50,880<br>So it depends upon whether it is automatic or whether controls given but the implement or will implement that and then provide some ways to set this up and it could be fully automated or the database and mister could provide hints to it sometimes when you’re creating the tables you might set up what the zone map how aggressive the zone map should be so it’s all over the place in there right it’s not a sequel standard it’s something that will get exposed to the database programmer depending upon that system.</p>
<p>208<br>00:42:50,880 –&gt; 00:43:19,880<br>But a lot of systems use it including Oracle DB to and pretty much all the modern systems use it including your snowflakes and data breaks so now zone maps this is really hard to see I don’t know why it looks great on my screen here but this is a paper that’s from more than 20 years ago by this guy.</p>
<p>209<br>00:43:19,880 –&gt; 00:43:33,880<br>By this guy called Gido for Kentel and he’s an amazing German researcher and this tells you you know more than a decade after he wrote the paper to say why zone maps are important and why you should use it.</p>
<p>210<br>00:43:33,880 –&gt; 00:43:40,880<br>It took the industry to go and implement this so research on this was way ahead of where it started to show up in products.</p>
<p>211<br>00:43:40,880 –&gt; 00:44:02,880<br>Okay it’s a beautiful paper and if you are interested in it and can find the paper let me know the research term for that is small materialized aggregate it’s what a beautiful name right it’s a materialized aggregate you’re doing min max some count stuff it’s an aggregate and they’re small sms is what it is called so very tourist name very memorable name yep.</p>
<p>212<br>00:44:02,880 –&gt; 00:44:09,880<br>But the industry guys had to call it zone maps because they have to market it differently so I don’t know why they didn’t call it sms.</p>
<p>213<br>00:44:09,880 –&gt; 00:44:38,880<br>So you would have one zone map per zone and how big is a zone depends again on the database implementation so the question was like how big is the zone map the zone map is one map per zone so if I’ve got a file let’s say I’m building it at the page level relating back to buster I could build a zone map at the page level if my file has.</p>
<p>214<br>00:44:38,880 –&gt; 00:45:00,880<br>A hundred pages and a hundred zone maps now where do I keep that zone map I could keep it in the page in some place or I could keep it outside the page and I have to keep it synchronized okay it’s pretty small even for a small 4k 8k page you can see the utility of this being really high yes.</p>
<p>215<br>00:45:00,880 –&gt; 00:45:04,880<br>You’re like.</p>
<p>216<br>00:45:04,880 –&gt; 00:45:08,880<br>I’m sorry.</p>
<p>217<br>00:45:08,880 –&gt; 00:45:20,880<br>You certainly as a database implementer you could do whatever so you can safely do min max on anything that is sort of including strings and for strings you have to be careful about</p>
<p>218<br>00:45:20,880 –&gt; 00:45:49,880<br>collation order I think Andy talked about that right collation order says what’s the right way to sort a string especially if you have a product that’s international the sort order for English language is different than for Mandarin different for a congee and stuff like that so anything that is sortable strings are sortable with the right correlation order you could do min max on and then you could decide if in the min max for strings you want to keep the entire min string and the max string or just a prefix and then use it in a safe way.</p>
<p>219<br>00:45:49,880 –&gt; 00:46:06,880<br>As a user of the system can I make those decisions most likely not most systems will give you the ability to tell you that turn on zone maps or not most systems do this automatically internally.</p>
<p>220<br>00:46:06,880 –&gt; 00:46:25,880<br>So you can zone maps we implemented alongside indices absolutely and fact they often are what zone maps to is reduce the need for indexing on extremely large data sets that’s how they become so popular especially on the very large old app stuff because now the need for index is a lot less.</p>
<p>221<br>00:46:25,880 –&gt; 00:46:54,880<br>And so yes if the zone maps are outside you’re taking a maintenance problem it’s like an index problem right and if I’ve got a zone map if I’ve got 10 columns in the table I’ll keep I could decide to pick a zone map on five of the columns what’s super interesting is I could decide I’m creating a zone map only on the first hundred pages that have been loaded the last hundred pages that were just loaded don’t have a zone maps so if you don’t find a zone map you’re going to fetch the five so it’s not zero or nothing.</p>
<p>222<br>00:46:55,880 –&gt; 00:47:03,880<br>You could do all kinds of interesting things especially if you’ve got data coming in you you got you have it’s a very flexible and powerful mechanism.</p>
<p>223<br>00:47:04,880 –&gt; 00:47:22,880<br>Okay it’s beautiful yep let’s assume for the sake of our indexes or something yeah so I just you only zone map so the question is if I hate indices with the the student in the first row seems to hate indices now I’m just kidding absolutely and.</p>
<p>224<br>00:47:22,880 –&gt; 00:47:33,880<br>System some of the newer systems like snowflake are very aggressive users of zone maps does reduce the need for them to index as much is there ever why something you can only do with indexing or you just want to.</p>
<p>225<br>00:47:34,880 –&gt; 00:47:51,880<br>So really with the indices you can get much finer values right if I said by the way there’s nothing there are systems there’s a research system called quick set that we build in which we use zone maps at the top level and indices inside the zone you could do that to maybe you can come talk to me later I don’t know if anyone else that does it it was a research.</p>
<p>226<br>00:47:52,880 –&gt; 00:47:59,880<br>I’m not a type but they’re so that’s an open question where you can combine that the people are doing it I at least don’t know that right now but you could combine stuff.</p>
<p>227<br>00:48:00,880 –&gt; 00:48:21,880<br>What is it I just think you are are they decide the ones to keep the coins yeah it’s based on use it and experience but pretty much everyone will keep minbacks and then maybe some independence upon you know how often does some get come you could argue like average is probably not that important because if I was selection followed by an average aggregate then the average is not that important.</p>
<p>228<br>00:48:22,880 –&gt; 00:48:47,880<br>The average is useless right because I have to do the selection first so it will depend but min max is typically used and sometimes you’ll hear the term min max indices and that’s used for just saying that version of the zone maps or SMAs with just the min max portion okay so this is crazy right as I said this is like more than 20 year old ideas only in the last 10 years people started to get excited about zone maps but academics have known that this is a very good idea long time ago.</p>
<p>229<br>00:48:48,880 –&gt; 00:48:49,880<br>Yep.</p>
<p>230<br>00:48:49,880 –&gt; 00:48:54,880<br>Those don’t have some fields once fine and then this guy before the government.</p>
<p>231<br>00:48:54,880 –&gt; 00:49:16,880<br>Just like an index you have to update it if you want to keep it around so zone maps if I update that page that’s I would have to update that many systems what they do and update to a page is marked as a delete on the page when you get to transactions you see that new records get put over here so this is just marked as you are no longer valid and so in that case.</p>
<p>232<br>00:49:16,880 –&gt; 00:49:24,880<br>If it’s like that notion of a block of a of a zone being immutable and only gets updated when you merge things together.</p>
<p>233<br>00:49:24,880 –&gt; 00:49:45,880<br>For that there are other models that apply so LSM trees you remember when you guys talked about LSM data structure where they grow in one direction is a merge phase so you could start to do interesting stuff for this it depends upon what’s your underlying storage model is where the updates are in place or somewhere else and that will have implications for indices in general zone maps will have the same thing they’re like indices but a very interesting different type of indices.</p>
<p>234<br>00:49:46,880 –&gt; 00:49:53,880<br>Right and as I said you could keep the zone map outside the zone and then it looks different.</p>
<p>235<br>00:49:53,880 –&gt; 00:49:56,880<br>Okay it looks like an index.</p>
<p>236<br>00:49:56,880 –&gt; 00:50:15,880<br>All right okay let’s keep moving so index scan is basically a scan I’ve got a predicate let’s just look at it with an example I’ve got the square where on a table I’ve got a predicate on age department and country.</p>
<p>237<br>00:50:15,880 –&gt; 00:50:34,880<br>And imagine I’ve got indices build on ancient department so obviously I could do a file scan and apply each of those predicates and that’s one way but if I’ve got an index on ancient department I could decide what I want to do with it so if there are 99 people under the age of 30 but only two people in the CS department.</p>
<p>238<br>00:50:34,880 –&gt; 00:50:43,880<br>If you if you have the department index you probably want to use the department index for that right you only have two records on which you need to check the rest of the predicates.</p>
<p>239<br>00:50:43,880 –&gt; 00:50:54,880<br>Right and vice versa if the scenario are different then you can flip the index around the question of course is do I I don’t know this distribution.</p>
<p>240<br>00:50:54,880 –&gt; 00:51:08,880<br>When I want to use the index so that again is something that an optimizer typically tries to decide when to use an index what to use an index statically and it has statistics to keep track of it we talk about that when we discuss the optimization work.</p>
<p>241<br>00:51:08,880 –&gt; 00:51:24,880<br>But assume that you know that you can see how you might switch between which index to use right you want to use the most selective index force because that reduces the predicate evaluation for the rest of the predicates because you only will apply it to the ones that pass through first.</p>
<p>242<br>00:51:24,880 –&gt; 00:51:34,880<br>Now if you have multiple indices like we do in that case there’s something else that you can also do it’s called a multi index can.</p>
<p>243<br>00:51:34,880 –&gt; 00:51:53,880<br>I can apply both predicates only on the index which is pretty small right I can do that check I won’t fetch the records I’ll just look at the index so I haven’t hit the data pages yet and then I’ll merge the in the hits I get from both indices to then fetch which records I need to go and build out right.</p>
<p>244<br>00:51:53,880 –&gt; 00:52:21,880<br>It gets called by different names like multi index can bitmap scan and index merge and basically the way it works if you look at this example is you’re going to start with it and then look at both of these cases will look at the first index on each and retrieve the record IDs that hit we haven’t fetch the records yet so delay that don’t retrieve it just yet then go and I’ll just let you know that I’m going to do that.</p>
<p>245<br>00:52:21,880 –&gt; 00:52:50,880<br>Then go and get the record IDs from the blue side in this case where department is equal to CS merge those record IDs you could represent the record IDs as a set and merge it or you could represent that as a bitmap and use bitmaps to filter stuff up you know those details don’t really the matter in the implementation but essentially trying to do some sort of set intersection and then only the common record IDs is the one that you will go and use to retrieve back.</p>
<p>246<br>00:52:50,880 –&gt; 00:52:53,880<br>From the system. Okay.</p>
<p>247<br>00:52:53,880 –&gt; 00:53:00,880<br>So you can use multiple indices to go and make that search better.</p>
<p>248<br>00:53:00,880 –&gt; 00:53:10,880<br>All right questions and for some reason my camera started to misbehave let me just go reset that here.</p>
<p>249<br>00:53:10,880 –&gt; 00:53:20,880<br>There we go. Oh, it stops tracking after a little while.</p>
<p>250<br>00:53:20,880 –&gt; 00:53:23,880<br>But you’ll only notice in the video recording but.</p>
<p>251<br>00:53:23,880 –&gt; 00:53:24,880<br>All right.</p>
<p>252<br>00:53:24,880 –&gt; 00:53:25,880<br>Yep question.</p>
<p>253<br>00:53:25,880 –&gt; 00:53:27,880<br>But question about multi index in.</p>
<p>254<br>00:53:27,880 –&gt; 00:53:31,880<br>Yeah, how would you use the most selected one first like once you have the record.</p>
<p>255<br>00:53:31,880 –&gt; 00:53:32,880<br>What do you do?</p>
<p>256<br>00:53:32,880 –&gt; 00:53:36,880<br>So the question is what do I do with the record IDs in this multi index scan.</p>
<p>257<br>00:53:36,880 –&gt; 00:53:39,880<br>Like after like if you’re using the more flat index.</p>
<p>258<br>00:53:39,880 –&gt; 00:53:51,880<br>Yeah, so in this case we’ll use the most selective index first it won’t matter if I’m using if I decide I’m going to use both the red and the blue index for doing this multi index scan.</p>
<p>259<br>00:53:51,880 –&gt; 00:53:55,880<br>Assume the optimizer said please use both indices somehow it knew.</p>
<p>260<br>00:53:55,880 –&gt; 00:54:01,880<br>Then you do the red index search first then the blue index search next I could have flipped the order cost will be the same.</p>
<p>261<br>00:54:01,880 –&gt; 00:54:05,880<br>I find the intersection and then it’s only those record IDs that I fetch.</p>
<p>262<br>00:54:05,880 –&gt; 00:54:07,880<br>So the.</p>
<p>263<br>00:54:07,880 –&gt; 00:54:09,880<br>If you’re only one.</p>
<p>264<br>00:54:09,880 –&gt; 00:54:10,880<br>That’s correct.</p>
<p>265<br>00:54:10,880 –&gt; 00:54:11,880<br>Yeah. Yeah.</p>
<p>266<br>00:54:11,880 –&gt; 00:54:16,880<br>So if I were to use only one index the question was when does the index selectivity matter.</p>
<p>267<br>00:54:16,880 –&gt; 00:54:24,880<br>If I were to decide and use only one index then I will need to know whether the red index is selective or the blue index is selective and picked that one.</p>
<p>268<br>00:54:24,880 –&gt; 00:54:25,880<br>Okay.</p>
<p>269<br>00:54:25,880 –&gt; 00:54:26,880<br>Yep.</p>
<p>270<br>00:54:26,880 –&gt; 00:54:32,880<br>Why is this more efficient than using the most selective index?</p>
<p>271<br>00:54:32,880 –&gt; 00:54:41,880<br>Imagine age less than 30s are most selective index and department greater than CS is less selective the first fetch is a million record IDs.</p>
<p>272<br>00:54:41,880 –&gt; 00:54:47,880<br>The second fetches 10 million record IDs but the intersection is only two.</p>
<p>273<br>00:54:47,880 –&gt; 00:54:50,880<br>Okay, because they could be independent.</p>
<p>274<br>00:54:50,880 –&gt; 00:54:54,880<br>So if both the predicates are completely correlated then it wouldn’t matter.</p>
<p>275<br>00:54:54,880 –&gt; 00:54:55,880<br>You’re right.</p>
<p>276<br>00:54:55,880 –&gt; 00:54:58,880<br>But if they’re not correlated then it’ll matter a lot.</p>
<p>277<br>00:54:58,880 –&gt; 00:55:00,880<br>Good question.</p>
<p>278<br>00:55:00,880 –&gt; 00:55:06,880<br>Why would you ever want to use like if you have an index on both of them.</p>
<p>279<br>00:55:06,880 –&gt; 00:55:08,880<br>Why would you ever only use one?</p>
<p>280<br>00:55:08,880 –&gt; 00:55:09,880<br>Yeah, because the opposite.</p>
<p>281<br>00:55:09,880 –&gt; 00:55:10,880<br>So I’ll flip around.</p>
<p>282<br>00:55:10,880 –&gt; 00:55:11,880<br>Yeah.</p>
<p>283<br>00:55:11,880 –&gt; 00:55:14,880<br>So the question is why would I use when could this be worse.</p>
<p>284<br>00:55:14,880 –&gt; 00:55:15,880<br>It’s the opposite right.</p>
<p>285<br>00:55:15,880 –&gt; 00:55:19,880<br>So it depends on whether they’re correlated or not correlated.</p>
<p>286<br>00:55:19,880 –&gt; 00:55:23,880<br>And so now you could ask the question is how do you know they’re correlated or not correlated.</p>
<p>287<br>00:55:23,880 –&gt; 00:55:26,880<br>That’s one of the big reasons the optimizers don’t quite work.</p>
<p>288<br>00:55:26,880 –&gt; 00:55:29,880<br>We’ll talk about that in query optimization in the advanced class.</p>
<p>289<br>00:55:29,880 –&gt; 00:55:34,880<br>So we’ll talk about why the optimizations fail all the time.</p>
<p>290<br>00:55:34,880 –&gt; 00:55:41,880<br>And Andy and I are trying to start a new project in which we make optimization even less important.</p>
<p>291<br>00:55:41,880 –&gt; 00:55:47,880<br>If you’re interested in what you can do to make optimization less important because optimizers make these mistakes all the time.</p>
<p>292<br>00:55:47,880 –&gt; 00:55:52,880<br>Go to my webpage at the top is a paper that talks about how if you do adaptiveness.</p>
<p>293<br>00:55:52,880 –&gt; 00:55:56,880<br>It’s better than trying to spend cycles in developing optimization.</p>
<p>294<br>00:55:56,880 –&gt; 00:56:00,880<br>So at the point of view, I could be wrong, but that’s the current point of view that I have.</p>
<p>295<br>00:56:00,880 –&gt; 00:56:02,880<br>So these are great questions optimizer.</p>
<p>296<br>00:56:02,880 –&gt; 00:56:05,880<br>You’re assuming it knows how to do this correlation.</p>
<p>297<br>00:56:05,880 –&gt; 00:56:08,880<br>Okay, questions.</p>
<p>298<br>00:56:08,880 –&gt; 00:56:10,880<br>All right.</p>
<p>299<br>00:56:10,880 –&gt; 00:56:17,880<br>Now there’s a little tricky situation that you have to consider when you’re looking at modification queries.</p>
<p>300<br>00:56:17,880 –&gt; 00:56:19,880<br>And you’ve seen that in SQL.</p>
<p>301<br>00:56:19,880 –&gt; 00:56:22,880<br>They are your insert, delete and update queries.</p>
<p>302<br>00:56:22,880 –&gt; 00:56:29,880<br>So how components we have to consider about one is what is it that gets returned by the query.</p>
<p>303<br>00:56:29,880 –&gt; 00:56:34,880<br>So imagine I say insert into an a full SQL sentence below it.</p>
<p>304<br>00:56:34,880 –&gt; 00:56:40,880<br>That sequel is going to run produce a bunch of records that I’m inserting into a new table.</p>
<p>305<br>00:56:40,880 –&gt; 00:56:46,880<br>Okay, that sequel query that is run the operator that is producing that final output.</p>
<p>306<br>00:56:46,880 –&gt; 00:56:49,880<br>Of course, there’s a full operator tree below that.</p>
<p>307<br>00:56:49,880 –&gt; 00:56:53,880<br>I like to say I’m only going to pass materialize the entire record.</p>
<p>308<br>00:56:53,880 –&gt; 00:56:58,880<br>Right. So for inserts, you could materialize the entire records inside the operator.</p>
<p>309<br>00:56:58,880 –&gt; 00:57:05,880<br>And then pass that along or the operator inserts any record passed to it from the child operator.</p>
<p>310<br>00:57:05,880 –&gt; 00:57:07,880<br>You’re basically getting it to that next call.</p>
<p>311<br>00:57:07,880 –&gt; 00:57:11,880<br>So it’s very similar to what we talked about that materialization versus inserts.</p>
<p>312<br>00:57:11,880 –&gt; 00:57:14,880<br>And you have that similar type of choice that you need to make.</p>
<p>313<br>00:57:14,880 –&gt; 00:57:15,880<br>Okay.</p>
<p>314<br>00:57:15,880 –&gt; 00:57:27,880<br>Now, the more interesting part, which is very subtle is that when you’re doing updates, you have to keep track of the record IDs for the target tuples.</p>
<p>315<br>00:57:27,880 –&gt; 00:57:34,880<br>And this is to avoid a problem that is called the Halloween problem, which was discovered by IBM decades ago.</p>
<p>316<br>00:57:34,880 –&gt; 00:57:38,880<br>IBM was at the front front of for many of these relational systems on Halloween night.</p>
<p>317<br>00:57:38,880 –&gt; 00:57:41,880<br>So here is the query.</p>
<p>318<br>00:57:41,880 –&gt; 00:57:44,880<br>So I’ll let you assimilate that a little bit.</p>
<p>319<br>00:57:44,880 –&gt; 00:57:49,880<br>What we have here is an index on salary.</p>
<p>320<br>00:57:49,880 –&gt; 00:57:58,880<br>And we’re updating all the people whose salary is less than 1100 giving them a hundred dollar salary raise.</p>
<p>321<br>00:57:58,880 –&gt; 00:57:59,880<br>Okay.</p>
<p>322<br>00:57:59,880 –&gt; 00:58:02,880<br>Now this query, the operator tree for that.</p>
<p>323<br>00:58:02,880 –&gt; 00:58:06,880<br>As you can see at the bottom is using the index to retrieve the appropriate records.</p>
<p>324<br>00:58:06,880 –&gt; 00:58:10,880<br>The appropriate records are those where the salary is less than 1100.</p>
<p>325<br>00:58:10,880 –&gt; 00:58:15,880<br>So now we start here and fetch the records go apply that.</p>
<p>326<br>00:58:15,880 –&gt; 00:58:20,880<br>So imagine we fetch the first record and that happens to be Andy.</p>
<p>327<br>00:58:20,880 –&gt; 00:58:21,880<br>I’m using Andy slide.</p>
<p>328<br>00:58:21,880 –&gt; 00:58:24,880<br>You know, as you can see he’s trying to do something sneaky here.</p>
<p>329<br>00:58:24,880 –&gt; 00:58:25,880<br>We always watch out for that.</p>
<p>330<br>00:58:25,880 –&gt; 00:58:28,880<br>But he also made this slide to say watch out for this slide.</p>
<p>331<br>00:58:28,880 –&gt; 00:58:32,880<br>So that gets called.</p>
<p>332<br>00:58:32,880 –&gt; 00:58:35,880<br>Imagine you’re using the iterator model one record at a time.</p>
<p>333<br>00:58:35,880 –&gt; 00:58:38,880<br>And now Andy has a hundred dollar race.</p>
<p>334<br>00:58:38,880 –&gt; 00:58:41,880<br>But that is inserted back into the table, right?</p>
<p>335<br>00:58:41,880 –&gt; 00:58:43,880<br>It’s updated.</p>
<p>336<br>00:58:43,880 –&gt; 00:58:52,880<br>So it now goes into the index a few distance away where the new salary is a hundred and a one thousand and nine dollars.</p>
<p>337<br>00:58:52,880 –&gt; 00:58:56,880<br>And now what happens as the index keeps getting called at some point.</p>
<p>338<br>00:58:56,880 –&gt; 00:59:01,880<br>That record is going to get fetched again the 1099 record the new update.</p>
<p>339<br>00:59:01,880 –&gt; 00:59:02,880<br>Right?</p>
<p>340<br>00:59:02,880 –&gt; 00:59:05,880<br>This is what we just updated the record to.</p>
<p>341<br>00:59:05,880 –&gt; 00:59:07,880<br>And now that we get another hundred dollar raise.</p>
<p>342<br>00:59:07,880 –&gt; 00:59:09,880<br>So Andy is really honest.</p>
<p>343<br>00:59:09,880 –&gt; 00:59:10,880<br>So he doesn’t want that.</p>
<p>344<br>00:59:10,880 –&gt; 00:59:11,880<br>Right.</p>
<p>345<br>00:59:11,880 –&gt; 00:59:13,880<br>So he said we should not make this happen.</p>
<p>346<br>00:59:13,880 –&gt; 00:59:17,880<br>He’d rather have the two hundred dollars raise a big let up front to him.</p>
<p>347<br>00:59:17,880 –&gt; 00:59:21,880<br>And so this is the type of stuff that happened as you can imagine in the first implementation.</p>
<p>348<br>00:59:21,880 –&gt; 00:59:22,880<br>People didn’t think about it.</p>
<p>349<br>00:59:22,880 –&gt; 00:59:24,880<br>And so it was buggy code.</p>
<p>350<br>00:59:24,880 –&gt; 00:59:26,880<br>People started to realize whoops.</p>
<p>351<br>00:59:26,880 –&gt; 00:59:28,880<br>The someone’s getting a lot of raises.</p>
<p>352<br>00:59:28,880 –&gt; 00:59:30,880<br>And that was the Halloween problem.</p>
<p>353<br>00:59:30,880 –&gt; 00:59:33,880<br>There’s a whole Wikipedia article associated with it that you can look at.</p>
<p>354<br>00:59:33,880 –&gt; 00:59:34,880<br>The question.</p>
<p>355<br>00:59:34,880 –&gt; 00:59:36,880<br>You’re right.</p>
<p>356<br>00:59:36,880 –&gt; 00:59:39,880<br>This wouldn’t happen if materialization was in place.</p>
<p>357<br>00:59:39,880 –&gt; 00:59:40,880<br>That is correct.</p>
<p>358<br>00:59:40,880 –&gt; 00:59:43,880<br>If everything were materialized completely and you never went back.</p>
<p>359<br>00:59:43,880 –&gt; 00:59:49,880<br>You had all the record IDs from the index produced once and sent across this wouldn’t happen.</p>
<p>360<br>00:59:49,880 –&gt; 00:59:50,880<br>Okay.</p>
<p>361<br>00:59:50,880 –&gt; 00:59:55,880<br>It seems like it goes against all like concurrency rules like.</p>
<p>362<br>00:59:55,880 –&gt; 00:59:57,880<br>We’re modifying some data structure.</p>
<p>363<br>00:59:57,880 –&gt; 00:59:58,880<br>We’re not actually hoping.</p>
<p>364<br>00:59:58,880 –&gt; 00:59:59,880<br>Yes, correct.</p>
<p>365<br>00:59:59,880 –&gt; 01:00:01,880<br>So the question is does it.</p>
<p>366<br>01:00:01,880 –&gt; 01:00:05,880<br>It seems like we are going against all kinds of concurrency rules.</p>
<p>367<br>01:00:05,880 –&gt; 01:00:08,880<br>We are modifying a data but not holding a lock on it.</p>
<p>368<br>01:00:08,880 –&gt; 01:00:09,880<br>That is true.</p>
<p>369<br>01:00:09,880 –&gt; 01:00:10,880<br>A lock would be too expensive.</p>
<p>370<br>01:00:10,880 –&gt; 01:00:12,880<br>So you’ll see what we’ll do is a little bit simpler.</p>
<p>371<br>01:00:12,880 –&gt; 01:00:13,880<br>Okay.</p>
<p>372<br>01:00:13,880 –&gt; 01:00:14,880<br>That’s right.</p>
<p>373<br>01:00:14,880 –&gt; 01:00:15,880<br>That’s exactly right.</p>
<p>374<br>01:00:15,880 –&gt; 01:00:18,880<br>It is something that you would end up having to do.</p>
<p>375<br>01:00:18,880 –&gt; 01:00:23,880<br>So what you end up doing is the following is you keep track of the solution is pretty simple.</p>
<p>376<br>01:00:23,880 –&gt; 01:00:26,880<br>Keep track of all the modified record IDs.</p>
<p>377<br>01:00:26,880 –&gt; 01:00:27,880<br>Right.</p>
<p>378<br>01:00:27,880 –&gt; 01:00:30,880<br>So if you see that new record again, you say, oh, I’ve already processed it.</p>
<p>379<br>01:00:30,880 –&gt; 01:00:32,880<br>I’m just going to skip over it.</p>
<p>380<br>01:00:32,880 –&gt; 01:00:36,880<br>Even though as you scan the index that new record ID is now in a different location.</p>
<p>381<br>01:00:36,880 –&gt; 01:00:37,880<br>You are going to simply skip that.</p>
<p>382<br>01:00:37,880 –&gt; 01:00:41,880<br>Or if everything were materialized, you would not have this problem as was just pointed out.</p>
<p>383<br>01:00:41,880 –&gt; 01:00:42,880<br>Right.</p>
<p>384<br>01:00:42,880 –&gt; 01:00:43,880<br>You’re not going back again to the index scan.</p>
<p>385<br>01:00:43,880 –&gt; 01:00:45,880<br>The index scan happened only once.</p>
<p>386<br>01:00:45,880 –&gt; 01:00:46,880<br>You got everything.</p>
<p>387<br>01:00:46,880 –&gt; 01:00:47,880<br>Then you’re going to be fine too.</p>
<p>388<br>01:00:47,880 –&gt; 01:00:50,880<br>And then you put everything back as the updated values.</p>
<p>389<br>01:00:50,880 –&gt; 01:00:51,880<br>Okay.</p>
<p>390<br>01:00:51,880 –&gt; 01:00:53,880<br>And then we told you to go back to the index scan.</p>
<p>391<br>01:00:53,880 –&gt; 01:00:56,880<br>And you put everything back as the updated values.</p>
<p>392<br>01:00:56,880 –&gt; 01:00:57,880<br>Okay.</p>
<p>393<br>01:00:57,880 –&gt; 01:00:58,880<br>And then we talk about transactions.</p>
<p>394<br>01:00:58,880 –&gt; 01:01:02,880<br>You’ll see we’ll do other things so that if there are concurrent requests happening to the index.</p>
<p>395<br>01:01:02,880 –&gt; 01:01:04,880<br>They don’t interfere with each other.</p>
<p>396<br>01:01:04,880 –&gt; 01:01:09,880<br>Here, we’re just trying to make a single queries action not interfere with itself.</p>
<p>397<br>01:01:09,880 –&gt; 01:01:15,880<br>And transactions will deal with the other problem of multiple queries interfering with each other.</p>
<p>398<br>01:01:15,880 –&gt; 01:01:16,880<br>Okay.</p>
<p>399<br>01:01:16,880 –&gt; 01:01:19,880<br>Question.</p>
<p>400<br>01:01:19,880 –&gt; 01:01:28,880<br>I have a question about how to insert one materialized people inside of the operator.</p>
<p>401<br>01:01:28,880 –&gt; 01:01:32,880<br>Another is how to insert and how to transfer the data to you.</p>
<p>402<br>01:01:32,880 –&gt; 01:01:34,880<br>Yeah.</p>
<p>403<br>01:01:34,880 –&gt; 01:01:38,880<br>So the question is when I materialize the tuples inside the operator.</p>
<p>404<br>01:01:38,880 –&gt; 01:01:47,880<br>Do I bring all of the tuples together like the joint has to bring the tuples together materialize it before I send it across or I’m just going to pass that.</p>
<p>405<br>01:01:47,880 –&gt; 01:01:48,880<br>Yeah.</p>
<p>406<br>01:01:48,880 –&gt; 01:01:50,880<br>So I’m going to put the tuple across and do that.</p>
<p>407<br>01:01:50,880 –&gt; 01:01:53,880<br>So it’s very similar to what we talked about with the different ways.</p>
<p>408<br>01:01:53,880 –&gt; 01:01:54,880<br>Yep.</p>
<p>409<br>01:01:54,880 –&gt; 01:01:56,880<br>Just the iterator versus materialization, yeah.</p>
<p>410<br>01:01:56,880 –&gt; 01:01:57,880<br>Yep.</p>
<p>411<br>01:01:57,880 –&gt; 01:01:58,880<br>Yeah.</p>
<p>412<br>01:01:58,880 –&gt; 01:01:59,880<br>Good question.</p>
<p>413<br>01:01:59,880 –&gt; 01:02:00,880<br>How do you track the record IDs?</p>
<p>414<br>01:02:00,880 –&gt; 01:02:01,880<br>You could just keep it in memory.</p>
<p>415<br>01:02:01,880 –&gt; 01:02:08,880<br>As I said, each operator has a state, so you can imagine the insert operator has a state which says here are the record IDs.</p>
<p>416<br>01:02:08,880 –&gt; 01:02:12,880<br>Now typically inserts don’t, you know, even if I’ve got a billion rows, I’m not changing all the billion rows.</p>
<p>417<br>01:02:12,880 –&gt; 01:02:13,880<br>So it’s usually small.</p>
<p>418<br>01:02:13,880 –&gt; 01:02:15,880<br>So that’s, that’s often okay.</p>
<p>419<br>01:02:15,880 –&gt; 01:02:17,460<br>That’s often OK.</p>
<p>420<br>01:02:17,460 –&gt; 01:02:20,200<br>OK?</p>
<p>421<br>01:02:20,200 –&gt; 01:02:21,039<br>All right.</p>
<p>422<br>01:02:21,039 –&gt; 01:02:23,960<br>We’ve got to keep moving a little bit.</p>
<p>423<br>01:02:23,960 –&gt; 01:02:25,119<br>So I had to rush a little bit up.</p>
<p>424<br>01:02:25,119 –&gt; 01:02:28,480<br>I’ll pause again for questions in a few minutes.</p>
<p>425<br>01:02:28,480 –&gt; 01:02:33,280<br>So expression evaluation, this question was asked.</p>
<p>426<br>01:02:33,280 –&gt; 01:02:35,079<br>When we started talking about efficiency</p>
<p>427<br>01:02:35,079 –&gt; 01:02:38,160<br>in the vectorization model, here’s a query which</p>
<p>428<br>01:02:38,160 –&gt; 01:02:41,760<br>has a bunch of expressions in it.</p>
<p>429<br>01:02:41,760 –&gt; 01:02:45,640<br>The query when it is formed by the SQL parser</p>
<p>430<br>01:02:45,639 –&gt; 01:02:48,159<br>is going to get converted into the expression portion</p>
<p>431<br>01:02:48,159 –&gt; 01:02:50,759<br>or if it will get converted into something that looks like this.</p>
<p>432<br>01:02:50,759 –&gt; 01:02:52,279<br>There’s an hand on one side.</p>
<p>433<br>01:02:52,279 –&gt; 01:02:54,679<br>There’s a join cause, the join predicate.</p>
<p>434<br>01:02:54,679 –&gt; 01:02:56,519<br>The other one is a selection predicate.</p>
<p>435<br>01:02:56,519 –&gt; 01:02:59,119<br>And so that’s what these expression trees look like.</p>
<p>436<br>01:02:59,119 –&gt; 01:03:00,599<br>Why are they important?</p>
<p>437<br>01:03:00,599 –&gt; 01:03:04,359<br>Is because evaluating this tree can take time.</p>
<p>438<br>01:03:04,359 –&gt; 01:03:05,599<br>It’s done for each record.</p>
<p>439<br>01:03:05,599 –&gt; 01:03:10,440<br>So here, I’m looking at the simple expression tree</p>
<p>440<br>01:03:10,440 –&gt; 01:03:11,639<br>where value is equal to 1.</p>
<p>441<br>01:03:11,639 –&gt; 01:03:13,759<br>I’m just checking that predicate.</p>
<p>442<br>01:03:13,760 –&gt; 01:03:17,520<br>Pull up a record and instantiate the attribute value.</p>
<p>443<br>01:03:17,520 –&gt; 01:03:20,240<br>Then the constant is always set for this query.</p>
<p>444<br>01:03:20,240 –&gt; 01:03:22,000<br>And I’m going to evaluate the operator.</p>
<p>445<br>01:03:22,000 –&gt; 01:03:24,880<br>So as you can imagine, if I just implement this</p>
<p>446<br>01:03:24,880 –&gt; 01:03:28,800<br>in the expression tree form, it’s a whole bunch of function</p>
<p>447<br>01:03:28,800 –&gt; 01:03:32,240<br>calls for the equal operator that has to look at its left side,</p>
<p>448<br>01:03:32,240 –&gt; 01:03:35,960<br>bind it to the value for the record at hand, then compare it,</p>
<p>449<br>01:03:35,960 –&gt; 01:03:37,080<br>and do that.</p>
<p>450<br>01:03:37,080 –&gt; 01:03:40,080<br>This is this technique called just in time compilation,</p>
<p>451<br>01:03:40,080 –&gt; 01:03:43,400<br>which says this expression tree’s constant for the whole query</p>
<p>452<br>01:03:43,400 –&gt; 01:03:48,200<br>instead of running this code in this form, which</p>
<p>453<br>01:03:48,200 –&gt; 01:03:50,280<br>is a whole bunch of code that is generic,</p>
<p>454<br>01:03:50,280 –&gt; 01:03:54,079<br>for the query, take that, convert it into an instruction,</p>
<p>455<br>01:03:54,079 –&gt; 01:03:57,119<br>type instruction code, effectively materialize a function</p>
<p>456<br>01:03:57,119 –&gt; 01:04:01,599<br>on the fly just for this predicate and call that function,</p>
<p>457<br>01:04:01,599 –&gt; 01:04:03,800<br>which is going to be a lot more efficient.</p>
<p>458<br>01:04:03,800 –&gt; 01:04:05,519<br>OK, I’m not going to go into a ton of detail.</p>
<p>459<br>01:04:05,519 –&gt; 01:04:09,639<br>The advanced database class talks about that a fair amount.</p>
<p>460<br>01:04:09,639 –&gt; 01:04:12,720<br>But over here, I just want to be aware that there’s</p>
<p>461<br>01:04:12,719 –&gt; 01:04:16,000<br>just in time compilation post-press ships with it</p>
<p>462<br>01:04:16,000 –&gt; 01:04:20,279<br>allows you to evaluate each expression efficiently,</p>
<p>463<br>01:04:20,279 –&gt; 01:04:22,719<br>because otherwise, if there’s a billion records,</p>
<p>464<br>01:04:22,719 –&gt; 01:04:26,039<br>the traditional way of doing it is going to be so,</p>
<p>465<br>01:04:26,039 –&gt; 01:04:29,159<br>because it’s a generic equality operator that is getting called,</p>
<p>466<br>01:04:29,159 –&gt; 01:04:35,199<br>as opposed to one for just that value for just that column type.</p>
<p>467<br>01:04:35,199 –&gt; 01:04:39,119<br>And so that code’s going to be a lot fewer instructions per record.</p>
<p>468<br>01:04:39,119 –&gt; 01:04:42,239<br>So it’s like compiling the predicate code on the fly</p>
<p>469<br>01:04:42,239 –&gt; 01:04:44,359<br>and running the compile code, but that compilation</p>
<p>470<br>01:04:44,359 –&gt; 01:04:47,279<br>is happening as the queryization.</p>
<p>471<br>01:04:47,279 –&gt; 01:04:49,959<br>OK, in post-press hazards, we can play around with it</p>
<p>472<br>01:04:49,959 –&gt; 01:04:51,679<br>and take a look at it.</p>
<p>473<br>01:04:51,679 –&gt; 01:04:54,799<br>Database systems also have this notion of,</p>
<p>474<br>01:04:54,799 –&gt; 01:04:57,000<br>I’ve got a query that’s run over and over again.</p>
<p>475<br>01:04:57,000 –&gt; 01:04:59,439<br>So here’s a query that is adding nine values.</p>
<p>476<br>01:04:59,439 –&gt; 01:05:05,039<br>So it’s like, here’s some additional incentive</p>
<p>477<br>01:05:05,039 –&gt; 01:05:07,119<br>that’s given to new account holders.</p>
<p>478<br>01:05:07,119 –&gt; 01:05:08,799<br>We add $9 to their account.</p>
<p>479<br>01:05:08,799 –&gt; 01:05:11,879<br>It’s a query that’s going to be run for every new account creation.</p>
<p>480<br>01:05:11,880 –&gt; 01:05:15,480<br>And so instead of saying, I’m going to issue that query</p>
<p>481<br>01:05:15,480 –&gt; 01:05:18,280<br>every time that button is pressed in the application,</p>
<p>482<br>01:05:18,280 –&gt; 01:05:21,519<br>you can say, I know this query template is the same.</p>
<p>483<br>01:05:21,519 –&gt; 01:05:25,519<br>All I might change is the account value $1.</p>
<p>484<br>01:05:25,519 –&gt; 01:05:27,960<br>So it’s kind of like saying, I’ve got the function,</p>
<p>485<br>01:05:27,960 –&gt; 01:05:31,000<br>SQL query is now like a function.</p>
<p>486<br>01:05:31,000 –&gt; 01:05:34,000<br>Everything in the function is known except for one parameter</p>
<p>487<br>01:05:34,000 –&gt; 01:05:37,800<br>that $1, and I’m going to compile that entire query.</p>
<p>488<br>01:05:37,800 –&gt; 01:05:40,519<br>And it’s called a prepared statement.</p>
<p>489<br>01:05:40,519 –&gt; 01:05:42,920<br>It has a name, let’s call it XXX.</p>
<p>490<br>01:05:42,920 –&gt; 01:05:44,679<br>And when that button is pressed,</p>
<p>491<br>01:05:44,679 –&gt; 01:05:46,320<br>we’ll just call the function XXX</p>
<p>492<br>01:05:46,320 –&gt; 01:05:47,880<br>and pass in the value 991.</p>
<p>493<br>01:05:47,880 –&gt; 01:05:51,400<br>991 will then get bound to the $1 value</p>
<p>494<br>01:05:51,400 –&gt; 01:05:54,519<br>because that’s the account value and it gets evaluated.</p>
<p>495<br>01:05:54,519 –&gt; 01:05:57,320<br>So essentially it’s pre-compiling the whole query now,</p>
<p>496<br>01:05:58,759 –&gt; 01:06:01,960<br>not just an expression, and then calling that whole query.</p>
<p>497<br>01:06:01,960 –&gt; 01:06:04,639<br>So it’s, and that pre-compile query could be pre-optimized</p>
<p>498<br>01:06:04,639 –&gt; 01:06:07,559<br>all of that stuff, but at runtime when the user is calling</p>
<p>499<br>01:06:07,559 –&gt; 01:06:10,559<br>that function, it doesn’t have to pay all that extra cost</p>
<p>500<br>01:06:10,559 –&gt; 01:06:12,360<br>in some much efficient piece of code.</p>
<p>501<br>01:06:12,360 –&gt; 01:06:15,000<br>And you can actually do the just-in-time compilation</p>
<p>502<br>01:06:15,000 –&gt; 01:06:18,400<br>to generate a lower level assembly language code</p>
<p>503<br>01:06:18,400 –&gt; 01:06:21,159<br>for the entire query too, and this jit idea</p>
<p>504<br>01:06:21,159 –&gt; 01:06:23,119<br>applies to entire queries too.</p>
<p>505<br>01:06:23,119 –&gt; 01:06:25,759<br>Again, there are full lectures in the advanced database class</p>
<p>506<br>01:06:25,759 –&gt; 01:06:27,199<br>where we talk about this stuff,</p>
<p>507<br>01:06:27,199 –&gt; 01:06:30,119<br>but he just wanted you to know that the performance game</p>
<p>508<br>01:06:30,119 –&gt; 01:06:33,559<br>has now moved on to where this just-in-time compilation</p>
<p>509<br>01:06:33,559 –&gt; 01:06:37,159<br>is pretty prevalent databases that care about performance.</p>
<p>510<br>01:06:37,159 –&gt; 01:06:38,960<br>And Postgres has it and you can play with it.</p>
<p>511<br>01:06:40,440 –&gt; 01:06:41,279<br>Okay?</p>
<p>512<br>01:06:41,279 –&gt; 01:06:42,759<br>So that’s just saying instead of doing this,</p>
<p>513<br>01:06:42,759 –&gt; 01:06:45,239<br>traverse the tree on every record,</p>
<p>514<br>01:06:45,239 –&gt; 01:06:47,239<br>this is all going to be very tight code</p>
<p>515<br>01:06:47,239 –&gt; 01:06:48,559<br>and that’s just gonna be right.</p>
<p>516<br>01:06:51,239 –&gt; 01:06:56,239<br>So I’m gonna very quickly talk about something called</p>
<p>517<br>01:06:56,239 –&gt; 01:06:57,399<br>the scheduler.</p>
<p>518<br>01:06:57,399 –&gt; 01:07:00,480<br>And if you open up pretty much any database textbook,</p>
<p>519<br>01:07:00,480 –&gt; 01:07:02,599<br>it will not talk about the scheduler at all,</p>
<p>520<br>01:07:03,839 –&gt; 01:07:07,000<br>which to me is one of the most interesting things</p>
<p>521<br>01:07:07,000 –&gt; 01:07:09,840<br>that you have to explicitly pay attention to</p>
<p>522<br>01:07:09,840 –&gt; 01:07:12,199<br>for a good runtime system.</p>
<p>523<br>01:07:12,199 –&gt; 01:07:13,480<br>And most people hack and scheduler</p>
<p>524<br>01:07:13,480 –&gt; 01:07:15,119<br>without knowing they build a scheduler,</p>
<p>525<br>01:07:15,119 –&gt; 01:07:17,239<br>but keeping it as a separate system infrastructure</p>
<p>526<br>01:07:17,239 –&gt; 01:07:18,880<br>in a system is super important</p>
<p>527<br>01:07:18,880 –&gt; 01:07:20,599<br>and only some of the new modern systems</p>
<p>528<br>01:07:20,599 –&gt; 01:07:22,280<br>are starting to do that.</p>
<p>529<br>01:07:22,280 –&gt; 01:07:25,800<br>So why is the scheduler important as an explicit module?</p>
<p>530<br>01:07:26,960 –&gt; 01:07:29,239<br>So far, everything we’ve talked about is the data flow, right?</p>
<p>531<br>01:07:29,239 –&gt; 01:07:30,840<br>Records flowing in and we’re talking about</p>
<p>532<br>01:07:30,840 –&gt; 01:07:32,639<br>whether the records flow one record at a time</p>
<p>533<br>01:07:32,639 –&gt; 01:07:35,360<br>or entire tables or in batches.</p>
<p>534<br>01:07:36,200 –&gt; 01:07:38,440<br>We very briefly talked about the control flow</p>
<p>535<br>01:07:38,440 –&gt; 01:07:40,160<br>and even when we talked about the control flow,</p>
<p>536<br>01:07:40,160 –&gt; 01:07:41,960<br>we said that the control flow is like once</p>
<p>537<br>01:07:41,960 –&gt; 01:07:44,360<br>at the start of the query, then you tear down.</p>
<p>538<br>01:07:44,360 –&gt; 01:07:45,960<br>But if you have a scheduler,</p>
<p>539<br>01:07:45,960 –&gt; 01:07:48,039<br>then you can start to do really interesting things</p>
<p>540<br>01:07:48,039 –&gt; 01:07:49,599<br>and I’ll talk about this research prototype</p>
<p>541<br>01:07:49,599 –&gt; 01:07:52,000<br>that we build called QuickSep and some companies</p>
<p>542<br>01:07:52,000 –&gt; 01:07:53,400<br>are now starting to look at it</p>
<p>543<br>01:07:53,400 –&gt; 01:07:55,400<br>and say should we be building explicit schedulers?</p>
<p>544<br>01:07:55,400 –&gt; 01:07:56,640<br>And some companies do,</p>
<p>545<br>01:07:56,640 –&gt; 01:07:59,079<br>but they haven’t really brought that out very clearly.</p>
<p>546<br>01:07:59,079 –&gt; 01:08:01,480<br>So here’s the traditional data flow graph</p>
<p>547<br>01:08:01,480 –&gt; 01:08:03,240<br>that we’ve seen before, right?</p>
<p>548<br>01:08:03,239 –&gt; 01:08:06,359<br>So I’ve got two selections in the query and the join</p>
<p>549<br>01:08:06,359 –&gt; 01:08:08,199<br>and records are going to flow through.</p>
<p>550<br>01:08:08,199 –&gt; 01:08:09,359<br>That’s what we’ve been talking about</p>
<p>551<br>01:08:09,359 –&gt; 01:08:12,679<br>since the beginning of the lecture today.</p>
<p>552<br>01:08:12,679 –&gt; 01:08:15,559<br>And imagine there are two pages in R</p>
<p>553<br>01:08:15,559 –&gt; 01:08:18,639<br>and the selection makes it only one page of output</p>
<p>554<br>01:08:18,639 –&gt; 01:08:20,439<br>and that goes to the join.</p>
<p>555<br>01:08:20,439 –&gt; 01:08:25,000<br>Four pages on the green side, two pages at the end of selection.</p>
<p>556<br>01:08:25,000 –&gt; 01:08:27,679<br>They get joined, the output has two pages,</p>
<p>557<br>01:08:27,679 –&gt; 01:08:30,479<br>but the records are much bigger right there combined.</p>
<p>558<br>01:08:30,479 –&gt; 01:08:32,559<br>So if you have an explicit scheduler,</p>
<p>559<br>01:08:32,560 –&gt; 01:08:36,120<br>then typically what gets done is it works well</p>
<p>560<br>01:08:36,120 –&gt; 01:08:37,200<br>with this batch mode,</p>
<p>561<br>01:08:37,200 –&gt; 01:08:39,320<br>especially the vectorization model.</p>
<p>562<br>01:08:39,320 –&gt; 01:08:41,160<br>And then the scheduler is explicit,</p>
<p>563<br>01:08:41,160 –&gt; 01:08:44,200<br>it will create something called a scheduling component</p>
<p>564<br>01:08:44,200 –&gt; 01:08:46,080<br>of in QuickSep we called it work orders,</p>
<p>565<br>01:08:46,080 –&gt; 01:08:48,000<br>but there are other ways to call it.</p>
<p>566<br>01:08:48,000 –&gt; 01:08:50,280<br>And so you’ll bring the data into the buffer pool,</p>
<p>567<br>01:08:50,280 –&gt; 01:08:53,600<br>buffer pool operates under normal conditions.</p>
<p>568<br>01:08:53,600 –&gt; 01:08:56,680<br>And now you are not calling that operator tree</p>
<p>569<br>01:08:56,680 –&gt; 01:08:57,720<br>from top to bottom,</p>
<p>570<br>01:08:57,720 –&gt; 01:09:00,039<br>but instead what you’re doing is you’re walking the tree</p>
<p>571<br>01:09:00,039 –&gt; 01:09:02,480<br>and putting scheduling work in the scheduler queue</p>
<p>572<br>01:09:02,479 –&gt; 01:09:05,079<br>with that black portion here, which is a pending queue.</p>
<p>573<br>01:09:05,079 –&gt; 01:09:06,959<br>So you start walking the tree and say,</p>
<p>574<br>01:09:06,959 –&gt; 01:09:09,959<br>I need to apply a selection on all the records</p>
<p>575<br>01:09:09,959 –&gt; 01:09:10,959<br>in page R1.</p>
<p>576<br>01:09:10,959 –&gt; 01:09:15,000<br>So that’s the work that’s been put on the scheduler queue.</p>
<p>577<br>01:09:15,000 –&gt; 01:09:17,119<br>And you can fill up the scheduler queue</p>
<p>578<br>01:09:17,119 –&gt; 01:09:18,879<br>with all the work that needs to be done</p>
<p>579<br>01:09:18,879 –&gt; 01:09:20,199<br>as you’re walking through the tree,</p>
<p>580<br>01:09:20,199 –&gt; 01:09:22,399<br>whichever operator is ready to work.</p>
<p>581<br>01:09:22,399 –&gt; 01:09:26,159<br>And then the worker threads are effectively stateless</p>
<p>582<br>01:09:26,159 –&gt; 01:09:29,000<br>and they just run select code and join code whatever.</p>
<p>583<br>01:09:29,000 –&gt; 01:09:30,839<br>They don’t remember much.</p>
<p>584<br>01:09:30,839 –&gt; 01:09:32,319<br>So that way you can distribute that,</p>
<p>585<br>01:09:32,840 –&gt; 01:09:35,079<br>they could be spread across different machines</p>
<p>586<br>01:09:35,079 –&gt; 01:09:38,119<br>and you can be very flexible about who does what.</p>
<p>587<br>01:09:38,119 –&gt; 01:09:42,920<br>And it’s very land alike in its execution for each operator.</p>
<p>588<br>01:09:42,920 –&gt; 01:09:45,159<br>And then you send it across whatever network</p>
<p>589<br>01:09:45,159 –&gt; 01:09:47,920<br>that a worker picks up and applies the first selection</p>
<p>590<br>01:09:47,920 –&gt; 01:09:49,399<br>it fetches the records.</p>
<p>591<br>01:09:49,399 –&gt; 01:09:51,559<br>And then when it does it produces its output</p>
<p>592<br>01:09:51,559 –&gt; 01:09:52,960<br>in the SCHR prime,</p>
<p>593<br>01:09:52,960 –&gt; 01:09:54,799<br>which is half a page worth of data.</p>
<p>594<br>01:09:54,799 –&gt; 01:09:58,399<br>Let’s say puts it into the buffer pool and goes on.</p>
<p>595<br>01:09:58,399 –&gt; 01:10:00,880<br>So the scheduler is at any point in time</p>
<p>596<br>01:10:00,880 –&gt; 01:10:03,119<br>just filled up with stuff that needs to be pulled up.</p>
<p>597<br>01:10:03,119 –&gt; 01:10:05,840<br>Anyone can pull it, it’s very dynamic.</p>
<p>598<br>01:10:05,840 –&gt; 01:10:08,840<br>And allows the system to go execute that.</p>
<p>599<br>01:10:08,840 –&gt; 01:10:12,600<br>So this filled up that first blue page and so on.</p>
<p>600<br>01:10:12,600 –&gt; 01:10:13,840<br>And jumping ahead a little bit,</p>
<p>601<br>01:10:13,840 –&gt; 01:10:15,279<br>once the selections are done,</p>
<p>602<br>01:10:15,279 –&gt; 01:10:17,840<br>which is the bottom of the trees now done,</p>
<p>603<br>01:10:17,840 –&gt; 01:10:20,680<br>you now put work orders to say go build the hash table</p>
<p>604<br>01:10:20,680 –&gt; 01:10:25,680<br>on R prime, the output of that first scan on R.</p>
<p>605<br>01:10:26,000 –&gt; 01:10:29,400<br>That gets scheduled, hash table gets built.</p>
<p>606<br>01:10:29,399 –&gt; 01:10:31,159<br>And quick step, we built it in the buffer pool too.</p>
<p>607<br>01:10:31,159 –&gt; 01:10:33,359<br>So there’s only one pool to manage.</p>
<p>608<br>01:10:33,359 –&gt; 01:10:38,119<br>And then you go and apply put into the scheduler saying,</p>
<p>609<br>01:10:38,119 –&gt; 01:10:40,920<br>now I’m ready to schedule the probe operators.</p>
<p>610<br>01:10:40,920 –&gt; 01:10:41,960<br>And you put that in.</p>
<p>611<br>01:10:41,960 –&gt; 01:10:44,359<br>So effectively, this becomes a very different way</p>
<p>612<br>01:10:44,359 –&gt; 01:10:48,759<br>of putting explicit breakpoints in the control flow.</p>
<p>613<br>01:10:48,759 –&gt; 01:10:51,319<br>The data flow is through the vectorization model.</p>
<p>614<br>01:10:51,319 –&gt; 01:10:52,319<br>But with this control flow,</p>
<p>615<br>01:10:52,319 –&gt; 01:10:55,199<br>what you can now do is you can start to say,</p>
<p>616<br>01:10:55,199 –&gt; 01:10:57,119<br>all kinds of interesting things like,</p>
<p>617<br>01:10:57,119 –&gt; 01:10:59,279<br>I’ve got four queries running in the system,</p>
<p>618<br>01:10:59,279 –&gt; 01:11:01,319<br>query one is already halfway through,</p>
<p>619<br>01:11:01,319 –&gt; 01:11:04,719<br>but query four just came in and it’s a very high priority.</p>
<p>620<br>01:11:04,719 –&gt; 01:11:07,439<br>And all you do is take all of query fours work</p>
<p>621<br>01:11:07,439 –&gt; 01:11:09,119<br>and put it to the front of the queue</p>
<p>622<br>01:11:09,119 –&gt; 01:11:10,880<br>and the high priority queries just start to take</p>
<p>623<br>01:11:10,880 –&gt; 01:11:13,800<br>over the entire system and come down.</p>
<p>624<br>01:11:13,800 –&gt; 01:11:16,319<br>Furthermore, if the pool of workers is just,</p>
<p>625<br>01:11:16,319 –&gt; 01:11:18,319<br>let’s say I’ve got 10 threads there,</p>
<p>626<br>01:11:18,319 –&gt; 01:11:19,840<br>I want to grow it to 40.</p>
<p>627<br>01:11:19,840 –&gt; 01:11:22,399<br>The system will elastically scale back and forth</p>
<p>628<br>01:11:22,399 –&gt; 01:11:24,519<br>and you don’t have to do anything.</p>
<p>629<br>01:11:24,519 –&gt; 01:11:26,599<br>In the traditional way of starting the operators,</p>
<p>630<br>01:11:26,599 –&gt; 01:11:27,759<br>when you start the operator, you’ll say,</p>
<p>631<br>01:11:27,760 –&gt; 01:11:30,600<br>oh, I’m going to run you as a two way parallelism.</p>
<p>632<br>01:11:30,600 –&gt; 01:11:31,880<br>But once I start that operator,</p>
<p>633<br>01:11:31,880 –&gt; 01:11:33,360<br>let’s say the hash join operator,</p>
<p>634<br>01:11:33,360 –&gt; 01:11:35,199<br>till it’s done, I can change it.</p>
<p>635<br>01:11:35,199 –&gt; 01:11:38,000<br>Here, the workers are all stateless, so very elastic.</p>
<p>636<br>01:11:38,000 –&gt; 01:11:40,119<br>You can do all kinds of fun stuff with priorities</p>
<p>637<br>01:11:40,119 –&gt; 01:11:43,760<br>and stuff like that and it provides a much cleaner abstraction.</p>
<p>638<br>01:11:43,760 –&gt; 01:11:45,239<br>And again, I’m not going to go into the details</p>
<p>639<br>01:11:45,239 –&gt; 01:11:47,360<br>of this, the advanced database class talks about that,</p>
<p>640<br>01:11:47,360 –&gt; 01:11:49,280<br>but if you’re talking about query execution,</p>
<p>641<br>01:11:49,280 –&gt; 01:11:51,840<br>you want to know about what schedulers do</p>
<p>642<br>01:11:51,840 –&gt; 01:11:55,039<br>and a modern way to do that is to make the scheduler explicit</p>
<p>643<br>01:11:55,039 –&gt; 01:11:57,159<br>and put a ton of smarts in that.</p>
<p>644<br>01:11:57,159 –&gt; 01:12:00,439<br>That is, student whose entire thesis was on scheduler.</p>
<p>645<br>01:12:00,439 –&gt; 01:12:02,039<br>And so I’ll just leave it at that.</p>
<p>646<br>01:12:02,039 –&gt; 01:12:04,399<br>You can basically see diagrams in the paper</p>
<p>647<br>01:12:04,399 –&gt; 01:12:06,720<br>that talk about, you have two queries in the system,</p>
<p>648<br>01:12:06,720 –&gt; 01:12:08,079<br>and the green query comes in.</p>
<p>649<br>01:12:08,079 –&gt; 01:12:09,399<br>It takes over all the resources</p>
<p>650<br>01:12:09,399 –&gt; 01:12:11,119<br>and everything just picks up automatically.</p>
<p>651<br>01:12:11,119 –&gt; 01:12:12,800<br>You don’t have to write any extra code.</p>
<p>652<br>01:12:12,800 –&gt; 01:12:14,920<br>The system just magically adjusts</p>
<p>653<br>01:12:14,920 –&gt; 01:12:16,599<br>in the elastic and flexible way.</p>
<p>654<br>01:12:17,840 –&gt; 01:12:20,199<br>All right, I’m going to skip that part.</p>
<p>655<br>01:12:20,199 –&gt; 01:12:24,119<br>So hopefully what we talked about today makes sense</p>
<p>656<br>01:12:24,119 –&gt; 01:12:26,639<br>in terms of how do queries actually execute</p>
<p>657<br>01:12:26,640 –&gt; 01:12:28,840<br>inside database engines.</p>
<p>658<br>01:12:28,840 –&gt; 01:12:32,680<br>And you went from different processing models</p>
<p>659<br>01:12:32,680 –&gt; 01:12:35,079<br>to all kinds of optimizations associated with it,</p>
<p>660<br>01:12:35,079 –&gt; 01:12:37,000<br>including doing just in time compilation</p>
<p>661<br>01:12:37,000 –&gt; 01:12:40,119<br>for just the predicate portion or the entire query.</p>
<p>662<br>01:12:41,480 –&gt; 01:12:43,400<br>So I’m going to take the next few minutes to talk about,</p>
<p>663<br>01:12:43,400 –&gt; 01:12:46,039<br>the next class we’ll talk about parallel query execution,</p>
<p>664<br>01:12:46,039 –&gt; 01:12:48,240<br>which is going back to the big thing on everyone’s mind,</p>
<p>665<br>01:12:48,240 –&gt; 01:12:50,880<br>the midterm, two days from now,</p>
<p>666<br>01:12:50,880 –&gt; 01:12:53,560<br>in this classroom at this time,</p>
<p>667<br>01:12:53,560 –&gt; 01:12:56,600<br>you must have seen the midterm guide</p>
<p>668<br>01:12:56,600 –&gt; 01:12:58,280<br>with sample questions and answers.</p>
<p>669<br>01:12:58,280 –&gt; 01:13:00,039<br>So please take a look at that.</p>
<p>670<br>01:13:00,039 –&gt; 01:13:02,240<br>Bring your ID, you will check your ID.</p>
<p>671<br>01:13:02,240 –&gt; 01:13:04,080<br>Don’t send your friend to take your exam,</p>
<p>672<br>01:13:04,080 –&gt; 01:13:04,920<br>we will catch it.</p>
<p>673<br>01:13:05,920 –&gt; 01:13:07,400<br>You can bring a calculator.</p>
<p>674<br>01:13:07,400 –&gt; 01:13:08,920<br>If you need a calculator,</p>
<p>675<br>01:13:10,160 –&gt; 01:13:11,360<br>you shouldn’t need a calculator,</p>
<p>676<br>01:13:11,360 –&gt; 01:13:13,320<br>but bring it if you really want to.</p>
<p>677<br>01:13:15,120 –&gt; 01:13:18,360<br>One 8.5 by 11 age paper,</p>
<p>678<br>01:13:18,360 –&gt; 01:13:22,000<br>on which you can handwrite, double-sided.</p>
<p>679<br>01:13:22,000 –&gt; 01:13:23,760<br>Again, as I talked earlier,</p>
<p>680<br>01:13:23,760 –&gt; 01:13:25,720<br>this is just a way for you to feel comfortable</p>
<p>681<br>01:13:25,720 –&gt; 01:13:28,159<br>that you don’t have to memorize a bunch of stuff,</p>
<p>682<br>01:13:28,159 –&gt; 01:13:30,319<br>but don’t be the way in which you’re going to study</p>
<p>683<br>01:13:30,319 –&gt; 01:13:31,159<br>for the exam, right?</p>
<p>684<br>01:13:31,159 –&gt; 01:13:33,640<br>This is just a way for you to feel comfortable,</p>
<p>685<br>01:13:33,640 –&gt; 01:13:36,800<br>which you still have the knowledge in your head, okay?</p>
<p>686<br>01:13:37,760 –&gt; 01:13:39,439<br>Andy told me that in previous classes,</p>
<p>687<br>01:13:39,439 –&gt; 01:13:42,319<br>some students brought in live animals.</p>
<p>688<br>01:13:42,319 –&gt; 01:13:44,079<br>If you need a pet to calm down,</p>
<p>689<br>01:13:45,359 –&gt; 01:13:47,159<br>work with your pet before you get into the classroom,</p>
<p>690<br>01:13:47,159 –&gt; 01:13:48,960<br>don’t bring your pet in.</p>
<p>691<br>01:13:48,960 –&gt; 01:13:50,960<br>I’ve been told that one time someone brought in</p>
<p>692<br>01:13:50,960 –&gt; 01:13:53,680<br>vet laundry and candles, don’t do all of that stuff, right?</p>
<p>693<br>01:13:53,680 –&gt; 01:13:55,800<br>Just come with your calculator, your ID,</p>
<p>694<br>01:13:55,800 –&gt; 01:13:57,960<br>and your two-page stuff,</p>
<p>695<br>01:13:57,960 –&gt; 01:14:00,880<br>and drink a bunch of coffee if that works for you.</p>
<p>696<br>01:14:01,800 –&gt; 01:14:04,159<br>The material is everything that we’ve talked about</p>
<p>697<br>01:14:04,159 –&gt; 01:14:07,000<br>so far in class, including the relational model,</p>
<p>698<br>01:14:07,000 –&gt; 01:14:09,279<br>relational algebra, integrity constraints,</p>
<p>699<br>01:14:09,279 –&gt; 01:14:13,239<br>how they form the foundation of what is SQL</p>
<p>700<br>01:14:13,239 –&gt; 01:14:15,199<br>in its declarative form,</p>
<p>701<br>01:14:15,199 –&gt; 01:14:16,800<br>then the core parts of SQL,</p>
<p>702<br>01:14:16,800 –&gt; 01:14:19,119<br>including the different operators select,</p>
<p>703<br>01:14:19,119 –&gt; 01:14:21,159<br>insert, update, delete,</p>
<p>704<br>01:14:21,159 –&gt; 01:14:24,319<br>you want you to know what the SQL query looks like,</p>
<p>705<br>01:14:24,319 –&gt; 01:14:26,439<br>we want you to be able to look at a SQL query</p>
<p>706<br>01:14:26,439 –&gt; 01:14:28,760<br>and tell what it does, right?</p>
<p>707<br>01:14:28,760 –&gt; 01:14:31,039<br>We’re not going to test you in intricate details</p>
<p>708<br>01:14:31,039 –&gt; 01:14:34,239<br>and try to tell you to write a 10-level nested SQL query, okay?</p>
<p>709<br>01:14:34,239 –&gt; 01:14:36,039<br>So that’s not what we are trying to do,</p>
<p>710<br>01:14:36,039 –&gt; 01:14:37,279<br>but you shouldn’t have to say,</p>
<p>711<br>01:14:37,279 –&gt; 01:14:39,519<br>oh, I don’t know what a having clause is,</p>
<p>712<br>01:14:39,519 –&gt; 01:14:41,239<br>or I don’t know what a nested query looks like.</p>
<p>713<br>01:14:41,239 –&gt; 01:14:42,880<br>You should be able to look at query</p>
<p>714<br>01:14:42,880 –&gt; 01:14:45,599<br>and write simple queries in the class, okay?</p>
<p>715<br>01:14:45,599 –&gt; 01:14:49,000<br>Without needing a debugger to go and figure things out.</p>
<p>716<br>01:14:49,000 –&gt; 01:14:50,920<br>Not checking for details, syntax, and stuff</p>
<p>717<br>01:14:50,920 –&gt; 01:14:52,840<br>like that just want to know how you think</p>
<p>718<br>01:14:52,840 –&gt; 01:14:55,199<br>and at least read queries correctly.</p>
<p>719<br>01:14:55,199 –&gt; 01:14:58,680<br>You should be aware of joins, aggregates, CTEs,</p>
<p>720<br>01:14:58,680 –&gt; 01:15:00,479<br>and window functions, okay?</p>
<p>721<br>01:15:00,479 –&gt; 01:15:02,039<br>All the stuff that you’ve talked about</p>
<p>722<br>01:15:02,039 –&gt; 01:15:04,560<br>is advanced components in SQL.</p>
<p>723<br>01:15:04,560 –&gt; 01:15:05,800<br>You build a buffer manager,</p>
<p>724<br>01:15:05,800 –&gt; 01:15:09,000<br>so hopefully that part of the exam will be easy for you,</p>
<p>725<br>01:15:09,000 –&gt; 01:15:11,279<br>you need to know about different replacement policies,</p>
<p>726<br>01:15:11,279 –&gt; 01:15:13,039<br>what are the pros and cons, right?</p>
<p>727<br>01:15:13,039 –&gt; 01:15:15,039<br>What works better when,</p>
<p>728<br>01:15:15,039 –&gt; 01:15:16,960<br>know about the disk layout</p>
<p>729<br>01:15:16,960 –&gt; 01:15:18,439<br>and the different methods we talked about,</p>
<p>730<br>01:15:18,439 –&gt; 01:15:20,439<br>slotted pages, LASNs,</p>
<p>731<br>01:15:20,439 –&gt; 01:15:22,720<br>someone asked this question earlier about this merging stuff,</p>
<p>732<br>01:15:22,720 –&gt; 01:15:25,480<br>so revise that from the discussion</p>
<p>733<br>01:15:25,480 –&gt; 01:15:27,880<br>from the log structured file system,</p>
<p>734<br>01:15:27,880 –&gt; 01:15:31,079<br>different types of hashing that we’ve discussed in class, right?</p>
<p>735<br>01:15:31,079 –&gt; 01:15:33,720<br>And the pros and cons for each one of those,</p>
<p>736<br>01:15:33,720 –&gt; 01:15:37,960<br>linear probing, Robinhood, and Google hashing,</p>
<p>737<br>01:15:37,960 –&gt; 01:15:39,600<br>and then the dynamic hashing structures,</p>
<p>738<br>01:15:39,600 –&gt; 01:15:42,720<br>we looked at two extendable hashing and linear hashing,</p>
<p>739<br>01:15:42,720 –&gt; 01:15:44,600<br>and you have a project on one of that.</p>
<p>740<br>01:15:44,600 –&gt; 01:15:47,640<br>So I’m sure you’re getting to know that well too.</p>
<p>741<br>01:15:47,640 –&gt; 01:15:49,960<br>Beatrice, in search of CELIGE,</p>
<p>742<br>01:15:49,960 –&gt; 01:15:52,720<br>you started with the tri-stuff as your first assignment,</p>
<p>743<br>01:15:52,720 –&gt; 01:15:54,560<br>so you kind of already have been spending</p>
<p>744<br>01:15:54,560 –&gt; 01:15:56,240<br>a fair amount of time on three structures,</p>
<p>745<br>01:15:56,240 –&gt; 01:15:58,760<br>so Beatrice has this magical, balanced,</p>
<p>746<br>01:15:58,760 –&gt; 01:16:02,120<br>logarithmic cost data structures,</p>
<p>747<br>01:16:02,120 –&gt; 01:16:04,800<br>in search of CELIGE, there’s specific algorithms for that,</p>
<p>748<br>01:16:04,800 –&gt; 01:16:07,360<br>so, learn that well, I know there was a question on Piazza</p>
<p>749<br>01:16:07,360 –&gt; 01:16:09,840<br>that was asking about some of the key rotations,</p>
<p>750<br>01:16:09,840 –&gt; 01:16:12,280<br>so read that well, it’s very logical,</p>
<p>751<br>01:16:12,280 –&gt; 01:16:14,560<br>but you have to read it to get that into your head,</p>
<p>752<br>01:16:14,600 –&gt; 01:16:16,680<br>what happens on splits and merges,</p>
<p>753<br>01:16:16,680 –&gt; 01:16:19,080<br>the difference with the older Beatrice</p>
<p>754<br>01:16:19,080 –&gt; 01:16:20,840<br>and latch-crabbing and coupling</p>
<p>755<br>01:16:20,840 –&gt; 01:16:24,120<br>to make all of that work well in concurrent environments.</p>
<p>756<br>01:16:24,120 –&gt; 01:16:26,480<br>We looked at sorting, two different types of sorting,</p>
<p>757<br>01:16:26,480 –&gt; 01:16:29,160<br>external merge sort, the general merge sort,</p>
<p>758<br>01:16:29,160 –&gt; 01:16:32,280<br>the N-weight tree, what were we trying to do</p>
<p>759<br>01:16:32,280 –&gt; 01:16:34,320<br>with the different optimizations to that,</p>
<p>760<br>01:16:35,840 –&gt; 01:16:38,440<br>with double buffering and all of that stuff.</p>
<p>761<br>01:16:39,400 –&gt; 01:16:41,440<br>Last lecture, you looked at different join algorithms</p>
<p>762<br>01:16:41,440 –&gt; 01:16:43,920<br>from very simple ones, nested loop stripes,</p>
<p>763<br>01:16:43,920 –&gt; 01:16:46,199<br>sort merge, different types of hash joins,</p>
<p>764<br>01:16:46,199 –&gt; 01:16:48,760<br>what are the pros and cons of those</p>
<p>765<br>01:16:48,760 –&gt; 01:16:50,560<br>and the execution cost, right?</p>
<p>766<br>01:16:50,560 –&gt; 01:16:51,920<br>That’s basically, what’s the cost of each</p>
<p>767<br>01:16:51,920 –&gt; 01:16:54,359<br>on those under different circumstances?</p>
<p>768<br>01:16:55,279 –&gt; 01:16:58,319<br>And this is not, the quake processing models</p>
<p>769<br>01:16:58,319 –&gt; 01:17:01,319<br>is what we talked about today, it’s not in the exam,</p>
<p>770<br>01:17:01,319 –&gt; 01:17:04,039<br>so I think Matt announced last time</p>
<p>771<br>01:17:04,039 –&gt; 01:17:05,600<br>that joins is the last thing, correct?</p>
<p>772<br>01:17:08,039 –&gt; 01:17:09,399<br>Is that right? Is that ready announced?</p>
<p>773<br>01:17:09,399 –&gt; 01:17:12,279<br>Yep, okay, so ignore this part,</p>
<p>774<br>01:17:12,439 –&gt; 01:17:14,439<br>then we’ll talk about panel query execution.</p>
<p>775<br>01:17:14,439 –&gt; 01:17:16,079<br>I’ll check with Matt, if he didn’t announce that,</p>
<p>776<br>01:17:16,079 –&gt; 01:17:18,079<br>then quake processing model will be part of that.</p>
<p>777<br>01:17:18,079 –&gt; 01:17:20,759<br>I’ll send in a via some message about that.</p>
<p>778<br>01:17:20,759 –&gt; 01:17:22,279<br>I think he announced that it’s not in the class,</p>
<p>779<br>01:17:22,279 –&gt; 01:17:26,479<br>so go with that as a default unless we post something otherwise.</p>
<p>780<br>01:17:26,479 –&gt; 01:17:29,639<br>All right, questions, last questions?</p>
<p>781<br>01:17:30,880 –&gt; 01:17:32,880<br>Okay, all right, go for it.</p>
<p>782<br>01:17:32,880 –&gt; 01:17:34,880<br>Let’s see this thing stuff.</p>
<p>783<br>01:17:34,880 –&gt; 01:17:36,880<br>That boy’s a gangster.</p>
<p>784<br>01:17:36,880 –&gt; 01:17:39,880<br>That ain’t nothing but gangster.</p>
<p>785<br>01:17:39,880 –&gt; 01:17:41,880<br>Yeah, yeah, now listen.</p>
<p>786<br>01:17:41,880 –&gt; 01:17:44,880<br>I’m gonna pop you with the motherfucking hog.</p>
<p>787<br>01:17:44,880 –&gt; 01:17:46,880<br>28 gram, depending on if it’s the cop.</p>
<p>788<br>01:17:46,880 –&gt; 01:17:49,880<br>You ain’t hit him up yet, still got your shirt up.</p>
<p>789<br>01:17:49,880 –&gt; 01:17:51,880<br>I smack you with the bottom of the cliff,</p>
<p>790<br>01:17:51,880 –&gt; 01:17:54,880<br>and tell you, look up, show me what it’s safe set.</p>
<p>791<br>01:17:54,880 –&gt; 01:17:57,880<br>For I blow your face, I’m gonna pop you up.</p>
<p>792<br>01:17:57,880 –&gt; 01:17:59,880<br>I’m gonna pop you up, I’m gonna pop you up.</p>
<p>793<br>01:17:59,880 –&gt; 01:18:01,880<br>I’m gonna pop you up, I’m gonna pop you up.</p>
<p>794<br>01:18:01,880 –&gt; 01:18:04,880<br>For I blow your face back, I got a block on top.</p>
<p>795<br>01:18:04,880 –&gt; 01:18:05,880<br>The feds can’t trace that.</p>
<p>796<br>01:18:05,880 –&gt; 01:18:07,880<br>Style is like tamper poop.</p>
<p>797<br>01:18:07,880 –&gt; 01:18:09,880<br>You can’t lace that at the Dominican.</p>
<p>798<br>01:18:09,880 –&gt; 01:18:11,880<br>Oh, you could call me Dominican.</p>
<p>799<br>01:18:11,880 –&gt; 01:18:13,880<br>Black Skelly, black leather, black sweat, dimmelins.</p>
<p>800<br>01:18:13,880 –&gt; 01:18:16,880<br>My poor black 38, I send you to the perigates.</p>
<p>801<br>01:18:16,880 –&gt; 01:18:19,880<br>You kick a zombie, try to skate, and that’s your first mistake.</p>
<p>802<br>01:18:19,880 –&gt; 01:18:21,880<br>I ain’t lying for that cake, you’re famous, see you wait.</p>
<p>803<br>01:18:21,880 –&gt; 01:18:24,880<br>My grandson’s happy, wait, the rant, the webby steak.</p>
<p>804<br>01:18:24,880 –&gt; 01:18:27,880<br>When he asked me how I’m living, I tell him I’m living great.</p>
<p>805<br>01:18:31,880 –&gt; 01:18:34,880<br>I’m gonna pop you up, I’m gonna pop you up.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CMU15445 P13F202312 QueryExecutionPart1</div>
      <div>http://example.com/2025/10/25/CMU15445 P13F202312-QueryExecutionPart1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/25/CMU15445%20P15F202314-QueryPlanningOptimization/" title="CMU15445 P15F202314 QueryPlanningOptimization">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CMU15445 P15F202314 QueryPlanningOptimization</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/25/CMU15445%20P14F202313-QueryExecutionPart2/" title="CMU15445 P14F202313 QueryExecutionPart2">
                        <span class="hidden-mobile">CMU15445 P14F202313 QueryExecutionPart2</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
