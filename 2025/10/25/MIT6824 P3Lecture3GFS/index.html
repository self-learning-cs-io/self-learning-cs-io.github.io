

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:03,680Okay, so the plan for today is talking about GFS. 200:00:03,680 –&gt; 00:00:06,000I’m going to do the in sort of multiple steps. 300:00:06,879 –&gt; 00:00:09,880One, I’">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6824 P3Lecture3GFS">
<meta property="og:url" content="http://example.com/2025/10/25/MIT6824%20P3Lecture3GFS/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:03,680Okay, so the plan for today is talking about GFS. 200:00:03,680 –&gt; 00:00:06,000I’m going to do the in sort of multiple steps. 300:00:06,879 –&gt; 00:00:09,880One, I’">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-25T05:03:39.806Z">
<meta property="article:modified_time" content="2025-10-25T05:03:39.807Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MIT6824 P3Lecture3GFS - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MIT6824 P3Lecture3GFS"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-25 13:03" pubdate>
          2025年10月25日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          92 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MIT6824 P3Lecture3GFS</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:03,680<br>Okay, so the plan for today is talking about GFS.</p>
<p>2<br>00:00:03,680 –&gt; 00:00:06,000<br>I’m going to do the in sort of multiple steps.</p>
<p>3<br>00:00:06,879 –&gt; 00:00:09,880<br>One, I’m going to talk a little bit about storage in general</p>
<p>4<br>00:00:09,880 –&gt; 00:00:13,280<br>and why it’s so important</p>
<p>5<br>00:00:14,160 –&gt; 00:00:18,039<br>and why we’ll spend a lot of time in this class talking about it.</p>
<p>6<br>00:00:18,039 –&gt; 00:00:22,320<br>Then I’m going to talk a little bit about,</p>
<p>7<br>00:00:22,320 –&gt; 00:00:26,080<br>I’m sure, intro to GFS and that’s made in design.</p>
<p>8<br>00:00:26,080 –&gt; 00:00:27,679<br>We’ll focus on consistency,</p>
<p>9<br>00:00:27,679 –&gt; 00:00:30,719<br>which will be the main theme through this lecture.</p>
<p>10<br>00:00:31,600 –&gt; 00:00:33,359<br>As part of the consistency,</p>
<p>11<br>00:00:33,359 –&gt; 00:00:36,159<br>we probably do a couple of this still time,</p>
<p>12<br>00:00:36,159 –&gt; 00:00:38,359<br>do a breakout room and talk a little bit about,</p>
<p>13<br>00:00:38,359 –&gt; 00:00:41,320<br>in the breakout rooms about the lecture,</p>
<p>14<br>00:00:41,320 –&gt; 00:00:43,240<br>the question that was posed for lecture</p>
<p>15<br>00:00:43,240 –&gt; 00:00:49,239<br>and then we’ll resume a discussion of consistency.</p>
<p>16<br>00:00:51,000 –&gt; 00:00:56,240<br>Okay, so we’ll talk a little bit about storage systems in general</p>
<p>17<br>00:00:56,240 –&gt; 00:01:01,679<br>and why they so feature so prominently in 6824.</p>
<p>18<br>00:01:02,280 –&gt; 00:01:06,799<br>And the main reason is it’s a fantastic building block</p>
<p>19<br>00:01:07,519 –&gt; 00:01:11,920<br>for false-along systems.</p>
<p>20<br>00:01:13,840 –&gt; 00:01:18,280<br>And so the basic idea is that if you can build</p>
<p>21<br>00:01:18,280 –&gt; 00:01:21,879<br>a durable storage system,</p>
<p>22<br>00:01:21,879 –&gt; 00:01:23,920<br>then you can structure sort of your application</p>
<p>23<br>00:01:23,920 –&gt; 00:01:28,920<br>as the app is basically stateless</p>
<p>24<br>00:01:31,799 –&gt; 00:01:35,640<br>and then the storage holds all the persistent state.</p>
<p>25<br>00:01:39,760 –&gt; 00:01:42,719<br>And that simplifies the design of the app tremendously.</p>
<p>26<br>00:01:43,879 –&gt; 00:01:48,840<br>Because the app basically doesn’t really have any stable storage</p>
<p>27<br>00:01:48,840 –&gt; 00:01:50,240<br>that it has to maintain itself.</p>
<p>28<br>00:01:50,240 –&gt; 00:01:53,159<br>In fact, it sort of factored it all out to the storage system.</p>
<p>29<br>00:01:53,159 –&gt; 00:01:56,799<br>So you can start up a new application very quickly.</p>
<p>30<br>00:01:56,799 –&gt; 00:01:58,079<br>It crashed doesn’t really matter</p>
<p>31<br>00:01:58,079 –&gt; 00:02:01,039<br>because it only has soft state, not any hard state.</p>
<p>32<br>00:02:01,039 –&gt; 00:02:03,039<br>You start up again and then you start up again,</p>
<p>33<br>00:02:03,039 –&gt; 00:02:06,439<br>you just reach the state from the distributed storage system.</p>
<p>34<br>00:02:06,439 –&gt; 00:02:07,759<br>And you can see this quickly.</p>
<p>35<br>00:02:07,759 –&gt; 00:02:09,280<br>You look at any website,</p>
<p>36<br>00:02:09,280 –&gt; 00:02:10,800<br>basically it’s structured in that way.</p>
<p>37<br>00:02:10,800 –&gt; 00:02:14,479<br>There’s a storage backend that links the state</p>
<p>38<br>00:02:14,479 –&gt; 00:02:18,479<br>and then there’s the application middle tier</p>
<p>39<br>00:02:18,479 –&gt; 00:02:20,400<br>that does the application-specific computation</p>
<p>40<br>00:02:20,400 –&gt; 00:02:23,599<br>or whatever runs JavaScript, Go, or whatever.</p>
<p>41<br>00:02:23,599 –&gt; 00:02:28,599<br>And it firmens that out to clients on the internet.</p>
<p>42<br>00:02:28,599 –&gt; 00:02:32,800<br>And so storage is just this like this fantastic building block.</p>
<p>43<br>00:02:32,800 –&gt; 00:02:34,000<br>And I think this is one reason</p>
<p>44<br>00:02:34,000 –&gt; 00:02:37,120<br>that we’re gonna see this over and over in this class.</p>
<p>45<br>00:02:38,599 –&gt; 00:02:40,560<br>That means that the storage system itself,</p>
<p>46<br>00:02:40,560 –&gt; 00:02:42,520<br>of course, has to be highly fault tolerance</p>
<p>47<br>00:02:42,520 –&gt; 00:02:44,719<br>and that turns out to be very tricky thing to do.</p>
<p>48<br>00:02:44,719 –&gt; 00:02:49,319<br>And so that is the other side, the flip side of it.</p>
<p>49<br>00:02:49,319 –&gt; 00:02:51,000<br>It will make life with the application easy</p>
<p>50<br>00:02:51,000 –&gt; 00:02:53,239<br>but the designing and actually fault tolerance</p>
<p>51<br>00:02:53,239 –&gt; 00:02:55,759<br>system storage system is not easy.</p>
<p>52<br>00:02:55,759 –&gt; 00:02:56,879<br>And so why is it hard?</p>
<p>53<br>00:03:00,560 –&gt; 00:03:05,159<br>And basically come down to one reason</p>
<p>54<br>00:03:05,159 –&gt; 00:03:07,240<br>that drives these designs,</p>
<p>55<br>00:03:07,240 –&gt; 00:03:10,079<br>which is like we generally want high performance.</p>
<p>56<br>00:03:10,079 –&gt; 00:03:12,599<br>When you think about the storage system for today,</p>
<p>57<br>00:03:12,599 –&gt; 00:03:15,680<br>GFS, it’s main goal is to basically support</p>
<p>58<br>00:03:15,680 –&gt; 00:03:17,199<br>map-produced types of applications.</p>
<p>59<br>00:03:18,079 –&gt; 00:03:20,719<br>And so it really needs high performance.</p>
<p>60<br>00:03:20,719 –&gt; 00:03:22,119<br>Well, what does that mean?</p>
<p>61<br>00:03:22,119 –&gt; 00:03:23,959<br>Well, it means it could typically have to</p>
<p>62<br>00:03:23,959 –&gt; 00:03:28,959<br>short data across servers.</p>
<p>63<br>00:03:30,759 –&gt; 00:03:34,359<br>So you can use one server, you have to use multiple servers.</p>
<p>64<br>00:03:34,359 –&gt; 00:03:37,079<br>And then you’re gonna reason you wanna read from the disk</p>
<p>65<br>00:03:37,079 –&gt; 00:03:40,599<br>and often, particularly machine has a limited throughput.</p>
<p>66<br>00:03:40,599 –&gt; 00:03:43,280<br>If you wanna read more than actually a single disk</p>
<p>67<br>00:03:43,280 –&gt; 00:03:44,959<br>and sustain, you have to use multiple disks</p>
<p>68<br>00:03:44,959 –&gt; 00:03:46,560<br>and you have to use multiple network cards.</p>
<p>69<br>00:03:46,680 –&gt; 00:03:49,000<br>And so you can immediately get into the sort of</p>
<p>70<br>00:03:49,000 –&gt; 00:03:51,800<br>large scale systems as in the GFS papers,</p>
<p>71<br>00:03:51,800 –&gt; 00:03:53,479<br>where you have thousands of machines.</p>
<p>72<br>00:03:54,719 –&gt; 00:03:56,159<br>But if you have many servers,</p>
<p>73<br>00:03:58,159 –&gt; 00:03:59,159<br>so I’m not gonna fail.</p>
<p>74<br>00:04:00,920 –&gt; 00:04:02,920<br>You’re gonna get failures.</p>
<p>75<br>00:04:02,920 –&gt; 00:04:04,800<br>Maybe you just can save more explicitly</p>
<p>76<br>00:04:04,800 –&gt; 00:04:06,159<br>if constant faults.</p>
<p>77<br>00:04:10,360 –&gt; 00:04:13,240<br>Let’s assume that a computer crashes once a year.</p>
<p>78<br>00:04:14,240 –&gt; 00:04:17,120<br>Now let’s say you have a thousand machines</p>
<p>79<br>00:04:17,120 –&gt; 00:04:19,680<br>like in the GFS paper, or actually many more</p>
<p>80<br>00:04:19,680 –&gt; 00:04:20,960<br>in a thousand machines, but at the minimum,</p>
<p>81<br>00:04:20,960 –&gt; 00:04:22,439<br>all the five of the machines.</p>
<p>82<br>00:04:22,439 –&gt; 00:04:24,600<br>And how many failures are you gonna see per day?</p>
<p>83<br>00:04:24,600 –&gt; 00:04:25,439<br>Roughly.</p>
<p>84<br>00:04:29,720 –&gt; 00:04:30,800<br>Around three?</p>
<p>85<br>00:04:30,800 –&gt; 00:04:31,920<br>Yeah, around three.</p>
<p>86<br>00:04:31,920 –&gt; 00:04:35,680<br>My job means that the sort of a failure of a computer</p>
<p>87<br>00:04:35,680 –&gt; 00:04:38,319<br>and like my laptop at the beginning of the lecture</p>
<p>88<br>00:04:38,319 –&gt; 00:04:41,400<br>is just a common scenario.</p>
<p>89<br>00:04:41,399 –&gt; 00:04:44,079<br>And so if you’re gonna move up to more than a thousand machines,</p>
<p>90<br>00:04:44,079 –&gt; 00:04:46,560<br>10,000 machines, you know, 100,000 machines,</p>
<p>91<br>00:04:46,560 –&gt; 00:04:47,519<br>and you run the application,</p>
<p>92<br>00:04:47,519 –&gt; 00:04:49,239<br>you’re using that kind of number of computers,</p>
<p>93<br>00:04:49,239 –&gt; 00:04:50,159<br>you’re gonna get faults.</p>
<p>94<br>00:04:50,159 –&gt; 00:04:53,599<br>And so that means that you want a fault-hull of design.</p>
<p>95<br>00:05:01,359 –&gt; 00:05:03,239<br>And you know, the get fault-hulls,</p>
<p>96<br>00:05:03,239 –&gt; 00:05:05,000<br>you’re gonna at least in the case with your storage chips</p>
<p>97<br>00:05:05,000 –&gt; 00:05:06,560<br>or the typical approach to the way to go,</p>
<p>98<br>00:05:06,560 –&gt; 00:05:08,120<br>is gonna go with replications.</p>
<p>99<br>00:05:09,120 –&gt; 00:05:11,920<br>You know, it’s tapping the data on multiple disks,</p>
<p>100<br>00:05:11,920 –&gt; 00:05:13,360<br>you know, so that they want this fail,</p>
<p>101<br>00:05:13,360 –&gt; 00:05:16,120<br>it’s, you know, the other disk hopefully have the data.</p>
<p>102<br>00:05:17,879 –&gt; 00:05:20,439<br>But if you go into replication,</p>
<p>103<br>00:05:20,439 –&gt; 00:05:23,399<br>and so the data is in multiple places,</p>
<p>104<br>00:05:23,399 –&gt; 00:05:25,519<br>that runs into the challenge that, you know,</p>
<p>105<br>00:05:25,519 –&gt; 00:05:27,160<br>the data may be out of sync.</p>
<p>106<br>00:05:27,160 –&gt; 00:05:29,800<br>And so you actually get into inconsistent potential</p>
<p>107<br>00:05:29,800 –&gt; 00:05:30,879<br>inconsistencies.</p>
<p>108<br>00:05:39,120 –&gt; 00:05:42,920<br>You know, to avoid these inconsistencies, you know,</p>
<p>109<br>00:05:42,920 –&gt; 00:05:45,000<br>then if you desire strong consistency,</p>
<p>110<br>00:05:45,000 –&gt; 00:05:47,959<br>basically your replicated system behaves as if it’s,</p>
<p>111<br>00:05:47,959 –&gt; 00:05:50,920<br>you know, has the same behavior as an unreplicated system,</p>
<p>112<br>00:05:52,160 –&gt; 00:05:55,399<br>then, you know, you will need some consistency protocol.</p>
<p>113<br>00:05:57,720 –&gt; 00:06:00,160<br>And that, you know, requires some maybe sending messages</p>
<p>114<br>00:06:00,160 –&gt; 00:06:02,439<br>and may you lower performance.</p>
<p>115<br>00:06:03,439 –&gt; 00:06:08,240<br>And maybe the message itself is not really huge,</p>
<p>116<br>00:06:08,240 –&gt; 00:06:09,680<br>you know, performance overhead, but you know,</p>
<p>117<br>00:06:09,680 –&gt; 00:06:11,000<br>tip bill as we’ll see,</p>
<p>118<br>00:06:11,000 –&gt; 00:06:12,680<br>you might actually have to read,</p>
<p>119<br>00:06:12,680 –&gt; 00:06:15,800<br>or write to durable storage as part of that protocol.</p>
<p>120<br>00:06:15,800 –&gt; 00:06:17,519<br>And you know, reading a writing to storage in 10</p>
<p>121<br>00:06:17,519 –&gt; 00:06:19,839<br>or we tend to be, you know, quite expensive.</p>
<p>122<br>00:06:19,839 –&gt; 00:06:21,519<br>And so here sort of we see this conundrum,</p>
<p>123<br>00:06:21,519 –&gt; 00:06:24,079<br>like, you know, we want high performance,</p>
<p>124<br>00:06:24,079 –&gt; 00:06:26,720<br>we want fault tolerance because we have many servers.</p>
<p>125<br>00:06:26,720 –&gt; 00:06:27,879<br>We want high performance,</p>
<p>126<br>00:06:27,879 –&gt; 00:06:29,800<br>so we want many servers, we have many servers</p>
<p>127<br>00:06:29,800 –&gt; 00:06:31,360<br>who mean fault tolerance.</p>
<p>128<br>00:06:31,400 –&gt; 00:06:33,920<br>That means replication, that means, you know,</p>
<p>129<br>00:06:33,920 –&gt; 00:06:37,319<br>inconsistencies because we have data in multiple places,</p>
<p>130<br>00:06:37,319 –&gt; 00:06:38,560<br>you know, to fix the inconsistencies,</p>
<p>131<br>00:06:38,560 –&gt; 00:06:40,280<br>we need to, you know, to basically get a protocol</p>
<p>132<br>00:06:40,280 –&gt; 00:06:41,759<br>that might lower performance.</p>
<p>133<br>00:06:41,759 –&gt; 00:06:44,240<br>And so here sort of this fundamental challenge,</p>
<p>134<br>00:06:44,240 –&gt; 00:06:46,480<br>you know, in designing these distributed storage systems</p>
<p>135<br>00:06:46,480 –&gt; 00:06:49,840<br>that you just struggle between consistency</p>
<p>136<br>00:06:49,840 –&gt; 00:06:51,199<br>and this new performance.</p>
<p>137<br>00:06:51,199 –&gt; 00:06:53,720<br>And we’ll see that throughout the turn.</p>
<p>138<br>00:06:55,920 –&gt; 00:06:58,280<br>So let me talk a little bit about consistency.</p>
<p>139<br>00:07:02,360 –&gt; 00:07:03,800<br>And it’s sort of very high level.</p>
<p>140<br>00:07:03,800 –&gt; 00:07:06,480<br>I know I promised you for a direct sleep test,</p>
<p>141<br>00:07:06,480 –&gt; 00:07:09,800<br>we’re going to go in more detail as we go.</p>
<p>142<br>00:07:09,800 –&gt; 00:07:13,319<br>So first let’s talk again about the ideal consistency.</p>
<p>143<br>00:07:13,319 –&gt; 00:07:16,040<br>An ideal consistency, the way the simplest way to think about it</p>
<p>144<br>00:07:16,040 –&gt; 00:07:17,879<br>is that basically the machine behaves</p>
<p>145<br>00:07:17,879 –&gt; 00:07:19,720<br>as if it’s a single system.</p>
<p>146<br>00:07:29,000 –&gt; 00:07:30,600<br>That’s where the desired behavior</p>
<p>147<br>00:07:30,680 –&gt; 00:07:34,480<br>and the sort of two things that make that desired behavior</p>
<p>148<br>00:07:34,480 –&gt; 00:07:39,480<br>or two hazards that make that this desired behavior</p>
<p>149<br>00:07:40,160 –&gt; 00:07:45,160<br>hard to achieve, or at least, you know, requires some thinking.</p>
<p>150<br>00:07:45,160 –&gt; 00:07:47,800<br>And one is concurrency and second thing is failure.</p>
<p>151<br>00:07:48,840 –&gt; 00:07:50,520<br>So let me start with a certain concurrency</p>
<p>152<br>00:07:50,520 –&gt; 00:07:54,280<br>because even if you have a single machine,</p>
<p>153<br>00:07:54,280 –&gt; 00:07:56,240<br>with multiple clients, so if concurrency</p>
<p>154<br>00:07:56,240 –&gt; 00:07:57,439<br>within the single machine,</p>
<p>155<br>00:07:57,439 –&gt; 00:07:59,560<br>you actually have to think about consistency.</p>
<p>156<br>00:07:59,560 –&gt; 00:08:01,399<br>And this course is quite obvious.</p>
<p>157<br>00:08:01,399 –&gt; 00:08:05,079<br>And let’s say we have one machine, one disk,</p>
<p>158<br>00:08:05,079 –&gt; 00:08:08,639<br>multiple requests come in from multiple different clients.</p>
<p>159<br>00:08:08,639 –&gt; 00:08:10,240<br>And if the machine is a multi-prousing machine,</p>
<p>160<br>00:08:10,240 –&gt; 00:08:12,920<br>they might actually run these requests</p>
<p>161<br>00:08:12,920 –&gt; 00:08:14,560<br>to truly imperil.</p>
<p>162<br>00:08:14,560 –&gt; 00:08:17,079<br>So let’s think a little bit about it,</p>
<p>163<br>00:08:17,079 –&gt; 00:08:17,920<br>what does it mean?</p>
<p>164<br>00:08:17,920 –&gt; 00:08:21,759<br>So let’s say we have a client one,</p>
<p>165<br>00:08:21,759 –&gt; 00:08:26,759<br>it does a right operation to a key X and the right one.</p>
<p>166<br>00:08:27,759 –&gt; 00:08:30,680<br>And at the same time, there’s a quest coming in,</p>
<p>167<br>00:08:30,680 –&gt; 00:08:34,080<br>it writes to X2, but it actually writes the value too.</p>
<p>168<br>00:08:35,159 –&gt; 00:08:38,279<br>Right now, if you want to specify or state</p>
<p>169<br>00:08:38,279 –&gt; 00:08:40,480<br>like consistency means, we need some rule</p>
<p>170<br>00:08:40,480 –&gt; 00:08:42,559<br>in about what will happen.</p>
<p>171<br>00:08:42,559 –&gt; 00:08:43,879<br>And the rule is typically phrased</p>
<p>172<br>00:08:43,879 –&gt; 00:08:45,240<br>from the perspective of the reader.</p>
<p>173<br>00:08:45,240 –&gt; 00:08:48,039<br>So let’s say there’s another reader coming in,</p>
<p>174<br>00:08:48,039 –&gt; 00:08:50,279<br>or another request coming in from an client,</p>
<p>175<br>00:08:50,279 –&gt; 00:08:51,799<br>and it actually reads X.</p>
<p>176<br>00:08:53,600 –&gt; 00:08:55,120<br>And the question is like, what is the value</p>
<p>177<br>00:08:55,120 –&gt; 00:08:58,560<br>that actually that reader or adapt this client on zeroes?</p>
<p>178<br>00:08:58,560 –&gt; 00:09:00,080<br>And like a little bit more complicated,</p>
<p>179<br>00:09:00,080 –&gt; 00:09:02,440<br>or more interesting, let’s say we have a fourth client,</p>
<p>180<br>00:09:02,440 –&gt; 00:09:03,279<br>which we’re going to bring out</p>
<p>181<br>00:09:03,279 –&gt; 00:09:05,960<br>to issue a consistency definitions in more clearly.</p>
<p>182<br>00:09:05,960 –&gt; 00:09:07,720<br>And it also does a read of X.</p>
<p>183<br>00:09:07,720 –&gt; 00:09:11,200<br>Well, after the client free, actually red X.</p>
<p>184<br>00:09:12,679 –&gt; 00:09:13,919<br>So now we have such a state,</p>
<p>185<br>00:09:13,919 –&gt; 00:09:15,279<br>like what does the desired outcomes</p>
<p>186<br>00:09:15,279 –&gt; 00:09:16,519<br>and what are incorrect outcomes?</p>
<p>187<br>00:09:16,519 –&gt; 00:09:19,840<br>And that’s really what defines consistency.</p>
<p>188<br>00:09:19,840 –&gt; 00:09:23,279<br>So let’s take the first case, see free.</p>
<p>189<br>00:09:23,279 –&gt; 00:09:28,279<br>There’s going to be a reasonable outcome for the read,</p>
<p>190<br>00:09:28,519 –&gt; 00:09:30,399<br>what is a reasonable outcome for the read of C for you</p>
<p>191<br>00:09:30,399 –&gt; 00:09:32,519<br>to return, or values.</p>
<p>192<br>00:09:34,079 –&gt; 00:09:35,319<br>What value would make you happy</p>
<p>193<br>00:09:35,319 –&gt; 00:09:37,279<br>or would make an application programmer happy?</p>
<p>194<br>00:09:39,000 –&gt; 00:09:40,240<br>To?</p>
<p>195<br>00:09:40,240 –&gt; 00:09:42,240<br>To you be very reasonable?</p>
<p>196<br>00:09:42,240 –&gt; 00:09:45,079<br>Any other reasonable values?</p>
<p>197<br>00:09:45,079 –&gt; 00:09:45,919<br>One.</p>
<p>198<br>00:09:45,919 –&gt; 00:09:47,639<br>Yeah, one reasonable,</p>
<p>199<br>00:09:47,639 –&gt; 00:09:49,240<br>because the operating system happened concurrently,</p>
<p>200<br>00:09:49,240 –&gt; 00:09:51,079<br>so maybe we don’t really know which one,</p>
<p>201<br>00:09:51,079 –&gt; 00:09:52,240<br>we don’t really want to restrict</p>
<p>202<br>00:09:52,240 –&gt; 00:09:53,759<br>and what particular order they go.</p>
<p>203<br>00:09:53,759 –&gt; 00:09:55,639<br>So we do not necessarily say like either one is fine,</p>
<p>204<br>00:09:55,639 –&gt; 00:09:57,480<br>because they’re not concurrently.</p>
<p>205<br>00:09:57,480 –&gt; 00:09:59,560<br>What are some values that we would like not to see</p>
<p>206<br>00:10:00,720 –&gt; 00:10:02,519<br>for the C free read?</p>
<p>207<br>00:10:02,519 –&gt; 00:10:03,480<br>Seven.</p>
<p>208<br>00:10:03,480 –&gt; 00:10:05,120<br>Yeah, seven, any other value, okay?</p>
<p>209<br>00:10:05,120 –&gt; 00:10:06,480<br>Because there’s nobody wrote that.</p>
<p>210<br>00:10:06,480 –&gt; 00:10:08,320<br>So that would be undesirable.</p>
<p>211<br>00:10:08,320 –&gt; 00:10:09,159<br>Okay, so good.</p>
<p>212<br>00:10:09,159 –&gt; 00:10:12,279<br>So like we agreed that probably the reasonable outcome</p>
<p>213<br>00:10:12,279 –&gt; 00:10:14,480<br>for C free would be either one or two.</p>
<p>214<br>00:10:14,480 –&gt; 00:10:15,600<br>Okay, how about C for?</p>
<p>215<br>00:10:17,639 –&gt; 00:10:19,680<br>The same as C for C three.</p>
<p>216<br>00:10:19,680 –&gt; 00:10:20,519<br>Really?</p>
<p>217<br>00:10:20,519 –&gt; 00:10:21,360<br>Exactly the same.</p>
<p>218<br>00:10:23,240 –&gt; 00:10:25,240<br>So let’s say C free, you return one.</p>
<p>219<br>00:10:25,240 –&gt; 00:10:27,480<br>What do we expect C for to return?</p>
<p>220<br>00:10:28,639 –&gt; 00:10:30,360<br>Whatever C three so?</p>
<p>221<br>00:10:30,360 –&gt; 00:10:32,759<br>Yeah, because it ran well after C free.</p>
<p>222<br>00:10:32,759 –&gt; 00:10:35,600<br>So we hope that if one is returned,</p>
<p>223<br>00:10:35,600 –&gt; 00:10:37,759<br>we expect one here to the graph.</p>
<p>224<br>00:10:37,759 –&gt; 00:10:40,120<br>If two was returned, we expect two here.</p>
<p>225<br>00:10:41,919 –&gt; 00:10:43,080<br>Does that make sense?</p>
<p>226<br>00:10:45,600 –&gt; 00:10:49,720<br>Okay, so there’s like a super brief introduction</p>
<p>227<br>00:10:49,720 –&gt; 00:10:50,680<br>of saying like now,</p>
<p>228<br>00:10:50,679 –&gt; 00:10:52,759<br>how can we define consistency?</p>
<p>229<br>00:10:52,759 –&gt; 00:10:55,120<br>And in a typical way, we do this using sort of traces.</p>
<p>230<br>00:10:55,120 –&gt; 00:10:57,000<br>And we argue about like what correctness</p>
<p>231<br>00:10:57,000 –&gt; 00:10:58,159<br>for particular traces.</p>
<p>232<br>00:10:58,159 –&gt; 00:11:00,039<br>And we’ll see more of that.</p>
<p>233<br>00:11:00,039 –&gt; 00:11:02,639<br>And of course, you know, the sort of beginning for this kind</p>
<p>234<br>00:11:02,639 –&gt; 00:11:05,159<br>of consistency by example, using locks.</p>
<p>235<br>00:11:05,159 –&gt; 00:11:06,359<br>If you have done it,</p>
<p>236<br>00:11:06,359 –&gt; 00:11:07,479<br>as you do in that producer,</p>
<p>237<br>00:11:07,479 –&gt; 00:11:09,479<br>or in sort of any concurrent node program,</p>
<p>238<br>00:11:09,479 –&gt; 00:11:10,319<br>that you’re right.</p>
<p>239<br>00:11:10,319 –&gt; 00:11:11,919<br>So just to stand up to technique, you know,</p>
<p>240<br>00:11:11,919 –&gt; 00:11:14,839<br>to enforce consistency in terms of,</p>
<p>241<br>00:11:14,839 –&gt; 00:11:18,039<br>in the presence of concurrency is to use locks.</p>
<p>242<br>00:11:19,039 –&gt; 00:11:22,559<br>Now, in a distributed system,</p>
<p>243<br>00:11:22,559 –&gt; 00:11:24,199<br>in the ideal consistency,</p>
<p>244<br>00:11:24,199 –&gt; 00:11:25,879<br>either sort of as a set of two hazards,</p>
<p>245<br>00:11:25,879 –&gt; 00:11:28,120<br>the second hazard is basically failure.</p>
<p>246<br>00:11:28,120 –&gt; 00:11:29,639<br>So it’s replication in general.</p>
<p>247<br>00:11:29,639 –&gt; 00:11:31,879<br>And we have two servers now assembly.</p>
<p>248<br>00:11:31,879 –&gt; 00:11:35,159<br>We use S1, we use S2,</p>
<p>249<br>00:11:36,559 –&gt; 00:11:38,599<br>and we’re gonna both have a disk.</p>
<p>250<br>00:11:39,959 –&gt; 00:11:42,719<br>And we have our same clients as before,</p>
<p>251<br>00:11:42,719 –&gt; 00:11:46,679<br>and C1 and C2, and they write two X.</p>
<p>252<br>00:11:48,439 –&gt; 00:11:51,719<br>And let’s say, you know, just to illustrate</p>
<p>253<br>00:11:51,719 –&gt; 00:11:52,879<br>like what kind of complications,</p>
<p>254<br>00:11:52,879 –&gt; 00:11:54,159<br>what kind of, you know,</p>
<p>255<br>00:11:54,159 –&gt; 00:11:56,399<br>just to illustrate that we actually have to do something.</p>
<p>256<br>00:11:56,399 –&gt; 00:11:58,599<br>Let’s start with like the most, you know,</p>
<p>257<br>00:11:58,599 –&gt; 00:12:01,279<br>dumb replication plan.</p>
<p>258<br>00:12:01,279 –&gt; 00:12:03,719<br>So like very bad replication plan.</p>
<p>259<br>00:12:11,439 –&gt; 00:12:13,439<br>So in this particular bad replication can find</p>
<p>260<br>00:12:13,439 –&gt; 00:12:14,439<br>what we’re gonna do is like,</p>
<p>261<br>00:12:14,439 –&gt; 00:12:16,279<br>oh, we’re gonna allow a client,</p>
<p>262<br>00:12:16,279 –&gt; 00:12:18,240<br>you know, when a client actually wants to update,</p>
<p>263<br>00:12:18,240 –&gt; 00:12:21,759<br>we’re right, we’re gonna tell it to basically,</p>
<p>264<br>00:12:21,759 –&gt; 00:12:23,039<br>the protocol that we’re gonna follow</p>
<p>265<br>00:12:23,039 –&gt; 00:12:25,360<br>is to client write to to both search</p>
<p>266<br>00:12:25,360 –&gt; 00:12:26,759<br>in, you know, whatever,</p>
<p>267<br>00:12:26,759 –&gt; 00:12:30,039<br>then we’re gonna coordinate out to just write it to both.</p>
<p>268<br>00:12:30,039 –&gt; 00:12:32,360<br>And so, for example, if we have client one</p>
<p>269<br>00:12:32,360 –&gt; 00:12:33,480<br>and client two running,</p>
<p>270<br>00:12:34,759 –&gt; 00:12:37,639<br>then you’re gonna maybe client two does the same thing.</p>
<p>271<br>00:12:39,639 –&gt; 00:12:44,120<br>And then we’re gonna ask ourselves the same question,</p>
<p>272<br>00:12:44,399 –&gt; 00:12:45,879<br>what this gonna see three,</p>
<p>273<br>00:12:45,879 –&gt; 00:12:48,840<br>see one that actually reads.</p>
<p>274<br>00:12:48,840 –&gt; 00:12:50,240<br>And let’s assume that for reading,</p>
<p>275<br>00:12:50,240 –&gt; 00:12:52,440<br>we’re gonna say like, ah, we’re in either way.</p>
<p>276<br>00:12:53,639 –&gt; 00:12:55,159<br>We’re gonna read from any other replica.</p>
<p>277<br>00:12:55,159 –&gt; 00:12:57,279<br>As I said, this is a very bad replication plan.</p>
<p>278<br>00:12:57,279 –&gt; 00:12:58,960<br>Basically, there’s no restrictions.</p>
<p>279<br>00:13:00,159 –&gt; 00:13:02,720<br>So what are the possible outcomes?</p>
<p>280<br>00:13:02,720 –&gt; 00:13:06,759<br>So this guy writes one, this guy writes two,</p>
<p>281<br>00:13:06,759 –&gt; 00:13:08,680<br>and you know, we now we see three.</p>
<p>282<br>00:13:10,240 –&gt; 00:13:12,360<br>What are the possible outcomes for each read?</p>
<p>283<br>00:13:15,039 –&gt; 00:13:16,560<br>One and two again.</p>
<p>284<br>00:13:16,560 –&gt; 00:13:17,840<br>Yeah, one and two.</p>
<p>285<br>00:13:17,840 –&gt; 00:13:20,039<br>Nothing really that bad happened, right?</p>
<p>286<br>00:13:20,039 –&gt; 00:13:21,039<br>And let’s see four.</p>
<p>287<br>00:13:22,639 –&gt; 00:13:23,679<br>We do a read of X,</p>
<p>288<br>00:13:23,679 –&gt; 00:13:25,320<br>we’re gonna well after see for your X,</p>
<p>289<br>00:13:25,320 –&gt; 00:13:28,720<br>like this is the previous board.</p>
<p>290<br>00:13:28,720 –&gt; 00:13:30,759<br>Also one and two.</p>
<p>291<br>00:13:30,759 –&gt; 00:13:33,159<br>Yeah, one and two again.</p>
<p>292<br>00:13:33,159 –&gt; 00:13:34,360<br>But what happens?</p>
<p>293<br>00:13:34,360 –&gt; 00:13:35,720<br>He three reads one.</p>
<p>294<br>00:13:37,759 –&gt; 00:13:40,039<br>What does see three, see four made in terms?</p>
<p>295<br>00:13:41,279 –&gt; 00:13:42,279<br>One or two.</p>
<p>296<br>00:13:43,120 –&gt; 00:13:44,959<br>And it’s not what we want or not.</p>
<p>297<br>00:13:45,919 –&gt; 00:13:46,919<br>No.</p>
<p>298<br>00:13:46,919 –&gt; 00:13:48,399<br>No, I mean, you know, again,</p>
<p>299<br>00:13:48,399 –&gt; 00:13:50,079<br>it’d be difficult for an application writer</p>
<p>300<br>00:13:50,079 –&gt; 00:13:51,399<br>to actually reason about this.</p>
<p>301<br>00:13:53,480 –&gt; 00:13:55,000<br>Particularly even if see three and see four,</p>
<p>302<br>00:13:55,000 –&gt; 00:13:55,839<br>we’re the same thing.</p>
<p>303<br>00:13:55,839 –&gt; 00:13:56,959<br>You first read to a teacher one.</p>
<p>304<br>00:13:56,959 –&gt; 00:13:58,159<br>No modification made.</p>
<p>305<br>00:13:58,159 –&gt; 00:13:59,919<br>And the next second read returns another value.</p>
<p>306<br>00:13:59,919 –&gt; 00:14:01,319<br>How’s that possible?</p>
<p>307<br>00:14:01,319 –&gt; 00:14:04,679<br>You know, it makes application program much difficult to write.</p>
<p>308<br>00:14:04,679 –&gt; 00:14:06,759<br>And so, you know, and the reason, of course,</p>
<p>309<br>00:14:06,759 –&gt; 00:14:09,120<br>that this inconsistency shows up here,</p>
<p>310<br>00:14:09,120 –&gt; 00:14:10,919<br>is because we basically have no protocol,</p>
<p>311<br>00:14:10,919 –&gt; 00:14:13,719<br>you know, to coordinate kind of declines,</p>
<p>312<br>00:14:13,719 –&gt; 00:14:14,639<br>the readers and the writers.</p>
<p>313<br>00:14:14,639 –&gt; 00:14:16,959<br>So we need some form and the system typically,</p>
<p>314<br>00:14:16,959 –&gt; 00:14:19,159<br>we need some form of a protocol to fix these.</p>
<p>315<br>00:14:20,439 –&gt; 00:14:22,120<br>To get the desired to enforce that,</p>
<p>316<br>00:14:22,120 –&gt; 00:14:23,839<br>we get the desired consistency.</p>
<p>317<br>00:14:23,839 –&gt; 00:14:24,959<br>Okay.</p>
<p>318<br>00:14:24,959 –&gt; 00:14:26,759<br>And so what we’re gonna see in this investment semester,</p>
<p>319<br>00:14:26,759 –&gt; 00:14:28,319<br>in a whole bunch of different types of protocols,</p>
<p>320<br>00:14:28,319 –&gt; 00:14:30,519<br>they have different trade-offs in terms of fault tolerance</p>
<p>321<br>00:14:30,519 –&gt; 00:14:31,360<br>and the consistency.</p>
<p>322<br>00:14:32,519 –&gt; 00:14:33,360<br>Okay.</p>
<p>323<br>00:14:34,079 –&gt; 00:14:38,439<br>And the fact, you know, to get our head in that kind of thinking,</p>
<p>324<br>00:14:39,440 –&gt; 00:14:44,040<br>we’re gonna use a whole bunch of different case studies.</p>
<p>325<br>00:14:44,040 –&gt; 00:14:47,440<br>And the case study for today is GFS.</p>
<p>326<br>00:14:55,040 –&gt; 00:14:57,040<br>And this is an instant case study, you know,</p>
<p>327<br>00:14:57,040 –&gt; 00:14:59,240<br>why we wouldn’t have signed it.</p>
<p>328<br>00:14:59,240 –&gt; 00:15:00,920<br>And one reason it’s an instant case study,</p>
<p>329<br>00:15:00,920 –&gt; 00:15:04,000<br>because it brings out sort of all these core issues,</p>
<p>330<br>00:15:04,000 –&gt; 00:15:07,880<br>correct, DFS, you know, is designed to get high performance.</p>
<p>331<br>00:15:09,440 –&gt; 00:15:14,040<br>Yeah, that means that actually uses replication</p>
<p>332<br>00:15:18,160 –&gt; 00:15:19,480<br>and fault tolerance.</p>
<p>333<br>00:15:22,920 –&gt; 00:15:25,640<br>And, you know, struggles with this consistency.</p>
<p>334<br>00:15:25,640 –&gt; 00:15:27,360<br>So it’s like the few four sort of themes</p>
<p>335<br>00:15:27,360 –&gt; 00:15:29,880<br>that we’re gonna be consistently seeing in throughout the semester,</p>
<p>336<br>00:15:29,880 –&gt; 00:15:31,800<br>and it’ll show up in this one paper.</p>
<p>337<br>00:15:34,080 –&gt; 00:15:36,200<br>The other side of this why is an instant case study,</p>
<p>338<br>00:15:36,200 –&gt; 00:15:37,840<br>because it’s a successful system.</p>
<p>339<br>00:15:39,440 –&gt; 00:15:43,440<br>Google doesn’t actually use GFS, at least at this point,</p>
<p>340<br>00:15:46,160 –&gt; 00:15:49,760<br>in my understanding, there’s a successor file system called Colossus,</p>
<p>341<br>00:15:49,760 –&gt; 00:15:51,760<br>but it’s inspired by DFS.</p>
<p>342<br>00:15:53,040 –&gt; 00:15:57,640<br>And, but there are other sort of these cluster-based file systems</p>
<p>343<br>00:15:57,640 –&gt; 00:16:00,800<br>that are for like, do type of use, like HDS,</p>
<p>344<br>00:16:00,800 –&gt; 00:16:03,720<br>you know, there was very much inspired by the design of GFS.</p>
<p>345<br>00:16:04,720 –&gt; 00:16:08,560<br>And, you know, one thing that is actually interesting,</p>
<p>346<br>00:16:08,560 –&gt; 00:16:12,680<br>at the point that this paper was written in the sort of late,</p>
<p>347<br>00:16:12,680 –&gt; 00:16:14,800<br>or in 2000, you know, it was pretty, you know,</p>
<p>348<br>00:16:14,800 –&gt; 00:16:17,320<br>distributed files, and were well understood to get in topics.</p>
<p>349<br>00:16:17,320 –&gt; 00:16:18,680<br>So people knew about fault tolerance,</p>
<p>350<br>00:16:18,680 –&gt; 00:16:20,200<br>but they knew about their application,</p>
<p>351<br>00:16:20,200 –&gt; 00:16:22,040<br>they knew about their consistency,</p>
<p>352<br>00:16:22,040 –&gt; 00:16:24,800<br>all the kind of stuff is pretty well understood.</p>
<p>353<br>00:16:26,160 –&gt; 00:16:28,399<br>However, you know, nobody actually sort of built,</p>
<p>354<br>00:16:28,399 –&gt; 00:16:31,879<br>you know, a system, you know, at the scale of thousands of computers.</p>
<p>355<br>00:16:31,879 –&gt; 00:16:36,720<br>And, and that sure brings out a number of challenges</p>
<p>356<br>00:16:36,720 –&gt; 00:16:38,759<br>that an approved system have to not address.</p>
<p>357<br>00:16:38,759 –&gt; 00:16:42,600<br>And the fact that the design is not completely standard.</p>
<p>358<br>00:16:43,639 –&gt; 00:16:45,720<br>So the end design that we’re reading about,</p>
<p>359<br>00:16:45,720 –&gt; 00:16:48,039<br>it’s not sort of the standard design</p>
<p>360<br>00:16:48,039 –&gt; 00:16:51,000<br>that you would see in academic papers at that time.</p>
<p>361<br>00:16:51,000 –&gt; 00:16:54,000<br>And there were sort of two aspects that make it non-standard,</p>
<p>362<br>00:16:54,000 –&gt; 00:16:56,919<br>over which we’ll get more time.</p>
<p>363<br>00:16:56,919 –&gt; 00:16:59,279<br>One is, you know, there’s actually a single master,</p>
<p>364<br>00:16:59,279 –&gt; 00:17:02,240<br>the master is not replicated.</p>
<p>365<br>00:17:02,240 –&gt; 00:17:04,240<br>You know, there’s a single machine that is sort of a charge</p>
<p>366<br>00:17:04,240 –&gt; 00:17:08,879<br>of like almost all the coordination in the system.</p>
<p>367<br>00:17:08,879 –&gt; 00:17:11,319<br>And so that is unusual, you know,</p>
<p>368<br>00:17:11,319 –&gt; 00:17:13,279<br>the good old why would you build a file,</p>
<p>369<br>00:17:13,279 –&gt; 00:17:14,839<br>a sort of a fault tolerance system</p>
<p>370<br>00:17:14,839 –&gt; 00:17:16,200<br>which has a single point of failure?</p>
<p>371<br>00:17:16,200 –&gt; 00:17:17,399<br>Right, that would be sort of not something</p>
<p>372<br>00:17:17,399 –&gt; 00:17:20,359<br>that people in the academic literature were doing at that time.</p>
<p>373<br>00:17:21,759 –&gt; 00:17:25,160<br>And the second thing is that it actually has,</p>
<p>374<br>00:17:25,160 –&gt; 00:17:28,399<br>it’s not consistent, you know, can have inconsistencies.</p>
<p>375<br>00:17:30,279 –&gt; 00:17:35,680<br>And again, you know, mostly in the literature,</p>
<p>376<br>00:17:35,680 –&gt; 00:17:38,359<br>in that particular time, you know, people were really sweating</p>
<p>377<br>00:17:38,359 –&gt; 00:17:40,399<br>actually to build, you know, the shivit systems</p>
<p>378<br>00:17:40,399 –&gt; 00:17:42,559<br>that actually have strong consistency.</p>
<p>379<br>00:17:42,559 –&gt; 00:17:44,319<br>And you know, don’t have the non-melese</p>
<p>380<br>00:17:44,319 –&gt; 00:17:46,119<br>that, you know, we saw in the previous book.</p>
<p>381<br>00:17:48,279 –&gt; 00:17:51,920<br>And so, you know, like a lot of the core techniques,</p>
<p>382<br>00:17:51,920 –&gt; 00:17:53,879<br>you know, where well known, you know,</p>
<p>383<br>00:17:53,879 –&gt; 00:17:55,319<br>the way that we’re putting together,</p>
<p>384<br>00:17:55,319 –&gt; 00:17:56,839<br>are actually quite different.</p>
<p>385<br>00:17:57,839 –&gt; 00:17:59,639<br>And so that makes it interesting.</p>
<p>386<br>00:17:59,639 –&gt; 00:18:01,639<br>And particularly, you know, the scale, you know,</p>
<p>387<br>00:18:01,639 –&gt; 00:18:03,319<br>which, you know, the system actually operates</p>
<p>388<br>00:18:03,319 –&gt; 00:18:05,240<br>is, I mean, it’s impressive.</p>
<p>389<br>00:18:05,240 –&gt; 00:18:07,119<br>And pretty common there, even for today, you know,</p>
<p>390<br>00:18:07,119 –&gt; 00:18:11,599<br>so this issue of struggle between fault tolerance,</p>
<p>391<br>00:18:12,639 –&gt; 00:18:16,399<br>replication, performance, and consistency is,</p>
<p>392<br>00:18:16,399 –&gt; 00:18:17,399<br>is a standard problem.</p>
<p>393<br>00:18:17,399 –&gt; 00:18:19,000<br>Rooker and problems should almost any</p>
<p>394<br>00:18:19,000 –&gt; 00:18:20,319<br>distributed storage systems, you know,</p>
<p>395<br>00:18:20,319 –&gt; 00:18:21,559<br>that people build today.</p>
<p>396<br>00:18:22,799 –&gt; 00:18:23,679<br>And changes over time.</p>
<p>397<br>00:18:23,679 –&gt; 00:18:25,279<br>So like S3 for a while, you know,</p>
<p>398<br>00:18:25,399 –&gt; 00:18:27,319<br>we have to have that strong consistency,</p>
<p>399<br>00:18:27,319 –&gt; 00:18:29,319<br>you know, lit me has gotten much stronger consistency.</p>
<p>400<br>00:18:31,079 –&gt; 00:18:32,559<br>Okay.</p>
<p>401<br>00:18:32,559 –&gt; 00:18:35,720<br>So one of, since the paper’s really written</p>
<p>402<br>00:18:35,720 –&gt; 00:18:37,920<br>and the design is written by a,</p>
<p>403<br>00:18:37,920 –&gt; 00:18:39,639<br>a hotel over there by performance,</p>
<p>404<br>00:18:39,639 –&gt; 00:18:44,639<br>I want to go back to the MapReduce paper for a second.</p>
<p>405<br>00:18:44,639 –&gt; 00:18:47,639<br>And this is a graph, you know, of the MapReduce paper.</p>
<p>406<br>00:18:47,639 –&gt; 00:18:52,639<br>And one way to think about GFS is that it’s the file system</p>
<p>407<br>00:18:53,640 –&gt; 00:18:55,400<br>for MapReduce.</p>
<p>408<br>00:19:00,640 –&gt; 00:19:03,440<br>So the goal is to actually run many MapReduce jobs</p>
<p>409<br>00:19:03,440 –&gt; 00:19:05,360<br>and get high performance.</p>
<p>410<br>00:19:05,360 –&gt; 00:19:07,400<br>And we know that basically from the,</p>
<p>411<br>00:19:07,400 –&gt; 00:19:09,200<br>we can tell from the MapReduce paper already</p>
<p>412<br>00:19:09,200 –&gt; 00:19:11,080<br>that, you know, this sort of GFS</p>
<p>413<br>00:19:11,080 –&gt; 00:19:14,080<br>is impressive in that matter in terms of performance.</p>
<p>414<br>00:19:14,080 –&gt; 00:19:18,080<br>So if you look at the, you know, this side of this graph,</p>
<p>415<br>00:19:18,080 –&gt; 00:19:20,600<br>this is straight out of the MapReduce paper,</p>
<p>416<br>00:19:20,599 –&gt; 00:19:24,719<br>this is the normal execution of one of the MapReduce jobs.</p>
<p>417<br>00:19:24,719 –&gt; 00:19:27,799<br>And it has in a free sort of parks to it.</p>
<p>418<br>00:19:27,799 –&gt; 00:19:29,159<br>One is the first part is input,</p>
<p>419<br>00:19:29,159 –&gt; 00:19:30,879<br>like reading the input files,</p>
<p>420<br>00:19:30,879 –&gt; 00:19:33,519<br>the inputs to the map from the file system.</p>
<p>421<br>00:19:33,519 –&gt; 00:19:35,359<br>And in case, you know, that they didn’t say much about it,</p>
<p>422<br>00:19:35,359 –&gt; 00:19:38,119<br>but those are written, Rhett from GFS.</p>
<p>423<br>00:19:39,439 –&gt; 00:19:41,399<br>There’s the internal shuffle that we know really care about.</p>
<p>424<br>00:19:41,399 –&gt; 00:19:42,759<br>And then, you know, at the end,</p>
<p>425<br>00:19:42,759 –&gt; 00:19:44,559<br>you know, the Reduce jobs right back</p>
<p>426<br>00:19:44,559 –&gt; 00:19:46,519<br>in results into GFS.</p>
<p>427<br>00:19:47,359 –&gt; 00:19:51,680<br>And so the performance, you know, part of the performance</p>
<p>428<br>00:19:51,680 –&gt; 00:19:54,160<br>of the GFS MapReduce task is determined by, you know,</p>
<p>429<br>00:19:54,160 –&gt; 00:19:57,920<br>the rate at which the MAPRs can actually read data</p>
<p>430<br>00:19:57,920 –&gt; 00:20:00,480<br>from the GFS file system, right?</p>
<p>431<br>00:20:00,480 –&gt; 00:20:02,680<br>So we’re running many, many MAPRs at the same time.</p>
<p>432<br>00:20:02,680 –&gt; 00:20:05,039<br>In fact, some MAPRs from different jobs,</p>
<p>433<br>00:20:05,039 –&gt; 00:20:07,319<br>nobody reading the same files.</p>
<p>434<br>00:20:07,319 –&gt; 00:20:09,759<br>So we look at the input, like this, this,</p>
<p>435<br>00:20:09,759 –&gt; 00:20:14,599<br>this top, you know, graph shows the input,</p>
<p>436<br>00:20:14,599 –&gt; 00:20:16,439<br>the internal megabytes per second,</p>
<p>437<br>00:20:16,439 –&gt; 00:20:17,719<br>at the rate at which, you know,</p>
<p>438<br>00:20:17,719 –&gt; 00:20:19,919<br>the map is actually jointly collectively</p>
<p>439<br>00:20:19,919 –&gt; 00:20:21,240<br>for one particular job, you know,</p>
<p>440<br>00:20:21,240 –&gt; 00:20:23,319<br>can read from the file system.</p>
<p>441<br>00:20:23,319 –&gt; 00:20:24,199<br>As you can see, you know,</p>
<p>442<br>00:20:24,199 –&gt; 00:20:26,959<br>it goes over well over a thousand,</p>
<p>443<br>00:20:26,959 –&gt; 00:20:28,719<br>or 10,000 megabyte per second.</p>
<p>444<br>00:20:30,879 –&gt; 00:20:33,079<br>And you know, the first question to ask you is maybe like,</p>
<p>445<br>00:20:33,079 –&gt; 00:20:34,399<br>is that an impressive number?</p>
<p>446<br>00:20:38,159 –&gt; 00:20:39,519<br>Yeah, should we be impressed with that number</p>
<p>447<br>00:20:39,519 –&gt; 00:20:41,839<br>or are we thinking, well, you know,</p>
<p>448<br>00:20:41,839 –&gt; 00:20:43,399<br>give me one this, can I do it too?</p>
<p>449<br>00:20:45,599 –&gt; 00:20:46,599<br>Okay.</p>
<p>450<br>00:20:50,599 –&gt; 00:20:51,919<br>Anybody?</p>
<p>451<br>00:20:51,919 –&gt; 00:20:54,959<br>I think because it’s older, maybe yes.</p>
<p>452<br>00:20:56,439 –&gt; 00:20:57,439<br>Okay.</p>
<p>453<br>00:20:57,439 –&gt; 00:20:58,959<br>How much can you write?</p>
<p>454<br>00:20:58,959 –&gt; 00:21:01,559<br>How much, like, what rates can you write?</p>
<p>455<br>00:21:01,559 –&gt; 00:21:02,399<br>Read.</p>
<p>456<br>00:21:08,399 –&gt; 00:21:10,399<br>Okay, let me tell you this.</p>
<p>457<br>00:21:10,399 –&gt; 00:21:13,319<br>Roughly the throughput of a single disk,</p>
<p>458<br>00:21:13,599 –&gt; 00:21:15,599<br>at the time that this paper,</p>
<p>459<br>00:21:15,599 –&gt; 00:21:17,679<br>it was around like 30 megabytes per second,</p>
<p>460<br>00:21:17,679 –&gt; 00:21:20,919<br>like somewhere in the tens of megabytes per second.</p>
<p>461<br>00:21:20,919 –&gt; 00:21:22,799<br>So here we’re looking at, you know,</p>
<p>462<br>00:21:22,799 –&gt; 00:21:25,159<br>well over 10,000 megabytes per second.</p>
<p>463<br>00:21:26,799 –&gt; 00:21:29,679<br>Correct? And so that is an impressive number.</p>
<p>464<br>00:21:29,679 –&gt; 00:21:30,960<br>And you have to do work.</p>
<p>465<br>00:21:30,960 –&gt; 00:21:31,799<br>As you know, the,</p>
<p>466<br>00:21:31,799 –&gt; 00:21:34,919<br>we’ll see in the GFS design that allows that kind of throughput.</p>
<p>467<br>00:21:36,359 –&gt; 00:21:37,720<br>And of course, the disk technology,</p>
<p>468<br>00:21:37,720 –&gt; 00:21:39,079<br>in the case of the GFS, of course,</p>
<p>469<br>00:21:39,079 –&gt; 00:21:40,799<br>if the disk technology was faster,</p>
<p>470<br>00:21:40,799 –&gt; 00:21:41,799<br>you know, it would be, you know,</p>
<p>471<br>00:21:41,799 –&gt; 00:21:43,039<br>what the real goal here, correct?</p>
<p>472<br>00:21:43,039 –&gt; 00:21:44,799<br>Is like we have a thousand machines,</p>
<p>473<br>00:21:44,799 –&gt; 00:21:46,159<br>maybe each one has a disk,</p>
<p>474<br>00:21:46,159 –&gt; 00:21:48,359<br>and each one can read a 30 megabyte per second,</p>
<p>475<br>00:21:48,359 –&gt; 00:21:50,519<br>which is one of thousand times 30 megabytes per second</p>
<p>476<br>00:21:50,519 –&gt; 00:21:52,000<br>to get out of it.</p>
<p>477<br>00:21:52,000 –&gt; 00:21:53,500<br>Okay?</p>
<p>478<br>00:21:53,500 –&gt; 00:21:55,919<br>And so I sort of, you know,</p>
<p>479<br>00:21:55,919 –&gt; 00:21:57,359<br>drives a lot of this design,</p>
<p>480<br>00:21:57,359 –&gt; 00:21:59,480<br>it’s through maybe a lot of these nappers</p>
<p>481<br>00:21:59,480 –&gt; 00:22:02,200<br>to reach the parallel from the file system,</p>
<p>482<br>00:22:02,200 –&gt; 00:22:05,079<br>for this, you know, just join file system.</p>
<p>483<br>00:22:05,079 –&gt; 00:22:05,919<br>Okay?</p>
<p>484<br>00:22:07,000 –&gt; 00:22:08,200<br>So let me say a little bit,</p>
<p>485<br>00:22:08,200 –&gt; 00:22:09,039<br>you know, more about this,</p>
<p>486<br>00:22:09,039 –&gt; 00:22:12,720<br>but what are the key properties that GFS has?</p>
<p>487<br>00:22:12,720 –&gt; 00:22:13,799<br>You know, one big,</p>
<p>488<br>00:22:16,879 –&gt; 00:22:18,920<br>large data set with that,</p>
<p>489<br>00:22:18,920 –&gt; 00:22:19,759<br>I mean, that.</p>
<p>490<br>00:22:24,000 –&gt; 00:22:25,319<br>And so in the thing with the data set,</p>
<p>491<br>00:22:25,319 –&gt; 00:22:27,440<br>you should think about this like the map-produced data sets.</p>
<p>492<br>00:22:27,440 –&gt; 00:22:28,440<br>You know, so for example,</p>
<p>493<br>00:22:28,440 –&gt; 00:22:31,519<br>you join the whole end of the complete crawl</p>
<p>494<br>00:22:31,519 –&gt; 00:22:32,359<br>of the worldwide web,</p>
<p>495<br>00:22:32,359 –&gt; 00:22:33,200<br>you’re stored in this,</p>
<p>496<br>00:22:33,200 –&gt; 00:22:34,759<br>you know, the stupid file system.</p>
<p>497<br>00:22:36,279 –&gt; 00:22:38,319<br>Has to be fast as we can talk about.</p>
<p>498<br>00:22:38,319 –&gt; 00:22:40,519<br>And you’re going to get the way they get like high performance</p>
<p>499<br>00:22:40,519 –&gt; 00:22:42,000<br>is to do automatic sharding.</p>
<p>500<br>00:22:43,839 –&gt; 00:22:45,879<br>Shard to files across multiple disk,</p>
<p>501<br>00:22:45,879 –&gt; 00:22:47,759<br>you’re allowed multiple clients to read</p>
<p>502<br>00:22:47,759 –&gt; 00:22:49,679<br>from those disks in parallel.</p>
<p>503<br>00:22:49,679 –&gt; 00:22:50,519<br>All right?</p>
<p>504<br>00:22:51,799 –&gt; 00:22:52,879<br>Now it goes global.</p>
<p>505<br>00:22:55,720 –&gt; 00:22:57,039<br>And without meaning,</p>
<p>506<br>00:22:57,039 –&gt; 00:22:57,879<br>again, it’s shared,</p>
<p>507<br>00:22:57,879 –&gt; 00:22:59,159<br>we’re going to all apps.</p>
<p>508<br>00:23:01,559 –&gt; 00:23:02,839<br>Csync file system.</p>
<p>509<br>00:23:06,279 –&gt; 00:23:07,279<br>And that’s convenient.</p>
<p>510<br>00:23:07,279 –&gt; 00:23:10,160<br>Like if you have multiple map-produced jobs</p>
<p>511<br>00:23:10,160 –&gt; 00:23:13,799<br>that operate on the same set of files,</p>
<p>512<br>00:23:13,799 –&gt; 00:23:16,079<br>they can, first of all, read all the same set of files,</p>
<p>513<br>00:23:16,079 –&gt; 00:23:17,480<br>but they can produce new files</p>
<p>514<br>00:23:17,480 –&gt; 00:23:19,119<br>and then other map-produced can use those,</p>
<p>515<br>00:23:19,119 –&gt; 00:23:20,119<br>you know, files again.</p>
<p>516<br>00:23:20,119 –&gt; 00:23:22,319<br>So is it a very convenient to get a live sharing</p>
<p>517<br>00:23:22,319 –&gt; 00:23:23,480<br>between applications?</p>
<p>518<br>00:23:23,480 –&gt; 00:23:24,879<br>So it’s very convenient to have.</p>
<p>519<br>00:23:26,119 –&gt; 00:23:26,720<br>And of course, you know,</p>
<p>520<br>00:23:26,720 –&gt; 00:23:28,119<br>GFS has to be fault-hulled.</p>
<p>521<br>00:23:33,879 –&gt; 00:23:35,399<br>And it’s likely that we’re going to be failures.</p>
<p>522<br>00:23:35,400 –&gt; 00:23:38,080<br>And so we want automatic,</p>
<p>523<br>00:23:38,080 –&gt; 00:23:40,000<br>close to automatic fault-hulled, as possible.</p>
<p>524<br>00:23:40,000 –&gt; 00:23:42,120<br>And we’ll see GFS doesn’t provide completely automatic,</p>
<p>525<br>00:23:42,120 –&gt; 00:23:43,240<br>but these are pretty good jobs</p>
<p>526<br>00:23:43,240 –&gt; 00:23:45,519<br>for actually getting high-proof fault-hulled.</p>
<p>527<br>00:23:48,280 –&gt; 00:23:51,000<br>Okay, any questions about the,</p>
<p>528<br>00:23:51,000 –&gt; 00:23:52,560<br>this part so far?</p>
<p>529<br>00:23:52,560 –&gt; 00:23:55,120<br>I’m going to run intro to this topic</p>
<p>530<br>00:23:55,120 –&gt; 00:23:57,640<br>and to a few intro,</p>
<p>531<br>00:23:57,640 –&gt; 00:23:59,240<br>we’re going to go to GFS.</p>
<p>532<br>00:23:59,240 –&gt; 00:24:01,240<br>Okay, let’s now talk about the design.</p>
<p>533<br>00:24:14,039 –&gt; 00:24:16,880<br>So here’s the design,</p>
<p>534<br>00:24:16,880 –&gt; 00:24:21,440<br>the scene from the figure one, I think, in the paper.</p>
<p>535<br>00:24:21,440 –&gt; 00:24:23,440<br>And there’s a couple of things I wanted to point out</p>
<p>536<br>00:24:23,440 –&gt; 00:24:25,559<br>to talk a little bit more in detail about.</p>
<p>537<br>00:24:25,559 –&gt; 00:24:27,359<br>So first of all, we have an application</p>
<p>538<br>00:24:27,359 –&gt; 00:24:30,719<br>and the application, again, might be MapReduceDoc,</p>
<p>539<br>00:24:30,719 –&gt; 00:24:34,759<br>just in multiple ReducedTask, multiple MapTask,</p>
<p>540<br>00:24:34,759 –&gt; 00:24:37,199<br>and they link with the GFS like you.</p>
<p>541<br>00:24:37,199 –&gt; 00:24:40,359<br>And so it’s not a Linux file system.</p>
<p>542<br>00:24:40,359 –&gt; 00:24:41,959<br>This is not the file system you do</p>
<p>543<br>00:24:41,959 –&gt; 00:24:46,240<br>through whatever, edit your files or compile.</p>
<p>544<br>00:24:46,240 –&gt; 00:24:50,159<br>It is really intended as a special for the Gris file system</p>
<p>545<br>00:24:50,159 –&gt; 00:24:52,519<br>for these large computations.</p>
<p>546<br>00:24:53,919 –&gt; 00:24:56,119<br>And as I said before, again, our real goal, correct,</p>
<p>547<br>00:24:56,119 –&gt; 00:24:58,159<br>is to achieve that impressive number,</p>
<p>548<br>00:24:58,159 –&gt; 00:24:59,959<br>or like, you know, we want the number of megabytes,</p>
<p>549<br>00:24:59,959 –&gt; 00:25:01,919<br>you know, from a single disk times the number of machines</p>
<p>550<br>00:25:01,919 –&gt; 00:25:04,919<br>and single applications should be able to exploit that.</p>
<p>551<br>00:25:04,919 –&gt; 00:25:09,119<br>And so the way they arranged that is to have a master</p>
<p>552<br>00:25:09,119 –&gt; 00:25:12,279<br>that is basically in charge of actually no number things are.</p>
<p>553<br>00:25:12,279 –&gt; 00:25:14,119<br>And the client just periodically, you know,</p>
<p>554<br>00:25:14,119 –&gt; 00:25:17,679<br>talks to the master to, you know,</p>
<p>555<br>00:25:17,679 –&gt; 00:25:18,759<br>to retrieve information.</p>
<p>556<br>00:25:18,759 –&gt; 00:25:20,839<br>So for example, it opens a file,</p>
<p>557<br>00:25:20,839 –&gt; 00:25:23,879<br>and the open call will result in a message, you know,</p>
<p>558<br>00:25:23,880 –&gt; 00:25:28,880<br>to the master and the master will respond back and say,</p>
<p>559<br>00:25:28,880 –&gt; 00:25:30,920<br>like all the four digital file name,</p>
<p>560<br>00:25:30,920 –&gt; 00:25:34,680<br>the chunks that you need are here,</p>
<p>561<br>00:25:34,680 –&gt; 00:25:36,640<br>or these are the chunks that you need.</p>
<p>562<br>00:25:36,640 –&gt; 00:25:38,360<br>And there’s a chunk handles,</p>
<p>563<br>00:25:38,360 –&gt; 00:25:40,000<br>and it’s identified for the particular chunks</p>
<p>564<br>00:25:40,000 –&gt; 00:25:41,800<br>that constitute a file.</p>
<p>565<br>00:25:41,800 –&gt; 00:25:45,160<br>And here are the servers that sure that chunk.</p>
<p>566<br>00:25:45,160 –&gt; 00:25:47,440<br>So you get back, you know, a chunk handle,</p>
<p>567<br>00:25:47,440 –&gt; 00:25:49,680<br>as well as, you know, a bunch of chunk locations.</p>
<p>568<br>00:25:50,720 –&gt; 00:25:52,280<br>And one file might, you know,</p>
<p>569<br>00:25:52,279 –&gt; 00:25:53,680<br>basically file consists, you know,</p>
<p>570<br>00:25:53,680 –&gt; 00:25:55,839<br>if you think about a big file,</p>
<p>571<br>00:25:55,839 –&gt; 00:25:57,559<br>it consists of many, many chunks.</p>
<p>572<br>00:25:59,440 –&gt; 00:26:01,879<br>Chunk zero, chunk one,</p>
<p>573<br>00:26:01,879 –&gt; 00:26:03,720<br>chunk two, et cetera.</p>
<p>574<br>00:26:03,720 –&gt; 00:26:05,519<br>Jump three, blah, blah, blah.</p>
<p>575<br>00:26:05,519 –&gt; 00:26:06,599<br>Et cetera, et cetera.</p>
<p>576<br>00:26:06,599 –&gt; 00:26:09,799<br>Any check, chunk is pretty big, 64 megabytes.</p>
<p>577<br>00:26:12,119 –&gt; 00:26:13,639<br>Next one, really, the application wants to be,</p>
<p>578<br>00:26:13,639 –&gt; 00:26:15,039<br>you know, the second second,</p>
<p>579<br>00:26:15,039 –&gt; 00:26:18,839<br>second 64 megabyte goes through the divestances,</p>
<p>580<br>00:26:18,959 –&gt; 00:26:21,119<br>like hey, I wanna read, you know,</p>
<p>581<br>00:26:21,119 –&gt; 00:26:24,519<br>the second chunk, you know, of this particular file,</p>
<p>582<br>00:26:24,519 –&gt; 00:26:26,599<br>and then the div answer will answer back</p>
<p>583<br>00:26:26,599 –&gt; 00:26:28,959<br>with the handle for chunk one,</p>
<p>584<br>00:26:28,959 –&gt; 00:26:31,439<br>as well as the servers that actually hold chunk one.</p>
<p>585<br>00:26:33,599 –&gt; 00:26:37,159<br>And so in multiple applications might ask,</p>
<p>586<br>00:26:37,159 –&gt; 00:26:39,359<br>you know, for chunks from the same file,</p>
<p>587<br>00:26:39,359 –&gt; 00:26:41,679<br>and they will get, you know,</p>
<p>588<br>00:26:41,679 –&gt; 00:26:44,000<br>we’ve got one application might be reading chunk zero,</p>
<p>589<br>00:26:44,000 –&gt; 00:26:46,240<br>another application might be already at chunk two,</p>
<p>590<br>00:26:46,240 –&gt; 00:26:47,920<br>then we’ll get different lists back</p>
<p>591<br>00:26:47,920 –&gt; 00:26:49,120<br>for each of these chunks.</p>
<p>592<br>00:26:50,519 –&gt; 00:26:51,799<br>So then the GFS client, you know,</p>
<p>593<br>00:26:51,799 –&gt; 00:26:53,720<br>wants to know some chunks from chunk locations,</p>
<p>594<br>00:26:53,720 –&gt; 00:26:56,440<br>and basically straight talks to the chunk servers.</p>
<p>595<br>00:26:58,240 –&gt; 00:27:02,000<br>And you know, basically read, you know, the data,</p>
<p>596<br>00:27:02,000 –&gt; 00:27:04,319<br>you know, at the speed of the network,</p>
<p>597<br>00:27:04,319 –&gt; 00:27:05,960<br>and you know, maybe whatever disk, you know,</p>
<p>598<br>00:27:05,960 –&gt; 00:27:08,519<br>that sits behind this particular chunk server,</p>
<p>599<br>00:27:08,519 –&gt; 00:27:10,559<br>directly to the application.</p>
<p>600<br>00:27:10,559 –&gt; 00:27:12,799<br>And here you can see where we’re gonna get the big win,</p>
<p>601<br>00:27:12,799 –&gt; 00:27:14,720<br>right, because we’re gonna be able to read, you know,</p>
<p>602<br>00:27:14,720 –&gt; 00:27:17,440<br>for multiple, you know, multiple clients</p>
<p>603<br>00:27:17,440 –&gt; 00:27:19,920<br>can be reading for multiple disks at the same time,</p>
<p>604<br>00:27:19,920 –&gt; 00:27:22,480<br>and we’re gonna get like tremendous amount of performance,</p>
<p>605<br>00:27:22,480 –&gt; 00:27:25,839<br>right, so for example, you’d like to use a map task running,</p>
<p>606<br>00:27:25,839 –&gt; 00:27:27,480<br>use another map task running,</p>
<p>607<br>00:27:27,480 –&gt; 00:27:29,200<br>and also use a client, you know,</p>
<p>608<br>00:27:29,200 –&gt; 00:27:31,759<br>they, you know, are all gonna be talking to the set of servers,</p>
<p>609<br>00:27:31,759 –&gt; 00:27:32,880<br>you know, that whole, you know,</p>
<p>610<br>00:27:32,880 –&gt; 00:27:35,160<br>the chunks of all the collection, the data set,</p>
<p>611<br>00:27:35,160 –&gt; 00:27:36,880<br>and this is gonna read in parallel</p>
<p>612<br>00:27:36,880 –&gt; 00:27:39,319<br>from all those different chunks here.</p>
<p>613<br>00:27:39,319 –&gt; 00:27:43,360<br>And that’s gonna give us like the high throughput number.</p>
<p>614<br>00:27:45,200 –&gt; 00:27:46,039<br>Does that make sense?</p>
<p>615<br>00:27:46,039 –&gt; 00:27:48,120<br>Does that sort of be overall plan clear here?</p>
<p>616<br>00:27:52,720 –&gt; 00:27:54,960<br>Just to use, sort of completed, like,</p>
<p>617<br>00:27:54,960 –&gt; 00:27:57,240<br>the chunk server is nothing really else,</p>
<p>618<br>00:27:57,240 –&gt; 00:27:58,920<br>and it’s sort of a Linux box,</p>
<p>619<br>00:27:58,920 –&gt; 00:28:01,360<br>you know, Linux computer with, you know, disk dudes,</p>
<p>620<br>00:28:01,360 –&gt; 00:28:03,440<br>and in fact, the 64 megabyte chunk,</p>
<p>621<br>00:28:03,440 –&gt; 00:28:06,839<br>each store there’s a Linux file in the Linux file system.</p>
<p>622<br>00:28:07,839 –&gt; 00:28:08,680<br>Not good?</p>
<p>623<br>00:28:12,200 –&gt; 00:28:14,559<br>Okay, so I wanna zoom in on the different pieces,</p>
<p>624<br>00:28:14,559 –&gt; 00:28:16,039<br>and I’ll start with the master,</p>
<p>625<br>00:28:16,039 –&gt; 00:28:20,879<br>because masters are really the control center around here.</p>
<p>626<br>00:28:20,879 –&gt; 00:28:22,919<br>So I’m talking a little bit about the state</p>
<p>627<br>00:28:22,919 –&gt; 00:28:24,480<br>that actually the master maintains.</p>
<p>628<br>00:28:29,480 –&gt; 00:28:32,480<br>Okay, so first of all, you know,</p>
<p>629<br>00:28:32,480 –&gt; 00:28:34,839<br>that has the mapping from filing</p>
<p>630<br>00:28:37,759 –&gt; 00:28:42,440<br>to an array of chunk handles.</p>
<p>631<br>00:28:44,559 –&gt; 00:28:49,559<br>And as you saw in the paper, one of the goals of actually</p>
<p>632<br>00:28:52,079 –&gt; 00:28:54,159<br>is to maintain all this memory</p>
<p>633<br>00:28:54,159 –&gt; 00:28:56,319<br>of most of the information actually directly available</p>
<p>634<br>00:28:56,319 –&gt; 00:28:59,079<br>in memory, so that the master can respond</p>
<p>635<br>00:28:59,079 –&gt; 00:29:00,960<br>to clients very quickly.</p>
<p>636<br>00:29:00,960 –&gt; 00:29:02,599<br>And the reason why in reason to do that is</p>
<p>637<br>00:29:02,599 –&gt; 00:29:05,720<br>because now there’s one master, many clients,</p>
<p>638<br>00:29:05,720 –&gt; 00:29:08,039<br>you wanna execute every client operation as efficient</p>
<p>639<br>00:29:08,039 –&gt; 00:29:10,200<br>as possible so that you can scale the master</p>
<p>640<br>00:29:10,200 –&gt; 00:29:12,319<br>to at least a reasonable number of clients.</p>
<p>641<br>00:29:13,319 –&gt; 00:29:15,559<br>And then for every chunk handle,</p>
<p>642<br>00:29:19,240 –&gt; 00:29:21,399<br>the master maintains some additional,</p>
<p>643<br>00:29:21,399 –&gt; 00:29:22,480<br>if you make it particular,</p>
<p>644<br>00:29:22,480 –&gt; 00:29:23,720<br>maintains a version number.</p>
<p>645<br>00:29:28,759 –&gt; 00:29:33,759<br>And then a list of chunk servers</p>
<p>646<br>00:29:35,119 –&gt; 00:29:38,119<br>that hold a copy of that chunk.</p>
<p>647<br>00:29:40,000 –&gt; 00:29:41,159<br>And as we’ll see in a second,</p>
<p>648<br>00:29:41,640 –&gt; 00:29:45,120<br>one of them is named one of those servers is a primary</p>
<p>649<br>00:29:46,120 –&gt; 00:29:48,040<br>and the other one’s on it to have secondaries.</p>
<p>650<br>00:29:50,360 –&gt; 00:29:53,320<br>And the typical number that a chunk of store tab</p>
<p>651<br>00:29:53,320 –&gt; 00:29:54,759<br>is a free search.</p>
<p>652<br>00:29:54,759 –&gt; 00:29:56,560<br>And we can maybe talk a little bit later about like,</p>
<p>653<br>00:29:56,560 –&gt; 00:29:58,160<br>why free?</p>
<p>654<br>00:29:58,160 –&gt; 00:30:02,360<br>And then there is a lease associated with each primary.</p>
<p>655<br>00:30:02,360 –&gt; 00:30:04,519<br>So there’s a lease time maintained as well.</p>
<p>656<br>00:30:06,200 –&gt; 00:30:10,040<br>Then there’s two sort of other big sort of storage components</p>
<p>657<br>00:30:10,039 –&gt; 00:30:13,000<br>and these are sort of the file system level things</p>
<p>658<br>00:30:13,000 –&gt; 00:30:14,799<br>and then the terms of implementation,</p>
<p>659<br>00:30:14,799 –&gt; 00:30:18,639<br>there is a log and there are checkpoints.</p>
<p>660<br>00:30:23,799 –&gt; 00:30:25,639<br>And since the master is the crucial</p>
<p>661<br>00:30:25,639 –&gt; 00:30:28,079<br>in the control center,</p>
<p>662<br>00:30:28,079 –&gt; 00:30:31,879<br>whenever there’s a change through the name space,</p>
<p>663<br>00:30:31,879 –&gt; 00:30:35,480<br>there’s generally created a new file in the GFS</p>
<p>664<br>00:30:35,480 –&gt; 00:30:39,519<br>where the mapping for filing into junk locks changes,</p>
<p>665<br>00:30:39,519 –&gt; 00:30:41,639<br>all those operations are written to this lock</p>
<p>666<br>00:30:41,639 –&gt; 00:30:44,480<br>and the lock sits on stable storage.</p>
<p>667<br>00:30:49,279 –&gt; 00:30:52,639<br>And the basic idea is that we were,</p>
<p>668<br>00:30:52,639 –&gt; 00:30:55,839<br>before we’re filing to decline that the change actually has been named</p>
<p>669<br>00:30:55,839 –&gt; 00:30:58,720<br>the master writes it to stable storage first</p>
<p>670<br>00:30:58,720 –&gt; 00:31:00,160<br>and then responds to decline.</p>
<p>671<br>00:31:00,160 –&gt; 00:31:04,119<br>And so this means that if the master fails or crashes,</p>
<p>672<br>00:31:04,119 –&gt; 00:31:06,920<br>then later comes back up and it can replay the lock</p>
<p>673<br>00:31:06,920 –&gt; 00:31:09,880<br>and reconstruct the state of its internal state.</p>
<p>674<br>00:31:10,960 –&gt; 00:31:13,400<br>And by writing it first to store it to the four</p>
<p>675<br>00:31:13,400 –&gt; 00:31:14,600<br>response to the client,</p>
<p>676<br>00:31:14,600 –&gt; 00:31:17,320<br>the client will never have jurisdiction results.</p>
<p>677<br>00:31:17,320 –&gt; 00:31:19,320<br>You could do the other way around correct</p>
<p>678<br>00:31:19,320 –&gt; 00:31:21,800<br>and that result in a problem because the client will think</p>
<p>679<br>00:31:21,800 –&gt; 00:31:23,640<br>that the file has be created, serve a crash,</p>
<p>680<br>00:31:23,640 –&gt; 00:31:26,360<br>it will be back up and then the file doesn’t exist.</p>
<p>681<br>00:31:26,360 –&gt; 00:31:30,200<br>So these are of another consistency point.</p>
<p>682<br>00:31:31,560 –&gt; 00:31:33,840<br>Now replaying always from all the operations</p>
<p>683<br>00:31:33,840 –&gt; 00:31:36,400<br>from the beginning of time to the log is of course undesirable</p>
<p>684<br>00:31:36,519 –&gt; 00:31:39,400<br>means that if the master crashes and we’re probably one of them</p>
<p>685<br>00:31:39,400 –&gt; 00:31:41,240<br>will be down for a long time.</p>
<p>686<br>00:31:41,240 –&gt; 00:31:42,440<br>So in this you do not,</p>
<p>687<br>00:31:42,440 –&gt; 00:31:45,400<br>it actually keeps checkpoints in stable storage.</p>
<p>688<br>00:31:47,360 –&gt; 00:31:50,400<br>So periodically the master makes a checkpoint</p>
<p>689<br>00:31:50,400 –&gt; 00:31:52,880<br>of its internal state and the mapping fulfillment</p>
<p>690<br>00:31:52,880 –&gt; 00:31:57,880<br>to re-chunk on those and stores that on stable storage.</p>
<p>691<br>00:31:58,960 –&gt; 00:32:01,680<br>And so then they only have to replay the last part</p>
<p>692<br>00:32:01,680 –&gt; 00:32:03,519<br>of basically all the operations in the log</p>
<p>693<br>00:32:03,519 –&gt; 00:32:05,080<br>after the last checkpoints.</p>
<p>694<br>00:32:05,079 –&gt; 00:32:06,559<br>So the recovery is actually quickly.</p>
<p>695<br>00:32:08,279 –&gt; 00:32:09,679<br>So there’s another couple of interesting questions</p>
<p>696<br>00:32:09,679 –&gt; 00:32:12,199<br>that we can ask ourselves like what state does need</p>
<p>697<br>00:32:12,199 –&gt; 00:32:15,279<br>to end up in stable storage for the master</p>
<p>698<br>00:32:15,279 –&gt; 00:32:17,240<br>to actually function correctly.</p>
<p>699<br>00:32:17,240 –&gt; 00:32:19,919<br>And so the first question to ask is how about this array</p>
<p>700<br>00:32:19,919 –&gt; 00:32:23,759<br>of chunk handles, the mapping for file name to chunk handles</p>
<p>701<br>00:32:23,759 –&gt; 00:32:26,399<br>was that need to be stable storage</p>
<p>702<br>00:32:27,399 –&gt; 00:32:28,919<br>or can it be only memory?</p>
<p>703<br>00:32:35,919 –&gt; 00:32:38,919<br>If the master crashes,</p>
<p>704<br>00:32:38,919 –&gt; 00:32:42,919<br>I think you can like get that information from the servers,</p>
<p>705<br>00:32:42,919 –&gt; 00:32:47,919<br>chunk servers, so maybe only main memory.</p>
<p>706<br>00:32:49,919 –&gt; 00:32:51,679<br>Yeah, well, let’s do some questions.</p>
<p>707<br>00:32:51,679 –&gt; 00:32:52,919<br>What other people think?</p>
<p>708<br>00:32:52,919 –&gt; 00:32:55,559<br>So it can be reconstructed from the log.</p>
<p>709<br>00:32:55,559 –&gt; 00:32:58,879<br>So when the server crashes, only the log needs to be</p>
<p>710<br>00:32:58,879 –&gt; 00:33:02,079<br>in the hard storage and then it can reload it</p>
<p>711<br>00:33:02,079 –&gt; 00:33:03,079<br>from the log.</p>
<p>712<br>00:33:03,079 –&gt; 00:33:05,079<br>So we read that there’s a rate of check homeless</p>
<p>713<br>00:33:05,079 –&gt; 00:33:07,079<br>basically has to be in stable storage.</p>
<p>714<br>00:33:11,079 –&gt; 00:33:13,079<br>Otherwise we lose, like we create a file</p>
<p>715<br>00:33:13,079 –&gt; 00:33:15,079<br>and we didn’t write the stable storage,</p>
<p>716<br>00:33:15,079 –&gt; 00:33:16,079<br>which is lose to file, right?</p>
<p>717<br>00:33:16,079 –&gt; 00:33:19,079<br>And so this mapping for file name to chunk handles</p>
<p>718<br>00:33:19,079 –&gt; 00:33:21,079<br>needs to be in stable storage.</p>
<p>719<br>00:33:21,079 –&gt; 00:33:25,079<br>How about this chunk handle to a list of chunk for our servers?</p>
<p>720<br>00:33:27,079 –&gt; 00:33:29,119<br>Is that actually the number of cases that we have</p>
<p>721<br>00:33:29,119 –&gt; 00:33:30,119<br>in the server?</p>
<p>722<br>00:33:31,119 –&gt; 00:33:33,119<br>Is that actually need to be in the log?</p>
<p>723<br>00:33:35,119 –&gt; 00:33:40,119<br>I think in the paper they say that when the master reboots,</p>
<p>724<br>00:33:41,119 –&gt; 00:33:46,119<br>it asks the servers to tell the master what the chunks</p>
<p>725<br>00:33:46,119 –&gt; 00:33:48,119<br>that they have are.</p>
<p>726<br>00:33:48,119 –&gt; 00:33:49,119<br>Yeah, great.</p>
<p>727<br>00:33:49,119 –&gt; 00:33:52,119<br>So this is not actually, this is basically just volatile state,</p>
<p>728<br>00:33:52,119 –&gt; 00:33:55,119<br>not stable storage.</p>
<p>729<br>00:33:55,119 –&gt; 00:33:59,119<br>So in the same is the true of the primary and the secondaries,</p>
<p>730<br>00:34:00,119 –&gt; 00:34:03,119<br>and two of the least time, how about the version number?</p>
<p>731<br>00:34:11,119 –&gt; 00:34:14,119<br>Is the master need to remember on stable storage</p>
<p>732<br>00:34:14,119 –&gt; 00:34:16,119<br>the version number or not?</p>
<p>733<br>00:34:16,119 –&gt; 00:34:22,119<br>Yes, because it needs to know if the chunks in the other servers</p>
<p>734<br>00:34:22,119 –&gt; 00:34:23,119<br>are scale or not.</p>
<p>735<br>00:34:23,119 –&gt; 00:34:24,119<br>Yeah, exactly.</p>
<p>736<br>00:34:24,119 –&gt; 00:34:25,119<br>Exactly.</p>
<p>737<br>00:34:25,119 –&gt; 00:34:26,119<br>Exactly right.</p>
<p>738<br>00:34:26,119 –&gt; 00:34:31,119<br>So the master must remember the version number because if it</p>
<p>739<br>00:34:31,119 –&gt; 00:34:36,119<br>doesn’t and like the whole system went down and the term servers came back up</p>
<p>740<br>00:34:36,119 –&gt; 00:34:40,119<br>and maybe the chunk server actually with the most recent data does not come up about</p>
<p>741<br>00:34:40,119 –&gt; 00:34:43,119<br>and older guy goes out with like version number 14,</p>
<p>742<br>00:34:43,119 –&gt; 00:34:46,119<br>then the master has to be able to tell that, you know, that chunk server</p>
<p>743<br>00:34:46,119 –&gt; 00:34:51,119<br>with version number 14 was not the most recent chunk server.</p>
<p>744<br>00:34:51,119 –&gt; 00:34:54,119<br>And so it needs to maintain, you know, the version number on disk</p>
<p>745<br>00:34:54,119 –&gt; 00:34:58,119<br>and the next one can tell which chunk server actually have the most updated information</p>
<p>746<br>00:34:58,119 –&gt; 00:35:00,119<br>and which ones don’t.</p>
<p>747<br>00:35:00,119 –&gt; 00:35:01,119<br>Okay.</p>
<p>748<br>00:35:01,119 –&gt; 00:35:03,119<br>I have a question here.</p>
<p>749<br>00:35:03,119 –&gt; 00:35:04,119<br>Yeah.</p>
<p>750<br>00:35:04,119 –&gt; 00:35:09,119<br>If, well, I mean, if the master failed and then it has to come up,</p>
<p>751<br>00:35:09,119 –&gt; 00:35:15,119<br>it’s anyway going to connect to all of the chunk servers and it will find out</p>
<p>752<br>00:35:15,119 –&gt; 00:35:18,119<br>what the largest version is.</p>
<p>753<br>00:35:18,119 –&gt; 00:35:20,119<br>Yeah, server right.</p>
<p>754<br>00:35:20,119 –&gt; 00:35:24,119<br>Does the ability to find out what the last, first of all,</p>
<p>755<br>00:35:24,119 –&gt; 00:35:26,119<br>will try to talk to all chunk servers, right?</p>
<p>756<br>00:35:26,119 –&gt; 00:35:28,119<br>And some chunk servers might be down.</p>
<p>757<br>00:35:28,119 –&gt; 00:35:29,119<br>Okay.</p>
<p>758<br>00:35:29,119 –&gt; 00:35:34,119<br>And that may be just the chunk server actually has the most recent version.</p>
<p>759<br>00:35:34,119 –&gt; 00:35:35,119<br>Yeah, okay.</p>
<p>760<br>00:35:35,119 –&gt; 00:35:46,119<br>So you can’t take the max of the life chunk servers that we incorrect.</p>
<p>761<br>00:35:46,119 –&gt; 00:35:52,119<br>And the other questions about this.</p>
<p>762<br>00:35:52,119 –&gt; 00:35:57,119<br>Okay, let’s look at the two major basic operations to really get down to consistency.</p>
<p>763<br>00:35:57,119 –&gt; 00:36:00,119<br>And of course, you know, that’s going to be reading and writing.</p>
<p>764<br>00:36:00,119 –&gt; 00:36:02,119<br>So reading a file.</p>
<p>765<br>00:36:02,119 –&gt; 00:36:04,119<br>And then we’ll talk about writing a file.</p>
<p>766<br>00:36:04,119 –&gt; 00:36:07,119<br>So reading file in some sense is straightforward.</p>
<p>767<br>00:36:07,119 –&gt; 00:36:11,119<br>We talked about it basically client, since message to.</p>
<p>768<br>00:36:11,119 –&gt; 00:36:14,119<br>With the file name plus offsets.</p>
<p>769<br>00:36:14,119 –&gt; 00:36:16,119<br>To the master.</p>
<p>770<br>00:36:16,119 –&gt; 00:36:20,119<br>And basically ask, you know, please give me, you know, the.</p>
<p>771<br>00:36:20,119 –&gt; 00:36:25,119<br>chunk servers and the chunk handle that.</p>
<p>772<br>00:36:25,119 –&gt; 00:36:30,119<br>That hold that hold the data at that offset.</p>
<p>773<br>00:36:30,119 –&gt; 00:36:33,119<br>And so it ends up the chunk handle.</p>
<p>774<br>00:36:33,119 –&gt; 00:36:37,119<br>So like I read by it, you know, whatever, zero, you know, it’s pretty clear.</p>
<p>775<br>00:36:37,119 –&gt; 00:36:43,119<br>Right, that has to be the first entry in the list, you know, from filing to.</p>
<p>776<br>00:36:43,119 –&gt; 00:36:46,119<br>To chunk handle.</p>
<p>777<br>00:36:46,119 –&gt; 00:36:51,119<br>So I am putting a master find to chunk handle basically replies, you know, with the.</p>
<p>778<br>00:36:51,119 –&gt; 00:36:57,119<br>Master replies to the client with, you know, the chunk handle.</p>
<p>779<br>00:36:57,119 –&gt; 00:37:01,119<br>And list of chunk servers.</p>
<p>780<br>00:37:01,119 –&gt; 00:37:03,119<br>For that.</p>
<p>781<br>00:37:03,119 –&gt; 00:37:09,119<br>For that handle in version of.</p>
<p>782<br>00:37:09,119 –&gt; 00:37:15,119<br>So basically the client gets back and message saying, you know, that’s chunk, you know, 221.</p>
<p>783<br>00:37:15,119 –&gt; 00:37:20,119<br>And here are the free machines with the IP address with the free machines that actually have it.</p>
<p>784<br>00:37:20,119 –&gt; 00:37:26,119<br>And the version number is like version of 10.</p>
<p>785<br>00:37:26,119 –&gt; 00:37:35,119<br>Then the client catches this list.</p>
<p>786<br>00:37:35,119 –&gt; 00:37:40,119<br>And then I basically sends a message to the closest.</p>
<p>787<br>00:37:40,119 –&gt; 00:37:45,119<br>Reach from closest.</p>
<p>788<br>00:37:45,119 –&gt; 00:37:52,119<br>Sure.</p>
<p>789<br>00:37:52,119 –&gt; 00:37:58,119<br>And so why does the client actually read cash this information.</p>
<p>790<br>00:37:58,119 –&gt; 00:38:01,119<br>We see later correct that actually costs some problems.</p>
<p>791<br>00:38:01,119 –&gt; 00:38:04,119<br>So it doesn’t have to contact the master for some time.</p>
<p>792<br>00:38:04,119 –&gt; 00:38:09,119<br>If it wants to read again or write to that.</p>
<p>793<br>00:38:09,119 –&gt; 00:38:12,119<br>Yeah, and why is that important.</p>
<p>794<br>00:38:12,119 –&gt; 00:38:16,119<br>To like reduce the, I guess, a traffic.</p>
<p>795<br>00:38:16,119 –&gt; 00:38:21,119<br>And in general, it takes less time if you have less communication with the master.</p>
<p>796<br>00:38:21,119 –&gt; 00:38:27,119<br>Yeah, and then you know, the same with aspect, correct, this design is that the master actually is a single machine.</p>
<p>797<br>00:38:27,119 –&gt; 00:38:32,119<br>And single machine can just ask a limit amount of memory and a limit of network interface.</p>
<p>798<br>00:38:32,119 –&gt; 00:38:36,119<br>And so you have too many clients talking to it, you know, we’ll be able to serve.</p>
<p>799<br>00:38:36,119 –&gt; 00:38:37,119<br>Right.</p>
<p>800<br>00:38:37,119 –&gt; 00:38:42,119<br>And so client cash was important to reduce the load of this single machine.</p>
<p>801<br>00:38:42,119 –&gt; 00:38:47,119<br>Okay, why read from the closest server.</p>
<p>802<br>00:38:47,119 –&gt; 00:38:49,119<br>Minimize network traffic.</p>
<p>803<br>00:38:49,119 –&gt; 00:38:50,119<br>Yeah, minimize network traffic.</p>
<p>804<br>00:38:50,119 –&gt; 00:38:56,119<br>Yeah, so the whole goal of right is to pump as much data, you know, to the client is possible of the highest throughput.</p>
<p>805<br>00:38:56,119 –&gt; 00:39:01,119<br>And, you know, we have to have to have to, you know, two problems that we have to cross with the data center network.</p>
<p>806<br>00:39:01,119 –&gt; 00:39:08,119<br>One, you know, there’s probably some topology and maybe swung like the top links of that apology.</p>
<p>807<br>00:39:08,119 –&gt; 00:39:13,119<br>And they actually increased latency, you know, to actually get to the other side.</p>
<p>808<br>00:39:13,119 –&gt; 00:39:25,119<br>Right. So it’s important to be able to read to the close site again to basically maximize, you know, the throughput, you know, that joint set of compliance, you know, can sort of experience from the reading and parallel from many, many chunk servers.</p>
<p>809<br>00:39:25,119 –&gt; 00:39:28,119<br>Okay.</p>
<p>810<br>00:39:28,119 –&gt; 00:39:35,119<br>So the chunk server, you know, S, you know, check the version number.</p>
<p>811<br>00:39:35,119 –&gt; 00:39:42,119<br>And the version numbers, okay, you know, then send data.</p>
<p>812<br>00:39:42,119 –&gt; 00:39:44,119<br>Okay.</p>
<p>813<br>00:39:44,119 –&gt; 00:39:50,119<br>Why is the check with the version number there?</p>
<p>814<br>00:39:50,119 –&gt; 00:39:53,119<br>The check if it’s to stay.</p>
<p>815<br>00:39:53,119 –&gt; 00:39:56,119<br>Yeah.</p>
<p>816<br>00:39:56,119 –&gt; 00:39:59,119<br>You know, we usually do our best to avoid reading scale data.</p>
<p>817<br>00:39:59,119 –&gt; 00:40:10,119<br>You know, as we’re seeing second, we don’t do, you know, do a perfect job at me, and we try hard to minimize, you know, the occurrences of the claims reading, scale data.</p>
<p>818<br>00:40:10,119 –&gt; 00:40:12,119<br>Okay.</p>
<p>819<br>00:40:12,119 –&gt; 00:40:15,119<br>That’s reading, reasonable straightforward.</p>
<p>820<br>00:40:15,119 –&gt; 00:40:19,119<br>So let’s look at the writing.</p>
<p>821<br>00:40:19,119 –&gt; 00:40:25,119<br>So this is the picture from the paper.</p>
<p>822<br>00:40:25,119 –&gt; 00:40:41,119<br>And so let’s say you climb once the, you know, let’s focus on the pen.</p>
<p>823<br>00:40:41,119 –&gt; 00:40:47,119<br>And so the, the argument that they’re common operation for them is to depend on a record to the file.</p>
<p>824<br>00:40:47,119 –&gt; 00:41:02,119<br>And can you see why you’re given what you guys know from, you know, sort of map deduces and, you know, Google, just that makes sense that why I’ve had to show important.</p>
<p>825<br>00:41:02,119 –&gt; 00:41:05,119<br>Because largely in doing map produce.</p>
<p>826<br>00:41:05,119 –&gt; 00:41:16,119<br>You need to, or as the map function spits out information, it’s largely just adding on information rather than changing previously spit out the operations.</p>
<p>827<br>00:41:16,119 –&gt; 00:41:17,119<br>Yeah.</p>
<p>828<br>00:41:17,119 –&gt; 00:41:23,119<br>Maybe the map is not the best example, but we’re going to write it to local file system, not to gfs, but the reducer does.</p>
<p>829<br>00:41:23,119 –&gt; 00:41:26,119<br>Same argument also the addition.</p>
<p>830<br>00:41:26,119 –&gt; 00:41:36,119<br>So we’re going to be in the work list that are writing is basically consume a lot of information and, you know, end records to the file with the result in competition with result of the competition.</p>
<p>831<br>00:41:36,119 –&gt; 00:41:37,119<br>Okay.</p>
<p>832<br>00:41:37,119 –&gt; 00:41:41,119<br>Good. So, you know, step one, you know, we have a client.</p>
<p>833<br>00:41:41,119 –&gt; 00:41:45,119<br>It will talk to the master to figure out like where to write.</p>
<p>834<br>00:41:45,119 –&gt; 00:41:57,119<br>And then the master looks in its, you know, table or the file main to chunk handles.</p>
<p>835<br>00:41:57,119 –&gt; 00:42:06,119<br>And find some of the chunk handles and then you know looks at this table of chunk, chunk handles.</p>
<p>836<br>00:42:06,119 –&gt; 00:42:08,119<br>To servers.</p>
<p>837<br>00:42:08,119 –&gt; 00:42:14,119<br>To find the list of servers that it has that half a particular thing that have that particular chunk.</p>
<p>838<br>00:42:14,119 –&gt; 00:42:16,119<br>Okay, so what happens next?</p>
<p>839<br>00:42:16,119 –&gt; 00:42:17,119<br>So there’s two cases.</p>
<p>840<br>00:42:17,119 –&gt; 00:42:23,119<br>When there is already a primary in the second case, the first case, well, the two cases, having a primary or not a crime.</p>
<p>841<br>00:42:23,119 –&gt; 00:42:31,119<br>So let’s say this is the very first time that this particular client contacts the master for this particular chunk nobody else has done it so far.</p>
<p>842<br>00:42:31,119 –&gt; 00:42:32,119<br>So there’s no primary.</p>
<p>843<br>00:42:32,119 –&gt; 00:42:40,119<br>So that case, you know, we need to do the master needs to pick a primary, right? How does it do that?</p>
<p>844<br>00:42:40,119 –&gt; 00:42:45,119<br>I think the master just picks any of the available chunk servers, right?</p>
<p>845<br>00:42:45,119 –&gt; 00:42:46,119<br>Yep.</p>
<p>846<br>00:42:46,119 –&gt; 00:42:51,119<br>So pick one. So pick one of those primary and the other ones are the secondary.</p>
<p>847<br>00:42:51,119 –&gt; 00:42:54,119<br>What other steps are involved in this sort of.</p>
<p>848<br>00:42:54,119 –&gt; 00:42:58,119<br>Yeah, and then subsequently the master grants a lease.</p>
<p>849<br>00:42:58,119 –&gt; 00:43:04,119<br>To that primary and that lease has a certain like a date of expiry.</p>
<p>850<br>00:43:04,119 –&gt; 00:43:10,119<br>Yeah, what else does it have? One more other piece of crucial information.</p>
<p>851<br>00:43:10,119 –&gt; 00:43:12,119<br>Even.</p>
<p>852<br>00:43:12,119 –&gt; 00:43:14,119<br>It increments the version number.</p>
<p>853<br>00:43:14,119 –&gt; 00:43:15,119<br>Yeah, increment.</p>
<p>854<br>00:43:15,119 –&gt; 00:43:19,119<br>Oh, yeah, step one is increment the version number.</p>
<p>855<br>00:43:19,119 –&gt; 00:43:29,119<br>Because you’re going to make a new primary and whenever time you make a new primary, you go to like one of a think about this like a new epoch in the end of the file system.</p>
<p>856<br>00:43:29,119 –&gt; 00:43:35,119<br>This particular file is you create the version of you can have a new mutator.</p>
<p>857<br>00:43:35,119 –&gt; 00:43:38,119<br>So basically the master increases the version number.</p>
<p>858<br>00:43:38,119 –&gt; 00:43:48,119<br>Yeah, it sends to the primary, the new version over in the secondaries and saying like, hey guys, we’re going to start a new.</p>
<p>859<br>00:43:48,119 –&gt; 00:43:49,119<br>We understood a new mutation.</p>
<p>860<br>00:43:49,119 –&gt; 00:43:57,119<br>You guys are forming a replica group and your replica group with this particular version of whatever version number 12.</p>
<p>861<br>00:43:57,119 –&gt; 00:44:07,119<br>And the primary is in the second there’s stored a version of what to do is they store that version number.</p>
<p>862<br>00:44:07,119 –&gt; 00:44:16,119<br>They sort of down disk on their disks were in memory or.</p>
<p>863<br>00:44:16,119 –&gt; 00:44:19,119<br>I don’t know.</p>
<p>864<br>00:44:19,119 –&gt; 00:44:22,119<br>What do we, what do we think?</p>
<p>865<br>00:44:22,119 –&gt; 00:44:24,119<br>Okay, let’s first do memory.</p>
<p>866<br>00:44:24,119 –&gt; 00:44:29,119<br>Let’s say it’s the storage of the memory would that be good design?</p>
<p>867<br>00:44:29,119 –&gt; 00:44:32,119<br>No, sorry.</p>
<p>868<br>00:44:32,119 –&gt; 00:44:39,119<br>You know, I guess it wouldn’t because if the chance server goes down and then it comes back up, it.</p>
<p>869<br>00:44:39,119 –&gt; 00:44:41,119<br>It should know what version it has.</p>
<p>870<br>00:44:41,119 –&gt; 00:44:48,119<br>Yeah, because otherwise it couldn’t convince the primary that it has the most recent one right otherwise the prime of the short of the master could pick the chart with the most recent data.</p>
<p>871<br>00:44:48,119 –&gt; 00:44:58,119<br>So it has to be on this. So basically this version number lives on this bove at the chunk servers and at master.</p>
<p>872<br>00:44:58,119 –&gt; 00:45:05,119<br>So when the chunch when the master gets back, you know, the acknowledgements from the primary and the secondary that they.</p>
<p>873<br>00:45:05,119 –&gt; 00:45:17,119<br>Written the version number to a disk and that the primary actually has received the least, then you know the master also think rights its version number to disk and then response to the client.</p>
<p>874<br>00:45:17,119 –&gt; 00:45:20,119<br>Okay.</p>
<p>875<br>00:45:20,119 –&gt; 00:45:30,119<br>So to back to the client that responds with the list of servers, then it’s primary plus the secondaries plus the version number.</p>
<p>876<br>00:45:30,119 –&gt; 00:45:32,119<br>Okay.</p>
<p>877<br>00:45:32,119 –&gt; 00:45:44,119<br>Then you know the next step and again here we see the whole goal is to fight a lot of data through the network is the client actually just sends the data that wants right to the primary and the secondaries.</p>
<p>878<br>00:45:44,119 –&gt; 00:45:53,119<br>And the way it actually does it is sort of an interesting way and basically context the closest secondary knows of, you know, out of this list and since the data there.</p>
<p>879<br>00:45:53,119 –&gt; 00:46:01,119<br>And that secondary you know move the data over to the next, you know, personally, the list and then to the next server in the list.</p>
<p>880<br>00:46:01,119 –&gt; 00:46:08,119<br>And so this way, you know, the data sort of pumped, you know, from the client, you know, to the pipeline to all the replicas.</p>
<p>881<br>00:46:08,119 –&gt; 00:46:17,119<br>And you know, and you know, when the secondary receives the first secondary receives some of the data immediately starts actually pushing the data to the further down the pipeline.</p>
<p>882<br>00:46:17,119 –&gt; 00:46:19,119<br>Okay.</p>
<p>883<br>00:46:19,119 –&gt; 00:46:29,119<br>The reason that this design is this way, you sort of basically this network interface that the client has to go through the outside world usually use this is a full network interface to push the data down the pipeline.</p>
<p>884<br>00:46:29,119 –&gt; 00:46:32,119<br>So this is high throughput.</p>
<p>885<br>00:46:32,119 –&gt; 00:46:35,119<br>Okay.</p>
<p>886<br>00:46:35,119 –&gt; 00:46:48,119<br>And you know, if this is all successful and the data has been pushed to all the servers, those servers don’t store that information on this yet, you know, just sits there, you know, sort of on the site, you know, to be used in the next step.</p>
<p>887<br>00:46:48,119 –&gt; 00:47:02,119<br>And so the next step is basically for the client to send a message like an append message to the primary and at that point, you know, the primary will check, you know, the version number right.</p>
<p>888<br>00:47:02,119 –&gt; 00:47:10,119<br>Or actually version of corresponds to the version number and if it doesn’t, you know, respond to each day, no match, and then the primary won’t allow it.</p>
<p>889<br>00:47:10,119 –&gt; 00:47:13,119<br>The primary checks is lease is the leases valid.</p>
<p>890<br>00:47:13,119 –&gt; 00:47:23,119<br>Because the lease is not valid anymore, it cannot accept any rotation operations because it is leases not valid, there might be another primary now outside in the world.</p>
<p>891<br>00:47:23,119 –&gt; 00:47:34,119<br>So it checks the lease and then if you know, basically the version of the match, the leases still valid and basically picks an offset to write it.</p>
<p>892<br>00:47:34,119 –&gt; 00:47:41,119<br>And then the next step is basically write, you know, the data that just came in, you know, this record to stable storage.</p>
<p>893<br>00:47:41,119 –&gt; 00:47:46,119<br>So the primary actually at this point, writes it to stable storage to data.</p>
<p>894<br>00:47:46,119 –&gt; 00:47:51,119<br>And then sends messages to the secondary, saying, please write the data to.</p>
<p>895<br>00:47:51,119 –&gt; 00:48:00,119<br>And since the primary picks the offsets, you know, the it tells the second there’s word right, you know, that particular record into the file.</p>
<p>896<br>00:48:00,119 –&gt; 00:48:12,119<br>So maybe like whatever it picks the offset, you know, 125 and it will tell the secondary, you know, all to write, you know, the data that came in earlier at cost at 125.</p>
<p>897<br>00:48:12,119 –&gt; 00:48:28,119<br>And then, you know, if everything works out, you know, everybody, all the second areas and the primary successfully write their data back, you know, to this and actually responds back to the client saying like, OK, success, your appendix really has happened.</p>
<p>898<br>00:48:28,119 –&gt; 00:48:36,119<br>And the way the, the right actually might be not successful or it might not be successful and namely, for example, the primary is written through its own disk.</p>
<p>899<br>00:48:36,119 –&gt; 00:48:46,119<br>But it fails to write it, you know, it fails to connect to one of the secondary, maybe the secondary actually crashed or maybe the secondary just has a network connection that doesn’t work.</p>
<p>900<br>00:48:46,119 –&gt; 00:48:59,119<br>And in that case, the primary actually returns an error to the client. So error if one secondary didn’t respond.</p>
<p>901<br>00:48:59,119 –&gt; 00:49:22,119<br>And in that case, the client library, one of will do is usually try a retry. It will reissue the same append and we’ll try again in the hope that the second time around, you know, that data actually wants to get through.</p>
<p>902<br>00:49:22,119 –&gt; 00:49:31,119<br>And so this is what they recall, like you do the least once.</p>
<p>903<br>00:49:31,119 –&gt; 00:49:37,119<br>If you retry, will the primary pick the same offset.</p>
<p>904<br>00:49:37,119 –&gt; 00:49:38,119<br>I don’t think so.</p>
<p>905<br>00:49:38,119 –&gt; 00:49:39,119<br>No, no, right.</p>
<p>906<br>00:49:39,119 –&gt; 00:49:53,119<br>And you write the, and write it at the disk, new particular offset. And so that means, right, if you look at sort of the disk of the, you know, the file on the free replica.</p>
<p>907<br>00:49:53,119 –&gt; 00:50:07,119<br>And the primary S1 and S2, it might be the case of the new roots, like, you know, at 125, the data, we succeeded maybe in S212, but S2 actually doesn’t have no data.</p>
<p>908<br>00:50:07,119 –&gt; 00:50:15,119<br>Right. And then we retry again, then we might write the same data to X and maybe we’ll succeed in all three.</p>
<p>909<br>00:50:15,119 –&gt; 00:50:21,119<br>So you see here that basically replicate records can be duplicated.</p>
<p>910<br>00:50:21,119 –&gt; 00:50:32,119<br>Is this something that can happen in a standard file system, like your Linux file system or your laptop for your computer.</p>
<p>911<br>00:50:32,119 –&gt; 00:50:40,119<br>No, no, would it be surprised if this computer did this.</p>
<p>912<br>00:50:40,119 –&gt; 00:50:43,119<br>I mean, yeah, this is not how standard file rates work.</p>
<p>913<br>00:50:43,119 –&gt; 00:50:53,119<br>Yeah, and it would be inconvenient to have this property or is like, doesn’t matter.</p>
<p>914<br>00:50:53,119 –&gt; 00:50:56,119<br>I think it would be nice.</p>
<p>915<br>00:50:56,119 –&gt; 00:51:02,119<br>Yeah, you know, you pretty bizarre, like, you know, presumably, like, you know, you could buy or you know, produce out boots in a file.</p>
<p>916<br>00:51:02,119 –&gt; 00:51:07,119<br>And then maybe, you know, certain blocks are written twice. And then you can’t run the program anymore.</p>
<p>917<br>00:51:07,119 –&gt; 00:51:11,119<br>Like, you know, the whole thing is just garbage at that point.</p>
<p>918<br>00:51:11,119 –&gt; 00:51:17,119<br>So it would just be weird, but like you’re writing email message and basically the body of the email message shows your players.</p>
<p>919<br>00:51:17,119 –&gt; 00:51:22,119<br>This is not what you typical files system would do. And so this is like a slightly bizarre.</p>
<p>920<br>00:51:22,119 –&gt; 00:51:30,119<br>And you know, what is the justification? Why, why, why do you think this is a good idea?</p>
<p>921<br>00:51:30,119 –&gt; 00:51:35,119<br>I’m not sure what’s the secret idea, but I’m confused how that works for a map produced specifically.</p>
<p>922<br>00:51:35,119 –&gt; 00:51:48,119<br>So if you run word count and you do that and like some files and you count, and they’re like word A, it shows up once, but you do it twice because something failed.</p>
<p>923<br>00:51:48,119 –&gt; 00:51:52,119<br>And now you have a one a one. So your account is going to be wrong.</p>
<p>924<br>00:51:52,119 –&gt; 00:51:55,119<br>How, how do yeah, I’m confused.</p>
<p>925<br>00:51:55,119 –&gt; 00:52:08,119<br>Yes, what do they work and seems like you don’t do anything. Then this is really highly inconvenient or like, so it returns the application will complete the wrong result.</p>
<p>926<br>00:52:08,119 –&gt; 00:52:16,119<br>They said, the use check some and unique ideas to check, you know, that every.</p>
<p>927<br>00:52:16,119 –&gt; 00:52:20,119<br>Yeah, every record was like one.</p>
<p>928<br>00:52:20,119 –&gt; 00:52:36,119<br>Additionally, when you do record append the response, which is returned from the primary to the client gives you the offset into the file where your data was actually written and the rest of it is assumed to be like undefined.</p>
<p>929<br>00:52:36,119 –&gt; 00:52:49,119<br>Yeah, I think the key point here, correct is like the basically the application doesn’t interact with the files directly interacts with your official library and the library basically if you write append records, the library sticks an idea in it.</p>
<p>930<br>00:52:49,119 –&gt; 00:52:59,119<br>And so, and also you lose the library to read these records. And so you see a record that the same idea, you know, you skip the second one because it’s clearly the same one.</p>
<p>931<br>00:52:59,119 –&gt; 00:53:05,119<br>And, you know, they have a double extra thing and therefore check some to make sure that the record didn’t get garbled.</p>
<p>932<br>00:53:05,119 –&gt; 00:53:13,119<br>And basically to detect the changes in the bytes, but the idea basically helps them to site.</p>
<p>933<br>00:53:13,119 –&gt; 00:53:19,119<br>Or allows the library to decide, well, this is the same record, I’m just not going to get to the application.</p>
<p>934<br>00:53:19,119 –&gt; 00:53:22,119<br>Or the applications need to process it.</p>
<p>935<br>00:53:22,119 –&gt; 00:53:24,119<br>Okay.</p>
<p>936<br>00:53:24,119 –&gt; 00:53:35,119<br>So my question is instead of rewriting to every replica, we’re going to be better to remember which replica is failing and to stop until it can be returned to that one.</p>
<p>937<br>00:53:35,119 –&gt; 00:53:42,119<br>Yeah, there’s a bunch of different designs possible when you let’s return to that later.</p>
<p>938<br>00:53:42,119 –&gt; 00:53:52,119<br>And I think one reason that they do this this way is like if there’s a pray, you know, temporary failure, like a network disconnection or whatever, you know, the least the right will succeed and they will continue.</p>
<p>939<br>00:53:52,119 –&gt; 00:53:59,119<br>And just have to be any reconfiguration and the rest of the nothing, you know, the right can just keep going.</p>
<p>940<br>00:53:59,119 –&gt; 00:54:03,119<br>Right. And so the right doesn’t have to fail.</p>
<p>941<br>00:54:03,119 –&gt; 00:54:05,119<br>Okay.</p>
<p>942<br>00:54:05,119 –&gt; 00:54:13,119<br>So the question in general, the all of these servers are trusted, right?</p>
<p>943<br>00:54:13,119 –&gt; 00:54:14,119<br>Yes.</p>
<p>944<br>00:54:14,119 –&gt; 00:54:15,119<br>Absolutely.</p>
<p>945<br>00:54:15,119 –&gt; 00:54:16,119<br>This is actually an important point.</p>
<p>946<br>00:54:16,119 –&gt; 00:54:23,119<br>This is not like, you know, your Linux file system where there’s permissions and access control rights and all that kind of stuff.</p>
<p>947<br>00:54:23,119 –&gt; 00:54:25,119<br>These servers are completely trusted.</p>
<p>948<br>00:54:25,119 –&gt; 00:54:32,119<br>The clients are trusted, the master’s trusted, the software written by Google is structured. The whole thing is trusted.</p>
<p>949<br>00:54:32,119 –&gt; 00:54:35,119<br>And then you can see the internal file system.</p>
<p>950<br>00:54:35,119 –&gt; 00:54:37,119<br>In fact, they’re just sort of cool.</p>
<p>951<br>00:54:37,119 –&gt; 00:54:42,119<br>It’s like a little bit maybe surprising that we even know about this file system in search of on detail, right?</p>
<p>952<br>00:54:42,119 –&gt; 00:54:49,119<br>Because some of the things I Google and one of the cool things is that you know that period of time and still they do.</p>
<p>953<br>00:54:49,119 –&gt; 00:54:52,119<br>They wrote up the papers and describing actually how the system worked.</p>
<p>954<br>00:54:52,119 –&gt; 00:54:54,119<br>And there’s one reason we can we know that.</p>
<p>955<br>00:54:54,119 –&gt; 00:54:59,119<br>And that’s extremely cool that they did that.</p>
<p>956<br>00:54:59,119 –&gt; 00:55:01,119<br>Okay.</p>
<p>957<br>00:55:01,119 –&gt; 00:55:04,119<br>So, okay, so we don’t understand how read works.</p>
<p>958<br>00:55:04,119 –&gt; 00:55:05,119<br>We understand that right works.</p>
<p>959<br>00:55:05,119 –&gt; 00:55:08,119<br>You know, there’s some sort of interesting.</p>
<p>960<br>00:55:08,119 –&gt; 00:55:09,119<br>The havers.</p>
<p>961<br>00:55:09,119 –&gt; 00:55:13,119<br>Now, I want to talk a little bit more about the consistency correct. And that really comes down to.</p>
<p>962<br>00:55:13,119 –&gt; 00:55:15,119<br>I get a.</p>
<p>963<br>00:55:15,119 –&gt; 00:55:18,119<br>What those read of jurors after you know, you did a depend.</p>
<p>964<br>00:55:18,119 –&gt; 00:55:21,119<br>And you know, the homework question.</p>
<p>965<br>00:55:21,119 –&gt; 00:55:22,119<br>We got it to this.</p>
<p>966<br>00:55:22,119 –&gt; 00:55:26,119<br>And so whatever I like to do now is I take a quick break out like five minutes.</p>
<p>967<br>00:55:26,119 –&gt; 00:55:34,119<br>And so we can discuss the answer to this question and then come back and talk a little bit more in detail with consistency.</p>
<p>968<br>00:55:34,119 –&gt; 00:55:36,119<br>Okay.</p>
<p>969<br>00:55:36,119 –&gt; 00:55:40,119<br>So I’m going to.</p>
<p>970<br>00:55:40,119 –&gt; 00:55:43,119<br>Make really.</p>
<p>971<br>00:55:43,119 –&gt; 00:55:44,119<br>Okay.</p>
<p>972<br>00:55:44,119 –&gt; 00:55:46,119<br>Everybody back.</p>
<p>973<br>00:55:46,119 –&gt; 00:55:49,119<br>Everybody can you make double checking.</p>
<p>974<br>00:55:49,119 –&gt; 00:55:50,119<br>Yeah, I hate to ask a question.</p>
<p>975<br>00:55:50,119 –&gt; 00:55:55,119<br>And then you can go back to this slide with the.</p>
<p>976<br>00:55:55,119 –&gt; 00:55:57,119<br>When we talked about the right side here.</p>
<p>977<br>00:55:57,119 –&gt; 00:56:03,119<br>So you mentioned the master responds to the client with the version number.</p>
<p>978<br>00:56:03,119 –&gt; 00:56:06,119<br>And if that is the keys, then is it possible?</p>
<p>979<br>00:56:06,119 –&gt; 00:56:08,119<br>Is it even possible?</p>
<p>980<br>00:56:08,119 –&gt; 00:56:14,119<br>Would it even have to be like his say data because the client has a version number and the chunk servers without the version number.</p>
<p>981<br>00:56:14,119 –&gt; 00:56:16,119<br>So they can just compare those.</p>
<p>982<br>00:56:16,119 –&gt; 00:56:18,119<br>If they don’t match the cloud that.</p>
<p>983<br>00:56:18,119 –&gt; 00:56:19,119<br>The chunks are chunks of chunks.</p>
<p>984<br>00:56:19,119 –&gt; 00:56:23,119<br>Errors can just say I have a stability at so.</p>
<p>985<br>00:56:23,119 –&gt; 00:56:25,119<br>You should not read this.</p>
<p>986<br>00:56:25,119 –&gt; 00:56:26,119<br>Okay.</p>
<p>987<br>00:56:26,119 –&gt; 00:56:27,119<br>Let’s go for the snare.</p>
<p>988<br>00:56:27,119 –&gt; 00:56:28,119<br>A little bit more detail.</p>
<p>989<br>00:56:28,119 –&gt; 00:56:29,119<br>We actually did this.</p>
<p>990<br>00:56:29,119 –&gt; 00:56:36,119<br>Well, no.</p>
<p>991<br>00:56:36,119 –&gt; 00:56:37,119<br>Okay. Let’s talk about it.</p>
<p>992<br>00:56:37,119 –&gt; 00:56:39,119<br>So I think the snare that we’re talking about.</p>
<p>993<br>00:56:39,119 –&gt; 00:56:42,119<br>That leads into a problematic situation follows.</p>
<p>994<br>00:56:42,119 –&gt; 00:56:44,119<br>We have a primary.</p>
<p>995<br>00:56:44,119 –&gt; 00:56:46,119<br>We have a secondary to second.</p>
<p>996<br>00:56:46,119 –&gt; 00:56:47,119<br>Secondary.</p>
<p>997<br>00:56:47,119 –&gt; 00:56:50,119<br>One. Secondary to you.</p>
<p>998<br>00:56:50,119 –&gt; 00:56:52,119<br>We have a client at this site.</p>
<p>999<br>00:56:52,119 –&gt; 00:56:55,119<br>We have a primary.</p>
<p>1000<br>00:56:55,119 –&gt; 00:56:56,119<br>The client reached.</p>
<p>1001<br>00:56:56,119 –&gt; 00:57:04,119<br>You know, it’s back like a version of her say 10.</p>
<p>1002<br>00:57:04,119 –&gt; 00:57:11,119<br>The later on, you know, the other primary will.</p>
<p>1003<br>00:57:11,119 –&gt; 00:57:17,119<br>So.</p>
<p>1004<br>00:57:17,119 –&gt; 00:57:18,119<br>Okay. So S2.</p>
<p>1005<br>00:57:18,119 –&gt; 00:57:20,119<br>It gets some servers.</p>
<p>1006<br>00:57:20,119 –&gt; 00:57:22,119<br>Then it’s on point.</p>
<p>1007<br>00:57:22,119 –&gt; 00:57:26,119<br>It’s a disinformation is cash.</p>
<p>1008<br>00:57:26,119 –&gt; 00:57:29,119<br>On the site, you know, maybe the.</p>
<p>1009<br>00:57:29,119 –&gt; 00:57:33,119<br>One of the thing as secondary is like S2 crashes.</p>
<p>1010<br>00:57:33,119 –&gt; 00:57:37,119<br>Or it appears to be disconnected from the network.</p>
<p>1011<br>00:57:37,119 –&gt; 00:57:40,119<br>So what the master will do is increment the version numbers.</p>
<p>1012<br>00:57:40,119 –&gt; 00:57:46,119<br>So that’s a number of.</p>
<p>1013<br>00:57:46,119 –&gt; 00:57:54,119<br>So that’s.</p>
<p>1014<br>00:57:54,119 –&gt; 00:57:56,119<br>That’s a number of 11.</p>
<p>1015<br>00:57:56,119 –&gt; 00:57:58,119<br>It’s a message used 11 11.</p>
<p>1016<br>00:57:58,119 –&gt; 00:58:01,119<br>And then, you know, another client may come wrong and start writing.</p>
<p>1017<br>00:58:01,119 –&gt; 00:58:02,119<br>So, you know, right.</p>
<p>1018<br>00:58:02,119 –&gt; 00:58:04,119<br>In a new value to S1 and S2.</p>
<p>1019<br>00:58:04,119 –&gt; 00:58:05,119<br>For the file.</p>
<p>1020<br>00:58:05,119 –&gt; 00:58:07,119<br>So the chunk has now been updated.</p>
<p>1021<br>00:58:07,119 –&gt; 00:58:09,119<br>And there are two.</p>
<p>1022<br>00:58:09,119 –&gt; 00:58:10,119<br>But the second client.</p>
<p>1023<br>00:58:10,119 –&gt; 00:58:15,119<br>The first client can still talk to the secondary and it will read the version numbers match.</p>
<p>1024<br>00:58:15,119 –&gt; 00:58:16,119<br>Right.</p>
<p>1025<br>00:58:16,119 –&gt; 00:58:17,119<br>They’re both 10.</p>
<p>1026<br>00:58:17,119 –&gt; 00:58:18,119<br>And it will read.</p>
<p>1027<br>00:58:18,119 –&gt; 00:58:22,119<br>And we’ll send 10 back.</p>
<p>1028<br>00:58:22,119 –&gt; 00:58:26,119<br>Right. So here we have the case where the right has completed.</p>
<p>1029<br>00:58:26,119 –&gt; 00:58:28,119<br>And it’s acknowledged to be okay.</p>
<p>1030<br>00:58:28,119 –&gt; 00:58:32,119<br>And nevertheless there’s a client that actually will read to still value back.</p>
<p>1031<br>00:58:32,119 –&gt; 00:58:35,119<br>So why doesn’t that 11 go back to the client?</p>
<p>1032<br>00:58:35,119 –&gt; 00:58:38,119<br>The first client.</p>
<p>1033<br>00:58:38,119 –&gt; 00:58:43,119<br>The reason is because the first client passes it for a longer period of time.</p>
<p>1034<br>00:58:43,119 –&gt; 00:58:50,119<br>I mean, they know actually have anything to protocol that actually dust.</p>
<p>1035<br>00:58:50,119 –&gt; 00:58:54,119<br>So does the version increments when the.</p>
<p>1036<br>00:58:54,119 –&gt; 00:58:57,119<br>When the system tries to push an update to S2.</p>
<p>1037<br>00:58:57,119 –&gt; 00:59:00,119<br>And it’s not able to or.</p>
<p>1038<br>00:59:00,119 –&gt; 00:59:04,119<br>And so there’s only increment the version numbers maintained by the master.</p>
<p>1039<br>00:59:04,119 –&gt; 00:59:13,119<br>Only increment when you select a new primary.</p>
<p>1040<br>00:59:13,119 –&gt; 00:59:14,119<br>Not when you do it.</p>
<p>1041<br>00:59:14,119 –&gt; 00:59:17,119<br>There’s an also serial number that they talk about.</p>
<p>1042<br>00:59:17,119 –&gt; 00:59:23,119<br>But that’s different from the version or that’s just order, you know, the rights.</p>
<p>1043<br>00:59:23,119 –&gt; 00:59:24,119<br>Okay.</p>
<p>1044<br>00:59:24,119 –&gt; 00:59:32,119<br>So how does the primary know which secondary is asked to check with before making before completing a right successfully?</p>
<p>1045<br>00:59:32,119 –&gt; 00:59:34,119<br>The primary master tells us.</p>
<p>1046<br>00:59:34,119 –&gt; 00:59:40,119<br>Master tells the primary here the second day as you update.</p>
<p>1047<br>00:59:40,119 –&gt; 00:59:43,119<br>So when the master basically issues the leads to the primary.</p>
<p>1048<br>00:59:43,119 –&gt; 00:59:53,119<br>And if one of the secondary is down at that moment, does the master considered a failure or does it just update the version number for the servers that are alive.</p>
<p>1049<br>00:59:53,119 –&gt; 00:59:59,119<br>And it just forgets about the other one because it’s going to have an outdated version of it anyway.</p>
<p>1050<br>00:59:59,119 –&gt; 01:00:05,119<br>Yeah, you know, the papers, a little bit vague and then jack and you have the recovery part or sort of the.</p>
<p>1051<br>01:00:05,119 –&gt; 01:00:07,119<br>Reconfiguration stuff or works.</p>
<p>1052<br>01:00:07,119 –&gt; 01:00:13,119<br>But I imagine that you know, basically the primary actually does have a beach with P1 S1 and S2.</p>
<p>1053<br>01:00:13,119 –&gt; 01:00:16,119<br>It’s on point that the site’s going to S2 is dead.</p>
<p>1054<br>01:00:16,119 –&gt; 01:00:22,119<br>And at that point, it will point and the lose of the primary maybe runs out.</p>
<p>1055<br>01:00:22,119 –&gt; 01:00:31,119<br>And then it will create a new primary and a new S1 and another S, you know, to actually hold, you know, or maybe just S1 because there’s no.</p>
<p>1056<br>01:00:31,119 –&gt; 01:00:37,119<br>No additional chunk server and that form the new replica group for that chunk.</p>
<p>1057<br>01:00:37,119 –&gt; 01:00:41,119<br>Also, the lease doesn’t run out yet.</p>
<p>1058<br>01:00:41,119 –&gt; 01:00:46,119<br>Well, the primary can’t point, okay, so usual, like some interesting cases.</p>
<p>1059<br>01:00:46,119 –&gt; 01:00:50,119<br>So you guys are doing exactly the thing I want.</p>
<p>1060<br>01:00:50,119 –&gt; 01:00:54,119<br>Based on this paper, which is you really start thinking about all the problem at a cases.</p>
<p>1061<br>01:00:54,119 –&gt; 01:00:56,119<br>And this is exactly how you think about consistency.</p>
<p>1062<br>01:00:56,119 –&gt; 01:01:01,119<br>You know, when you start thinking about consistency, you need to sort of consider all possible failures.</p>
<p>1063<br>01:01:01,119 –&gt; 01:01:05,119<br>And argue whether you know, those favorites lead to inconsistencies.</p>
<p>1064<br>01:01:05,119 –&gt; 01:01:12,119<br>So one thing, let’s talk about this one case where we got a master, we got a primary.</p>
<p>1065<br>01:01:12,119 –&gt; 01:01:17,119<br>And let’s say the primary and the master are get disconnected.</p>
<p>1066<br>01:01:17,119 –&gt; 01:01:21,119<br>Actually, let me draw a picture slightly differently.</p>
<p>1067<br>01:01:21,119 –&gt; 01:01:24,119<br>Master in the middle.</p>
<p>1068<br>01:01:24,119 –&gt; 01:01:28,119<br>And we got a server, we got the server here.</p>
<p>1069<br>01:01:28,119 –&gt; 01:01:33,119<br>S1, S2, and let’s say S2 is the primary.</p>
<p>1070<br>01:01:33,119 –&gt; 01:01:39,119<br>And so, you know, whatever it may talk to some other servers out there.</p>
<p>1071<br>01:01:39,119 –&gt; 01:01:42,119<br>So, you know, the master is the primary.</p>
<p>1072<br>01:01:42,119 –&gt; 01:01:45,119<br>So, let’s say it’s a network petition.</p>
<p>1073<br>01:01:45,119 –&gt; 01:01:53,119<br>So, the master sends messages, you know, heartbeat messages doesn’t get a response.</p>
<p>1074<br>01:01:53,119 –&gt; 01:01:59,119<br>When can the master point a new primary?</p>
<p>1075<br>01:01:59,119 –&gt; 01:02:04,119<br>When the lease is over for us to.</p>
<p>1076<br>01:02:04,119 –&gt; 01:02:07,119<br>Yeah, right. We give us.</p>
<p>1077<br>01:02:07,119 –&gt; 01:02:12,119<br>The primary has to wait. The master has to wait until the lease has expired.</p>
<p>1078<br>01:02:12,119 –&gt; 01:02:18,119<br>Because if the lease was not expired, then maybe we have two primaries at the same time.</p>
<p>1079<br>01:02:18,119 –&gt; 01:02:22,119<br>With P1 and P2 staying at the same time.</p>
<p>1080<br>01:02:22,119 –&gt; 01:02:27,119<br>And would that be bad?</p>
<p>1081<br>01:02:27,119 –&gt; 01:02:30,119<br>Yeah, then I think.</p>
<p>1082<br>01:02:30,119 –&gt; 01:02:32,119<br>Wait, would clients.</p>
<p>1083<br>01:02:32,119 –&gt; 01:02:37,119<br>Clients wouldn’t know where to send to and the master wouldn’t know which one is primary rate.</p>
<p>1084<br>01:02:37,119 –&gt; 01:02:41,119<br>Well, but you know, sometimes might be still talking to this primary work.</p>
<p>1085<br>01:02:41,119 –&gt; 01:02:43,119<br>Yeah, clients might be talking to this primary.</p>
<p>1086<br>01:02:43,119 –&gt; 01:02:48,119<br>And their primary for the same chunk.</p>
<p>1087<br>01:02:48,119 –&gt; 01:02:51,119<br>So, I think you get very bizarre orderings, right?</p>
<p>1088<br>01:02:51,119 –&gt; 01:02:55,119<br>Where like some rides will get lost, you know, you know, like it would be a mess.</p>
<p>1089<br>01:02:55,119 –&gt; 01:02:58,119<br>And you know, you know, you know, you know, you know, you know, you know,</p>
<p>1090<br>01:02:58,119 –&gt; 01:03:03,119<br>we’re not a principal to get a argument where like one, you know, we’re all right to happen in order.</p>
<p>1091<br>01:03:03,119 –&gt; 01:03:05,119<br>And one at a time.</p>
<p>1092<br>01:03:05,119 –&gt; 01:03:06,119<br>So this is bad situation.</p>
<p>1093<br>01:03:06,119 –&gt; 01:03:09,119<br>And so this is the situation is avoided like the split brain syndrome.</p>
<p>1094<br>01:03:09,119 –&gt; 01:03:14,119<br>This is sometimes called the split brain syndrome where you end up with system where you have two masters.</p>
<p>1095<br>01:03:14,119 –&gt; 01:03:19,119<br>And this is from here is avoided because of like the lease.</p>
<p>1096<br>01:03:19,119 –&gt; 01:03:24,119<br>And the master will not appoint any other primary until the lease of the first primary absolutely has.</p>
<p>1097<br>01:03:24,119 –&gt; 01:03:30,119<br>And it knows even if the primary job, but not reachable to it, but they be reachable to other clients.</p>
<p>1098<br>01:03:30,119 –&gt; 01:03:40,119<br>That primary won’t accept any right messages anymore because it leaves has expired.</p>
<p>1099<br>01:03:40,119 –&gt; 01:03:43,119<br>Does that make sense?</p>
<p>1100<br>01:03:43,119 –&gt; 01:03:47,119<br>Okay, let me say one more thing before wrapping up and apologize.</p>
<p>1101<br>01:03:47,119 –&gt; 01:04:01,119<br>And this is partly because you know, why I had some technical problems, but I wanted to make one more point and it came up in the discussion to in the breakout room, which is, you know, how can you do better?</p>
<p>1102<br>01:04:01,119 –&gt; 01:04:06,119<br>How do you get strong for system.</p>
<p>1103<br>01:04:06,119 –&gt; 01:04:08,119<br>Maybe just strong work.</p>
<p>1104<br>01:04:08,119 –&gt; 01:04:16,119<br>I got pretty strong systems, but not, you know, not with some little issues.</p>
<p>1105<br>01:04:16,119 –&gt; 01:04:18,119<br>And so there’s a point of different ways you could do it.</p>
<p>1106<br>01:04:18,119 –&gt; 01:04:26,119<br>And in fact, you know, the what we’re going to be seeing.</p>
<p>1107<br>01:04:26,119 –&gt; 01:04:37,119<br>And I think one issue that I was showing up here all the time is like you could instead of like updating the primary and then reporting of making rights visible incrementally is probably not a good idea.</p>
<p>1108<br>01:04:37,119 –&gt; 01:04:41,119<br>So you probably want to do is like update all.</p>
<p>1109<br>01:04:41,119 –&gt; 01:04:45,119<br>Secondary primary’s or none.</p>
<p>1110<br>01:04:45,119 –&gt; 01:04:53,119<br>But not as in this, you know, particular design where like somebody get updated and somebody not be get updated and that’s actually visible to the client.</p>
<p>1111<br>01:04:53,119 –&gt; 01:04:59,119<br>And so a bunch of like, you know, techniques or the protocol changes that you could do that will make this better.</p>
<p>1112<br>01:04:59,119 –&gt; 01:05:06,119<br>And the fact, you know, we’ll see in labs two and three, you know, you will build systems that actually have these stronger properties.</p>
<p>1113<br>01:05:06,119 –&gt; 01:05:11,119<br>And a deal with the scenarios that you know, the curable your legal consistency.</p>
<p>1114<br>01:05:11,119 –&gt; 01:05:20,119<br>And in fact, if you look at Google itself, you know, and we’ll read some of these tables later, you know, Google built additional storage systems.</p>
<p>1115<br>01:05:20,119 –&gt; 01:05:26,119<br>Other store systems that have stronger consistency.</p>
<p>1116<br>01:05:26,119 –&gt; 01:05:34,119<br>And basically tailored also to a different application domain. So example, like in like halfway the term, we just pay a paper called Spanner.</p>
<p>1117<br>01:05:34,119 –&gt; 01:05:41,119<br>And actually has a much stronger story for consistency and even have support for transactions.</p>
<p>1118<br>01:05:41,119 –&gt; 01:05:52,119<br>But that’s like the application domain is quite different, you know, like you can sort of see here the g as is really tailored, you know, to sort of the reduce running map of juice jobs.</p>
<p>1119<br>01:05:52,119 –&gt; 01:05:58,119<br>So I hope this is a, you know, useful introduction sort of consistency and start thinking about these kinds of problems.</p>
<p>1120<br>01:05:58,119 –&gt; 01:06:04,119<br>Because they will be recurring set of problems that will show up in the rest of the term.</p>
<p>1121<br>01:06:04,119 –&gt; 01:06:08,119<br>And I apologize for running over a little bit late.</p>
<p>1122<br>01:06:08,119 –&gt; 01:06:09,119<br>Thank you.</p>
<p>1123<br>01:06:09,119 –&gt; 01:06:14,119<br>So people want to ask additional questions, you know, feel free to ask it.</p>
<p>1124<br>01:06:14,119 –&gt; 01:06:18,119<br>And if you have to run to another class, you know, please run to another class.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MIT6824 P3Lecture3GFS</div>
      <div>http://example.com/2025/10/25/MIT6824 P3Lecture3GFS/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/25/MIT6824%20P5Lecture5FaultToleranceRaft1/" title="MIT6824 P5Lecture5FaultToleranceRaft1">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MIT6824 P5Lecture5FaultToleranceRaft1</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/25/MIT6824%20P2Lecture2RPCandThreads/" title="MIT6824 P2Lecture2RPCandThreads">
                        <span class="hidden-mobile">MIT6824 P2Lecture2RPCandThreads</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
