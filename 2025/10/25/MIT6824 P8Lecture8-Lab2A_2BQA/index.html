

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="100:00:00,000 –&gt; 00:00:07,000Okay, good afternoon. Sound check. 200:00:07,000 –&gt; 00:00:15,000Yeah, we know good. Okay, great. Good afternoon. Good evening. Good morning. Where we are. 300:00:15,">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6824 P8Lecture8 Lab2A_2BQA">
<meta property="og:url" content="http://example.com/2025/10/25/MIT6824%20P8Lecture8-Lab2A_2BQA/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="100:00:00,000 –&gt; 00:00:07,000Okay, good afternoon. Sound check. 200:00:07,000 –&gt; 00:00:15,000Yeah, we know good. Okay, great. Good afternoon. Good evening. Good morning. Where we are. 300:00:15,">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-25T05:03:39.809Z">
<meta property="article:modified_time" content="2025-10-25T05:03:39.809Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>MIT6824 P8Lecture8 Lab2A_2BQA - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MIT6824 P8Lecture8 Lab2A_2BQA"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-25 13:03" pubdate>
          2025年10月25日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          74 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MIT6824 P8Lecture8 Lab2A_2BQA</h1>
            
            
              <div class="markdown-body">
                
                <p>1<br>00:00:00,000 –&gt; 00:00:07,000<br>Okay, good afternoon. Sound check.</p>
<p>2<br>00:00:07,000 –&gt; 00:00:15,000<br>Yeah, we know good. Okay, great. Good afternoon. Good evening. Good morning. Where we are.</p>
<p>3<br>00:00:15,000 –&gt; 00:00:22,000<br>So today I want to talk about a lot to A and B. And then this is really a question and answering session.</p>
<p>4<br>00:00:22,000 –&gt; 00:00:32,000<br>So feel free to interrupt anytime. Ask questions as much as you like. It’s really this today’s lecture is really dedicated to your questions.</p>
<p>5<br>00:00:32,000 –&gt; 00:00:35,000<br>I summarized.</p>
<p>6<br>00:00:35,000 –&gt; 00:00:43,000<br>Many of the questions that came up or either wants a multiple times in the email on the on the right side here of this on the board.</p>
<p>7<br>00:00:43,000 –&gt; 00:00:57,000<br>Hopefully we’ll get through them as I walk through my solutions. And so I’m going to basically cover four topics related to the solution.</p>
<p>8<br>00:00:57,000 –&gt; 00:01:01,000<br>One, I’m going to first talk a little bit about voting.</p>
<p>9<br>00:01:01,000 –&gt; 00:01:09,000<br>Or like the voting code, basically, the hard beats.</p>
<p>10<br>00:01:09,000 –&gt; 00:01:18,000<br>Now, I’ll talk about start and commit.</p>
<p>11<br>00:01:18,000 –&gt; 00:01:20,000<br>And this sort of follows, I think the.</p>
<p>12<br>00:01:20,000 –&gt; 00:01:30,000<br>Yes, and that we made in the lab, like how you should get started. Like first get voting to work, you know, then get hard beats to work once you got hard beats to work, you can actually start taking commands from clients.</p>
<p>13<br>00:01:30,000 –&gt; 00:01:34,000<br>And then, of course, and yet you’re, you got to commit them, supplied them on the applied channel.</p>
<p>14<br>00:01:34,000 –&gt; 00:01:41,000<br>So there’s roughly the order I’m planning to go through. But again, I feel free to interrupt at any particular time.</p>
<p>15<br>00:01:41,000 –&gt; 00:01:55,000<br>But before diving or looking at my particular solutions or the solution I wrote this year, I want to talk a little bit about debugging because I was the problem with the question that came up most in the.</p>
<p>16<br>00:01:55,000 –&gt; 00:01:58,000<br>In all your in the submitted in the submitted questions.</p>
<p>17<br>00:01:58,000 –&gt; 00:02:05,000<br>So let me tell you a little bit at a very high level about debugging.</p>
<p>18<br>00:02:05,000 –&gt; 00:02:10,000<br>And this is a clearly topic that we could spend a whole lecture on.</p>
<p>19<br>00:02:10,000 –&gt; 00:02:17,000<br>And, but I’m just going to give you sort of my high level approach that, you know, I typically use, you need to address.</p>
<p>20<br>00:02:17,000 –&gt; 00:02:20,000<br>You know, to basically pass the labs.</p>
<p>21<br>00:02:20,000 –&gt; 00:02:26,000<br>And basically, it starts out, I just started, basically, we run the first test case.</p>
<p>22<br>00:02:26,000 –&gt; 00:02:35,000<br>And of course, if I have not written any code, I’m going to fail it. But at least I have some, you know, starting point where I can start writing some code for.</p>
<p>23<br>00:02:35,000 –&gt; 00:02:41,000<br>And so, you know, think about the first test case, you know, started writing, you know, look at the hints and write some code.</p>
<p>24<br>00:02:41,000 –&gt; 00:02:44,000<br>And while writing the code.</p>
<p>25<br>00:02:44,000 –&gt; 00:02:58,000<br>And I found it, you know, convenient in this lab to, or these, the set of labs actually any lab in the eight to four to log all messages.</p>
<p>26<br>00:02:58,000 –&gt; 00:03:03,000<br>And you know, typically use, you know, that the deep print F function in the new toe logo.</p>
<p>27<br>00:03:03,000 –&gt; 00:03:07,000<br>And I’m pretty, pretty systematic of logging messages.</p>
<p>28<br>00:03:07,000 –&gt; 00:03:12,000<br>And the reason that I do this is for debugging purposes.</p>
<p>29<br>00:03:12,000 –&gt; 00:03:20,000<br>And so I wrote my code, I’m going to run the test code fails, writes code to actually try to pass the test case.</p>
<p>30<br>00:03:20,000 –&gt; 00:03:31,000<br>And, you know, there’s sort of two scenarios, you know, one, you know, I pass, which then I immediately move on to the next test case or a fail.</p>
<p>31<br>00:03:31,000 –&gt; 00:03:43,000<br>In that case, the first thing I do is, you know, study the test case a little bit more in detail, and try to figure out like what actually the test case is trying to test.</p>
<p>32<br>00:03:43,000 –&gt; 00:03:52,000<br>And you know, the name of the test case is often there suggestive of like what the particular scenario or what sort of set of scenarios, you know, the test case is trying to cover.</p>
<p>33<br>00:03:52,000 –&gt; 00:04:02,000<br>And then I try to sort of formally for myself, hypothesis, not why, you know, my code, my not test that pass the test case.</p>
<p>34<br>00:04:02,000 –&gt; 00:04:08,000<br>And so basically this is sort of a moment of like reflection and thinking.</p>
<p>35<br>00:04:08,000 –&gt; 00:04:20,000<br>And to sort of like understand what the, like constructing my head, the scenario that there seems to fit the test case, you know, think about my code and what it actually could be your problem.</p>
<p>36<br>00:04:20,000 –&gt; 00:04:28,000<br>And once I have a sort of hypothesis, then the next thing to do is to study, you know, basically try to confirm the hypothesis.</p>
<p>37<br>00:04:28,000 –&gt; 00:04:37,000<br>Whether, you know, my explanation part, why I’m passing the test case might be right or wrong. And so to do that, then basically I studied the log.</p>
<p>38<br>00:04:37,000 –&gt; 00:04:58,000<br>So if I have a print, you know, and trace of all the messages, you know, being sent to the part of the protocol, I can look at the, you know, trace and kind of the sea, you know, where things go wrong and sort of work where back works and, you know, in that way sort of test and refine my hypothesis about why my code might be wrong.</p>
<p>39<br>00:04:58,000 –&gt; 00:05:17,000<br>Sometimes, you know, that might require, you know, going back and basically run the test case to basically get more detailed log out boots, although early on, like tend to be very systematic and, you know, don’t really have to add any print statements, but in some cases, that there’s necessary.</p>
<p>40<br>00:05:17,000 –&gt; 00:05:26,000<br>And then you know, that gives me that more information and I can sort of really zoom in on a scenario that, you know, my code doesn’t handle.</p>
<p>41<br>00:05:26,000 –&gt; 00:05:37,000<br>And once I sort of have a hypothesis, I’ve verified with the log that there are indeed that hypothesis to be correct and that that is short or bugging my code, I can just go fix the code.</p>
<p>42<br>00:05:37,000 –&gt; 00:05:42,000<br>And then run the test case.</p>
<p>43<br>00:05:42,000 –&gt; 00:05:57,000<br>And so this is a bit of a process run test case, you fail, study test case and study log, you know, perform a late hypothesis, you know, try to confirm hypothesis and then move on fix the code and then move on to the next one.</p>
<p>44<br>00:05:57,000 –&gt; 00:06:00,000<br>And that tend to be reasonable systematic in this.</p>
<p>45<br>00:06:01,000 –&gt; 00:06:17,000<br>And so often I watch right down in a file and text by what my hypothesis is and sort of try to collect evidence or counter evidence, you know, to either prove a dispute my hypothesis and I really have a good reason to fix the code.</p>
<p>46<br>00:06:17,000 –&gt; 00:06:31,000<br>I think any approach that basically is not very systematic, you know, where, example, you think something is not really 100% right, you know, maybe you’ll change that and then see you pass the test cases, tends to be not work that well, I think that takes a lot of time.</p>
<p>47<br>00:06:31,000 –&gt; 00:06:44,000<br>Because you might be wrong or and worse, you might be wrong and actually pass the test case and think you’re right, but it turned out like, you know, basically you’re just shifted the bug from one corner to another corner and it will show up later again.</p>
<p>48<br>00:06:45,000 –&gt; 00:06:51,000<br>So at a very high level, this is the sort of the approach that I take.</p>
<p>49<br>00:06:51,000 –&gt; 00:06:58,000<br>And you can see what the key here is really logging the messages.</p>
<p>50<br>00:06:58,000 –&gt; 00:07:09,000<br>Any questions were comments on this, this approach, I know it’s a very high level, but at least if you some sense that like how I approach this.</p>
<p>51<br>00:07:09,000 –&gt; 00:07:11,000<br>So the messages here are the RPC.</p>
<p>52<br>00:07:11,000 –&gt; 00:07:14,000<br>Okay.</p>
<p>53<br>00:07:14,000 –&gt; 00:07:19,000<br>Okay, so some so do a quick question.</p>
<p>54<br>00:07:19,000 –&gt; 00:07:20,000<br>Go ahead.</p>
<p>55<br>00:07:20,000 –&gt; 00:07:28,000<br>So what’s a good like approach for deciding the granularity of what to log and what not to log and that’s a very good.</p>
<p>56<br>00:07:28,000 –&gt; 00:07:38,000<br>I just a great question of hoping that someone was asked is I tend to be long things are the pretty fine grain clarinet and log everything.</p>
<p>57<br>00:07:38,000 –&gt; 00:07:51,000<br>And then I use, you know, whatever I pulled the basically blog in the editor or I use unique activities like rap to basically pull out the things that are actually really interested in.</p>
<p>58<br>00:07:51,000 –&gt; 00:08:01,000<br>And the reason I’m doing that is, you know, sometimes I don’t know what level granularity I want to study something and I don’t want to go back and run the test case again.</p>
<p>59<br>00:08:01,000 –&gt; 00:08:06,000<br>I just collect everything and then you know, filter to stop out that I don’t that I care about.</p>
<p>60<br>00:08:06,000 –&gt; 00:08:18,000<br>And this brings me on so some people write quite a bit of infrastructure for debugging the using the logs or making the logs more easier to understand.</p>
<p>61<br>00:08:18,000 –&gt; 00:08:30,000<br>I’m pretty primitive, you know, deep enough and lots of information, although I structure my brain is in this sort of a clear matter sort of like I can see what the source of the destination is.</p>
<p>62<br>00:08:30,000 –&gt; 00:08:33,000<br>And what the RPC itself is.</p>
<p>63<br>00:08:33,000 –&gt; 00:08:43,000<br>And so I can sort of figure a graph and filter very quickly because all the text lines have a particular format.</p>
<p>64<br>00:08:43,000 –&gt; 00:08:49,000<br>And then people spend quite a bit of time building some infrastructure to make it all easier.</p>
<p>65<br>00:08:49,000 –&gt; 00:08:59,000<br>If you come to one of the TAs, the Jose, when you took the class, he actually built some software to make it a little bit of a personal script section, easier to actually part of locks.</p>
<p>66<br>00:08:59,000 –&gt; 00:09:03,000<br>And I thought it may be interesting to see what he did.</p>
<p>67<br>00:09:03,000 –&gt; 00:09:12,000<br>So I’m going to stop sharing and ask Jose to share and maybe demo like how his long structure works.</p>
<p>68<br>00:09:12,000 –&gt; 00:09:14,000<br>I have a follow up question.</p>
<p>69<br>00:09:14,000 –&gt; 00:09:21,000<br>So how do you make the debugging prints go into a log rather than the standard out.</p>
<p>70<br>00:09:21,000 –&gt; 00:09:26,000<br>Oh, you’re bigger than two and I output it to file.</p>
<p>71<br>00:09:26,000 –&gt; 00:09:29,000<br>So so do you just pipe everything into a file.</p>
<p>72<br>00:09:29,000 –&gt; 00:09:31,000<br>Yes, I pipe everything into a file.</p>
<p>73<br>00:09:31,000 –&gt; 00:09:35,000<br>Got it. Thank you.</p>
<p>74<br>00:09:35,000 –&gt; 00:09:39,000<br>So I can use Jose screen and Jose go ahead.</p>
<p>75<br>00:09:39,000 –&gt; 00:09:42,000<br>And then I can hear him again.</p>
<p>76<br>00:09:42,000 –&gt; 00:09:44,000<br>Yeah, I can hear it.</p>
<p>77<br>00:09:44,000 –&gt; 00:09:45,000<br>Okay. Awesome.</p>
<p>78<br>00:09:45,000 –&gt; 00:09:49,000<br>And I’ll say as I kind of agree on all kinds of points.</p>
<p>79<br>00:09:49,000 –&gt; 00:09:54,000<br>I think it’s very similar to like how France was describing them a pretty aggressive bloggers.</p>
<p>80<br>00:09:54,000 –&gt; 00:09:59,000<br>I try to kind of just walk every single event that that is going on.</p>
<p>81<br>00:09:59,000 –&gt; 00:10:04,000<br>And again, I also have like a kind of like a format that I follow.</p>
<p>82<br>00:10:04,000 –&gt; 00:10:09,000<br>And I went about making my life easier going and passing through the logs.</p>
<p>83<br>00:10:09,000 –&gt; 00:10:14,000<br>The high level idea is I do very simple structuring in go.</p>
<p>84<br>00:10:14,000 –&gt; 00:10:23,000<br>And then I usually dump that the standard out or to a file and then I use Python scripts to actually do the kind of like all the coloring and the structuring.</p>
<p>85<br>00:10:23,000 –&gt; 00:10:29,000<br>Since that’s much easier to do in Python that in that it go.</p>
<p>86<br>00:10:29,000 –&gt; 00:10:33,000<br>And so here’s for example, what I get out of when I run a testing goal.</p>
<p>87<br>00:10:33,000 –&gt; 00:10:39,000<br>So when I enable the bribalsity, I just get like an output that looks something like this.</p>
<p>88<br>00:10:39,000 –&gt; 00:10:48,000<br>And here what I’m logging is kind of like the number of milliseconds is the first column that’s pretty useful when you’re trying to the back timer events.</p>
<p>89<br>00:10:48,000 –&gt; 00:10:52,000<br>Things like that or trying to see how long an RPC takes to fail.</p>
<p>90<br>00:10:52,000 –&gt; 00:10:56,000<br>Then the second column is what I like to call topics.</p>
<p>91<br>00:10:56,000 –&gt; 00:11:02,000<br>They are not levels because they are no there’s no hierarchy between them. They’re just related to different events in rock.</p>
<p>92<br>00:11:02,000 –&gt; 00:11:07,000<br>Probably a lot of you right now have realized that in rather is a lot of things going on.</p>
<p>93<br>00:11:07,000 –&gt; 00:11:14,000<br>Like timers, there’s elections, there’s like log things being applied communication with the same machine.</p>
<p>94<br>00:11:14,000 –&gt; 00:11:17,000<br>And all of those events happen with a slightly different frequencies.</p>
<p>95<br>00:11:17,000 –&gt; 00:11:29,000<br>So if you want to later just like select some of them or like decide to ignore the more verbose ones, it’s really handy to just have like that in that you’re either.</p>
<p>96<br>00:11:29,000 –&gt; 00:11:39,000<br>And then the third column probably a lot of you have something like this is with server like who is saying this message because without that is really hard to which and what is going on.</p>
<p>97<br>00:11:39,000 –&gt; 00:11:45,000<br>And the rest is just like a free for message that explain kind of like what this message is about.</p>
<p>98<br>00:11:45,000 –&gt; 00:11:54,000<br>And even though this is kind of just the very initial test that you run the one that just test that you can do an election.</p>
<p>99<br>00:11:54,000 –&gt; 00:11:59,000<br>You actually have to like read to follow what the logic is going on here.</p>
<p>100<br>00:11:59,000 –&gt; 00:12:25,000<br>And I made this easier in kind of like first approach. And this is what I think when I took the class was just convert all the topics into colors like most more internal supports like why the way of color support and again by doing this in Python, you can use some fantastic libraries that do all the heavy lifting so you don’t have to get in the in the weeds of doing this.</p>
<p>101<br>00:12:25,000 –&gt; 00:12:36,000<br>And here I just have included different events with different colors. And as you get more familiar with the colors, for example, here all the time, there’s events and gray so maybe they’re easier to ignore.</p>
<p>102<br>00:12:36,000 –&gt; 00:12:43,000<br>We are looking for when someone is voting, we can look at like C and which related to both.</p>
<p>103<br>00:12:43,000 –&gt; 00:12:53,000<br>And that like we’ll just encode visually things that are much easier to pick up like for example here, Jello is when we in next election you leader.</p>
<p>104<br>00:12:53,000 –&gt; 00:13:03,000<br>We still have to decide who is saying what and in order to do that what I incorporate is just having different columns.</p>
<p>105<br>00:13:03,000 –&gt; 00:13:19,000<br>And again, what I’m doing is just running here like what I’m doing just running this standard best script and then just typing that into like the script that I wrote in this case, I’m specifying that I have three columns because of like three years in this test case.</p>
<p>106<br>00:13:19,000 –&gt; 00:13:31,000<br>I have now decided to ignore the timer like the events with the timer topic because there are like too many of them and if time in logic is working, we probably don’t need them to the back what is going on.</p>
<p>107<br>00:13:31,000 –&gt; 00:13:51,000<br>And if you look at this law compared to what we did playing text log is fairly easy to see that what’s going on is like three servers are starting the last one is becoming a candidate that their two are voting for that it’s becoming a leader as soon as it gets the first vote and then it’s just hard bits through the rest of the test.</p>
<p>108<br>00:13:51,000 –&gt; 00:14:01,000<br>And there’s nothing else to look at here, but now again, compared to this kind of like an order of magnitude easier to pick up what is going on.</p>
<p>109<br>00:14:01,000 –&gt; 00:14:05,000<br>And as you tweak that to your liking it becomes more and more efficient.</p>
<p>110<br>00:14:05,000 –&gt; 00:14:32,000<br>And as you move to like harder test because a lot of you have probably have had to look at the logs of the backup at this in the to be loud, there will be lots and lots of events going on and even kind of even if you log what you need it might become like a daunting tasks going through like thousands of lines of logs just searching for the point of failure and trying to reach out what’s going on.</p>
<p>111<br>00:14:32,000 –&gt; 00:15:01,000<br>Again, if we look just like make this up kind of like a simpler format to visualize we can quickly see what’s going on we just have like five different servers that are starting the first one is becoming a candidate, the other ones are voting for it becoming a leader and by looking at the different columns against, for example, all like purple encodes whenever something is committed or applied so we can see that a new entry is.</p>
<p>112<br>00:15:01,000 –&gt; 00:15:29,000<br>And this this servers are receiving it and because backup and two has like a very very boss log I have and a lot of drop RPCs i’m also ignoring those topics here and as the test goes on we can start reaching in about what’s going on so so fairly helpful to just have like some print statements of the back statement in the test code you just can modify there.</p>
<p>113<br>00:15:29,000 –&gt; 00:15:53,000<br>To know what the test is doing for example here the test that takes the first server as you is the leader and then disconnects s2 through s4 which are like the three on the right side and that’s pretty much what happens we just get like a stream of entries that won’t be committed because there’s only two servers that can talk to each other and then after a while.</p>
<p>114<br>00:15:53,519 –&gt; 00:16:02,000<br>We see that the first two are now disconnected and the the three on the right are reconnected and now they come form a majority.</p>
<p>115<br>00:16:02,600 –&gt; 00:16:18,519<br>And that’s what we will see like the last one becomes a candidate that tips a majority and kind of repeatedly we see this color pattern of like green purple purple kind of like this staircase signifying that oh yeah receiving an entry.</p>
<p>116<br>00:16:18,919 –&gt; 00:16:35,279<br>i’m propagating it through the other servers and the disconnected servers here converting to a candidate and hopefully i’ve convinced you by now by just slightly changing the presentation of your logs kind of like the mental effort to like go to them.</p>
<p>117<br>00:16:35,360 –&gt; 00:16:55,959<br>Can significantly decrease and even though this is like really fancy there’s no lot of like fancy going on i just use some of the self python libraries really rich and kind of all fits in our like a hundred lines of python script and if you’re interested i.</p>
<p>118<br>00:16:56,519 –&gt; 00:17:15,200<br>Roll like a block pause that will be linking on the website on the apps about kind of like the the steps to build a tool like this and kind of how it all fit together some like some like the sign decisions related to that and anyone has like any questions specific to this happy to answer them.</p>
<p>119<br>00:17:23,600 –&gt; 00:17:24,200<br>Any questions for.</p>
<p>120<br>00:17:26,279 –&gt; 00:17:36,840<br>Yeah, I have a question what about general logging so I know that I had some bugs that when I put in the logging there were no longer there.</p>
<p>121<br>00:17:38,000 –&gt; 00:17:44,240<br>Because of some timing issue or perhaps a concurrency issue so what what do we do then.</p>
<p>122<br>00:17:44,599 –&gt; 00:17:58,960<br>Okay, so there’s a couple things I do, first of all, one reason I log it’s sort of a fine grain always at the same level of granularity and the fine grained lever in the early so I always have a trace of everything and I generally don’t have to go back.</p>
<p>123<br>00:18:00,400 –&gt; 00:18:13,000<br>The other thing to do is I do run the test many, many, many times and they save all logs and then once I hit the wrong one once I hit a bug then you know study that particular log.</p>
<p>124<br>00:18:15,079 –&gt; 00:18:23,359<br>And so for example, if I run something overnight I just save all the logs from all the runs overnight and then grab the one that you know failed.</p>
<p>125<br>00:18:28,039 –&gt; 00:18:33,480<br>Any further questions on the topic of logging.</p>
<p>126<br>00:18:38,000 –&gt; 00:18:41,000<br>Okay, good let me proceed.</p>
<p>127<br>00:18:41,000 –&gt; 00:18:56,000<br>But before again, you know looking at code I want to talk a little bit about the structure that my particular solution has and this is definitely not the only structure you can do with many, many different ways and you’re free to actually do it in many different ways.</p>
<p>128<br>00:18:57,000 –&gt; 00:19:09,000<br>And the fact that every year when I teach a class, you know, I actually try to rewrite write implement the labs again and often experiment with different types of ways of implementing it.</p>
<p>129<br>00:19:09,960 –&gt; 00:19:22,119<br>So the one I will share you with you today is one that I wrote over IP, you know, sort of getting ready for eight to four and then has the following structure and some pretty standard structure.</p>
<p>130<br>00:19:23,000 –&gt; 00:19:31,400<br>You know, when you draw a box, you know, signifying the draft library, you know, there’s two basically.</p>
<p>131<br>00:19:32,400 –&gt; 00:19:42,400<br>API calls great one start to initiate an append entries and initiate a logging operation in one to actually.</p>
<p>132<br>00:19:43,400 –&gt; 00:19:47,400<br>And output, you know, that goes through the apply channel.</p>
<p>133<br>00:19:49,400 –&gt; 00:19:57,400<br>And then in, you know, the one that we’re showing you have basically one, essentially one structure, the draft structure.</p>
<p>134<br>00:19:58,400 –&gt; 00:20:10,400<br>That basically has all the state of the of the graph library, you know, the all the sort of variables that are in the bigger two and basically have one lock on this guy.</p>
<p>135<br>00:20:12,400 –&gt; 00:20:26,400<br>And basically all my, so you quite course rate walking, you know, all my RC handlers, all my, you know, start take basically this one lock, do whatever their stuff they need to be do, do and then.</p>
<p>136<br>00:20:27,400 –&gt; 00:20:37,400<br>Release the lock on so there’s a couple of frets that sort of running around one, of course, is the ticker for it that we sort of gave you.</p>
<p>137<br>00:20:38,400 –&gt; 00:20:53,400<br>And you know that just waits as I’ll show you in a second that will wait for you know some number of milliseconds 50 milliseconds and then run and then check you know periodically if any time out election time has gone off and then does whatever needs to be done.</p>
<p>138<br>00:20:54,400 –&gt; 00:21:04,400<br>I have one threat dedicated to writing on the apply channel, so no other threat actually writes to the apply channel there’s only single one and a basically sleeps on a condition variable.</p>
<p>139<br>00:21:04,400 –&gt; 00:21:32,400<br>And so when for example, a new append entry comes in from the leader and the commit index goes up, then you know the thread that thread will wake up on the signal in the condition variable that will wake up the thread that actually looks at the apply that writes on the apply channel, it will grab whatever entry out of the log and stick them on the apply channel.</p>
<p>140<br>00:21:35,400 –&gt; 00:21:44,400<br>And so that’s one and the reason I have a single thread is that of course you can’t hold locks while writing across the apply channel release you know like in cars, some problems later.</p>
<p>141<br>00:21:45,400 –&gt; 00:21:49,400<br>And so I just have a single thread that actually writes on the apply channel.</p>
<p>142<br>00:21:50,400 –&gt; 00:22:13,400<br>Then the course you know number of things coming in from the outside required messages coming in and of course each message or each RPC you know start your own threat or go well, you know, RPC library will basically start a threat for every incoming message and basically the way I process every incoming messages and the first thing that graph the log on the raster.</p>
<p>143<br>00:22:14,400 –&gt; 00:22:25,400<br>It reads a right you know the raster and then when it’s done you have to release the log and maybe lock and maybe in between it will update you know signal in the condition variable to.</p>
<p>144<br>00:22:27,400 –&gt; 00:22:38,400<br>Then you know of course like start itself runs on a particular thread so it jumps into the rath library you know the same thing you know acquire the lock and then let me.</p>
<p>145<br>00:22:39,400 –&gt; 00:23:02,400<br>A Penti entry if it’s the leader you know append it to the log in the lock structure and then sends off you know the sent RPC the append RPCs and since I want to do the append RPCs in parallel basically what it works is that you know for every RPC I start a separate thread.</p>
<p>146<br>00:23:02,400 –&gt; 00:23:18,400<br>And that art and that thread actually is responsible for sending it reserving the response and in the response you know doing any updating that is necessary to the rath structure so response handler or when the response comes in you know we’ll grab the.</p>
<p>147<br>00:23:18,400 –&gt; 00:23:35,400<br>Rath lock and then do whatever update necessary to the rath state and then release the lock so so there’s a bunch of threats quite a number of threats that can be running around right because of message and maybe late you know and so there may be many many many many friends here.</p>
<p>148<br>00:23:35,400 –&gt; 00:23:43,400<br>And there might be you know multiple starts there might be a start outstanding and so they might be multiple friends there and of course the ticker you know also start.</p>
<p>149<br>00:23:43,400 –&gt; 00:23:52,400<br>So, uh, uh, may send hard beats and those hard beats know again again you know turn into a separate threat.</p>
<p>150<br>00:23:52,400 –&gt; 00:23:54,400<br>But all those threats are basically.</p>
<p>151<br>00:23:54,400 –&gt; 00:24:08,400<br>Surreledged by the rath lock or my rath lock serializes.</p>
<p>152<br>00:24:08,400 –&gt; 00:24:19,400<br>And so when I create a print network law and messages you know of course that is inside you know done by holding the rath lock and since you know sort of every front runs one by one.</p>
<p>153<br>00:24:19,400 –&gt; 00:24:25,400<br>And all the log messages will make a lot of sense you know they do they all serialize to.</p>
<p>154<br>00:24:25,400 –&gt; 00:24:29,400<br>Similar I make all our sea handlers.</p>
<p>155<br>00:24:29,400 –&gt; 00:24:48,400<br>Atomic or serialized so no fine drain locking and that helps and I’ll talk about it in a second and then the only sort of thing that you know you have to be a little bit careful with if you do sort of this core spade locking is that you can get into dead locks and particularly you can have a dead lock if you hold locks across.</p>
<p>156<br>00:24:48,400 –&gt; 00:24:58,400<br>RPCs and so I never hold no locks across RPCs.</p>
<p>157<br>00:24:58,400 –&gt; 00:25:06,400<br>And as partially achieved your as a surprise as a cheese this is side effect of really starting a new threat for every RPC.</p>
<p>158<br>00:25:06,400 –&gt; 00:25:22,400<br>So that’s sort of the overall structure of this particular solution that I will share in a second with you again other structures are possible but hopefully it’s good for you some some ideas any questions about this.</p>
<p>159<br>00:25:22,400 –&gt; 00:25:30,400<br>What were the threads on the right on the right these guys yeah those are the incoming messages.</p>
<p>160<br>00:25:30,400 –&gt; 00:25:36,400<br>So like a pen RPC a photo pen RPC request or a vote request.</p>
<p>161<br>00:25:36,400 –&gt; 00:25:40,400<br>I think it’s only to.</p>
<p>162<br>00:25:40,400 –&gt; 00:25:43,400<br>I also have a question.</p>
<p>163<br>00:25:43,400 –&gt; 00:25:52,400<br>What’s the is there a benefit of having a single thread sleeping on the condition variable and then.</p>
<p>164<br>00:25:52,400 –&gt; 00:26:02,400<br>So having only that thread a thread sending to apply channel compared to having each RPC thread.</p>
<p>165<br>00:26:02,400 –&gt; 00:26:10,400<br>Send to the apply channel well you everything has to go in order from the apply channel right so the whole log that you are made.</p>
<p>166<br>00:26:10,400 –&gt; 00:26:16,400<br>The entire structure has to be sent on the apply channel exactly in order as the entries are in the log.</p>
<p>167<br>00:26:16,400 –&gt; 00:26:22,400<br>And so that’s just more easier to do I find it easier to do with the single thread.</p>
<p>168<br>00:26:22,400 –&gt; 00:26:28,400<br>Is that that basically goes through the path log and just sticks to one by one the entries onto the apply channel.</p>
<p>169<br>00:26:28,400 –&gt; 00:26:32,400<br>And there’s no further coordination necessary.</p>
<p>170<br>00:26:32,400 –&gt; 00:26:34,400<br>That makes sense.</p>
<p>171<br>00:26:34,400 –&gt; 00:26:37,400<br>You know, it’s like if you will you know.</p>
<p>172<br>00:26:37,400 –&gt; 00:26:45,400<br>This goes like up into the service that actually uses the right library.</p>
<p>173<br>00:26:45,400 –&gt; 00:26:52,400<br>Okay, so one more word about this sort of fine grain versus coarse grain.</p>
<p>174<br>00:26:52,400 –&gt; 00:27:01,400<br>Some of you like a common mistake early on you know when you haven’t done that much you know a parallel programming.</p>
<p>175<br>00:27:01,400 –&gt; 00:27:06,400<br>You might like if you have your RPC struct.</p>
<p>176<br>00:27:06,400 –&gt; 00:27:15,400<br>You know maybe you have like the log and some other fields and you know some people or sometimes you know there’s a temptation or not unreasonable.</p>
<p>177<br>00:27:15,400 –&gt; 00:27:22,400<br>You have multiple walks so instead of having a single.</p>
<p>178<br>00:27:22,400 –&gt; 00:27:25,400<br>Or even have a single one.</p>
<p>179<br>00:27:25,400 –&gt; 00:27:36,400<br>But not really hold it for a long time.</p>
<p>180<br>00:27:36,400 –&gt; 00:27:39,400<br>And.</p>
<p>181<br>00:27:39,400 –&gt; 00:27:43,400<br>And I think in general that my reasoning about the code a little bit hard.</p>
<p>182<br>00:27:43,400 –&gt; 00:27:50,400<br>So so example of common thing that you know that you might do it in is like if you have a hard PC handler like like this.</p>
<p>183<br>00:27:50,400 –&gt; 00:27:53,400<br>And then where.</p>
<p>184<br>00:27:53,400 –&gt; 00:27:56,400<br>Whatever hard is.</p>
<p>185<br>00:27:56,400 –&gt; 00:27:58,400<br>You know, reply.</p>
<p>186<br>00:27:58,400 –&gt; 00:28:00,400<br>I’m just catching this out.</p>
<p>187<br>00:28:00,400 –&gt; 00:28:05,400<br>You know, and you might you know, you might do like you know whatever you walk.</p>
<p>188<br>00:28:05,400 –&gt; 00:28:15,400<br>Do something you know with the arguments maybe you know update some state you know in the raft structure and do a new unlock.</p>
<p>189<br>00:28:15,400 –&gt; 00:28:24,400<br>And then you do some other stuff that is not maybe directly related to the raft structure and then basically maybe grab the lock again.</p>
<p>190<br>00:28:24,400 –&gt; 00:28:29,400<br>And then you know whatever update and read maybe the raft structure again and then the unlock.</p>
<p>191<br>00:28:29,400 –&gt; 00:28:33,400<br>And all your sort of in a single RPC handler.</p>
<p>192<br>00:28:33,400 –&gt; 00:28:36,400<br>And.</p>
<p>193<br>00:28:36,400 –&gt; 00:28:43,400<br>Just as a sort of thought exercise again what is risky about this sort of style of fine rate walking.</p>
<p>194<br>00:28:43,400 –&gt; 00:28:54,400<br>And then this is a little bit artificial, but you know, just a reasonable common sort of early mistake that you know you might make.</p>
<p>195<br>00:28:54,400 –&gt; 00:29:00,400<br>You have to like recheck your assumptions before locking again every time right.</p>
<p>196<br>00:29:00,400 –&gt; 00:29:02,400<br>Yeah, you know, basically this executes.</p>
<p>197<br>00:29:02,400 –&gt; 00:29:07,400<br>It’s automatically this executes it, it’s automatically a lot of things can happen in between right.</p>
<p>198<br>00:29:07,400 –&gt; 00:29:11,400<br>So, for example, new RPCs might have been coming in.</p>
<p>199<br>00:29:11,400 –&gt; 00:29:20,400<br>And they might be running to and they might actually have been updating the raft struct or the raft state between you know these two critical sections.</p>
<p>200<br>00:29:20,400 –&gt; 00:29:22,400<br>And team one and two.</p>
<p>201<br>00:29:22,400 –&gt; 00:29:31,400<br>And so by the time you know to the you start running critical section two, the raft structure might be completely different and how it can make completely different content.</p>
<p>202<br>00:29:31,400 –&gt; 00:29:35,400<br>And sort of to avoid you know those kinds of situations.</p>
<p>203<br>00:29:35,400 –&gt; 00:29:42,400<br>You know my general approach is to basically you know basically have this to be one critical one critical section.</p>
<p>204<br>00:29:42,400 –&gt; 00:29:49,400<br>So I don’t have to recheck any I don’t have to reset the state at the new one the second.</p>
<p>205<br>00:29:49,400 –&gt; 00:29:53,400<br>Critical section starts.</p>
<p>206<br>00:29:53,400 –&gt; 00:29:56,400<br>Does that make sense?</p>
<p>207<br>00:29:56,400 –&gt; 00:29:59,400<br>And this problem shows up in different you know.</p>
<p>208<br>00:29:59,400 –&gt; 00:30:04,400<br>Or this problem can show up in different fashion in different ways.</p>
<p>209<br>00:30:04,400 –&gt; 00:30:10,400<br>But you know sort of doing or lying problems always the same you know you do a lot of fine grain blocking you’re going to have additional interleavings.</p>
<p>210<br>00:30:10,400 –&gt; 00:30:16,400<br>And you have to consider and make sure that there that you don’t have a incorrect.</p>
<p>211<br>00:30:16,400 –&gt; 00:30:22,400<br>And the living that result in incorrect behavior.</p>
<p>212<br>00:30:22,400 –&gt; 00:30:34,400<br>I want to ask is it but it’s not possible to avoid rechecking conditions after you send an RPC right inside the RPC thread.</p>
<p>213<br>00:30:34,400 –&gt; 00:30:44,400<br>Yeah, you you you cannot hold the lock while sending correct so like you should not you know year you should not call whatever you know send RPC.</p>
<p>214<br>00:30:44,400 –&gt; 00:30:53,400<br>Because you can’t do that while holding a lock because they can easily result in deadlock right you holding the lock you send it to appear and RPC while still holding the lock to peer actually.</p>
<p>215<br>00:30:53,400 –&gt; 00:31:09,400<br>Since it RPC to you but you’re holding you know the you wrote the leader already holds the lock on our structure so the response cannot be processed and maybe you know the two are interdependent and when you have a deadlock.</p>
<p>216<br>00:31:09,400 –&gt; 00:31:25,400<br>One thing that’s worth noting is something I saw some people doing is that they spin off a thread they have to send an RPC in that thread they take the lock to prepare the arguments for the RPC and then they send the RPC without lock.</p>
<p>217<br>00:31:25,400 –&gt; 00:31:38,400<br>And you can do that but it’s often there’s often fewer interleavings if you generate the arguments for the RPC before you spit off the thread that actually sends it.</p>
<p>218<br>00:31:38,400 –&gt; 00:31:42,400<br>Good point I will see you will show you this will show up in a second actually and.</p>
<p>219<br>00:31:42,400 –&gt; 00:31:59,400<br>But doesn’t that cause so sometimes it’s actually depending on the implementation I think it’s beneficial for other RPCs to see the changes like for example if other RPCs made progress you want to start off from the most recent last log index.</p>
<p>220<br>00:31:59,400 –&gt; 00:32:09,400<br>Perhaps it depends on exactly what you do and how your implementation works.</p>
<p>221<br>00:32:09,400 –&gt; 00:32:19,400<br>I don’t do that at least I don’t think I do what you’re suggesting when I send an RPC to all the peers all the peer from going to get exactly the same arguments.</p>
<p>222<br>00:32:19,400 –&gt; 00:32:26,400<br>No changes in between.</p>
<p>223<br>00:32:26,400 –&gt; 00:32:36,400<br>Okay, good. So let me then talk a little bit about the implementation can people read can people read the screen.</p>
<p>224<br>00:32:36,400 –&gt; 00:32:39,400<br>Sorry, I have a follow up.</p>
<p>225<br>00:32:39,400 –&gt; 00:32:46,400<br>So I think you mentioned that we shouldn’t lock around sending things over the plie channel.</p>
<p>226<br>00:32:46,400 –&gt; 00:33:05,400<br>Although I let me it’s risky because like while you’re holding the lock right and you send on the apply channel you might also block on sending on the apply channel because the service you must the other side must be reading correct before your own walk.</p>
<p>227<br>00:33:05,400 –&gt; 00:33:13,400<br>Of course you have buffer can unbuffered you know that changes a little bit but let’s say we have a not a buffer channel was just an unbuffered channel.</p>
<p>228<br>00:33:13,400 –&gt; 00:33:16,400<br>But the reader.</p>
<p>229<br>00:33:16,400 –&gt; 00:33:18,400<br>If there’s no reader.</p>
<p>230<br>00:33:18,400 –&gt; 00:33:21,400<br>Then this writer will block.</p>
<p>231<br>00:33:21,400 –&gt; 00:33:31,400<br>And maybe holding the lock and that might be you know, may lead to problems later and lead to deathlocks.</p>
<p>232<br>00:33:31,400 –&gt; 00:33:44,400<br>So I think that is isn’t this all right like like the apply channel will never like the client who’s calling raft won’t ever hold the lock right there like.</p>
<p>233<br>00:33:44,400 –&gt; 00:33:46,400<br>You don’t not not true.</p>
<p>234<br>00:33:46,400 –&gt; 00:33:54,400<br>Actually, these are sort of service quick sitting on top calling start and reading from the apply channel.</p>
<p>235<br>00:33:54,400 –&gt; 00:34:03,400<br>But it’s called start and start is just going to be depending on how you do it’s going to start is a threat comes into with that threat into the raft library and you’re at least in my invitation.</p>
<p>236<br>00:34:03,400 –&gt; 00:34:10,400<br>The first thing that the start function does is actually grab the raft lock.</p>
<p>237<br>00:34:10,400 –&gt; 00:34:17,400<br>And it can’t grab the lock raft lock if it actually either the apply Fred is already holding it’s trying to get something on the apply channel.</p>
<p>238<br>00:34:17,400 –&gt; 00:34:21,400<br>But the server is now won’t read from the apply channel depending on how you set it up.</p>
<p>239<br>00:34:21,400 –&gt; 00:34:25,400<br>But I mean, as you’re saying, there is a risk here you’ve got to be a little bit careful.</p>
<p>240<br>00:34:25,400 –&gt; 00:34:29,400<br>So would the solution be just to like create a new thread.</p>
<p>241<br>00:34:29,400 –&gt; 00:34:32,400<br>Yes, there’s all kinds of possible solutions here.</p>
<p>242<br>00:34:32,400 –&gt; 00:34:42,400<br>So I’m warning you that you know, there’s learning you that you have to think a little bit about how you range this.</p>
<p>243<br>00:34:42,400 –&gt; 00:34:44,400<br>Okay.</p>
<p>244<br>00:34:44,400 –&gt; 00:34:55,400<br>Well, isn’t isn’t using a single thread not sufficient because the thread that puts it onto the apply channel will still be looking at date right so long it still need to acquire the lock.</p>
<p>245<br>00:34:55,400 –&gt; 00:35:06,400<br>But let me look back off in your middle it’s easy to see that the deadlocks here correct like if you’re in the apply channel you’re not reading from the apply channel because you’re causing your calling start.</p>
<p>246<br>00:35:06,400 –&gt; 00:35:09,400<br>Like maybe I get because there’s a.</p>
<p>247<br>00:35:09,400 –&gt; 00:35:18,400<br>And start can run because the guy actually hold the lock that they can’t actually unlock because they can’t write to the fly channel because there’s no reader.</p>
<p>248<br>00:35:18,400 –&gt; 00:35:21,400<br>There’s easy to construction areas where you can get into the deadlocks.</p>
<p>249<br>00:35:21,400 –&gt; 00:35:31,400<br>Of course, you can avoid all these deadlocks that that’s the whole goal and one way to avoiding these deadlocks is actually not the whole block while writing on the channel.</p>
<p>250<br>00:35:31,400 –&gt; 00:35:34,400<br>There are other ways of doing it too.</p>
<p>251<br>00:35:34,400 –&gt; 00:35:41,400<br>I just don’t tell you in my implementation, you know, I find a convenient not to have the whole box while writing on a channel.</p>
<p>252<br>00:35:41,400 –&gt; 00:35:50,400<br>I think in general it’s bad practice.</p>
<p>253<br>00:35:50,400 –&gt; 00:35:56,400<br>Okay, back to crude.</p>
<p>254<br>00:35:56,400 –&gt; 00:35:57,400<br>Okay, good.</p>
<p>255<br>00:35:57,400 –&gt; 00:36:05,400<br>So I’m going to show you one particular implementation and again, you know, this is an implementation that I wrote over January to get ready for the class.</p>
<p>256<br>00:36:05,400 –&gt; 00:36:08,400<br>So there’s nothing particularly special about it.</p>
<p>257<br>00:36:08,400 –&gt; 00:36:15,400<br>I’m purely for myself and I’m sure you know there are things in it that you were to violently object to.</p>
<p>258<br>00:36:15,400 –&gt; 00:36:18,400<br>But you know it gives you sense you know what I did.</p>
<p>259<br>00:36:18,400 –&gt; 00:36:19,400<br>So here I go.</p>
<p>260<br>00:36:19,400 –&gt; 00:36:24,400<br>So in terms of the raft structure, I basically you know copy figure two.</p>
<p>261<br>00:36:24,400 –&gt; 00:36:28,400<br>Usually see in the code that’s going to be a lot of figure two in the code.</p>
<p>262<br>00:36:28,400 –&gt; 00:36:39,400<br>And you know the here’s the main thing you may probably the main thing to point out is like here’s the big new text is the rap lock that my code will acquire or release all over the place, but in a very coarse rate manner.</p>
<p>263<br>00:36:39,400 –&gt; 00:36:46,400<br>And the rest is just, you know, exactly as you expect, you know, the persistent state of all text state, the leader state and some snapshot state.</p>
<p>264<br>00:36:46,400 –&gt; 00:36:52,400<br>I won’t talk much about snapshot at all since you know that was really due for Friday.</p>
<p>265<br>00:36:52,400 –&gt; 00:36:54,400<br>And that’s basically it.</p>
<p>266<br>00:36:54,400 –&gt; 00:37:12,400<br>Then the interesting I’m just going to go bottom off sort of like in the beginning, you know what happens. So at some point the tester.</p>
<p>267<br>00:37:12,400 –&gt; 00:37:19,400<br>So I’m going to go to the next one.</p>
<p>268<br>00:37:19,400 –&gt; 00:37:21,400<br>I’ll go to the next one.</p>
<p>269<br>00:37:21,400 –&gt; 00:37:23,400<br>I’m going to go to the next one.</p>
<p>270<br>00:37:23,400 –&gt; 00:37:25,400<br>And here’s the last one.</p>
<p>271<br>00:37:25,400 –&gt; 00:37:26,400<br>And here’s the last one.</p>
<p>272<br>00:37:26,400 –&gt; 00:37:28,400<br>And here’s my.</p>
<p>273<br>00:37:28,400 –&gt; 00:37:30,400<br>Basically the make call.</p>
<p>274<br>00:37:30,400 –&gt; 00:37:33,400<br>It constructs, you know, the raft state.</p>
<p>275<br>00:37:33,400 –&gt; 00:37:36,400<br>You know, apply channel, the condition variable that I mentioned.</p>
<p>276<br>00:37:36,400 –&gt; 00:37:37,400<br>It sets itself to a follower.</p>
<p>277<br>00:37:37,400 –&gt; 00:37:40,400<br>Initially some other parts, you know, make an empty log.</p>
<p>278<br>00:37:40,400 –&gt; 00:37:46,400<br>And then basically for stuff to go routines, want to do a prior.</p>
<p>279<br>00:37:46,400 –&gt; 00:37:49,400<br>That’s the the threat that actually writes in the apply channel.</p>
<p>280<br>00:37:49,400 –&gt; 00:37:58,400<br>And then I got my the ticker that we basically gave you to the basically runs the ticker code.</p>
<p>281<br>00:37:58,400 –&gt; 00:38:01,400<br>So nothing particularly exciting going on here.</p>
<p>282<br>00:38:01,400 –&gt; 00:38:05,400<br>So let’s look at the ticker goat.</p>
<p>283<br>00:38:05,400 –&gt; 00:38:11,400<br>So some people ask, you know, should you structure everything in a single file multiple files.</p>
<p>284<br>00:38:11,400 –&gt; 00:38:15,400<br>Of course, it all up to you what actually is most convenient for you to actually find your goats.</p>
<p>285<br>00:38:15,400 –&gt; 00:38:18,400<br>In this case, I structured with multiple files and a half.</p>
<p>286<br>00:38:18,400 –&gt; 00:38:25,400<br>Basically, vote the go deals with all the election part.</p>
<p>287<br>00:38:25,400 –&gt; 00:38:29,400<br>So let’s look at the ticker.</p>
<p>288<br>00:38:29,400 –&gt; 00:38:32,400<br>So the ticker basically runs every 50 milliseconds.</p>
<p>289<br>00:38:32,400 –&gt; 00:38:35,400<br>And it calls this function tick.</p>
<p>290<br>00:38:35,400 –&gt; 00:38:38,400<br>And the function tick is like right up here.</p>
<p>291<br>00:38:38,400 –&gt; 00:38:48,400<br>It grips, you know, you’ll see that all over the place it graphs the graph log calls uses deferred to make sure that like no matter way I leave the function.</p>
<p>292<br>00:38:48,400 –&gt; 00:38:51,400<br>The lock actually will be released.</p>
<p>293<br>00:38:51,400 –&gt; 00:38:54,400<br>And then you know checks what it is the leader.</p>
<p>294<br>00:38:54,400 –&gt; 00:38:58,400<br>And it is a leader does one thing. It’s not a leader that means that’s a faller.</p>
<p>295<br>00:38:58,400 –&gt; 00:39:03,400<br>And it just checks what are actually the election time has passed.</p>
<p>296<br>00:39:03,400 –&gt; 00:39:08,400<br>And so basically the way a compute that is like I get the current time.</p>
<p>297<br>00:39:08,400 –&gt; 00:39:12,400<br>And see if the current time is actually past the.</p>
<p>298<br>00:39:12,400 –&gt; 00:39:17,400<br>If now is now past the election time.</p>
<p>299<br>00:39:17,400 –&gt; 00:39:20,400<br>And if that is the case, I’ll start the election.</p>
<p>300<br>00:39:20,400 –&gt; 00:39:24,400<br>And well, first I’ll set the election time out again.</p>
<p>301<br>00:39:24,400 –&gt; 00:39:26,400<br>As required by figure two.</p>
<p>302<br>00:39:26,400 –&gt; 00:39:29,400<br>And then they’ll start the election.</p>
<p>303<br>00:39:29,400 –&gt; 00:39:32,400<br>In terms of setting the election time out.</p>
<p>304<br>00:39:32,400 –&gt; 00:39:40,400<br>So the first thing, you know, the way I do it, you know, I election time out of the set to one second, which is what I got from.</p>
<p>305<br>00:39:40,400 –&gt; 00:39:42,400<br>I can hold on a second on the L.</p>
<p>306<br>00:39:42,400 –&gt; 00:39:44,400<br>That’s a good reason.</p>
<p>307<br>00:39:44,400 –&gt; 00:39:47,400<br>And then I can hold on a second from the chat.</p>
<p>308<br>00:39:47,400 –&gt; 00:39:50,400<br>The, the.</p>
<p>309<br>00:39:50,400 –&gt; 00:39:52,400<br>The selection time is one second.</p>
<p>310<br>00:39:52,400 –&gt; 00:39:58,400<br>And then of course, you know, you need to randomize, you know, the peers across the interval.</p>
<p>311<br>00:39:58,400 –&gt; 00:40:02,400<br>And I use an interval from zero to 300 milliseconds.</p>
<p>312<br>00:40:02,400 –&gt; 00:40:04,400<br>And add that to the election time out.</p>
<p>313<br>00:40:04,400 –&gt; 00:40:09,400<br>And so basically every peer likely has to have has a slightly different election time out.</p>
<p>314<br>00:40:09,400 –&gt; 00:40:15,400<br>And so they will call take a different stages and you know, we had a bit of luck.</p>
<p>315<br>00:40:15,400 –&gt; 00:40:19,400<br>Only one or a few actually will start the election.</p>
<p>316<br>00:40:19,400 –&gt; 00:40:21,400<br>I have a question.</p>
<p>317<br>00:40:21,400 –&gt; 00:40:26,400<br>So you’re only like checking every like 50 milliseconds, right?</p>
<p>318<br>00:40:26,400 –&gt; 00:40:29,400<br>Doesn’t that lead to like contest of like elections?</p>
<p>319<br>00:40:29,400 –&gt; 00:40:33,400<br>Like because you’re essentially like, it doesn’t just like limit.</p>
<p>320<br>00:40:33,400 –&gt; 00:40:38,400<br>Like, you know, you technically can like get.</p>
<p>321<br>00:40:38,400 –&gt; 00:40:43,400<br>Anywhere from three to like zero to 300 right like.</p>
<p>322<br>00:40:43,400 –&gt; 00:40:51,400<br>Like you get from one second to 300 and one second to any value between 1000 milliseconds of 1300 milliseconds.</p>
<p>323<br>00:40:51,400 –&gt; 00:40:52,400<br>Right.</p>
<p>324<br>00:40:52,400 –&gt; 00:41:00,400<br>So, but at the end of the day, like, because you’re like only checking every 50 milliseconds doesn’t that just give it like.</p>
<p>325<br>00:41:00,400 –&gt; 00:41:03,400<br>I just more course rate, but it’s good enough.</p>
<p>326<br>00:41:03,400 –&gt; 00:41:04,400<br>Okay.</p>
<p>327<br>00:41:04,400 –&gt; 00:41:06,400<br>I mean, basically too constraints here, correct?</p>
<p>328<br>00:41:06,400 –&gt; 00:41:09,400<br>You know, you don’t want to be too slow.</p>
<p>329<br>00:41:09,400 –&gt; 00:41:13,400<br>And because that means that you’re takes a long time before you start a new election.</p>
<p>330<br>00:41:13,400 –&gt; 00:41:17,400<br>And you don’t want to be too fast because you know, then you start too many elections.</p>
<p>331<br>00:41:17,400 –&gt; 00:41:21,400<br>And you need to allow for some time for an election to lose some, you know,</p>
<p>332<br>00:41:21,400 –&gt; 00:41:23,400<br>some votes may get delayed.</p>
<p>333<br>00:41:23,400 –&gt; 00:41:32,400<br>And you don’t want to restart it before, you know, you have a chance before the candidate has chance to sort of do a couple of rounds of communication with the followers.</p>
<p>334<br>00:41:32,400 –&gt; 00:41:35,400<br>Okay.</p>
<p>335<br>00:41:35,400 –&gt; 00:41:39,400<br>So, somebody or people are speculating about my capital L.</p>
<p>336<br>00:41:39,400 –&gt; 00:41:42,400<br>This was just an experiment, you know, for this implementation.</p>
<p>337<br>00:41:42,400 –&gt; 00:41:48,400<br>I follow the convention and I probably broke it in some places, but I followed the consumption that.</p>
<p>338<br>00:41:48,400 –&gt; 00:41:57,400<br>If the caller or the colleague assumes that the lock is held, then I put a capital L behind the function.</p>
<p>339<br>00:41:57,400 –&gt; 00:42:08,400<br>And I thought I would start election, the assumes that the caller actually is required to lock and basically any function or structure of an L has that particular, you know, assumes that convention.</p>
<p>340<br>00:42:08,400 –&gt; 00:42:12,400<br>And so this is purely a coding convention for myself.</p>
<p>341<br>00:42:12,400 –&gt; 00:42:15,400<br>And I thought it was sort of interesting to write it up in this implementation.</p>
<p>342<br>00:42:15,400 –&gt; 00:42:21,400<br>I not always do that, but I just did it in this one.</p>
<p>343<br>00:42:21,400 –&gt; 00:42:23,400<br>Any questions?</p>
<p>344<br>00:42:23,400 –&gt; 00:42:29,400<br>Okay.</p>
<p>345<br>00:42:29,400 –&gt; 00:42:35,400<br>Okay. Well, let’s look at the election part and you’ll see here start election.</p>
<p>346<br>00:42:35,400 –&gt; 00:42:42,400<br>So, you know, it doesn’t require a lock, but because I assume the caller holds it and basically just follows figure two.</p>
<p>347<br>00:42:42,400 –&gt; 00:42:48,400<br>So, first, you know, the rule is you have to increment the current term by once I do that.</p>
<p>348<br>00:42:48,400 –&gt; 00:42:58,400<br>I set the state to candidates, you know, also dictated by figure two, basically, I record that I voted for myself. This is also part of figure two.</p>
<p>349<br>00:42:58,400 –&gt; 00:43:08,400<br>And then, you know, this is for lap C, you know, to see you ready to know that like whenever you change, basically state that’s to be persistent, you have to persist at right after.</p>
<p>350<br>00:43:08,400 –&gt; 00:43:19,400<br>So, that’s it. And basically here in here, you see my debugging messages, like, you know, what Jose says, you know, I always have to source at the beginning and just simplifies my life.</p>
<p>351<br>00:43:19,400 –&gt; 00:43:31,400<br>And I have a bunch of other sort of, I don’t have a perilscript or reply transcript is nicely used Jose, but I have a bunch of sort of unique scripts that I use to parse the law and create a process it.</p>
<p>352<br>00:43:31,400 –&gt; 00:43:37,400<br>And then, you know, we call request votes and request votes is right up here.</p>
<p>353<br>00:43:37,400 –&gt; 00:43:48,400<br>And we’ll see in second, you know, how this is all going to work out, but basically it as sales said, you know, we construct the arguments once, you know, upfront.</p>
<p>354<br>00:43:48,400 –&gt; 00:43:53,400<br>And let me, so let’s look at the request for the votes arguments.</p>
<p>355<br>00:43:53,400 –&gt; 00:44:07,400<br>And basically, you know, your data here, and you know, basically it contains exactly, you know, what, you know, basically figure two says that you contain the term the candidate ID, the last block index and the last block term.</p>
<p>356<br>00:44:07,400 –&gt; 00:44:20,400<br>And system struct and one thing maybe worth pointing out is I do try to write these string functions that, you know, allow go, you know, when you type in percent fee, you know, we’ll call that string function on this struct.</p>
<p>357<br>00:44:20,400 –&gt; 00:44:27,400<br>And it allows you to format, you know, the, the structure, the request in a sort of a nice way.</p>
<p>358<br>00:44:27,400 –&gt; 00:44:31,400<br>And again, that helps with me, that helps me processing my law.</p>
<p>359<br>00:44:31,400 –&gt; 00:44:37,400<br>And so basically every request argument that I have, I print in one standard way.</p>
<p>360<br>00:44:37,400 –&gt; 00:44:46,400<br>And again, to simplify log processing.</p>
<p>361<br>00:44:46,400 –&gt; 00:44:58,400<br>And then I put back to studying elections. So multiple followers who started at the same time, you know, they become one of them is hopefully starts first it becomes candidate.</p>
<p>362<br>00:44:58,400 –&gt; 00:45:08,400<br>And it does request votes and here I construct the arguments, I put the current term in here, it’s going to be one if this is the first time for the election, you know, who I am.</p>
<p>363<br>00:45:08,400 –&gt; 00:45:17,400<br>And that’s just one index is, you know, which usually is zero or one, whatever the, you know, it’s going to be zero, I guess.</p>
<p>364<br>00:45:17,400 –&gt; 00:45:24,400<br>And then the term in that entry, which is the term zero.</p>
<p>365<br>00:45:24,400 –&gt; 00:45:33,400<br>Because, you know, what we’re doing, correct, if we’re running an election for one and you need to show what the previous ones were.</p>
<p>366<br>00:45:33,400 –&gt; 00:45:42,400<br>Okay, so then here, this is sort of my standard way of sending RPCs, you just go for all the peers skipping myself.</p>
<p>367<br>00:45:42,400 –&gt; 00:45:46,400<br>Of course, I have to count that I voted for myself. So I said the number votes to one.</p>
<p>368<br>00:45:46,400 –&gt; 00:45:55,400<br>And then I basically fork off and Fred that basically is going to do actually the sending the RPC to each individual peer.</p>
<p>369<br>00:45:55,400 –&gt; 00:46:07,400<br>The first argument is the peer to which the RPC sent they all get the same arguments and also passing the address with the votes so they can have a shared vote count.</p>
<p>370<br>00:46:07,400 –&gt; 00:46:10,400<br>Any questions about this.</p>
<p>371<br>00:46:10,400 –&gt; 00:46:18,400<br>So for request votes, the lock is being held and then you’re sending the RPC.</p>
<p>372<br>00:46:18,400 –&gt; 00:46:22,400<br>Yeah, so in request vote here is the lock XE health.</p>
<p>373<br>00:46:22,400 –&gt; 00:46:25,400<br>So the first one is the one that’s inside of dysfunction.</p>
<p>374<br>00:46:25,400 –&gt; 00:46:28,400<br>No, right, because it’s a new thread.</p>
<p>375<br>00:46:28,400 –&gt; 00:46:29,400<br>Yeah, it’s a new.</p>
<p>376<br>00:46:29,400 –&gt; 00:46:36,400<br>So it doesn’t hold the lock and you see my naming convention hints at that because it doesn’t have an L there.</p>
<p>377<br>00:46:36,400 –&gt; 00:46:41,400<br>Okay, so reused request votes and request votes when it actually is done running.</p>
<p>378<br>00:46:41,400 –&gt; 00:46:48,400<br>It has no walks because only the parent held the lock and this guy this red actually hasn’t acquired the lock yet.</p>
<p>379<br>00:46:48,400 –&gt; 00:46:51,400<br>So I have a lock.</p>
<p>380<br>00:46:51,400 –&gt; 00:46:57,400<br>So yeah, so so basically one Fred runs for each of these requests votes for each peer.</p>
<p>381<br>00:46:57,400 –&gt; 00:47:05,400<br>It allocates a reply structure and then basically it sends off the RPC right and this is all done without holding the lock.</p>
<p>382<br>00:47:05,400 –&gt; 00:47:08,400<br>And then at some point we get a response back.</p>
<p>383<br>00:47:08,400 –&gt; 00:47:17,400<br>And then at that point in the response handler, I grabbed the lock right at the beginning and do whatever response handling that is necessary.</p>
<p>384<br>00:47:17,400 –&gt; 00:47:28,400<br>And as you can see, yeah, you said earlier that you shouldn’t hold the lock when you’re doing like when you’re doing a RPC call you mean like basically it’s okay to.</p>
<p>385<br>00:47:28,400 –&gt; 00:47:34,400<br>It’s okay for the RPC call itself in the RPC call to do to hold a lock but not like while you’re calling.</p>
<p>386<br>00:47:34,400 –&gt; 00:47:39,400<br>Yeah, not not across this like why are you sending it across and cross sending it over to network.</p>
<p>387<br>00:47:39,400 –&gt; 00:47:42,400<br>But it’s okay if you’re doing it within the RPC.</p>
<p>388<br>00:47:42,400 –&gt; 00:47:52,400<br>So the reply handler like think about this is like ways through the reply handler running like so the response came back and now there’s a reply and I have to process the reply.</p>
<p>389<br>00:47:52,400 –&gt; 00:48:02,400<br>Oh no, I’m talking about like say in the request vote like the capital R requests capsule V votes that’s okay to hold locks in there at least.</p>
<p>390<br>00:48:02,400 –&gt; 00:48:04,400<br>Where you want to hold locks.</p>
<p>391<br>00:48:04,400 –&gt; 00:48:08,400<br>So like so like capsule request votes here.</p>
<p>392<br>00:48:08,400 –&gt; 00:48:10,400<br>Yeah, that’s what I’m talking about.</p>
<p>393<br>00:48:10,400 –&gt; 00:48:12,400<br>This one.</p>
<p>394<br>00:48:12,400 –&gt; 00:48:14,400<br>No, like the function here.</p>
<p>395<br>00:48:14,400 –&gt; 00:48:22,400<br>So it’s request vote but it’s I think it’s capital R. Yeah.</p>
<p>396<br>00:48:22,400 –&gt; 00:48:27,400<br>So like you probably have a method right it’s the RPC call.</p>
<p>397<br>00:48:27,400 –&gt; 00:48:30,400<br>I think you mean on the RPC on the receiver side.</p>
<p>398<br>00:48:30,400 –&gt; 00:48:31,400<br>Okay, the other.</p>
<p>399<br>00:48:31,400 –&gt; 00:48:37,400<br>Yeah, yeah, yeah, we’ll look at it in a second of course that will run on the completely you know way to think about it runs on a totally different machine.</p>
<p>400<br>00:48:37,400 –&gt; 00:48:39,400<br>Yeah, yeah, absolutely.</p>
<p>401<br>00:48:39,400 –&gt; 00:48:48,400<br>So so basically it’s two plays of our hope the lock like in the handler in the request handler and in the reply handler.</p>
<p>402<br>00:48:48,400 –&gt; 00:48:50,400<br>Hey, thank you.</p>
<p>403<br>00:48:50,400 –&gt; 00:48:55,400<br>Sorry, sorry for being confused and glad we clarified that.</p>
<p>404<br>00:48:55,400 –&gt; 00:49:01,400<br>Okay, so grab the lock then put a print statement in the logs that I can know what’s later on I can study it.</p>
<p>405<br>00:49:01,400 –&gt; 00:49:09,400<br>And then of course you know the basic checks you know that you know you’re actually figure two different things much about it.</p>
<p>406<br>00:49:09,400 –&gt; 00:49:13,400<br>But you know this is the rule that applies to all.</p>
<p>407<br>00:49:13,400 –&gt; 00:49:20,400<br>Service correct the term is bigger than the reply term is better than the current term.</p>
<p>408<br>00:49:20,400 –&gt; 00:49:27,400<br>Then you got to switch to the follower state and to the term of the.</p>
<p>409<br>00:49:27,400 –&gt; 00:49:29,400<br>And then you have to respond to you.</p>
<p>410<br>00:49:29,400 –&gt; 00:49:31,400<br>I’ll look at that in a second.</p>
<p>411<br>00:49:31,400 –&gt; 00:49:43,400<br>So that basically you know if this is the candidate and it was talking to appear that actually was in a higher term and basically backs off and becomes a follower.</p>
<p>412<br>00:49:43,400 –&gt; 00:49:45,400<br>Okay, so.</p>
<p>413<br>00:49:45,400 –&gt; 00:49:53,400<br>So if you know the follow respond that saying that I’m granting my vote then I increment you know number votes that the shared vote got by one.</p>
<p>414<br>00:49:53,400 –&gt; 00:49:57,400<br>It’s totally safe to do correct because you know I’m holding the raft lock.</p>
<p>415<br>00:49:57,400 –&gt; 00:50:09,400<br>And so this is a serialized so multiple thing that will happen correct this multiple responses will come back and they may run in parallel, but they will be serialized because of the raft lock.</p>
<p>416<br>00:50:09,400 –&gt; 00:50:16,400<br>So add up the votes if the votes is longer than the you know if I have a majority of the votes then.</p>
<p>417<br>00:50:16,400 –&gt; 00:50:24,400<br>And if I’m still in the same term as the start when I started out actually running the election.</p>
<p>418<br>00:50:24,400 –&gt; 00:50:29,400<br>Then I’m going to become a leader and I’ll send out you know the first round of heart beats.</p>
<p>419<br>00:50:29,400 –&gt; 00:50:32,400<br>So I’ll look in a second.</p>
<p>420<br>00:50:32,400 –&gt; 00:50:37,400<br>I want to look at two things. Let’s see what become leader is become leader you know right up here.</p>
<p>421<br>00:50:37,400 –&gt; 00:50:44,400<br>You know has capital L because it’s you know already holds the lock basically sets the state to the leader state.</p>
<p>422<br>00:50:44,400 –&gt; 00:50:48,400<br>And initializes the next index.</p>
<p>423<br>00:50:48,400 –&gt; 00:50:53,400<br>And the next index is a settling last lecture is basically guess and it’s an optimistic guess.</p>
<p>424<br>00:50:53,400 –&gt; 00:50:57,400<br>You know I just said it to whatever my last index is plus one.</p>
<p>425<br>00:50:57,400 –&gt; 00:51:00,400<br>So basically I’m assuming that all the followers are up to date.</p>
<p>426<br>00:51:00,400 –&gt; 00:51:04,400<br>And if they’re not you know we’ll see later they will back off.</p>
<p>427<br>00:51:04,400 –&gt; 00:51:10,400<br>I’ll back off on the appendentry sorry I reply.</p>
<p>428<br>00:51:10,400 –&gt; 00:51:12,400<br>Okay good.</p>
<p>429<br>00:51:12,400 –&gt; 00:51:14,400<br>So that’s become leader.</p>
<p>430<br>00:51:14,400 –&gt; 00:51:17,400<br>Let me look at new term.</p>
<p>431<br>00:51:17,400 –&gt; 00:51:27,400<br>So new term is nothing really you know too exciting it basically says again we’ll go to the next term that we supplied by the collar.</p>
<p>432<br>00:51:27,400 –&gt; 00:51:41,400<br>I said voted for to minus one because I haven’t voted yet in this term and I changed to my state to follow her because this is going to state that needs to be persistent I call persistent.</p>
<p>433<br>00:51:41,400 –&gt; 00:51:55,400<br>Okay so this is sort of the candidate site and now we want to look at the fall arrest site or perhaps another candidate as I was running a election in parallel.</p>
<p>434<br>00:51:55,400 –&gt; 00:52:05,400<br>So so here’s the request vote handler and this is sort of running so this is the piece of code that runs on the other machine if you will correct or where.</p>
<p>435<br>00:52:05,400 –&gt; 00:52:09,400<br>Where I just was confused about a little bit and answering that question.</p>
<p>436<br>00:52:09,400 –&gt; 00:52:21,400<br>And you know you just could see the first thing it does this is a vote by the RPC library system correct and with its own thread and the first thing it does it actually grabs the lock on the raft structure.</p>
<p>437<br>00:52:21,400 –&gt; 00:52:39,400<br>You know this follows literally the rules figure two you know this the rule for all servers correct if the term the argument the term in the argument is higher than my current term then I should switch you know to this new term and that’s it.</p>
<p>438<br>00:52:39,400 –&gt; 00:52:57,400<br>Then you’re sort of the you know the instinct piece correct this is all related to figure eight see what it means to be or not eight see figure seven what it means to be up to date great you can only become a leader if you’re up to date so I compute you know the up to date function and.</p>
<p>439<br>00:52:57,400 –&gt; 00:53:11,400<br>And that’s basically based on the last index work and the term in the last index and so it says up the date is my our the term in the arguments is equal to my term in the.</p>
<p>440<br>00:53:11,400 –&gt; 00:53:22,400<br>The call the color the candidate has a last login that just equal a higher to my index so basically to turn for equal the longer lock should win.</p>
<p>441<br>00:53:22,400 –&gt; 00:53:31,400<br>And or if you know the candidates is in a higher term period then he always wins the candidate wins.</p>
<p>442<br>00:53:31,400 –&gt; 00:53:50,400<br>So that means to be up to date so compute up to date and then basically go through the different cases if the terms smaller than the current term that means that the color is behind and so I vote granted to false and then in the other case if I haven’t voted or I voted you know already voted for this candidate.</p>
<p>443<br>00:53:50,400 –&gt; 00:54:02,400<br>And you know the candidates is up to date then I give my vote and and reset the election time at.</p>
<p>444<br>00:54:02,400 –&gt; 00:54:13,400<br>So why why is this the second case here the or the R voted for is our candidate ID.</p>
<p>445<br>00:54:13,400 –&gt; 00:54:20,400<br>Because the the candidate may resend maybe the RPC was delayed.</p>
<p>446<br>00:54:20,400 –&gt; 00:54:24,400<br>Yeah we’re doing it or actually never made it right.</p>
<p>447<br>00:54:24,400 –&gt; 00:54:34,400<br>And so you know this is basically checking so this allows me to vote twice for the same candidate but I can’t vote for any other candidate.</p>
<p>448<br>00:54:34,400 –&gt; 00:54:54,400<br>So just to double check the logic here so if we have the candidate has a term that is bigger than the current term we obviously have to convert to follower and update the term to the term of the candidate but we don’t automatically grant them vote unless their log is at least is up to date.</p>
<p>449<br>00:54:54,400 –&gt; 00:54:55,400<br>Yeah.</p>
<p>450<br>00:54:55,400 –&gt; 00:54:58,400<br>I talked about that.</p>
<p>451<br>00:54:58,400 –&gt; 00:55:03,400<br>I’m also wondering is voted for every set to minus one.</p>
<p>452<br>00:55:03,400 –&gt; 00:55:10,400<br>Yep when they go to new term ever always I knew said it always whenever you go to the new term.</p>
<p>453<br>00:55:10,400 –&gt; 00:55:11,400<br>Okay.</p>
<p>454<br>00:55:11,400 –&gt; 00:55:16,400<br>I said it’s the one place where this happens.</p>
<p>455<br>00:55:16,400 –&gt; 00:55:24,400<br>Any questions.</p>
<p>456<br>00:55:24,400 –&gt; 00:55:32,400<br>So this is probably a reasonable good sense about the overall structure and everything else falls to sort of roughly the same structure.</p>
<p>457<br>00:55:32,400 –&gt; 00:55:41,400<br>And so let’s go back and go here so let’s see you know let’s assume this guy actually the leader or the candidate wins the election.</p>
<p>458<br>00:55:41,400 –&gt; 00:55:44,400<br>So it started the election go trace back.</p>
<p>459<br>00:55:44,400 –&gt; 00:55:47,400<br>So we started the election.</p>
<p>460<br>00:55:47,400 –&gt; 00:55:50,400<br>So we got the votes.</p>
<p>461<br>00:55:50,400 –&gt; 00:56:03,400<br>And we won the election and we became the leader and then the first thing that the figure truth tells you to do is like send a heartbeat to every peer.</p>
<p>462<br>00:56:03,400 –&gt; 00:56:08,400<br>And so basically this is going to be the standard code for sending a pants.</p>
<p>463<br>00:56:08,400 –&gt; 00:56:23,400<br>In fact, you know the heartbeat code is identical to the cent a pen entry code except you know the heartbeat often will may have a no entry or no entries in the log that is being sent to the followers.</p>
<p>464<br>00:56:23,400 –&gt; 00:56:28,400<br>Okay. So since the pens falls the same structure as send votes.</p>
<p>465<br>00:56:28,400 –&gt; 00:56:38,400<br>So cycle over all the peers and the peers not equal to me then basically send a different.</p>
<p>466<br>00:56:38,400 –&gt; 00:56:43,400<br>And so here is the cent a pen.</p>
<p>467<br>00:56:43,400 –&gt; 00:56:52,400<br>And you know basically we’re keeping track right of who what the next log entry that the peer should have.</p>
<p>468<br>00:56:52,400 –&gt; 00:56:56,400<br>So we’re going to get the initialized to an optimistic guest in equal to ours.</p>
<p>469<br>00:56:56,400 –&gt; 00:57:01,400<br>So basically in this case there’s going to be no log entries that are going to be sent.</p>
<p>470<br>00:57:01,400 –&gt; 00:57:03,400<br>So I can skip all this stuff for now.</p>
<p>471<br>00:57:03,400 –&gt; 00:57:07,400<br>Now we’ll come back to it when we’re looking actually at start.</p>
<p>472<br>00:57:07,400 –&gt; 00:57:10,400<br>I fill in the append entry arguments.</p>
<p>473<br>00:57:10,400 –&gt; 00:57:17,400<br>And we can look at the structure if you’d like to, but you know it is exactly as in figure two.</p>
<p>474<br>00:57:17,400 –&gt; 00:57:21,400<br>The only thing is a little bit we can carefully you got to be a little bit careful about is.</p>
<p>475<br>00:57:21,400 –&gt; 00:57:29,400<br>I allocate a slice you know to hold the entries that need to be sent in this particular case number of entries is zero.</p>
<p>476<br>00:57:29,400 –&gt; 00:57:41,400<br>Because we’re assuming that everybody’s up to date and then a copy you know the parts from the slices from the log in the raft structure to the.</p>
<p>477<br>00:57:41,400 –&gt; 00:57:44,400<br>To the entries in the arguments.</p>
<p>478<br>00:57:44,400 –&gt; 00:57:49,400<br>And so I have to really my own copy at this point of the log.</p>
<p>479<br>00:57:49,400 –&gt; 00:57:53,400<br>There’s a little bit of a danger correct that like slices share memory.</p>
<p>480<br>00:57:53,400 –&gt; 00:57:56,400<br>So this is why the copy needs to happen.</p>
<p>481<br>00:57:56,400 –&gt; 00:58:04,400<br>So I copy the entries out of the raft structure that I hold the log on into my private argument structure.</p>
<p>482<br>00:58:04,400 –&gt; 00:58:15,400<br>And once done is done basically I sent you know I started go function or go go go routine for every peer and in that no go function in that.</p>
<p>483<br>00:58:15,400 –&gt; 00:58:26,400<br>And in that function I send the RPC and then in the reply handler you know I grabbed the log just reply handler of the RPC I grabbed the log and then process the reply.</p>
<p>484<br>00:58:26,400 –&gt; 00:58:30,400<br>The append reply.</p>
<p>485<br>00:58:30,400 –&gt; 00:58:34,400<br>Does all make sense.</p>
<p>486<br>00:58:34,400 –&gt; 00:58:38,400<br>Yeah, yeah, go ahead.</p>
<p>487<br>00:58:38,400 –&gt; 00:58:47,400<br>One little question. So in send a pencil we have we have the loop in which we call RF.CenderPendel.</p>
<p>488<br>00:58:47,400 –&gt; 00:58:58,400<br>And we assume the lock is held through that call but we do the you know any thread at which point the thread let’s go to the lock right.</p>
<p>489<br>00:58:58,400 –&gt; 00:59:08,400<br>Okay, so like there’s an other loop correct where somebody to call our holds the lock and basically it calls send a pen L you know n times correct where n is the number of peers minus one.</p>
<p>490<br>00:59:08,400 –&gt; 00:59:18,400<br>And for every one of them for every iteration of that loop you know we’re going to create a new go function that go function runs without holding the locks right.</p>
<p>491<br>00:59:18,400 –&gt; 00:59:25,400<br>So it will send its RPC about all in the locks and at the same time a new go function might be started by the caller.</p>
<p>492<br>00:59:25,400 –&gt; 00:59:28,400<br>That actually also is going to do send RPC.</p>
<p>493<br>00:59:28,400 –&gt; 00:59:33,400<br>No, the sent RPC is going parallel to the followers. The followers respond.</p>
<p>494<br>00:59:33,400 –&gt; 00:59:45,400<br>And so all the responses come back in that will so that will return you know when the follower response comes in that returns from send RPC and at that point I grabbed the log you know to process through the plot.</p>
<p>495<br>00:59:45,400 –&gt; 01:00:00,400<br>So if the caller were still busy sending RPCs to the followers then basically you know the reply hand will block correct until the caller is done sending all the RPCs.</p>
<p>496<br>01:00:00,400 –&gt; 01:00:15,400<br>Yeah, so my question was I assumed why that happens is because you had a we had a differ RF that lock and lock is that’s why it doesn’t hold the lock when it starts to thread right.</p>
<p>497<br>01:00:15,400 –&gt; 01:00:20,400<br>Or is that just when you start a friend you don’t hold any locks.</p>
<p>498<br>01:00:20,400 –&gt; 01:00:31,400<br>Yeah, yeah, like whatever it is, even if we don’t have like that, like even if we tried to hold the lock right before the go call it wouldn’t hold it.</p>
<p>499<br>01:00:31,400 –&gt; 01:00:33,400<br>That’s right.</p>
<p>500<br>01:00:33,400 –&gt; 01:00:35,400<br>Yeah, yeah, yeah.</p>
<p>501<br>01:00:35,400 –&gt; 01:00:37,400<br>I was sort of follow up.</p>
<p>502<br>01:00:37,400 –&gt; 01:00:46,400<br>So in the if okay block, where’s the defer being like called from from the return statement of that method.</p>
<p>503<br>01:00:46,400 –&gt; 01:00:53,400<br>And this block exits when this block exits then the defer the new unlock will be called.</p>
<p>504<br>01:00:53,400 –&gt; 01:01:03,400<br>So the defer the defer is called when the surrounding basic block exits or not just return statements not just return statements that’s correct.</p>
<p>505<br>01:01:03,400 –&gt; 01:01:04,400<br>Okay.</p>
<p>506<br>01:01:04,400 –&gt; 01:01:05,400<br>Cool.</p>
<p>507<br>01:01:05,400 –&gt; 01:01:06,400<br>That’s cool.</p>
<p>508<br>01:01:06,400 –&gt; 01:01:07,400<br>It’s very heavy.</p>
<p>509<br>01:01:07,400 –&gt; 01:01:15,400<br>Can you repeat that so when does the defer ex it like defer is called like so when this defer or this unlock runs when this basic block.</p>
<p>510<br>01:01:15,400 –&gt; 01:01:20,400<br>Exits or returns or goes out whatever would turn all you want to run.</p>
<p>511<br>01:01:20,400 –&gt; 01:01:27,400<br>So if you return from this basic block, this unlock will happen.</p>
<p>512<br>01:01:27,400 –&gt; 01:01:39,400<br>Sorry, why you need to check if the current term is still the term that you thought you were in because some requests can be slow and you might receive a response.</p>
<p>513<br>01:01:39,400 –&gt; 01:01:40,400<br>Yep.</p>
<p>514<br>01:01:40,400 –&gt; 01:01:41,400<br>Okay.</p>
<p>515<br>01:01:41,400 –&gt; 01:01:45,400<br>So here, let’s look at process a pen reply.</p>
<p>516<br>01:01:45,400 –&gt; 01:01:48,400<br>I think this is what you’re asking like what does it do.</p>
<p>517<br>01:01:48,400 –&gt; 01:01:50,400<br>And we haven’t looked at it yet.</p>
<p>518<br>01:01:50,400 –&gt; 01:01:52,400<br>So we can look at it.</p>
<p>519<br>01:01:52,400 –&gt; 01:01:56,400<br>And actually reasonable complicated.</p>
<p>520<br>01:01:56,400 –&gt; 01:01:59,400<br>It follows the general rule for all service.</p>
<p>521<br>01:01:59,400 –&gt; 01:02:06,400<br>If the reply term is big on my current term, then you know, I got switched to becoming a follower and you know going to a new term.</p>
<p>522<br>01:02:06,400 –&gt; 01:02:10,400<br>If it is actually equal to my term, correct. This is where you’re asking.</p>
<p>523<br>01:02:10,400 –&gt; 01:02:18,400<br>If I do the reply comes in in the same term that I sent it in, you know, my arcs, term, then I’m going to do.</p>
<p>524<br>01:02:18,400 –&gt; 01:02:25,400<br>I have a different function that actually does all the processing assuming that at least the terms are matching.</p>
<p>525<br>01:02:25,400 –&gt; 01:02:26,400<br>Oh, sorry, sorry.</p>
<p>526<br>01:02:26,400 –&gt; 01:02:29,400<br>I’m ending the leader when it receives a response to have.</p>
<p>527<br>01:02:29,400 –&gt; 01:02:32,400<br>You had like a check for the.</p>
<p>528<br>01:02:32,400 –&gt; 01:02:35,400<br>Yeah, I’m basically having a year to it’s like the same check here.</p>
<p>529<br>01:02:35,400 –&gt; 01:02:36,400<br>I see.</p>
<p>530<br>01:02:36,400 –&gt; 01:02:37,400<br>I see.</p>
<p>531<br>01:02:37,400 –&gt; 01:02:41,400<br>Okay.</p>
<p>532<br>01:02:41,400 –&gt; 01:02:46,400<br>Okay. So you know, basically you this is then the.</p>
<p>533<br>01:02:46,400 –&gt; 01:02:49,400<br>A pen entries reply code.</p>
<p>534<br>01:02:49,400 –&gt; 01:02:52,400<br>So what the handler that runs in response to a reply.</p>
<p>535<br>01:02:52,400 –&gt; 01:02:57,400<br>We know that the term matches and we check reply success.</p>
<p>536<br>01:02:57,400 –&gt; 01:03:04,400<br>If you reply success, you know, we update our match indexes and.</p>
<p>537<br>01:03:04,400 –&gt; 01:03:10,400<br>And next index following exactly the rules of figure two.</p>
<p>538<br>01:03:10,400 –&gt; 01:03:16,400<br>If there’s a conflict valid, you know, then you know, I process the conflict.</p>
<p>539<br>01:03:16,400 –&gt; 01:03:21,400<br>And so this is the piece of code that’s going to deal with like backing off fast.</p>
<p>540<br>01:03:21,400 –&gt; 01:03:24,400<br>And.</p>
<p>541<br>01:03:24,400 –&gt; 01:03:31,400<br>And if there’s no conflict information available, then I get back off by one.</p>
<p>542<br>01:03:31,400 –&gt; 01:03:32,400<br>Okay.</p>
<p>543<br>01:03:32,400 –&gt; 01:03:36,400<br>Is it a question about how we back off by one.</p>
<p>544<br>01:03:36,400 –&gt; 01:03:40,400<br>Is it not problem that I was thinking about this.</p>
<p>545<br>01:03:40,400 –&gt; 01:03:44,400<br>I think it wasn’t true, but I had fully convinced myself.</p>
<p>546<br>01:03:44,400 –&gt; 01:03:50,400<br>But isn’t it possible that RF.nxt index pure changed between.</p>
<p>547<br>01:03:50,400 –&gt; 01:03:54,400<br>And when we sent it and when we’re processing this response.</p>
<p>548<br>01:03:54,400 –&gt; 01:03:55,400<br>Yeah, problematic.</p>
<p>549<br>01:03:55,400 –&gt; 01:03:58,400<br>Did that command kind of using a potential.</p>
<p>550<br>01:03:58,400 –&gt; 01:04:00,400<br>A value that’s potentially changed.</p>
<p>551<br>01:04:00,400 –&gt; 01:04:01,400<br>Probably not, right?</p>
<p>552<br>01:04:01,400 –&gt; 01:04:03,400<br>Because I think your risk.</p>
<p>553<br>01:04:03,400 –&gt; 01:04:05,400<br>Your concern is valid.</p>
<p>554<br>01:04:05,400 –&gt; 01:04:08,400<br>Because certainly, you know, the raft structure might have completely changed.</p>
<p>555<br>01:04:08,400 –&gt; 01:04:11,400<br>By the time this response comes in.</p>
<p>556<br>01:04:11,400 –&gt; 01:04:14,400<br>And in the fact, you know.</p>
<p>557<br>01:04:14,400 –&gt; 01:04:18,400<br>Although unlikely, of course, because this is the response to the same here.</p>
<p>558<br>01:04:18,400 –&gt; 01:04:28,400<br>So there’s a, you know, but I might have multiple RPCs outstanding to that particular peer.</p>
<p>559<br>01:04:28,400 –&gt; 01:04:34,400<br>And so those reply handlers near my drone in some order.</p>
<p>560<br>01:04:34,400 –&gt; 01:04:35,400<br>So I have a question.</p>
<p>561<br>01:04:35,400 –&gt; 01:04:43,400<br>So why do we increment the next index by one if there’s no conflict?</p>
<p>562<br>01:04:43,400 –&gt; 01:04:47,400<br>I think this has to do that maybe at some point I hadn’t implemented the conflict.</p>
<p>563<br>01:04:47,400 –&gt; 01:04:51,400<br>The conflict term stuff yet.</p>
<p>564<br>01:04:51,400 –&gt; 01:04:56,400<br>I don’t remember whether this actually is essential or not.</p>
<p>565<br>01:04:56,400 –&gt; 01:05:00,400<br>You know, of course, like you have changed my coach multiple times.</p>
<p>566<br>01:05:00,400 –&gt; 01:05:03,400<br>And you know, as I go along, implementing the.</p>
<p>567<br>01:05:03,400 –&gt; 01:05:07,400<br>In response to the test.</p>
<p>568<br>01:05:07,400 –&gt; 01:05:10,400<br>I don’t think there’s harm in it.</p>
<p>569<br>01:05:10,400 –&gt; 01:05:19,400<br>And I think the downside could be that I may send too many entries on the RPC or send more entries on the RPC that I really have to.</p>
<p>570<br>01:05:19,400 –&gt; 01:05:24,400<br>On the next event.</p>
<p>571<br>01:05:24,400 –&gt; 01:05:28,400<br>Okay, any questions.</p>
<p>572<br>01:05:28,400 –&gt; 01:05:32,400<br>Okay, good. Let me talk a little bit about the commit.</p>
<p>573<br>01:05:32,400 –&gt; 01:05:38,400<br>So we might have learned correct that the follower actually has.</p>
<p>574<br>01:05:38,400 –&gt; 01:05:43,400<br>Has committed some entries that we didn’t know before and the match index is updated.</p>
<p>575<br>01:05:43,400 –&gt; 01:05:44,400<br>And so.</p>
<p>576<br>01:05:44,400 –&gt; 01:05:53,400<br>So basically I always check after, you know, processing and apply and whatever I should advance, you know, the commit point.</p>
<p>577<br>01:05:53,400 –&gt; 01:06:03,400<br>And this is basically the, you know, the, this code corresponds to the last bullet of the leaders in figure two.</p>
<p>578<br>01:06:03,400 –&gt; 01:06:07,400<br>Literally, influence what actually you’re supposed to be happening there.</p>
<p>579<br>01:06:07,400 –&gt; 01:06:13,400<br>And probably the only thing that’s sort of interesting in here is this particular point.</p>
<p>580<br>01:06:13,400 –&gt; 01:06:16,400<br>And this has to do with figure eight.</p>
<p>581<br>01:06:16,400 –&gt; 01:06:27,400<br>Right. The scenario is that you’re a leader is not allowed to commit a previous term unless at least has committed one entry in its current term.</p>
<p>582<br>01:06:27,400 –&gt; 01:06:32,400<br>So this is this is exactly that one check that describe this section 5.4.</p>
<p>583<br>01:06:32,400 –&gt; 01:06:43,400<br>It checks whether the current walk entry that I want about to be in the entry that I’m about to commit, whether that actually has a term to different than the current term.</p>
<p>584<br>01:06:43,400 –&gt; 01:06:45,400<br>And if that’s the case, I just skip it.</p>
<p>585<br>01:06:45,400 –&gt; 01:06:56,400<br>Now happens if there’s another log entry following that term in my term for which I have a majority of the phones, then I’ll basically commit that newer one.</p>
<p>586<br>01:06:56,400 –&gt; 01:07:03,400<br>And then automatically it will also commit the previous one.</p>
<p>587<br>01:07:03,400 –&gt; 01:07:07,400<br>So that’s that figure eight problem.</p>
<p>588<br>01:07:07,400 –&gt; 01:07:19,400<br>And then I signal the supplier and the supplier, you know, me run if there’s actually, you know, let’s look at the supplier threat.</p>
<p>589<br>01:07:19,400 –&gt; 01:07:22,400<br>Here’s the supplier threat.</p>
<p>590<br>01:07:22,400 –&gt; 01:07:28,400<br>And it’s basically a fire threat to wake it up when maybe it advanced the commit point.</p>
<p>591<br>01:07:28,400 –&gt; 01:07:39,400<br>It has a last applied first graphs log has last applied and then you know basically go through here and dust to check.</p>
<p>592<br>01:07:39,400 –&gt; 01:07:41,400<br>You know, that is the rule for all servers.</p>
<p>593<br>01:07:41,400 –&gt; 01:07:51,400<br>Now when you commit something and it just follows that rule and then basically write something to the applied channel. And as you can see here, I unlock before writing to the applied channel.</p>
<p>594<br>01:07:51,400 –&gt; 01:08:05,400<br>Then if there’s nothing anymore to nothing more to supply and give on the applied channel, I just do a way down the condition variable.</p>
<p>595<br>01:08:05,400 –&gt; 01:08:10,400<br>And again, different ways of writing this, but this is the way I happen to do it.</p>
<p>596<br>01:08:10,400 –&gt; 01:08:13,400<br>So what are you using the broadcast?</p>
<p>597<br>01:08:13,400 –&gt; 01:08:17,399<br>Yeah, I know why instead of signal. Yeah, no, no, no, good reason.</p>
<p>598<br>01:08:17,399 –&gt; 01:08:19,399<br>There’s only one.</p>
<p>599<br>01:08:19,399 –&gt; 01:08:25,399<br>Yeah, there’s no arm, you know, broadcast signal will in this case do exactly the same thing.</p>
<p>600<br>01:08:25,399 –&gt; 01:08:28,399<br>For the supplier.</p>
<p>601<br>01:08:28,399 –&gt; 01:08:35,399<br>So you’re using a condition variable and it seems like, like, probably natural to do that.</p>
<p>602<br>01:08:35,399 –&gt; 01:08:47,399<br>And it does advantage to doing it on it, like, on sleeping, like sleeping for a time interval, then like, you know, watching everything together.</p>
<p>603<br>01:08:47,399 –&gt; 01:08:52,399<br>I, I, I, I, I, this light code with random sleeps in them.</p>
<p>604<br>01:08:52,399 –&gt; 01:08:56,399<br>I think that was generally that style of writing code.</p>
<p>605<br>01:08:56,399 –&gt; 01:08:59,399<br>And so I don’t do that.</p>
<p>606<br>01:08:59,399 –&gt; 01:09:02,399<br>And that’s why I do sleep is in the ticker.</p>
<p>607<br>01:09:02,399 –&gt; 01:09:05,399<br>And that’s the way it plays where you have to.</p>
<p>608<br>01:09:05,399 –&gt; 01:09:07,399<br>Otherwise, I should never do that.</p>
<p>609<br>01:09:07,399 –&gt; 01:09:13,399<br>Actually, that’s, is there any disadvantage to doing it with the ticker?</p>
<p>610<br>01:09:13,399 –&gt; 01:09:14,399<br>Sorry.</p>
<p>611<br>01:09:14,399 –&gt; 01:09:20,399<br>Is there any disadvantage of like checking and like, like, updating, like, alongside with the ticker?</p>
<p>612<br>01:09:20,399 –&gt; 01:09:23,399<br>Yeah, you could do that.</p>
<p>613<br>01:09:23,399 –&gt; 01:09:25,399<br>I find that harder to reason about.</p>
<p>614<br>01:09:25,399 –&gt; 01:09:30,399<br>I do, you know, so I have one thread, we charge, there’s one thing and then the ticker thread and one thing.</p>
<p>615<br>01:09:30,399 –&gt; 01:09:35,399<br>You know, I think there are people that basically do everything in the ticker thread.</p>
<p>616<br>01:09:35,399 –&gt; 01:09:39,399<br>And you know, one of, you know, from me, it’s hard to reason about.</p>
<p>617<br>01:09:39,399 –&gt; 01:09:49,399<br>But that’s more a question of, you know, personal taste than anything.</p>
<p>618<br>01:09:49,399 –&gt; 01:09:54,399<br>Okay.</p>
<p>619<br>01:09:54,399 –&gt; 01:10:00,399<br>Any further questions?</p>
<p>620<br>01:10:00,399 –&gt; 01:10:06,399<br>Okay. I want to quickly look then at start because basically there’s nothing really left to discuss anymore.</p>
<p>621<br>01:10:06,399 –&gt; 01:10:09,399<br>You know, we talked a bit voting, we talked about appending.</p>
<p>622<br>01:10:09,399 –&gt; 01:10:16,399<br>I haven’t really discussed exactly what happens on the follower site when it gets you in a pen request.</p>
<p>623<br>01:10:16,399 –&gt; 01:10:20,399<br>But basically follows figure two and we have time left.</p>
<p>624<br>01:10:20,399 –&gt; 01:10:22,399<br>We can look at that too.</p>
<p>625<br>01:10:22,399 –&gt; 01:10:25,399<br>Here’s the start command.</p>
<p>626<br>01:10:25,399 –&gt; 01:10:30,399<br>So this is like the service calls this to a pen or an entry to the log.</p>
<p>627<br>01:10:30,399 –&gt; 01:10:33,399<br>And I get a meal grabs the log.</p>
<p>628<br>01:10:33,399 –&gt; 01:10:37,399<br>Checks with a resilble leader, if not, will return false.</p>
<p>629<br>01:10:37,399 –&gt; 01:10:42,399<br>Otherwise, we create an entry and we pen it to the log.</p>
<p>630<br>01:10:42,399 –&gt; 01:10:45,399<br>And log has to be persistent so we’re persistent.</p>
<p>631<br>01:10:45,399 –&gt; 01:10:47,399<br>And then we send the applies.</p>
<p>632<br>01:10:47,399 –&gt; 01:10:49,399<br>And this is exactly the same or we sent the appends.</p>
<p>633<br>01:10:49,399 –&gt; 01:10:54,399<br>And this is exactly the same code as the hard beats.</p>
<p>634<br>01:10:54,399 –&gt; 01:11:05,399<br>Except in like in the hard beats, you know, most likely now it’s going to actually send the entry that is that just has been appended to the log.</p>
<p>635<br>01:11:05,399 –&gt; 01:11:08,399<br>Okay.</p>
<p>636<br>01:11:09,399 –&gt; 01:11:22,399<br>You noticed that probably many places have this log dot less index log that that’s something and that’s because of like sort of extracted the log away into its own structure.</p>
<p>637<br>01:11:22,399 –&gt; 01:11:32,399<br>Here’s the log actually it has just a log of entries slice of entries and the index zero and this is really for part 2D.</p>
<p>638<br>01:11:32,399 –&gt; 01:11:37,399<br>And basically you’re going to cut up the beginning of the log the sort of global log.</p>
<p>639<br>01:11:37,399 –&gt; 01:11:45,399<br>And you need to keep track of what the index is of the first entry that actually you have recorded in your log.</p>
<p>640<br>01:11:45,399 –&gt; 01:11:53,399<br>And you know to hide most of those details away, you know, basically have an abstracted that way in this file log dot go.</p>
<p>641<br>01:11:53,399 –&gt; 01:11:59,399<br>And they’re basically functions for depending to get the start of the log, you know to cut the end to cut the cut the start.</p>
<p>642<br>01:11:59,399 –&gt; 01:12:05,399<br>And then it slides out of it, get the last index, get the particular entry or get the last entry.</p>
<p>643<br>01:12:05,399 –&gt; 01:12:16,399<br>And that might be convenient for 2D, although there’s many other ways of doing it.</p>
<p>644<br>01:12:16,399 –&gt; 01:12:22,399<br>Okay, let me go back for a second to sort of some of the questions that people asked.</p>
<p>645<br>01:12:22,399 –&gt; 01:12:32,399<br>I’m going to take, you know, hopefully I’ve answered many of them by now, but if not, let me just review a quickly to go through them.</p>
<p>646<br>01:12:32,399 –&gt; 01:12:44,399<br>So I think we talked quite extensively about the election timeout, you know how to compute it, how to check where the time out is passed.</p>
<p>647<br>01:12:44,399 –&gt; 01:12:53,399<br>The question about always when receiving a message from the leader, you know, I only reset it when I receive a message from the leader that actually is in my current term.</p>
<p>648<br>01:12:53,399 –&gt; 01:12:56,399<br>Or in my new term, I become a follower.</p>
<p>649<br>01:12:56,399 –&gt; 01:13:01,399<br>But not for somebody that’s behind in terms of terms.</p>
<p>650<br>01:13:01,399 –&gt; 01:13:08,399<br>When to send the append entries, you know, there are different ways of doing it. You can do it only in the hard beats, you know, some people done that.</p>
<p>651<br>01:13:08,399 –&gt; 01:13:13,399<br>So I’ve never sent anything in start. That’s like I showed me as I showed in the code.</p>
<p>652<br>01:13:13,399 –&gt; 01:13:17,399<br>And sometimes you people do also do it in the response.</p>
<p>653<br>01:13:17,399 –&gt; 01:13:24,399<br>If, for example, the follower is behind, you know, send immediately the remaining entries.</p>
<p>654<br>01:13:24,399 –&gt; 01:13:37,399<br>I don’t do that. I never send anything in response, although I had an implementation of dust that the risk is that I think you swamp the follower in later laps or in test for 2C and 2D.</p>
<p>655<br>01:13:37,399 –&gt; 01:13:52,399<br>You do in only some people I think just sent our sent entries only in the hard beats. So that means like every, you know, you’re not allowed to send a hard be more than 10 times a second in the rules of the game for the laps.</p>
<p>656<br>01:13:52,399 –&gt; 01:14:00,399<br>So that means that you will do a sent our paint entries once every, you know, on the milliseconds or maybe a little bit faster.</p>
<p>657<br>01:14:00,399 –&gt; 01:14:11,399<br>That may be running to problems in lap 3 where we actually see if you make a fast enough progress.</p>
<p>658<br>01:14:11,399 –&gt; 01:14:15,399<br>So basically I do it in the hard beats and I do it in start.</p>
<p>659<br>01:14:15,399 –&gt; 01:14:18,399<br>I think we talked quite extensively about debugging.</p>
<p>660<br>01:14:18,399 –&gt; 01:14:24,399<br>I’ve talked a bunch about code organization. I think we talked quite a bit about concurrency.</p>
<p>661<br>01:14:24,399 –&gt; 01:14:33,399<br>There’s a number of questions about like why 3.5 is 7 servers and they have more. I think this is the reason that is the case because I think it reflects how raft is actually used in practice.</p>
<p>662<br>01:14:33,399 –&gt; 01:14:39,399<br>And really that 3.5 is 7 is based on the computation of known what the meantime between failures are.</p>
<p>663<br>01:14:39,399 –&gt; 01:14:45,399<br>Right. And in the raft paper, it’s assumed that the meantime between the failures are rough, you know, couple, couple of months.</p>
<p>664<br>01:14:45,399 –&gt; 01:14:54,399<br>So if you run with free servers and one goes down, you know, you have plenty of time to actually rebuild a third server and get it back online.</p>
<p>665<br>01:14:54,399 –&gt; 01:14:59,399<br>And so get back to free before hopefully the next failure happens.</p>
<p>666<br>01:14:59,399 –&gt; 01:15:08,399<br>So that’s why you know this small number of servers.</p>
<p>667<br>01:15:08,399 –&gt; 01:15:11,399<br>We talked a little bit about when to persist.</p>
<p>668<br>01:15:11,399 –&gt; 01:15:18,399<br>There’s a number of good questions about like, and what happens if you crash while writing to stable storage.</p>
<p>669<br>01:15:18,399 –&gt; 01:15:22,399<br>And so you may write partial state and that would be a disaster.</p>
<p>670<br>01:15:22,399 –&gt; 01:15:28,399<br>And so typically what people do is actually to make sure that when they write to stable stores that is an atomic operation.</p>
<p>671<br>01:15:28,399 –&gt; 01:15:41,399<br>You know, this does show up in the tester because the tester basically sort of simulates a persistent storage and basically updates the the persistent storage, atomically, within a real system that actually has a disk.</p>
<p>672<br>01:15:41,399 –&gt; 01:15:54,399<br>You might like like a trick like the map reduce library did where the atomic reading refers right in temporary file, everything’s written and then you’re talking to reading or use a lot right and logging system.</p>
<p>673<br>01:15:54,399 –&gt; 01:16:05,399<br>But yeah, you have to that be a disaster if the crash over the persistent state to stable storage becomes inconsistent.</p>
<p>674<br>01:16:05,399 –&gt; 01:16:09,399<br>Let me stop here so that like it does maybe a little bit more time to ask questions.</p>
<p>675<br>01:16:09,399 –&gt; 01:16:14,399<br>And of course, I’ll stay around and as always, and I can answer more questions.</p>
<p>676<br>01:16:14,399 –&gt; 01:16:22,399<br>I see there’s also a ton of discussion that chat. I’m not I’m unfortunately not able probably I didn’t keep up with all of it.</p>
<p>677<br>01:16:22,399 –&gt; 01:16:31,399<br>Okay, good.</p>
<p>678<br>01:16:31,399 –&gt; 01:16:35,399<br>Okay, so yeah, any more questions.</p>
<p>679<br>01:16:35,399 –&gt; 01:16:38,399<br>I have a question about the log.</p>
<p>680<br>01:16:38,399 –&gt; 01:16:42,399<br>You’re in your code for the log.</p>
<p>681<br>01:16:42,399 –&gt; 01:16:46,399<br>The index zero, it is.</p>
<p>682<br>01:16:46,399 –&gt; 01:16:54,399<br>I guess in the underlying array, what the start of the log is, is that right?</p>
<p>683<br>01:16:54,399 –&gt; 01:17:04,399<br>So this is basically for lap 2d, not for no in laps a b and c index zero would be all the always zero.</p>
<p>684<br>01:17:04,399 –&gt; 01:17:12,399<br>And lap 2d where you take snapshots, you know, the index zero would know the index not about the snapshot.</p>
<p>685<br>01:17:12,399 –&gt; 01:17:15,399<br>Because you’re going to cut the beginning of the log.</p>
<p>686<br>01:17:15,399 –&gt; 01:17:23,399<br>Okay, so if you take a snapshot index 10, you know, you’re going to cut 0 for 9 and index zero will be 10.</p>
<p>687<br>01:17:23,399 –&gt; 01:17:30,399<br>Oh, this is the end of the snapshot.</p>
<p>688<br>01:17:30,399 –&gt; 01:17:35,399<br>So basically everything through to until index zero is actually included in a snapshot.</p>
<p>689<br>01:17:35,399 –&gt; 01:17:45,399<br>So there’s no reason to maintain that and that’s take any more into log.</p>
<p>690<br>01:17:45,399 –&gt; 01:17:51,399<br>Any other questions.</p>
<p>691<br>01:17:51,399 –&gt; 01:17:58,399<br>I hope this was useful, particularly still and time for, you know, to see in 2d.</p>
<p>692<br>01:17:58,399 –&gt; 01:18:06,399<br>And maybe there’s some ideas here that might be useful for you in implementing those laps.</p>
<p>693<br>01:18:06,399 –&gt; 01:18:15,399<br>I have a question about like what kind of ranges for election timeouts people used.</p>
<p>694<br>01:18:15,399 –&gt; 01:18:27,399<br>I think I use like, you know, the lower the limit of like 100 milliseconds for the heartbeat and then time out anywhere between like 300 and 700 milliseconds.</p>
<p>695<br>01:18:27,399 –&gt; 01:18:37,399<br>I don’t know if that’s like totally reasonable. I usually live a bigger number correct like the stranger we gave you is that you know, you should be able to elect a leader in the five seconds.</p>
<p>696<br>01:18:37,399 –&gt; 01:18:43,399<br>And that means you should count on and you may have to run the election couple times.</p>
<p>697<br>01:18:43,399 –&gt; 01:18:51,399<br>And so you know, the numbers you pick seems reasonable.</p>
<p>698<br>01:18:51,399 –&gt; 01:19:11,399<br>Any people that want to share a particular annoying bug that they have actually there were a number of questions where people are asking, what does the most nasty bug that people have seen.</p>
<p>699<br>01:19:11,399 –&gt; 01:19:16,399<br>I had a pretty annoying bug in my implantation.</p>
<p>700<br>01:19:16,399 –&gt; 01:19:25,399<br>I didn’t take my own advice and sort of did a like weird implantation of a timer where I like spawn off.</p>
<p>701<br>01:19:25,399 –&gt; 01:19:36,399<br>I had a new thread to sleep for something and then send a message back at the end. It was not particularly great design. And I had two different timers one for heart beats and one for election timers.</p>
<p>702<br>01:19:36,399 –&gt; 01:19:42,399<br>And I was forgetting to stop the one of those timers when the server shut down.</p>
<p>703<br>01:19:42,399 –&gt; 01:19:54,399<br>One of them was fine. And one of them wasn’t. And it meant I would slowly gain like a number of go routines over the course of a long running test until it ran out and the race sector crashed everything.</p>
<p>704<br>01:19:54,399 –&gt; 01:20:01,399<br>And it was incredibly embarrassing because it was literally just that I forgot to stop a timer.</p>
<p>705<br>01:20:01,399 –&gt; 01:20:18,399<br>So, but it took a very long time to debug because I couldn’t figure out I think I thought there was a bug in the lab RPC code and know there wasn’t no there’s probably no bugs in the lab RPC code. It was just me and misinterpreting data.</p>
<p>706<br>01:20:18,399 –&gt; 01:20:20,399<br>Yep.</p>
<p>707<br>01:20:20,399 –&gt; 01:20:34,399<br>I’m talking about election timeouts. I have an issue on where the one call is called from config.co that were occasionally fails to reach agreement.</p>
<p>708<br>01:20:34,399 –&gt; 01:20:54,399<br>I realized that if I increase my election timeouts to have like the random interval go up to like 1500 milliseconds that like greatly decreases the frequency at which this happens, but I’m wondering if I should go even higher than that for the random interval that this is indicative of another bug I have.</p>
<p>709<br>01:20:54,399 –&gt; 01:20:57,399<br>I think it’s integrated with another bug you have.</p>
<p>710<br>01:20:57,399 –&gt; 01:21:05,399<br>Well, my first guess and I got you know, of course I don’t know for sure at all, but like you don’t have to be able to run that kind of long time.</p>
<p>711<br>01:21:05,399 –&gt; 01:21:08,399<br>To pass.</p>
<p>712<br>01:21:08,399 –&gt; 01:21:19,399<br>Yeah, most of the time when people are tweaking their timeouts, it’s not actually fixing their bugs. It’s just changing how often they show up.</p>
<p>713<br>01:21:19,399 –&gt; 01:21:22,399<br>Okay, thanks.</p>
<p>714<br>01:21:22,399 –&gt; 01:21:24,399<br>Here’s a bug in the channel.</p>
<p>715<br>01:21:24,399 –&gt; 01:21:29,399<br>On the chat channel, I was just bug ahead was that I forgot to initialize the channel.</p>
<p>716<br>01:21:29,399 –&gt; 01:21:34,399<br>How did that manifest itself as a bug?</p>
<p>717<br>01:21:34,399 –&gt; 01:21:41,399<br>Oh, like basically when I was sending something when you able to receive it.</p>
<p>718<br>01:21:41,399 –&gt; 01:21:46,399<br>And I wonder what was going on. It turns out it was just that they didn’t ever make this blind.</p>
<p>719<br>01:21:46,399 –&gt; 01:21:50,399<br>So it’s like the normal channel.</p>
<p>720<br>01:21:50,399 –&gt; 01:21:52,399<br>Hmm.</p>
<p>721<br>01:21:52,399 –&gt; 01:21:56,399<br>I don’t really know what the semantics are over writing to a new channel.</p>
<p>722<br>01:21:56,399 –&gt; 01:22:01,399<br>I can’t recall the top of my head. I know the rules for that, but I don’t remember what the rule is.</p>
<p>723<br>01:22:01,399 –&gt; 01:22:09,399<br>Do you have a comment on the previous point regarding the election timeouts and setting them high?</p>
<p>724<br>01:22:09,399 –&gt; 01:22:14,399<br>Should we try and aim thus to set them a little bit low?</p>
<p>725<br>01:22:14,399 –&gt; 01:22:18,399<br>So that if there are any bugs, we can expose them.</p>
<p>726<br>01:22:18,399 –&gt; 01:22:20,399<br>Oh, yeah, not a bad plan.</p>
<p>727<br>01:22:20,399 –&gt; 01:22:28,399<br>I think it’s always good to like push the boundaries and see if you have any other bugs when I’m learning.</p>
<p>728<br>01:22:28,399 –&gt; 01:22:32,399<br>So the boundaries should be something akin to what the paper suggests.</p>
<p>729<br>01:22:32,399 –&gt; 01:22:37,399<br>Limit higher because the way we set up the tests are slightly different.</p>
<p>730<br>01:22:37,399 –&gt; 01:22:42,399<br>You know, the intersection of each has a discussion on this, correct?</p>
<p>731<br>01:22:42,399 –&gt; 01:22:46,399<br>And actually the rough paper kind of has guidelines.</p>
<p>732<br>01:22:46,399 –&gt; 01:22:50,399<br>And even if they have like a specific value, they set the value based on their guidelines.</p>
<p>733<br>01:22:50,399 –&gt; 01:22:58,399<br>And the guidelines said that you should have kind of elected a leader with like an order of magnitude more time, but what the hype it interval is.</p>
<p>734<br>01:22:58,399 –&gt; 01:23:00,399<br>Yeah, exactly.</p>
<p>735<br>01:23:00,399 –&gt; 01:23:05,399<br>Like 100, like, for example, like if you go to like 800 to a second, like things will work out.</p>
<p>736<br>01:23:05,399 –&gt; 01:23:09,399<br>It’s fine even if those are high because that’s kind of the guidelines.</p>
<p>737<br>01:23:09,399 –&gt; 01:23:20,399<br>It all changes because we just make you change the kind of like they innermost, hard bit frequency because of the RPC that.</p>
<p>738<br>01:23:20,399 –&gt; 01:23:26,399<br>Sorry, can I actually see the hard bit timer in the code?</p>
<p>739<br>01:23:26,399 –&gt; 01:23:34,399<br>Yeah, sure.</p>
<p>740<br>01:23:34,399 –&gt; 01:23:49,399<br>Basically, you know, every 50 milliseconds, the ticker comes off, the ticker comes tick and if I a leader, I’ll basically send an RPC, this comes down to basically a heartbeat.</p>
<p>741<br>01:23:49,399 –&gt; 01:23:58,399<br>So here my implementation every 50 milliseconds, I’m sending a heartbeat.</p>
<p>742<br>01:23:58,399 –&gt; 01:24:00,399<br>I had a question.</p>
<p>743<br>01:24:00,399 –&gt; 01:24:12,399<br>So you were saying like, it should be like timeout should be like an order of magnitude, like greater than heartbeat, right?</p>
<p>744<br>01:24:12,399 –&gt; 01:24:16,399<br>But I started like playing to see how low it could get.</p>
<p>745<br>01:24:16,399 –&gt; 01:24:29,399<br>And you know, I could like with 100 millisecond timeout, you know, it could go down to like three to 500 milliseconds and still work like, you know, without a pitch.</p>
<p>746<br>01:24:29,399 –&gt; 01:24:34,399<br>And I was wondering like, it’s that like why.</p>
<p>747<br>01:24:34,399 –&gt; 01:24:38,399<br>Like how low, you know, how low can they get.</p>
<p>748<br>01:24:38,399 –&gt; 01:24:45,399<br>And why are we making them so much greater than the, like in timeout or than that hard bit time?</p>
<p>749<br>01:24:45,399 –&gt; 01:24:55,399<br>Because we need to really, we need to keep the candidate a shot actually becoming the leader and some of the messages might be delayed for a long time.</p>
<p>750<br>01:24:55,399 –&gt; 01:24:59,399<br>But we’re dropped.</p>
<p>751<br>01:24:59,399 –&gt; 01:25:01,399<br>Yeah.</p>
<p>752<br>01:25:01,399 –&gt; 01:25:11,399<br>I have a question. I think I missed this part, which is how you’re like, which appendentries are sending from start and which ones from the heartbeat.</p>
<p>753<br>01:25:11,399 –&gt; 01:25:15,399<br>They’re the same. It’s the same code.</p>
<p>754<br>01:25:15,399 –&gt; 01:25:16,399<br>Okay.</p>
<p>755<br>01:25:16,399 –&gt; 01:25:23,399<br>There’s nothing different. I only have one. If you look here at this, here, send the pants. Right. This is a little from the ticker.</p>
<p>756<br>01:25:23,399 –&gt; 01:25:24,399<br>Yeah.</p>
<p>757<br>01:25:24,399 –&gt; 01:25:32,399<br>And if you look at the API code, the start function calls the same function.</p>
<p>758<br>01:25:32,399 –&gt; 01:25:40,399<br>But in this case, which which ones are like, if you’re sending all of them from start, which ones are going to be sent from the ticker.</p>
<p>759<br>01:25:40,399 –&gt; 01:25:44,399<br>The ticker probably sends mostly NT.</p>
<p>760<br>01:25:44,399 –&gt; 01:25:46,399<br>A pants.</p>
<p>761<br>01:25:46,399 –&gt; 01:25:47,399<br>Okay.</p>
<p>762<br>01:25:47,399 –&gt; 01:25:50,399<br>So the bulk are coming from start.</p>
<p>763<br>01:25:50,399 –&gt; 01:25:53,399<br>The one is coming from the ticker.</p>
<p>764<br>01:25:53,399 –&gt; 01:25:56,399<br>Or like the actual log entries.</p>
<p>765<br>01:25:56,399 –&gt; 01:26:04,399<br>The actual log entries are all sitting in the struct raft. Right. So they’re coming out of the raft struct.</p>
<p>766<br>01:26:04,399 –&gt; 01:26:08,399<br>And if you look at start, the only thing start does.</p>
<p>767<br>01:26:08,399 –&gt; 01:26:16,399<br>Hold on. Let me go pull up start again. This is a good question. Like you pull start up basically it depends into the log here.</p>
<p>768<br>01:26:16,399 –&gt; 01:26:26,399<br>And that’s all it does. And like the only difference basically between ticker and start is that start actually depends something to the log and the ticker doesn’t do that.</p>
<p>769<br>01:26:26,399 –&gt; 01:26:30,399<br>And send the pants basically grabs, you know, whatever.</p>
<p>770<br>01:26:30,399 –&gt; 01:26:33,399<br>So this is the look for all of them.</p>
<p>771<br>01:26:33,399 –&gt; 01:26:37,399<br>So here’s the individual.</p>
<p>772<br>01:26:37,399 –&gt; 01:26:50,399<br>Here’s the individual one that you sent to one peer and it basically grabs the right log entries out of the, out of the log right here.</p>
<p>773<br>01:26:50,399 –&gt; 01:26:55,399<br>Your cocktails it out of the log into the arcs entries.</p>
<p>774<br>01:26:55,399 –&gt; 01:27:02,399<br>And so if it’s a heartbeat, most likely, this always be zero, not always correct because you might either might have the follow might have missed some.</p>
<p>775<br>01:27:02,399 –&gt; 01:27:10,399<br>But in the case when start calls this, you know, you always be sending the thing that actually just has been a pendant.</p>
<p>776<br>01:27:10,399 –&gt; 01:27:16,399<br>Okay, because I did it that I’m such that I’m sending everything in the heart beats like all the entries.</p>
<p>777<br>01:27:16,399 –&gt; 01:27:27,399<br>And for some of the two CSS sometimes I’ll like fail to reach agreement. I’m wondering if that’s why because here you’re, it seems like the bulk of the entries are being sent in start.</p>
<p>778<br>01:27:27,399 –&gt; 01:27:40,399<br>Okay, that’s might not be the reason why you, I don’t think it will affect reaching agreements from the not dependent on the number of entries you send in the number of walk entries you’re sending in the end of the seat.</p>
<p>779<br>01:27:40,399 –&gt; 01:27:43,399<br>No, no.</p>
<p>780<br>01:27:43,399 –&gt; 01:27:51,399<br>Yeah, I was able to make it all the way through lab 2 with only ever sending appendories from the heartbeat timer.</p>
<p>781<br>01:27:51,399 –&gt; 01:28:03,399<br>You never in promise, slow things down though, like it definitely, it can’t seem slow down to be clear. I don’t recommend doing this, but like you can get through lab 2 with just sending from the heart beats.</p>
<p>782<br>01:28:03,399 –&gt; 01:28:07,399<br>So if you’re right, that’s not so.</p>
<p>783<br>01:28:07,399 –&gt; 01:28:12,399<br>How do the time out or how do the limits on heart beats work?</p>
<p>784<br>01:28:12,399 –&gt; 01:28:20,399<br>Like are the limit on heart beats like the same as a limit on appendentries, RPC or they come to different.</p>
<p>785<br>01:28:20,399 –&gt; 01:28:30,399<br>The heart beats are different. You can send, you know, you have to send it, you know, a principal soon that ever start can reach all in a pen entry call.</p>
<p>786<br>01:28:30,399 –&gt; 01:28:32,399<br>Right.</p>
<p>787<br>01:28:32,399 –&gt; 01:28:36,399<br>And you’re not allowed to send more than 10 hard beats.</p>
<p>788<br>01:28:36,399 –&gt; 01:28:40,399<br>How do you like differentiate that?</p>
<p>789<br>01:28:40,399 –&gt; 01:28:43,399<br>Hard beats have no entries most typically.</p>
<p>790<br>01:28:43,399 –&gt; 01:28:45,399<br>Okay.</p>
<p>791<br>01:28:45,399 –&gt; 01:28:54,399<br>So you literally go in and check like, oh, we don’t really literally check, but we basically see if you make more progress than 10 times a second.</p>
<p>792<br>01:28:54,399 –&gt; 01:29:03,399<br>Like one of the tests in lottery checks if you go quick enough.</p>
<p>793<br>01:29:03,399 –&gt; 01:29:05,399<br>Exactly for this reason.</p>
<p>794<br>01:29:05,399 –&gt; 01:29:13,399<br>We’re being limited to know you’re basically in a real application, correct if you delayed, you know, your depends, you know, by 10 mil by 50 milliseconds before you do anything.</p>
<p>795<br>01:29:13,399 –&gt; 01:29:23,399<br>If a client, you know, imagine a client’s meeting through your service, you know, basically it’s going to get one append operation through every 50 milliseconds.</p>
<p>796<br>01:29:23,399 –&gt; 01:29:30,399<br>That would be not a very desirable service to use.</p>
<p>797<br>01:29:30,399 –&gt; 01:29:38,399<br>I had a question about accessing parts of the RF struct without lock.</p>
<p>798<br>01:29:38,399 –&gt; 01:29:46,399<br>So in centiped entries, you are, you’re reading the peer peers.</p>
<p>799<br>01:29:46,399 –&gt; 01:29:48,399<br>Yeah.</p>
<p>800<br>01:29:48,399 –&gt; 01:30:01,399<br>I guess slides, but I know that it is, it is static, but there, it could be that multiple threads read the same thing twice, right.</p>
<p>801<br>01:30:01,399 –&gt; 01:30:09,399<br>So is, is there a danger of the race, the texture complaining about this?</p>
<p>802<br>01:30:09,399 –&gt; 01:30:12,399<br>Yeah, some echo, sorry, sorry.</p>
<p>803<br>01:30:12,399 –&gt; 01:30:17,399<br>Let me see.</p>
<p>804<br>01:30:17,399 –&gt; 01:30:20,399<br>So let me see.</p>
<p>805<br>01:30:20,399 –&gt; 01:30:24,399<br>So I guess I don’t hold the walk on RF, RF peers.</p>
<p>806<br>01:30:24,399 –&gt; 01:30:27,399<br>Yeah.</p>
<p>807<br>01:30:27,399 –&gt; 01:30:31,399<br>Yeah, the race protectors not complaining.</p>
<p>808<br>01:30:31,399 –&gt; 01:30:49,399<br>So there’s a race detector.</p>
<p>809<br>01:30:49,399 –&gt; 01:30:54,399<br>Sorry, what is that question about whether iterating over peers could cause races.</p>
<p>810<br>01:30:54,399 –&gt; 01:30:56,399<br>Yeah, yeah.</p>
<p>811<br>01:30:56,399 –&gt; 01:31:01,399<br>Accesses it without holding the lock and right.</p>
<p>812<br>01:31:01,399 –&gt; 01:31:04,399<br>Never know.</p>
<p>813<br>01:31:04,399 –&gt; 01:31:06,399<br>New words right.</p>
<p>814<br>01:31:06,399 –&gt; 01:31:09,399<br>You can’t get the race protectors won’t complain.</p>
<p>815<br>01:31:09,399 –&gt; 01:31:13,399<br>What about our dot killed.</p>
<p>816<br>01:31:13,399 –&gt; 01:31:14,399<br>Sorry.</p>
<p>817<br>01:31:14,399 –&gt; 01:31:19,399<br>RF dot killed.</p>
<p>818<br>01:31:19,399 –&gt; 01:31:22,399<br>That is a problem.</p>
<p>819<br>01:31:22,399 –&gt; 01:31:25,399<br>I guess it was just an obscure scenario.</p>
<p>820<br>01:31:25,399 –&gt; 01:31:30,399<br>If you kill it at the same time as doing something else, I’m not sure.</p>
<p>821<br>01:31:30,399 –&gt; 01:31:33,399<br>But that was not like I’ll modify.</p>
<p>822<br>01:31:33,399 –&gt; 01:31:43,399<br>Killed still doesn’t modify peers.</p>
<p>823<br>01:31:43,399 –&gt; 01:31:44,399<br>Yeah.</p>
<p>824<br>01:31:44,399 –&gt; 01:31:46,399<br>Okay. Thank you.</p>
<p>825<br>01:31:46,399 –&gt; 01:31:49,399<br>I’ll see how you do the applied channel thing again.</p>
<p>826<br>01:31:49,399 –&gt; 01:31:50,399<br>You talked about it earlier.</p>
<p>827<br>01:31:50,399 –&gt; 01:31:53,399<br>How you needed to have a walk with the apply channel.</p>
<p>828<br>01:31:53,399 –&gt; 01:31:56,399<br>Not a walk the opposite or sorry.</p>
<p>829<br>01:31:56,399 –&gt; 01:31:58,399<br>What is it?</p>
<p>830<br>01:31:58,399 –&gt; 01:31:59,399<br>Conditioned variable.</p>
<p>831<br>01:31:59,399 –&gt; 01:32:01,399<br>Yeah, condition variable.</p>
<p>832<br>01:32:01,399 –&gt; 01:32:03,399<br>Oh,</p>
<p>833<br>01:32:03,399 –&gt; 01:32:05,399<br>Oh, huh.</p>
<p>834<br>01:32:05,399 –&gt; 01:32:06,399<br>So you have a.</p>
<p>835<br>01:32:06,399 –&gt; 01:32:09,399<br>Oh, what do you do with the condition variable?</p>
<p>836<br>01:32:09,399 –&gt; 01:32:11,399<br>I brought a signal on it.</p>
<p>837<br>01:32:11,399 –&gt; 01:32:13,399<br>So like when.</p>
<p>838<br>01:32:13,399 –&gt; 01:32:15,399<br>When the.</p>
<p>839<br>01:32:15,399 –&gt; 01:32:19,399<br>Match index is updated and a new entry needs to be committed.</p>
<p>840<br>01:32:19,399 –&gt; 01:32:22,399<br>That threat will call signal.</p>
<p>841<br>01:32:22,399 –&gt; 01:32:26,399<br>And that will wake up the apply a threat and apply a threat.</p>
<p>842<br>01:32:26,399 –&gt; 01:32:30,399<br>We’ll see if there’s anything that needs to be pushed on the.</p>
<p>843<br>01:32:30,399 –&gt; 01:32:32,399<br>Apply channel, which is the checks here.</p>
<p>844<br>01:32:32,399 –&gt; 01:32:35,399<br>And if so, we will push it on the apply channel.</p>
<p>845<br>01:32:35,399 –&gt; 01:32:37,399<br>Oh, okay.</p>
<p>846<br>01:32:37,399 –&gt; 01:32:39,399<br>And if there’s nothing to be pushed on the apply channel anymore,</p>
<p>847<br>01:32:39,399 –&gt; 01:32:41,399<br>we’ll have to sleep.</p>
<p>848<br>01:32:41,399 –&gt; 01:32:42,399<br>Okay.</p>
<p>849<br>01:32:48,399 –&gt; 01:32:50,399<br>Okay.</p>
<p>850<br>01:32:50,399 –&gt; 01:32:59,399<br>Maybe this is it for today.</p>
<p>851<br>01:32:59,399 –&gt; 01:33:00,399<br>Okay.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MIT6824 P8Lecture8 Lab2A_2BQA</div>
      <div>http://example.com/2025/10/25/MIT6824 P8Lecture8-Lab2A_2BQA/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/25/PrincetonAlgorithms%20P103Part210-03_regular-expressions/" title="PrincetonAlgorithms P103Part210 03_regular Expressions">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">PrincetonAlgorithms P103Part210 03_regular Expressions</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/25/MIT6824%20P9Lecture9-Zookeeper/" title="MIT6824 P9Lecture9 Zookeeper">
                        <span class="hidden-mobile">MIT6824 P9Lecture9 Zookeeper</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
